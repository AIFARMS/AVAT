(this.webpackJsonpavat=this.webpackJsonpavat||[]).push([[0],{456:function(e){e.exports=JSON.parse('[{"src":"/assets/tensorflow.gif","altText":"Model assisted annotation","description":"Supports integration with pre-trained Tensorflow models to accelerate annotation","slide_time":10000},{"src":"/assets/add_remove.gif","altText":"Quickly add and remove annotations","description":"Add and remove annotations with ease with individual edits or whole frame edits","slide_time":8000},{"src":"/assets/segmentation.png","altText":"Segmentation","description":"Multiple dots across an object to help train AI models to identify objects in frame. This annotation can be coupled with behavior data.","slide_time":4000},{"src":"/assets/bounding_box.png","altText":"Bounding Box","description":"Rectangle that serves as a point of refrence for training object detection AI models. This annotation can be coupled with behavior data.","slide_time":4000},{"src":"/assets/annotation_count.png","altText":"Keep track of multiple annotations accross frames","description":"Full frame data summary helps keep track of multiple annotations by local and global id.","slide_time":4000},{"src":"/assets/youtube.png","altText":"Video Support","description":"Supports videos from Local Files, Youtube, Vimeo and Dailymotion","slide_time":4000}]')},463:function(e,t,a){e.exports=a(628)},468:function(e,t,a){},469:function(e,t,a){},493:function(e,t){},494:function(e,t){},495:function(e,t){},507:function(e,t){},508:function(e,t){},516:function(e,t){},526:function(e,t){},625:function(e,t){},628:function(e,t,a){"use strict";a.r(t);var n=a(1),o=a.n(n),l=a(66),i=a.n(l),r=(a(468),a(469),a(205)),c=a.n(r),s=(a(133),a(6)),u=a(198),d=a(8),m=a(9),f=a(134).fabric,h=function(){function e(t,a,n,o,l,i,r){Object(d.a)(this,e),this.top=t,this.left=a,this.id=i,this.behavior=r,this.color=l,this.width=n,this.height=o}return Object(m.a)(e,[{key:"rectangle",value:function(){return new f.Rect({hasRotatingPoint:!1,height:this.height,width:this.width,fill:this.color,opacity:".4",top:this.top,left:this.left})}},{key:"id_text",value:function(){return new f.Text(this.id.toString(),{fontSize:20,top:this.top,left:this.left,uniScaleTransform:!1})}},{key:"generate_no_behavior",value:function(e){var t=new f.Group([this.rectangle(),this.id_text()],{borderColor:"#000000",hasBorders:!0,uniScaleTransform:!0});e.on({"object:scaling":function(e){var t=e.target.item(1),a=e.target,n=a.width/(a.width*a.scaleX),o=a.height/(a.height*a.scaleY);t.set("scaleX",n),t.set("scaleY",o)}});var a=this.id;return t.local_id=a,e.add(t),t.toJSON()}},{key:"generate_mouse_no_behavior",value:function(e){var t,a,n,o;new f.Text(this.id.toString(),{fontSize:20,top:this.top,left:this.left,uniScaleTransform:!1});e.on("mouse:down",(function(l){a=!0;var i=e.getPointer(l.e);n=i.x,o=i.y;i=e.getPointer(l.e);var r=new f.Rect({left:n,top:o,originX:"left",originY:"top",width:i.x-n,height:i.y-o,angle:0,fill:"rgba(255,0,0,0.5)",transparentCorners:!1,uniScaleTransform:!0});t=r,e.add(t)})),e.on("mouse:move",(function(l){if(a){var i=e.getPointer(l.e);n>i.x&&t.set({left:Math.abs(i.x)}),o>i.y&&t.set({top:Math.abs(i.y)}),t.set({width:Math.abs(n-i.x)}),t.set({height:Math.abs(o-i.y)}),e.renderAll()}})),e.on("mouse:up",(function(t){a=!1,e.off("mouse:down"),e.off("mouse:up")}))}}]),e}(),g=a(134).fabric,p=(a(219),function(){function e(t,a,n){Object(d.a)(this,e),this.frame_data=t.annotations,this.annotation_data=t.behavior_data,this.canvas=a,this.metadata=t.vid_metadata}return Object(m.a)(e,[{key:"get_frame_data",value:function(){return 1==this.check_legacy()?(alert("Legacy format detected - when exporting the format will be changed to the latest version automatically."),this.frame_data):this.scale_annotations()}},{key:"get_annotation_data",value:function(){return this.annotation_data}},{key:"check_legacy",value:function(){for(var e=0;e<this.frame_data.length;e++){var t=this.frame_data[e];if(null!=t&&void 0!==t.objects)return!0}return console.log("false"),!1}},{key:"scale_annotations",value:function(){var e=[];console.log(this.frame_data);for(var t=0;t<this.frame_data.length;t++){var a=[],n=this.frame_data[t];if(null!=n){for(var o=0;o<n.length;o++)if("bounding_box"===n[o].type){var l=parseInt(n[o].x)/parseInt(this.metadata.horizontal_res)*this.canvas.width,i=n[o].y/this.metadata.vertical_res*this.canvas.height,r=n[o].width/this.metadata.horizontal_res*this.canvas.width,c=n[o].height/this.metadata.vertical_res*this.canvas.height,s="#"+((1<<24)*Math.random()|0).toString(16),u=new h(i,l,r,c,s,n[o].local_id,"None").generate_no_behavior(this.canvas);a.push(u)}else if("segmentation"===n[o].type){for(var d=[],m=n[o].points,f=0;f<m.length;f++){var p=parseInt(m[f].x)/parseInt(this.metadata.horizontal_res)*this.canvas.width,v=m[f].y/this.metadata.vertical_res*this.canvas.height;d.push({x:p,y:v})}console.log(d);var b=new g.Polygon(d,{strokeWidth:1,stroke:"green",opacity:.5,scaleX:1,scaleY:1,objectCaching:!1,transparentCorners:!1,cornerColor:"blue",originX:"center",originY:"center"}),y=new g.Text(n[o].local_id,{fontSize:20,centerX:"center",top:d[0].y,left:d[0].x,uniScaleTransform:!1,fill:"white"}),_=new g.Group([b,y],{perPixelTargetFind:!0});console.log(_),_.lockMovementY=!0,_.lockMovementX=!0,_.selectable=!1,this.canvas.add(_),a.push(_)}e.push(a)}else e.push([])}return console.log(e),e}}]),e}()),v=(a(134).fabric,a(134).fabric);a(219);function b(e,t,a){var n=a.points[this.pointIndex].x-a.pathOffset.x,o=a.points[this.pointIndex].y-a.pathOffset.y;return v.util.transformPoint({x:n,y:o},v.util.multiplyTransformMatrices(a.canvas.viewportTransform,a.calcTransformMatrix()))}function y(e,t,a,n){var o=t.target,l=o.controls[o.__corner],i=o.toLocalPoint(new v.Point(a,n),"center","center"),r=o._getNonTransformedDimensions(),c=o._getTransformedDimensions(0,0),s={x:i.x*r.x/c.x+o.pathOffset.x,y:i.y*r.y/c.y+o.pathOffset.y};return o.points[l.pointIndex]=s,!0}function _(e){var t=e.getActiveObject();if(console.log(t),void 0!=t&&null!=t){var a;if("group"===t.type){a=t._objects[0];var n=t._objects[1].text;a.local_id=n,t.destroy(),e.remove(t),e.add(a)}else"polygon"===t.type&&(a=t);if(e.setActiveObject(a),a.edit=!a.edit,a.edit){var o=a.points.length-1;a.cornerStyle="circle",a.cornerColor="rgba(0,0,255,1)",a.controls=a.points.reduce((function(e,t,a){var n,l;return e["p"+a]=new v.Control({positionHandler:b,actionHandler:(n=a>0?a-1:o,l=y,function(e,t,a,o){var i=t.target,r=v.util.transformPoint({x:i.points[n].x-i.pathOffset.x,y:i.points[n].y-i.pathOffset.y},i.calcTransformMatrix()),c=l(e,t,a,o),s=(i._setPositionDimensions({}),i._getNonTransformedDimensions()),u=(i.points[n].x-i.pathOffset.x)/s.x,d=(i.points[n].y-i.pathOffset.y)/s.y;return i.setPositionByOrigin(r,u+.5,d+.5),c}),actionName:"modifyPolygon",pointIndex:a}),e}),{})}else{a.cornerColor="blue",a.cornerStyle="rect",a.controls=v.Object.prototype.controls,void 0==a.local_id&&alert("Error - missing poly.local_id. Please report this bug in the bug tracker and the steps taken to reproduce this.");var l=a.get("points"),i=new v.Polygon(l,{strokeWidth:1,stroke:"green",opacity:.5,scaleX:1,scaleY:1,objectCaching:!1,transparentCorners:!1,cornerColor:"blue",originX:"center",originY:"center"}),r=new v.Text(a.local_id.toString(),{fontSize:20,top:a.points[0].y,left:a.points[0].x,uniScaleTransform:!1,fill:"white"}),c=new v.Group([i,r]);c.local_id=a.local_id,c.lockMovementY=!0,c.lockMovementX=!0,c.selectable=!0,e.remove(a),e.add(c),console.log(e.getObjects())}a.hasBorders=!a.edit,e.requestRenderAll()}else alert("Please select a segmentation")}var E=a(134).fabric,w=a(219),O=function(){function e(){Object(d.a)(this,e)}return Object(m.a)(e,[{key:"generate_polygon",value:function(e,t,a){var n,o=!0,l=new Array,i=new Array,r=!1,c=!1;e.forEachObject((function(e){e.selectable=!1})),e.selection=!1;var s=new function(){e.on("mouse:down",(function(e){e.target&&e.target.id===l[0].id&&0==c&&(s.polygon.generatePolygon(l),c=!0),o&&s.polygon.addPoint(e)})),e.on("mouse:up",(function(e){})),e.on("mouse:move",(function(t){if(n&&"line"==n.class){var a=e.getPointer(t.e,!1);n.set({x2:a.x,y2:a.y});var o=r.get("points");o[l.length]={x:a.x,y:a.y},r.set({points:o}),e.renderAll()}}))};s.polygon={drawPolygon:function(){o=!0,l=new Array,i=new Array},addPoint:function(t){var a=e.getPointer(t.e,!1),o=Math.floor(999901*Math.random())+99,c=(new Date).getTime()+o,s=new E.Circle({id:c,radius:2,fill:"#ffffff",stroke:"#333333",strokeWidth:.5,left:a.x,top:a.y,selectable:!1,hasBorders:!1,hasControls:!1,originX:"center",originY:"center",objectCaching:!1});s.selectable=!1,0===l.length?s.set({fill:"red",zindex:1}):s.set({zindex:0});var u=[a.x,a.y,a.x,a.y],d=new E.Line(u,{strokeWidth:2,fill:"#999999",stroke:"#999999",class:"line",originX:"center",originY:"center",selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1});if(r){(u=r.get("points")).push({x:a.x,y:a.y});var m=new E.Polygon(u,{stroke:"#333333",strokeWidth:1,fill:"#cccccc",opacity:.3,selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1});e.remove(r),e.add(m),r=m,e.renderAll()}else{var f=[{x:a.x,y:a.y}];console.log(f);m=new E.Polygon(f,{stroke:"#333333",strokeWidth:1,fill:"#cccccc",opacity:.3,selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1});r=m,e.add(m)}n=d,l.push(s),i.push(d),e.add(s),e.selection=!1},generatePolygon:function(l){var c=new Array;w.each(l,(function(t,a){c.push({x:a.left,y:a.top}),e.remove(a)})),w.each(i,(function(t,a){e.remove(a)})),console.log(l),console.log(i);var s=new E.Polygon(c,{strokeWidth:1,stroke:"green",opacity:.5,scaleX:1,scaleY:1,objectCaching:!1,transparentCorners:!1,cornerColor:"blue",originX:"center",originY:"center"});s.local_id=t,s.lockMovementY=!0,s.lockMovementX=!0,console.log(t),console.log(s),e.remove(r),a();var u=new E.Text(t.toString(),{fontSize:20,centerX:"center",top:l[0].top,left:l[0].left,uniScaleTransform:!1,fill:"white"}),d=new E.Group([s,u],{perPixelTargetFind:!0,hasControls:!1,hasBorders:!1});d.lockMovementY=!0,d.lockMovementX=!0,d.selectable=!0,d.local_id=t,console.log(d),e.add(d),console.log(d._objects[0]),console.log(d),e.remove(n),e.remove(r),n=null,r=null,o=!1,e.forEachObject((function(e){e.selectable=!0}))}}}}]),e}(),k=a(195),j=a.n(k),C=[{value:"Feeding",label:"Feeding"},{value:"Drinking",label:"Drinking"},{value:"Exploratory",label:"Exploratory"},{value:"Social",label:"Social"},{value:"Locomotion",label:"Locomotion"},{value:"Proximity",label:"Proximity"},{value:"Others",label:"Others"}],S=[{value:"Lying",label:"Lying"},{value:"Sitting",label:"Sitting"},{value:"Kneeling",label:"Kneeling"},{value:"Standing",label:"Standing"}],x=[{value:"Unambigous",label:"Unambigous"},{value:"Reliable",label:"Reliable"},{value:"Seperated",label:"Seperated"},{value:"Part-missing",label:"Part-missing"},{value:"Suspected",label:"Suspected"}],T=a(36),A=function(e){return[{dataField:"id",text:"ID",headerStyle:function(){return{width:"40px",left:0}},editable:!1},{dataField:"global_id",text:"Glo",headerStyle:function(){return{width:"70px",left:0}}},{dataField:"posture",text:"Posture",editor:{type:k.Type.SELECT,options:S}},{dataField:"behavior",text:"Behavior",editor:{type:k.Type.SELECT,options:C}},{dataField:"confidence",text:"Confidence",editor:{type:k.Type.SELECT,options:x}},{dataField:"remove",text:"Del",editable:!1,headerStyle:function(){return{width:"50px",left:0}},headerFormatter:function(){return o.a.createElement("div",null,"Del",o.a.createElement(T.a,{className:"btn btn-danger btn-xs",onClick:function(){return e()},label:"Del"}))},formatter:function(t,a){return o.a.createElement("div",null,o.a.createElement(T.a,{className:"btn btn-danger btn-xs",onClick:function(){return e(a.id)},label:"Del"}))}}]},I=a(164),M=a(158),R=a(640),N=a(194),D=a(62),P=a(48),F=a(641),B=a(45),V=a(287),U=a.n(V);a(330);function L(){return o.a.createElement("div",null,o.a.createElement("h3",null,"Keybinds:"),"There are preset keybinds setup to make it easier to use the tool without having to click around. If done properly a combination of mouse and keyboard actions speed up the annotation process.",o.a.createElement("br",null),o.a.createElement("br",null),"* ",o.a.createElement("kbd",null,"1")," : Mode Switch: Behavior",o.a.createElement("br",null),"* ",o.a.createElement("kbd",null,"2")," : Mode Switch: Bounding Box",o.a.createElement("br",null),"* ",o.a.createElement("kbd",null,"3")," : Mode Switch: Segmentation",o.a.createElement("br",null),"* ",o.a.createElement("kbd",null,"a")," : Add annotation",o.a.createElement("br",null),"* ",o.a.createElement("kbd",null,"e")," : Skip forward frame(s)",o.a.createElement("br",null),"* ",o.a.createElement("kbd",null,"q")," : Skip backward frame(s)",o.a.createElement("br",null),"* ",o.a.createElement("kbd",null,"w")," : Pause/Play",o.a.createElement("br",null),"* ",o.a.createElement("kbd",null,"c")," : Copy previous annotation",o.a.createElement("br",null),"* ",o.a.createElement("kbd",null,"f")," : Activate/Deactivate scrub mode (Activated by default)",o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("h3",null,"Uploading Video:"),'Ensure that you know the framerate of the video chosen to be annotated. These values should be entered into the settings tab into their "frame rate" fields.',o.a.createElement("br",null),o.a.createElement("br",null),"Click on the right side browse button. All other buttons on the screen shuold be disabled until the video has been uploaded. Currenntly ```.mp4``` format is the best choice and tested for. Other file types such as .avi are supported but might have unintended bugs.",o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("h3",null,"Annotations"),o.a.createElement("br",null),"There are currently three kinds of annotations.",o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("h4",null,"Behavior Annotation:"),"This is for having annotations that do not have any visual attribute attached to it. This annotation is also attached by default when the bounding box or segmentation annotation is created.",o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("h4",null,"Bounding Box:"),"This forms a square around the desired object. There should be small squares at the edges of the bounding box which can be used to resize the box. The number on the top left of the box is used to identify the placement of the box in the table to the right.",o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("h4",null,"Segmentation:"),'Upon generating this each click on the video generates a point which eventually will transform to a set of interconnected points. To complete the polygon click on the original point generated (which is the red colored point) If there is a need to edit, then click on the "Edit Seg" button to start the editing process.')}var z=a(10),Y=a.n(z),K=a(16);function X(e,t,a,n,o){return J.apply(this,arguments)}function J(){return(J=Object(K.a)(Y.a.mark((function e(t,a,n,o,l){var i,r,c,s,u;return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="generated_annotations",""!==t&&""!==a&&(i=t.split(".").slice(0,-1).join(".")+"_"+a),console.log(o),r=JSON.stringify({vid_metadata:l,annotations:n,behavior_data:o}),c=new Blob([r],{type:"application/json"}),e.next=7,URL.createObjectURL(c);case 7:s=e.sent,(u=document.createElement("a")).href=s,u.download=i+".json",document.body.appendChild(u),u.click(),document.body.removeChild(u);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e,t){console.log(t);for(var a=new Array(e.length+1),n=0;n<a.length;n++)a[n]=[];a[0].push("frame_num");for(n=0;n<t.length;n++)a[0].push(t[n].dataField);for(n=0;n<e.length;n++){for(var o=0;o<e[n].length;o++){a[n+1][o]=[];var l=e[n][o],i=Object.keys(l).map((function(e){return l[e]}));a[n+1][o]=n+","+i.join(",")}a[n+1]=a[n+1].join("\n")}return a=a.join("\n")}function W(){return(W=Object(K.a)(Y.a.mark((function e(t,a,n,o){var l,i,r,c,s;return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l="generated_annotations",""!==t&&""!==a&&(l=t.split(".").slice(0,-1).join(".")+"_"+a),i=H(n,o("")),r=new Blob([i],{type:"application/octet-stream"}),e.next=6,URL.createObjectURL(r);case 6:c=e.sent,(s=document.createElement("a")).href=c,s.download=l+".csv",document.body.appendChild(s),s.click(),document.body.removeChild(s);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}a(627),a(626);var q=a(321);function G(e){return Z.apply(this,arguments)}function Z(){return(Z=Object(K.a)(Y.a.mark((function e(t){return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return alert("Loading model\nThis might take a second or so..."),e.next=3,q.load();case 3:e.sent.dispose(),q.load({base:t});case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Q=a(536),$=(a(256),a(134).fabric),ee=a(219),te=function(){var e=Object(K.a)(Y.a.mark((function e(){return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"pascal",4,e.next=4,Q.load({base:"pascal",quantizationBytes:4});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function ae(e,t,a,n,o){return ne.apply(this,arguments)}function ne(){return(ne=Object(K.a)(Y.a.mark((function e(t,a,n,o,l){var i;return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=document.getElementsByTagName("video")[0],console.log(i.height),te().then((function(e){return e.segment(i)})).then((function(e){var a=e.segmentationMap,n=e.width,o=e.height;e.legend;console.log(a),console.log(t.getHeight()),console.log(t.getWidth());var l=new ImageData(a,n,o),i=document.createElement("canvas");i.setAttribute("id","_temp_canvas"),i.width=n,i.height=o,i.getContext("2d").putImageData(l,0,0),$.Image.fromURL(i.toDataURL(),(function(e){e.left=0,e.top=0,e.opacity=.5,e.scaleX=t.getHeight()/o,e.scaleY=t.getWidth()/n,t.add(e),e.bringToFront(),i=null,ee("#_temp_canvas").remove(),t.renderAll()}))}));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var oe=function(){function e(t,a,n,o){Object(d.a)(this,e),this.frame_data=t,this.canvas=a,this.metadata=n,this.image_data=o}return Object(m.a)(e,[{key:"get_frame_json",value:function(){console.log(this.frame_data[0][0].get("type"));var e=new Array(this.frame_data.length);console.log(this.metadata);for(var t=0;t<this.frame_data.length;t++){var a=[];if(this.frame_data[t]!=[]){var n=this.frame_data[t];if(void 0!=n){for(var o=0;o<n.length;o++)if(console.log(n[o]._objects),"group"===n[o].get("type"))if("rect"===n[o]._objects[0].type){console.log(n[o]);var l=n[o].left/this.canvas.width*this.metadata.horizontal_res,i=n[o].top/this.canvas.height*this.metadata.vertical_res,r=n[o].width*n[o].scaleX/this.canvas.width*this.metadata.horizontal_res,c=n[o].height*n[o].scaleY/this.canvas.height*this.metadata.vertical_res,s=n[o]._objects[1].text;0!=this.image_data.length?a.push({type:"bounding_box",x:l,y:i,width:r,height:c,local_id:s,"fileName:":this.image_data[t].name,dataType:"image"}):a.push({type:"bounding_box",x:l,y:i,width:r,height:c,local_id:s,"fileName:":this.metadata.name,dataType:"video"})}else if("polygon"===n[o]._objects[0].type){for(var u=n[o]._objects[0].points,d=[],m=0;m<u.length;m++){l=u[m].x/this.canvas.width*this.metadata.horizontal_res,i=u[m].y/this.canvas.height*this.metadata.vertical_res;d.push({x:l,y:i})}s=n[o]._objects[1].text;0!=this.image_data.length?a.push({type:"segmentation",points:d,local_id:s,"fileName:":this.image_data[t].name,dataType:"image"}):a.push({type:"segmentation",points:d,local_id:s,"fileName:":this.metadata.name,dataType:"video"})}e[t]=a}}}return e}},{key:"get_frame_json_fullCanvas",value:function(){var e=new Array(this.frame_data.length);console.log(this.metadata);for(var t=0;t<this.frame_data.length;t++){var a=[];if(this.frame_data[t]!=[]){var n=this.frame_data[t].objects;if(void 0!=n){for(var o=0;o<n.length;o++)if(console.log(n[o]),"group"===n[o].type)if("rect"===n[o].objects[0].type){console.log(n[o]);var l=n[o].left/this.canvas.width*this.metadata.horizontal_res,i=n[o].top/this.canvas.height*this.metadata.vertical_res,r=n[o].width*n[o].scaleX/this.canvas.width*this.metadata.horizontal_res,c=n[o].height*n[o].scaleY/this.canvas.height*this.metadata.vertical_res,s=n[o].objects[1].text;0!=this.image_data.length?a.push({type:"bounding_box",x:l,y:i,width:r,height:c,local_id:s,"fileName:":this.image_data[t].name,dataType:"image"}):a.push({type:"bounding_box",x:l,y:i,width:r,height:c,local_id:s,"fileName:":this.metadata.name,dataType:"video"})}else if("polygon"===n[o].objects[0].type){for(var u=n[o].objects[0].points,d=[],m=0;m<u.length;m++){l=u[m].x/this.canvas.width*this.metadata.horizontal_res,i=u[m].y/this.canvas.height*this.metadata.vertical_res;d.push({x:l,y:i})}s=n[o].objects[1].text;0!=this.image_data.length?a.push({type:"segmentation",points:d,local_id:s,"fileName:":this.image_data[t].name,dataType:"image"}):a.push({type:"segmentation",points:d,local_id:s,"fileName:":this.metadata.name,dataType:"video"})}e[t]=a}}}return e}},{key:"get_frame_coco",value:function(){}}]),e}(),le=a(197),ie=a(644);function re(e,t,a){return ce.apply(this,arguments)}function ce(){return(ce=Object(K.a)(Y.a.mark((function e(t,a,n){var o,l,i,r,c,s,u,d,m,f,h,g,p;return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=document.getElementById("process_vid"),l=o.duration*t,console.log(l),console.log(o.duration),i=document.createElement("canvas"),r=i.getContext("2d"),c=[o.videoWidth,o.videoHeight],s=c[0],u=c[1],i.width=s,i.height=u,d=[],r.drawImage(o,0,0,s,u),m=i.toDataURL(),d.push(m),o.addEventListener("seeked",Object(K.a)(Y.a.mark((function e(){return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:f&&f();case 1:case"end":return e.stop()}}),e)})))),h=1;case 15:if(!(h<l)){e.next=28;break}return g=parseFloat(h/l*o.duration),console.log(g),o.currentTime=g,n((h/(l-1)*100).toFixed(2).toString()+"%completed    |   "+(h+1).toString()+"/"+l.toString()+" frames processed."),e.next=22,new Promise((function(e){return f=e}));case 22:r.drawImage(o,0,0,s,u),p=i.toDataURL(),d.push(p);case 25:h+=a,e.next=15;break;case 28:return e.abrupt("return",d);case 29:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var se=[];function ue(e){var t=Object(n.useState)(!0),a=Object(s.a)(t,2),l=a[0],i=a[1],r=function(){return i(!1)},c=Object(n.useState)(null),u=Object(s.a)(c,2),d=u[0],m=u[1],f=Object(n.useState)(""),h=Object(s.a)(f,2),g=h[0],p=h[1],v=function(e){p(e)};return console.log(se),o.a.createElement(B.a,{show:l,onHide:r,size:"lg"},o.a.createElement(B.a.Header,{closeButton:!0},o.a.createElement(B.a.Title,null,"Processing Video...")),o.a.createElement(B.a.Body,null,o.a.createElement("div",null,o.a.createElement("video",{id:"process_vid",style:{objectFit:"contain",height:"100%",width:"100%"},src:e.video_link}),o.a.createElement(T.a,{onClick:function(t){if(0!==e.frame_rate){a=re(e.frame_rate);m(a),se=a,console.log(a)}else var a=re(15,15,v).then((function(e){m(e),se=e,console.log(e)}))},enable:null!=d},"Process Video"),g,null!=d&&o.a.createElement(le.a,{controls:!0,fade:!0,style:{objectFit:"contain",height:"100%",width:"100%"}},d.map((function(e){return o.a.createElement(le.a.Item,null,"eee",o.a.createElement(ie.a,{className:"mb-5 box-shadow",top:!0,width:"100%"},o.a.createElement(ie.a.Img,{style:{objectFit:"contain",height:"100%",width:"100%"},src:e})))}))))),o.a.createElement(B.a.Footer,null,o.a.createElement(T.a,{variant:"secondary",onClick:r},"Close")))}function de(e){var t=Object(n.useState)(!1),a=Object(s.a)(t,2),l=a[0],i=a[1],r=Object(n.useState)(!0),c=Object(s.a)(r,2),u=c[0],d=c[1],m=Object(n.useState)(0),f=Object(s.a)(m,2),h=f[0],g=f[1],p=Object(n.useState)(0),v=Object(s.a)(p,2),b=v[0],y=v[1],E=Object(n.useState)(0),w=Object(s.a)(E,2),O=(w[0],w[1],Object(n.useState)(0)),k=Object(s.a)(O,2),j=(k[0],k[1],Object(n.useState)(0)),C=Object(s.a)(j,2),S=(C[0],C[1],Object(n.useState)(0)),x=Object(s.a)(S,2),A=x[0],V=x[1],z=Object(n.useState)(""),Y=Object(s.a)(z,2),K=Y[0],J=Y[1],H=Object(n.useState)(""),W=Object(s.a)(H,2),q=W[0],Z=W[1],Q=Object(n.useState)(!1),$=Object(s.a)(Q,2),ee=$[0],te=$[1],ne=Object(n.useState)(!1),le=Object(s.a)(ne,2),ie=le[0],re=le[1],ce=function(){return i(!1)},se=function(){d(!1),te(!0)},de=function(e){"string"===typeof e?(J(e.target.value),console.log(e.target.value)):J(URL.createObjectURL(e.target.files[0]))};return o.a.createElement("div",null,2==ee&&o.a.createElement(ue,{frame_rate:b,video_link:K}),o.a.createElement(B.a,{show:l,onHide:ce,size:"lg"},o.a.createElement(B.a.Header,{closeButton:!0},o.a.createElement(B.a.Title,null,"Instructions")),o.a.createElement(B.a.Body,null,o.a.createElement(L,null)),o.a.createElement(B.a.Footer,null,o.a.createElement(T.a,{variant:"secondary",onClick:ce},"Close"))),o.a.createElement(B.a,{show:u,onHide:se,size:"lg"},o.a.createElement(B.a.Header,{closeButton:!0},o.a.createElement(B.a.Title,null,"Upload")),o.a.createElement(B.a.Body,null,o.a.createElement("div",{style:{display:"grid"}},o.a.createElement(D.a,{style:{float:"left",gridColumn:1,gridRow:1,zIndex:99}},"Video Format:",o.a.createElement(D.a.Control,{as:"select",id:"inlineFormCustomSelect",onChange:function(t){var a;a=t.target.value,console.log(a),0===(a=parseInt(a))?V(0):1===a?V(1):2===a&&(V(2),e.handleInputType(1))},defaultValue:A},o.a.createElement("option",{value:"0"},"Upload"),o.a.createElement("option",{value:"1"},"Youtube"),o.a.createElement("option",{value:"2"},"Image")),o.a.createElement(R.a.Divider,null)),o.a.createElement("div",{style:{float:"left",gridColumn:1,gridRow:2,zIndex:99}},"Annotator Name: ",o.a.createElement("input",{type:"text",defaultValue:e.ANNOTATOR_NAME,onClick:function(t){e.toggleKeyCheck(!1)},onBlur:function(t){e.toggleKeyCheck(!0)},onChange:function(t){e.change_annotator_name(t.target.value)}}),o.a.createElement(R.a.Divider,null)),o.a.createElement("div",{style:{float:"left",gridColumn:1,gridRow:3,zIndex:99}},o.a.createElement("text",null,"Date and Time: "),o.a.createElement(U.a,{selected:h,onChange:function(t){!function(t){g(t);try{e.setDateTime(Math.floor(t.getTime()/1e3))}catch(a){alert("Invalid date input!")}}(t)},timeInputLabel:"Time:",dateFormat:"yyyy/MM/dd hh:mm",showTimeInput:!0,onClick:function(t){e.toggleKeyCheck(!1)},onClickOutside:function(t){e.toggleKeyCheck(!0)},onCalendarOpen:function(t){e.toggleKeyCheck(!1)},onCalendarClose:function(t){e.toggleKeyCheck(!0)}}),o.a.createElement(R.a.Divider,null)),0===A&&o.a.createElement(D.a,{style:{float:"left",gridColumn:1,gridRow:4}},o.a.createElement(D.a.File,{multiple:!0,id:"file",label:"Video Upload",accept:".mp4",custom:!0,type:"file",onChange:function(t){e.handleVideoUpload(t),de(t)}})),1===A&&o.a.createElement("div",null,o.a.createElement("text",null,"Youtube URL: "),o.a.createElement("input",{onChange:de}),o.a.createElement(T.a,{onClick:function(t){e.handleVideoUpload(K)}},"Upload")),2===A&&o.a.createElement(D.a,{style:{float:"left",gridColumn:1,gridRow:4}},o.a.createElement(D.a.File,{multiple:!0,id:"file",label:"Image-set Upload",accept:"image/*",custom:!0,type:"file",onChange:function(t){e.handleVideoUpload(t),de(t)}})),o.a.createElement(D.a,{style:{float:"left",gridColumn:1,gridRow:5}},o.a.createElement(D.a.File,{disabled:e.disable_buttons,accept:".json",id:"file",label:"Annotation Upload",custom:!0,type:"file",onChange:e.handleOldAnnotation})),o.a.createElement(R.a.Divider,null),"Frame Rate: ",o.a.createElement("input",{type:"number",value:e.frame_rate,onClick:function(t){e.toggleKeyCheck(!1)},onBlur:function(t){e.toggleKeyCheck(!0)},onChange:function(t){e.setFrameRate(parseInt(t.target.value)),y(parseInt(t.target.value))}}),o.a.createElement(R.a.Divider,null),"Skip Value: ",o.a.createElement("input",{type:"number",defaultValue:"1",onChange:function(t){e.change_skip_value(parseInt(t.target.value))}}),"Playback Rate: ",o.a.createElement("input",{type:"number",defaultValue:"1",onChange:function(t){e.handleSetPlaybackRate(parseInt(t.target.value))}}),o.a.createElement(R.a.Divider,null),o.a.createElement("div",null,"Enable Object Detection Model:"," ",o.a.createElement("select",{defaultValue:q,onChange:function(e){Z(e.target.value)},id:"base_model"},o.a.createElement("option",{value:""},"Select"),o.a.createElement("option",{value:"lite_mobilenet_v2"},"SSD Lite Mobilenet V2"),o.a.createElement("option",{value:"mobilenet_v1"},"SSD Mobilenet v1"),o.a.createElement("option",{value:"mobilenet_v2"},"SSD Mobilenet v2"))," ",o.a.createElement(T.a,{size:"sm",variant:"outline-success",onClick:function(e){""===q&&alert("Please select a model"),G(q)}},"Enable")),o.a.createElement(R.a.Divider,null))),o.a.createElement(B.a.Footer,null,o.a.createElement(T.a,{variant:"success",onClick:se},"Upload"))),o.a.createElement(I.a,{sticky:"top",bg:"dark",variant:"dark",className:"bg-5"},o.a.createElement(I.a.Brand,{href:"#home"},"AVAT"),o.a.createElement(M.a,{className:"mr-auto"},o.a.createElement(R.a,{disabled:e.disable_buttons,title:"Export",id:"basic-nav-dropdown"},o.a.createElement(R.a.Item,{onClick:function(){var t=new oe(e.frame_data,e.fabricCanvas,e.VIDEO_METADATA,e.image_frames).get_frame_json();X(e.ANNOTATION_VIDEO_NAME,e.ANNOTATOR_NAME,t,e.annotation_data,e.VIDEO_METADATA)}},"JSON"),o.a.createElement(R.a.Divider,null)),o.a.createElement(N.a,{onClick:function(){return i(!0)}},"Instructions"),o.a.createElement(N.a,{onClick:e.handle_link_open},"Report")),o.a.createElement("div",null,q.length>0&&o.a.createElement(T.a,{id:"run",variant:"outline-info",onClick:function(t){ae(e.fabricCanvas,e.annotation_data,e.currentFrame,e.save_data,e.handle_visual_toggle),e.handle_visual_toggle()}},"Run model"),o.a.createElement(T.a,{variant:"outline-success",onClick:function(){return d(!0)}},"Upload")," ",o.a.createElement(T.a,{variant:"outline-success",onClick:function(t){re(!ie),_(e.fabricCanvas,e.save_data),e.toggle_segmentation(),e.save_data()}},"Edit Seg")," ",o.a.createElement(P.a,{as:F.a},o.a.createElement(T.a,{variant:"secondary",disabled:!0},e.display_frame_num)," ",o.a.createElement(P.a.Toggle,{split:!0,variant:"secondary",id:"dropdown-split-basic"}),o.a.createElement(P.a.Menu,null,"Skip Value: ",o.a.createElement("input",{type:"number",defaultValue:"1",onChange:function(t){e.change_skip_value(parseInt(t.target.value))}}),"Playback Rate: ",o.a.createElement("input",{type:"number",defaultValue:"1",onChange:function(t){e.handleSetPlaybackRate(parseInt(t.target.value))}})))," ",o.a.createElement(T.a,{variant:"primary",disabled:e.disable_buttons,onClick:e.skip_frame_backward},"Prev")," ",o.a.createElement(T.a,{variant:"primary",disabled:e.disable_buttons,onClick:e.handlePlaying},e.play_button_text)," ",o.a.createElement(T.a,{variant:"primary",disabled:e.disable_buttons,onClick:e.skip_frame_forward},"Next")," ",o.a.createElement(P.a,{as:F.a,drop:"left"},o.a.createElement(T.a,{variant:"success",onClick:e.addToCanvas},"Add"),o.a.createElement(P.a.Toggle,{split:!0,variant:"success",id:"dropdown-split-basic"}),o.a.createElement(P.a.Menu,null,o.a.createElement(P.a.Item,{onClick:function(t){e.change_annotation_type("1")}},"Behavior Annotation"),o.a.createElement(P.a.Item,{onClick:function(t){e.change_annotation_type("2")}},"BoundingBox"),o.a.createElement(P.a.Item,{onClick:function(t){e.change_annotation_type("3")}},"Segmentation"))))))}var me=a(57),fe=a(56),he=function(e){Object(me.a)(a,e);var t=Object(fe.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=i.a.findDOMNode(this);this.props.fabricCanvas.initialize(t,{height:this.props.scaling_factor_height,width:this.props.scaling_factor_width,backgroundColor:null}),this.props.fabricCanvas.on("mouse:up",(function(){e.props.save_data(e.props.currentFrame)})),this.props.fabricCanvas.on("object:added",this.props.save_data(this.props.currentFrame)),this.props.fabricCanvas.on("object:removed",this.props.save_data(this.props.currentFrame)),this.props.fabricCanvas.on("object:modified",this.props.save_data(this.props.currentFrame)),this.props.fabricCanvas.on("saveData",(function(){e.props.fabricCanvas.renderAll()}))}},{key:"render",value:function(){return o.a.createElement("canvas",{id:"canvas"})}}]),a}(o.a.Component),ge=a(322),pe=a.n(ge),ve=(a(614),a(323)),be=a.n(ve),ye=a(455),_e=a(324),Ee=a(454);function we(e){var t,a={onlyOneExpanding:!0,renderer:function(t,a){return o.a.createElement("div",null,o.a.createElement(Ee.a,{as:"textarea","aria-label":"With textarea",defaultValue:e.annotation_data[e.currentFrame][a].notes,onChange:function(e){n(e,a)},onClick:function(t){e.toggleKeyCheck(!1)},onBlur:function(t){e.toggleKeyCheck(!0)}}))}},n=function(t,a){console.log(e.annotation_data[e.currentFrame]),e.annotation_data[e.currentFrame][a].notes=t.target.value,console.log(e.annotation_data[e.currentFrame])},l=function(e){for(var t=[],a=0;a<e.length;a++)if(0!==e[a].length){for(var n="",o="",l=0;l<e[a].length;l++)n+=e[a][l].id+", ",o+=e[a][l].global_id+", ";t.push({frame_num:a,anno_count:e[a].length,local_ids:n,global_ids:o})}return t}(e.annotation_data);return o.a.createElement(ye.a,{defaultActiveKey:"home",id:"uncontrolled-tab-example"},o.a.createElement(_e.a,{eventKey:"home",title:"Current"},o.a.createElement(pe.a,{keyField:"id",data:e.annotation_data[e.currentFrame],columns:e.columns(e.remove_table_index),table:!0,noDataIndication:function(){return o.a.createElement("div",null,"No recorded annotations or behaviors for this frame",o.a.createElement("br",null),"Please add an annotation or behavior tag to start.")},cellEdit:j()({mode:"click",blurToSave:!0,afterSaveCell:function(t,a,n,o){console.log(n),e.toggleKeyCheck(!0)},onStartEdit:function(t,a,n,o){e.toggleKeyCheck(!1)}}),pagination:be()(),expandRow:a})),o.a.createElement(_e.a,{eventKey:"profile",title:"Previous"},o.a.createElement(pe.a,{keyField:"frame_num",data:l,columns:(t=e.handleSetCurrentFrame,[{dataField:"frame_num",text:"Frame",headerStyle:function(){return{width:"40px",left:0}}},{dataField:"anno_count",text:"Count",headerStyle:function(){return{width:"40px",left:0}}},{dataField:"local_ids",text:"Local ID",headerStyle:function(){return{width:"40px",left:0}}},{dataField:"global_ids",text:"Global ID",headerStyle:function(){return{width:"40px",left:0}}},{dataField:"swap",text:"Swap",editable:!1,headerStyle:function(){return{width:"50px",left:0}},formatter:function(e,a){return o.a.createElement(T.a,{className:"btn btn-confirm btn-xs",label:"Del",onClick:function(){t(a.frame_num)}},"Skip")}}]),table:!0,noDataIndication:function(){return o.a.createElement("div",null,"No recorded annotations or behaviors for this video.")},pagination:be()()})))}"undefined"===typeof Storage&&alert("Your browser does not support local storage. \nSome autosaving features of the app will not work as intended.\nPlease see the documentation to find supported browsers and their versions");var Oe=a(134).fabric,ke=15,je=-1,Ce=1920,Se=1080,xe=1;console.log(window.screen.width),console.log(window.screen.height);var Te=window.screen.height;Te>=1080?(Ce=1280,Se=720):Te>=1024?(Ce=1152,Se=648):Te>=768&&(Ce=1024,Se=576);var Ae,Ie,Me=new Oe.Canvas("c",{uniScaleTransform:!0,uniformScaling:!1,includeDefaultValues:!1});Me.on("mouse:over",(function(e){null==e.target|1==He||void 0!=e.target._objects&&(Ie=e.target._objects[0].get("fill"),e.target._objects[0].set("fill","#39FF14"),Me.renderAll())})),Me.on("mouse:out",(function(e){null==e.target|1==He||void 0!=e.target._objects&&(e.target._objects[0].set("fill",Ie),Me.renderAll())})),Oe.Image.prototype.toObject=(Ae=Oe.Image.prototype.toObject,function(){return Oe.util.object.extend(Ae.call(this),{src:this.toDataURL()})}),Me.on("mouse:wheel",(function(e){var t=e.e.deltaY,a=Me.getZoom();(a*=Math.pow(.999,t))>20&&(a=20),a<.01&&(a=.01),Me.zoomToPoint({x:e.e.offsetX,y:e.e.offsetY},a),e.e.preventDefault(),e.e.stopPropagation()})),Me.on("mouse:down",(function(e){var t=e.e;!0===t.altKey&&(this.isDragging=!0,this.selection=!1,this.lastPosX=t.clientX,this.lastPosY=t.clientY)})),Me.on("mouse:move",(function(e){if(this.isDragging){var t=e.e,a=this.viewportTransform;a[4]+=t.clientX-this.lastPosX,a[5]+=t.clientY-this.lastPosY,this.requestRenderAll(),this.lastPosX=t.clientX,this.lastPosY=t.clientY}})),Me.on("mouse:up",(function(e){this.setViewportTransform(this.viewportTransform),this.isDragging=!1,this.selection=!0}));var Re,Ne=0,De=0,Pe=[[]],Fe=[[]],Be=!1,Ve=!0,Ue="",Le="",ze="",Ye={},Ke="ERROR",Xe=!1,Je=0,He=!1,We=!1,qe=[],Ge=0;function Ze(e){0!=Me.getObjects().length?(Pe[e]=Me.getObjects(),Pe[e].backgroundImage=null):Pe[e]=[],console.log("SAVED")}function Qe(){var e=Object(n.useState)(0),t=Object(s.a)(e,2),a=(t[0],t[1]),l=Object(n.useState)("1"),i=Object(s.a)(l,2),r=i[0],d=i[1],m=Object(n.useState)(0),f=Object(s.a)(m,2),g=f[0],v=f[1],b=Object(n.useState)(null),y=Object(s.a)(b,2),_=y[0],E=y[1],w=Object(n.useState)(null),k=Object(s.a)(w,2),j=(k[0],k[1],Object(n.useState)(null)),C=Object(s.a)(j,2),S=C[0],x=C[1],T=Object(n.useState)(null),I=Object(s.a)(T,2),M=I[0],R=I[1],N=Object(n.useState)(0),D=Object(s.a)(N,2),P=D[0],F=D[1],B=Object(n.useState)(!1),V=Object(s.a)(B,2),U=(V[0],V[1],Object(n.useState)(!1)),L=Object(s.a)(U,2),z=L[0],Y=L[1],K=Object(n.useState)(!1),X=Object(s.a)(K,2),J=(X[0],X[1],Object(n.useState)(!1)),H=Object(s.a)(J,2),W=H[0],q=H[1],G=Object(n.useState)(!0),Z=Object(s.a)(G,2),Q=Z[0],$=Z[1],ee=Object(n.useState)(1),te=Object(s.a)(ee,2),ae=te[0],ne=te[1],oe=Object(n.useState)(0),le=Object(s.a)(oe,2),ie=le[0],re=le[1],ce=Object(n.useState)(0),se=Object(s.a)(ce,2),ue=se[0],me=se[1],fe=Object(n.useState)(0),ge=Object(s.a)(fe,2),pe=ge[0],ve=ge[1],be=Object(n.useState)(0),ye=Object(s.a)(be,2),_e=ye[0],Ee=ye[1],Te=Object(n.useState)(A),Ae=Object(s.a)(Te,2);Ae[0],Ae[1];He||Me.forEachObject((function(e){e.selectable=!0,e.evented=!0}));var Ie=function(e){if(Re=P*ke,dt(),"number"===typeof e){me(e),a(Math.floor(999999999999*Math.random()));var t=e/Re;t>P&&(t=P),M.seekTo(t)}else{Ze(ue);var n=e.played;if(n=Math.floor(e.played*Re),("Play"===Ke&&!0===Xe)|"Pause"===Ke){if(n>=Re)return me(Re-1),a(Math.floor(999999999999*Math.random())),void(Xe=!1);me(n),a(Math.floor(999999999999*Math.random())),Xe=!1}a(Math.floor(999999999999*Math.random()))}},Qe=function(e){for(var t=0,a=0;a<Fe[ue].length;a++)if(Fe[ue][a].id==e){t=a;break}if("f"!==e.substring(e.length-1,e.length)){var n=Me.getObjects();for(a=0;a<n.length;a++)if(console.log(n[a]),n[a]._objects[1].text===e){console.log("REMOVED"),console.log(n[a]),Me.remove(n[a]),Me.fire("saveData"),Me.renderAll();break}}Fe[ue].splice(t,1),Ze(ue)},$e=function(){0!=Fe[ue].length&&(console.log(Pe[ue]),Ee(ue))},et=function(){var e="#"+((1<<24)*Math.random()|0).toString(16);if(null==Fe[ue]&&(Fe[ue]=[]),1!=He){var t="error";if("2"===r){t="b";new h(Me.height/2,Me.width/2,50,50,e,g+"b","None").generate_no_behavior(Me)}else if("4"===r)alert("KeyPoint annotation are currently unavailable"),t="k";else if("3"===r){t="s";(new O).generate_polygon(Me,g+"s",tt);tt()}else"1"===r&&(t="f");1===ie?Fe[ue].push({id:g+t,global_id:"",status:"",current:"",behavior:"",posture:"",notes:"",confidence:"",dataType:"image",fileName:qe[ue].name}):Fe[ue].push({id:g+t,global_id:"",status:"",current:"",behavior:"",posture:"",notes:"",confidence:"",dataType:"video",fileName:"frame_"+ue}),Ze(ue),v(g+1),Me.fire("saveData")}else alert("Please finish your current segmentation!")},tt=function(e){He=!He};Object(n.useEffect)((function(){null!=S&&(Pe=S.get_frame_data(),Fe=S.get_annotation_data(),dt(),ft(),console.log(S.get_frame_data()))}),[S]);var at=function(e){return new Promise((function(t,a){var n=new FileReader;n.onload=function(e){t(JSON.parse(e.target.result))},n.readAsText(e.target.files[0])}))},nt=function(e){"Pause"===Ke&&(Xe=!0),q(!W),$e()};!0===W?(Ke="Pause",Ge=100):(Ke="Play",Ge=0);var ot=Object(n.useState)(!0),lt=Object(s.a)(ot,2),it=lt[0],rt=lt[1],ct=function(e){$e();var t=ue+xe;if(t>=Re){if(1===ie)return void me(Re-1);Ie(Re-1)}else{if(1===ie)return void me(t);Ie(t)}},st=function(e){$e();var t=ue-xe;if(t<0){if(1===ie)return void me(0);Ie(0)}else{if(1===ie)return void me(t);Ie(t)}};Object(n.useEffect)((function(){(1===ie||0!=P)&&ft()}),[ue]);var ut=function(e){if(!1!==Q)if(!0!==He)if("2"===e.key)Ue="Mode Switch: Bounding Box",Y(!0),d("2");else if("4"===e.key)Ue="Mode Switch: Key Point",Y(!0),d("4");else if("3"===e.key)Ue="Mode Switch: Segmentation",Y(!0),d("3");else if("1"===e.key)Ue="Mode Switch: Behavior Annotation",Y(!0),d("1");else if("a"===e.key){var t="";"2"===r?t="Bounding Box":"1"===r?t="Behavior Data":"4"===r?t="Keypoint":"3"===r&&(t="Segmentation"),Ue="Added Annotation - "+t,"3"!==r&&Y(!0),et()}else"q"===e.key?st():"w"===e.key?(ft(),nt()):"e"===e.key?(console.log(Me.toJSON()),ct()):"s"===e.key?(Ue="Annotation Saved",Y(!0),Pe[ue]=Me.toJSON()):"f"===e.key?!1===it?(Ue="Scrubbing Mode Activated",rt(!0),Y(!0)):(Ue="Scrubbing Mode Deactivated",rt(!1),Y(!0)):"c"===e.key&&(Ue="Copying previous frame annotation",Fe[ue]=JSON.parse(JSON.stringify(Fe[_e])),Pe[ue]=JSON.parse(JSON.stringify(Pe[_e])),Oe.util.enlivenObjects(Pe[ue],(function(e){console.log(e),Pe[ue]=e;for(var t=0;t<e.length;t++)Pe[ue][t].local_id=Pe[_e][t].local_id})),console.log(Pe[ue][0]),Y(!0),ft());else alert("Please finish your current action!")};Object(n.useEffect)((function(){return document.addEventListener("keydown",ut),function(){return document.removeEventListener("keydown",ut)}}),[ut]);var dt=function(){a(Math.floor(999999999999*Math.random()))},mt=function(e){console.log("Keycheck activated"),$(void 0===e?!Q:e)},ft=function(){if(1==ie)return(l=new Image).onload=function(){if(Me.clear(),console.log(Pe[ue]),void 0!=Pe[ue])for(var e=0;e<Pe[ue].length;e++)Me.add(Pe[ue][e]);Ye={name:ze,duration:P,horizontal_res:l.width,vertical_res:l.height,frame_rate:ke,time:Je};var t=new Oe.Image(l,{objectCaching:!1,scaleX:Ce/l.width,scaleY:Se/l.height});console.log("CURRFRAME: "+ue),Me.setBackgroundImage(t),Me.renderAll(),ve(ue)},void(l.src=URL.createObjectURL(qe[ue]));if(0==ie){console.log("updated canvas");var e=document.getElementsByTagName("video")[0],t=document.createElement("canvas"),a=t.getContext("2d"),n=Ce,o=Se;t.width=Ce,t.height=Se,a.drawImage(e,0,0,n,o);var l,i=t.toDataURL();(l=new Image).onload=function(){if(Me.clear(),void 0!=Pe[ue])for(var e=0;e<Pe[ue].length;e++)Me.add(Pe[ue][e]);var a=new Oe.Image(l,{objectCaching:!1});Me.setBackgroundImage(a),Me.renderAll(),t.remove(),ve(ue)},l.src=i}};return o.a.createElement("div",null,o.a.createElement(de,{disable_buttons:Ve,video_width:Ne,video_height:De,skip_value:xe,ANNOTATOR_NAME:Le,handleOldAnnotation:function(e){at(e).then((function(e){null!=e?x(new p(e,Me)):alert("Error in processing Annotation")}))},handleVideoUpload:function(e){if(1===ie){qe=e.target.files,Re=qe.length;for(var t=0;t<Re;t++)Fe.push([]);ft(),Ve=!1}if("string"===typeof e)return E(e),ze=e,void(Be=!0);ze=e.target.files[0].name,E(URL.createObjectURL(e.target.files[0])),Be=!0},currentFrame:ue,display_frame_num:"Frame #"+parseInt(ue+1)+" / "+parseInt(Re),skip_frame_forward:ct,skip_frame_backward:st,handlePlaying:nt,play_button_text:Ke,addToCanvas:et,ANNOTATION_VIDEO_NAME:ze,frame_data:Pe,change_skip_value:function(e){xe=e},change_annotator_name:function(e){Le=e},change_annotation_type:function(e){d(e)},annotation_data:Fe,VIDEO_METADATA:Ye,scaling_factor_height:Se,scaling_factor_width:Ce,handleSetPlaybackRate:function(e){isNaN(e)?ne(0):e>16?(alert("Max playback rate is 16!"),ne(16)):ne(e)},toggleKeyCheck:mt,setFrameRate:function(e){if((ke=parseInt(e))>120)ke=120;else if(ke<=0)ke=1;else if(0==Number.isFinite(ke))return void(ke=1);if(console.log(Number.isFinite(ke)),console.log(ke),je=Math.round(P*ke),0==Fe[0].length){Re=P*e,console.log("Resetting frame_data and annotation_data"),Pe=new Array(je),Fe=new Array(je);for(var t=0;t<je;t++)Pe[t]=[],Fe[t]=[];a(Math.floor(999999999999*Math.random()))}else alert("There is data currently annotated! To change frame rate refresh the page and re-upload!")},frame_rate:ke,setDateTime:function(e){Ye={name:ze,duration:P,horizontal_res:Ne,vertical_res:De,frame_rate:ke,time:Je=e},console.log(e)},fabricCanvas:Me,save_data:Ze,handle_visual_toggle:dt,handleInputType:function(e){0==e|1==e?re(e):alert("ERROR VALUE SET - Please report this bug!\n")},image_frames:qe,toggle_segmentation:tt}),o.a.createElement(u.a,{onClose:function(){return Y(!1)},show:z,delay:500,autohide:!0,style:{position:"absolute",top:"100",left:"100",zIndex:"100"}},o.a.createElement(u.a.Header,null,o.a.createElement("strong",{className:"mr-auto"},Ue))),!0===Be&&o.a.createElement("div",{style:{display:"grid"},show:Be},o.a.createElement("div",{style:{gridColumn:1,gridRow:1,position:"relative",width:Ce,height:Se,top:0,left:0,opacity:Ge}},0==ie&&o.a.createElement(c.a,{onReady:function(e){0==We&&(ft(),We=!0)},ref:function(e){if(null!=e&&null!=e.player&&null!=e.player.player&&null!=e.player.player){Ne=e.player.player.player.videoWidth,De=e.player.player.player.videoHeight;var t=e.player.player.player.duration;Ye={name:ze,duration:t,horizontal_res:Ne,vertical_res:De,frame_rate:ke,time:Je}}R(e)},onDuration:function(e){if(!0===Be&&null!=M){if(je=Math.round(e*ke),0==Fe[0].length){console.log("Resetting frame_data and annotation_data"),Pe=new Array(je),Fe=new Array(je);for(var t=0;t<je;t++)Pe[t]=[],Fe[t]=[]}Ve=!1}Re=parseInt(e)*ke,F(parseInt(e))},url:_,width:"100%",height:"100%",playing:W,controls:!1,style:{position:"absolute",float:"left",top:0,left:0},volume:0,muted:!0,pip:!1,playbackRate:ae,id:"myvideo"})),o.a.createElement("div",{style:{gridColumn:1,gridRow:1,position:"relative",top:0,left:0,opacity:100-Ge}},o.a.createElement(he,{fabricCanvas:Me,currentFrame:ue,save_data:Ze,scaling_factor_height:Se,scaling_factor_width:Ce})),o.a.createElement("div",{style:{gridColumn:2,gridRow:1,position:"relative",width:.4*Ce,height:Se,top:0,left:0}},o.a.createElement(we,{annotation_data:Fe,currentFrame:pe,toggleKeyCheck:mt,columns:A,remove_table_index:function(e){if(void 0===e){for(var t=[],n=0;n<Fe[ue].length;n++)t.push(Fe[ue][n].id);t.map((function(e){return Qe(e)}))}else Qe(e);a(Math.floor(999999999999*Math.random()))},handleSetCurrentFrame:Ie}))))}function $e(e){var t=Object(n.useState)(!1),a=Object(s.a)(t,2),l=a[0],i=a[1],r=Object(n.useState)(!0),c=Object(s.a)(r,2),u=c[0],d=c[1],m=Object(n.useState)(0),f=Object(s.a)(m,2),h=f[0],g=f[1],p=Object(n.useState)(0),v=Object(s.a)(p,2),b=v[0],y=v[1],E=Object(n.useState)(0),w=Object(s.a)(E,2),O=(w[0],w[1],Object(n.useState)(0)),k=Object(s.a)(O,2),j=(k[0],k[1],Object(n.useState)(0)),C=Object(s.a)(j,2),S=(C[0],C[1],Object(n.useState)(2)),x=Object(s.a)(S,2),A=x[0],V=x[1],z=Object(n.useState)(""),Y=Object(s.a)(z,2),K=Y[0],J=Y[1],H=Object(n.useState)(""),q=Object(s.a)(H,2),Z=q[0],Q=q[1],$=Object(n.useState)(!1),ee=Object(s.a)($,2),te=ee[0],ne=ee[1],le=Object(n.useState)(!1),ie=Object(s.a)(le,2),re=ie[0],ce=ie[1],se=function(){return i(!1)},de=function(){d(!1),ne(!0)},me=function(e){"string"===typeof e?(J(e.target.value),console.log(e.target.value)):J(URL.createObjectURL(e.target.files[0]))},fe=function(t){ce(!re),_(e.fabricCanvas,e.save_data),e.toggle_segmentation()};return o.a.createElement("div",null,2==te&&o.a.createElement(ue,{frame_rate:b,video_link:K}),o.a.createElement(B.a,{show:l,onHide:se,size:"lg"},o.a.createElement(B.a.Header,{closeButton:!0},o.a.createElement(B.a.Title,null,"Instructions")),o.a.createElement(B.a.Body,null,o.a.createElement(L,null)),o.a.createElement(B.a.Footer,null,o.a.createElement(T.a,{variant:"secondary",onClick:se},"Close"))),o.a.createElement(B.a,{show:u,onHide:de,size:"lg"},o.a.createElement(B.a.Header,{closeButton:!0},o.a.createElement(B.a.Title,null,"Upload")),o.a.createElement(B.a.Body,null,o.a.createElement("div",{style:{display:"grid"}},o.a.createElement(D.a,{style:{float:"left",gridColumn:1,gridRow:1,zIndex:99}},"Video Format:",o.a.createElement(D.a.Control,{as:"select",id:"inlineFormCustomSelect",onChange:function(t){var a;a=t.target.value,console.log(a),0===(a=parseInt(a))?V(0):1===a?V(1):2===a&&(V(2),e.handleInputType(1))},defaultValue:A},o.a.createElement("option",{value:"2"},"Image")),o.a.createElement(R.a.Divider,null)),o.a.createElement("div",{style:{float:"left",gridColumn:1,gridRow:2,zIndex:99}},"Annotator Name: ",o.a.createElement("input",{type:"text",defaultValue:e.ANNOTATOR_NAME,onClick:function(t){e.toggleKeyCheck(!1)},onBlur:function(t){e.toggleKeyCheck(!0)},onChange:function(t){e.change_annotator_name(t.target.value)}}),o.a.createElement(R.a.Divider,null)),o.a.createElement("div",{style:{float:"left",gridColumn:1,gridRow:3,zIndex:99}},o.a.createElement("text",null,"Date and Time: "),o.a.createElement(U.a,{selected:h,onChange:function(t){!function(t){g(t);try{e.setDateTime(Math.floor(t.getTime()/1e3))}catch(a){alert("Invalid date input!")}}(t)},timeInputLabel:"Time:",dateFormat:"yyyy/MM/dd hh:mm",showTimeInput:!0,onClick:function(t){e.toggleKeyCheck(!1)},onClickOutside:function(t){e.toggleKeyCheck(!0)},onCalendarOpen:function(t){e.toggleKeyCheck(!1)},onCalendarClose:function(t){e.toggleKeyCheck(!0)}}),o.a.createElement(R.a.Divider,null)),0===A&&o.a.createElement(D.a,{style:{float:"left",gridColumn:1,gridRow:4}},o.a.createElement(D.a.File,{multiple:!0,id:"file",label:"Video Upload",accept:".mp4",custom:!0,type:"file",onChange:function(t){e.handleVideoUpload(t),me(t)}})),1===A&&o.a.createElement("div",null,o.a.createElement("text",null,"Youtube URL: "),o.a.createElement("input",{onChange:me}),o.a.createElement(T.a,{onClick:function(t){e.handleVideoUpload(K)}},"Upload")),2===A&&o.a.createElement("div",null,o.a.createElement(D.a,{style:{float:"left",gridColumn:1,gridRow:4}},o.a.createElement(D.a.File,{multiple:!0,id:"file",label:"Image-set 1 Upload",accept:"image/*",custom:!0,type:"file",onChange:function(t){e.handleVideoUpload(t),me(t)}})),o.a.createElement(D.a,{style:{float:"left",gridColumn:1,gridRow:4}},o.a.createElement(D.a.File,{multiple:!0,id:"file",label:"Image-set 2 Upload",accept:"image/*",custom:!0,type:"file",onChange:function(t){e.handleVideoUpload(t),me(t)}})),o.a.createElement(D.a,{style:{float:"left",gridColumn:1,gridRow:4}},o.a.createElement(D.a.File,{multiple:!0,id:"file",label:"Image-set 3 Upload",accept:"image/*",custom:!0,type:"file",onChange:function(t){e.handleVideoUpload(t),me(t)}}))),o.a.createElement(D.a,{style:{float:"left",gridColumn:1,gridRow:5}},o.a.createElement(D.a.File,{disabled:e.disable_buttons,accept:".json",id:"file",label:"Annotation Upload",custom:!0,type:"file",onChange:e.handleOldAnnotation})),o.a.createElement(R.a.Divider,null),"Frame Rate: ",o.a.createElement("input",{type:"number",value:e.frame_rate,onClick:function(t){e.toggleKeyCheck(!1)},onBlur:function(t){e.toggleKeyCheck(!0)},onChange:function(t){e.setFrameRate(parseInt(t.target.value)),y(parseInt(t.target.value))}}),o.a.createElement(R.a.Divider,null),"Skip Value: ",o.a.createElement("input",{type:"number",defaultValue:"1",onChange:function(t){e.change_skip_value(parseInt(t.target.value))}}),"Playback Rate: ",o.a.createElement("input",{type:"number",defaultValue:"1",onChange:function(t){e.handleSetPlaybackRate(parseInt(t.target.value))}}),o.a.createElement(R.a.Divider,null),o.a.createElement("div",null,"Enable Object Detection Model:"," ",o.a.createElement("select",{defaultValue:Z,onChange:function(e){Q(e.target.value)},id:"base_model"},o.a.createElement("option",{value:""},"Select"),o.a.createElement("option",{value:"lite_mobilenet_v2"},"SSD Lite Mobilenet V2"),o.a.createElement("option",{value:"mobilenet_v1"},"SSD Mobilenet v1"),o.a.createElement("option",{value:"mobilenet_v2"},"SSD Mobilenet v2"))," ",o.a.createElement(T.a,{size:"sm",variant:"outline-success",onClick:function(e){""===Z&&alert("Please select a model"),G(Z)}},"Enable")),o.a.createElement(R.a.Divider,null))),o.a.createElement(B.a.Footer,null,o.a.createElement(T.a,{variant:"success",onClick:de},"Upload"))),o.a.createElement(I.a,{sticky:"top",bg:"dark",variant:"dark",className:"bg-5"},o.a.createElement(I.a.Brand,{href:"#home"},"AVAT"),o.a.createElement(M.a,{className:"mr-auto"},o.a.createElement(R.a,{disabled:e.disable_buttons,title:"Export",id:"basic-nav-dropdown"},o.a.createElement(R.a.Item,{onClick:function(){var t=new oe(e.frame_data,e.fabricCanvas,e.VIDEO_METADATA,e.image_frames).get_frame_json();X(e.ANNOTATION_VIDEO_NAME,e.ANNOTATOR_NAME,t,e.annotation_data,e.VIDEO_METADATA)}},"JSON"),o.a.createElement(R.a.Divider,null),o.a.createElement(R.a.Item,{onClick:function(){!function(e,t,a,n){W.apply(this,arguments)}(e.ANNOTATION_VIDEO_NAME,e.ANNOTATOR_NAME,e.annotation_data,e.columns)}},"CSV")),o.a.createElement(N.a,{onClick:function(){return i(!0)}},"Instructions"),o.a.createElement(N.a,{onClick:e.handle_link_open},"Report")),o.a.createElement("div",null,Z.length>0&&o.a.createElement(T.a,{id:"run",variant:"outline-info",onClick:function(t){ae(e.fabricCanvas,e.annotation_data,e.currentFrame,e.save_data,e.handle_visual_toggle),e.handle_visual_toggle()}},"Run model"),o.a.createElement(T.a,{variant:"outline-success",onClick:function(){return d(!0)}},"Upload")," ",!1===re&&o.a.createElement(T.a,{variant:"outline-success",onClick:fe},"Edit Seg"),!0===re&&o.a.createElement(T.a,{variant:"outline-success",onClick:fe},"Confirm")," ",o.a.createElement(P.a,{as:F.a},o.a.createElement(T.a,{variant:"secondary",disabled:!0},e.display_frame_num)," ",o.a.createElement(P.a.Toggle,{split:!0,variant:"secondary",id:"dropdown-split-basic"}),o.a.createElement(P.a.Menu,null,"Skip Value: ",o.a.createElement("input",{type:"number",defaultValue:"1",onChange:function(t){e.change_skip_value(parseInt(t.target.value))}}),"Playback Rate: ",o.a.createElement("input",{type:"number",defaultValue:"1",onChange:function(t){e.handleSetPlaybackRate(parseInt(t.target.value))}})))," ",o.a.createElement(T.a,{variant:"primary",disabled:e.disable_buttons,onClick:e.skip_frame_backward},"Prev")," ",o.a.createElement(T.a,{variant:"primary",disabled:e.disable_buttons,onClick:e.handlePlaying},e.play_button_text)," ",o.a.createElement(T.a,{variant:"primary",disabled:e.disable_buttons,onClick:e.skip_frame_forward},"Next")," ",o.a.createElement(P.a,{as:F.a,drop:"left"},o.a.createElement(T.a,{variant:"success",onClick:e.addToCanvas},"Add"),o.a.createElement(P.a.Toggle,{split:!0,variant:"success",id:"dropdown-split-basic"}),o.a.createElement(P.a.Menu,null,o.a.createElement(P.a.Item,{onClick:function(t){e.change_annotation_type("1")}},"Behavior Annotation"),o.a.createElement(P.a.Item,{onClick:function(t){e.change_annotation_type("2")}},"BoundingBox"),o.a.createElement(P.a.Item,{onClick:function(t){e.change_annotation_type("3")}},"Segmentation"))))))}"undefined"===typeof Storage&&alert("Your browser does not support local storage. \nSome autosaving features of the app will not work as intended.\nPlease see the documentation to find supported browsers and their versions");var et=a(134).fabric,tt=15,at=-1,nt=1920,ot=1080,lt=1;console.log(window.screen.width),console.log(window.screen.height);var it=window.screen.height;it>=1080?(nt=1280,ot=720):it>=1024?(nt=1152,ot=648):it>=768&&(nt=1024,ot=576);var rt,ct=new et.Canvas("c",{uniScaleTransform:!0,uniformScaling:!1,includeDefaultValues:!1});ct.on("mouse:over",(function(e){null==e.target|1==Ct||void 0!=e.target._objects&&(rt=e.target._objects[0].get("fill"),e.target._objects[0].set("fill","#39FF14"),ct.renderAll())})),ct.on("mouse:out",(function(e){null==e.target|1==Ct||void 0!=e.target._objects&&(e.target._objects[0].set("fill",rt),ct.renderAll())})),et.Image.prototype.toObject=function(e){return function(){return et.util.object.extend(e.call(this),{src:this.toDataURL()})}}(et.Image.prototype.toObject),ct.on("mouse:wheel",(function(e){var t=e.e.deltaY,a=ct.getZoom();(a*=Math.pow(.999,t))>20&&(a=20),a<.01&&(a=.01),ct.zoomToPoint({x:e.e.offsetX,y:e.e.offsetY},a),e.e.preventDefault(),e.e.stopPropagation()})),ct.on("mouse:down",(function(e){var t=e.e;!0===t.altKey&&(this.isDragging=!0,this.selection=!1,this.lastPosX=t.clientX,this.lastPosY=t.clientY)})),ct.on("mouse:move",(function(e){if(this.isDragging){var t=e.e,a=this.viewportTransform;a[4]+=t.clientX-this.lastPosX,a[5]+=t.clientY-this.lastPosY,this.requestRenderAll(),this.lastPosX=t.clientX,this.lastPosY=t.clientY}})),ct.on("mouse:up",(function(e){this.setViewportTransform(this.viewportTransform),this.isDragging=!1,this.selection=!0}));var st,ut=0,dt=0,mt=[[]],ft=[[]],ht=!1,gt=!0,pt=0,vt="",bt=[],yt=[],_t="",Et="",wt={},Ot="ERROR",kt=!1,jt=0,Ct=!1,St=!1,xt=[],Tt=0;function At(e){0!=ct.getObjects().length?(mt[e]=ct.getObjects(),mt[e].backgroundImage=null):mt[e]=[],console.log("SAVED")}function It(){var e=Object(n.useState)(0),t=Object(s.a)(e,2),a=(t[0],t[1]),l=Object(n.useState)("1"),i=Object(s.a)(l,2),r=i[0],d=i[1],m=Object(n.useState)(0),f=Object(s.a)(m,2),g=f[0],v=f[1],b=Object(n.useState)(null),y=Object(s.a)(b,2),_=y[0],E=y[1],w=Object(n.useState)(null),k=Object(s.a)(w,2),j=(k[0],k[1],Object(n.useState)(null)),C=Object(s.a)(j,2),S=C[0],x=C[1],T=Object(n.useState)(null),I=Object(s.a)(T,2),M=I[0],R=I[1],N=Object(n.useState)(0),D=Object(s.a)(N,2),P=D[0],F=D[1],B=Object(n.useState)(!1),V=Object(s.a)(B,2),U=(V[0],V[1],Object(n.useState)(!1)),L=Object(s.a)(U,2),z=L[0],Y=L[1],K=Object(n.useState)(!1),X=Object(s.a)(K,2),J=(X[0],X[1]),H=Object(n.useState)(!1),W=Object(s.a)(H,2),q=W[0],G=W[1],Z=Object(n.useState)(!0),Q=Object(s.a)(Z,2),$=Q[0],ee=Q[1],te=Object(n.useState)(1),ae=Object(s.a)(te,2),ne=ae[0],oe=ae[1],le=Object(n.useState)(0),ie=Object(s.a)(le,2),re=ie[0],ce=ie[1],se=Object(n.useState)(0),ue=Object(s.a)(se,2),de=ue[0],me=ue[1],fe=Object(n.useState)(0),ge=Object(s.a)(fe,2),pe=ge[0],ve=ge[1];Ct||ct.forEachObject((function(e){e.selectable=!0,e.evented=!0}));var be=function(e){if(st=P*tt,Re(),"number"===typeof e){me(e),a(Math.floor(999999999999*Math.random()));var t=e/st;t>P&&(t=P),M.seekTo(t)}else{At(de);var n=e.played;if(n=Math.floor(e.played*st),("Play"===Ot&&!0===kt)|"Pause"===Ot){if(n>=st)return me(st-1),a(Math.floor(999999999999*Math.random())),void(kt=!1);me(n),a(Math.floor(999999999999*Math.random())),kt=!1}a(Math.floor(999999999999*Math.random()))}},ye=function(e){for(var t=0,a=0;a<ft[de].length;a++)if(ft[de][a].id==e){t=a;break}if("f"!==e.substring(e.length-1,e.length)){var n=ct.getObjects();for(a=0;a<n.length;a++)if(console.log(n[a]),n[a]._objects[1].text===e){console.log("REMOVED"),console.log(n[a]),ct.remove(n[a]),ct.fire("saveData"),ct.renderAll();break}}ft[de].splice(t,1),At(de)},_e=function(){0!=ft[de].length&&(bt=ft[de],yt=mt[de])},Ee=function(){var e="#"+((1<<24)*Math.random()|0).toString(16);if(null==ft[de]&&(ft[de]=[]),1!=Ct){var t="error";if("2"===r){t="b";new h(ct.height/2,ct.width/2,50,50,e,g+"b","None").generate_no_behavior(ct)}else if("4"===r)alert("KeyPoint annotation are currently unavailable"),t="k";else if("3"===r){t="s";(new O).generate_polygon(ct,g+"s",Oe);Oe()}else"1"===r&&(t="f");1===re?ft[de].push({id:g+t,global_id:"",status:"",current:"",behavior:"",posture:"",notes:"",confidence:"",dataType:"image",fileName:xt[de].name}):ft[de].push({id:g+t,global_id:"",status:"",current:"",behavior:"",posture:"",notes:"",confidence:"",dataType:"video",fileName:"frame_"+de}),At(de),v(g+1),ct.fire("saveData")}else alert("Please finish your current segmentation!")},Oe=function(e){Ct=!Ct};Object(n.useEffect)((function(){null!=S&&(mt=S.get_frame_data(),ft=S.get_annotation_data(),Re(),De(),console.log(S.get_frame_data()))}),[S]);var ke=function(e){return new Promise((function(t,a){var n=new FileReader;n.onload=function(e){t(JSON.parse(e.target.result))},n.readAsText(e.target.files[0])}))},je=function(e){"Pause"===Ot&&(kt=!0),G(!q),_e()};!0===q?(Ot="Pause",Tt=100):(Ot="Play",Tt=0);var Ce=Object(n.useState)(!0),Se=Object(s.a)(Ce,2),xe=Se[0],Te=Se[1],Ae=function(e){_e();var t=de+lt;if(t>=st){if(1===re)return void me(st-1);be(st-1)}else{if(1===re)return void me(t);be(t)}},Ie=function(e){_e();var t=de-lt;if(t<0){if(1===re)return void me(0);be(0)}else{if(1===re)return void me(t);be(t)}};Object(n.useEffect)((function(){1===re&&De()}),[de]);var Me=function(e){if(!1!==$)if(!0!==Ct)if("2"===e.key)vt="Mode Switch: Bounding Box",Y(!0),d("2");else if("4"===e.key)vt="Mode Switch: Key Point",Y(!0),d("4");else if("3"===e.key)vt="Mode Switch: Segmentation",Y(!0),d("3");else if("1"===e.key)vt="Mode Switch: Behavior Annotation",Y(!0),d("1");else if("a"===e.key){var t="";"2"===r?t="Bounding Box":"1"===r?t="Behavior Data":"4"===r?t="Keypoint":"3"===r&&(t="Segmentation"),vt="Added Annotation - "+t,"3"!==r&&Y(!0),Ee()}else"q"===e.key?Ie():"w"===e.key?(De(),je()):"e"===e.key?(console.log(ct.toJSON()),Ae()):"s"===e.key?(vt="Annotation Saved",Y(!0),mt[de]=ct.toJSON()):"f"===e.key?!1===xe?(vt="Scrubbing Mode Activated",Te(!0),Y(!0)):(vt="Scrubbing Mode Deactivated",Te(!1),Y(!0)):"c"===e.key&&(vt="Copying previous frame annotation",ft[de]=JSON.parse(JSON.stringify(bt)),mt[de]=JSON.parse(JSON.stringify(yt)),et.util.enlivenObjects(mt[de],(function(e){console.log(e),mt[de]=e;for(var t=0;t<e.length;t++)mt[de][t].local_id=yt[t].local_id;De(),Y(!0)})));else alert("Please finish your current action!")};Object(n.useEffect)((function(){return document.addEventListener("keydown",Me),function(){return document.removeEventListener("keydown",Me)}}),[Me]);var Re=function(){a(Math.floor(999999999999*Math.random()))},Ne=function(e){console.log("Keycheck activated"),ee(void 0===e?!$:e)},De=function(){if(1==re)return(i=new Image).onload=function(){if(ct.clear(),console.log(mt[de]),void 0!=mt[de])for(var e=0;e<mt[de].length;e++)ct.add(mt[de][e]);wt={name:Et,duration:P,horizontal_res:i.width,vertical_res:i.height,frame_rate:tt,time:jt};var t=new et.Image(i,{objectCaching:!1,scaleX:nt/i.width,scaleY:ot/i.height});console.log("CURRFRAME: "+de),ct.setBackgroundImage(t),ct.renderAll(),ve(de)},void(i.src=URL.createObjectURL(xt[de]));parseInt(JSON.parse(JSON.stringify(de)));var e=document.getElementsByTagName("video")[0],t=e.duration*tt;console.log(t),console.log(e.duration);var a=document.createElement("canvas"),n=a.getContext("2d"),o=nt,l=ot;a.width=nt,a.height=ot,n.drawImage(e,0,0,o,l);var i,r=a.toDataURL();(i=new Image).onload=function(){if(ct.clear(),void 0!=mt[de])for(var e=0;e<mt[de].length;e++)ct.add(mt[de][e]);var t=new et.Image(i,{objectCaching:!1});ct.setBackgroundImage(t),ct.renderAll(),a.remove(),ve(de)},i.src=r};return o.a.createElement("div",null,o.a.createElement($e,{disable_buttons:gt,video_width:ut,video_height:dt,skip_value:lt,ANNOTATOR_NAME:_t,handle_link_open:function(){window.open("https://forms.gle/CrJuYEoT39uFgnR17","_blank")},handleOldAnnotation:function(e){ke(e).then((function(e){null!=e?x(new p(e,ct)):alert("Error in processing Annotation")}))},handleVideoUpload:function(e){if(1===re){xt=e.target.files,st=xt.length;for(var t=0;t<st;t++)ft.push([]);De(),gt=!1}if("string"===typeof e)return E(e),Et=e,void(ht=!0);Et=e.target.files[0].name,E(URL.createObjectURL(e.target.files[0])),ht=!0},currentFrame:de,display_frame_num:"Frame #"+parseInt(de+1)+" / "+parseInt(st),skip_frame_forward:Ae,skip_frame_backward:Ie,handlePlaying:je,play_button_text:Ot,addToCanvas:Ee,ANNOTATION_VIDEO_NAME:Et,frame_data:mt,change_skip_value:function(e){lt=e},change_annotator_name:function(e){_t=e},change_annotation_type:function(e){d(e)},annotation_data:ft,VIDEO_METADATA:wt,scaling_factor_height:ot,scaling_factor_width:nt,columns:A,handleSetPlaybackRate:function(e){isNaN(e)?oe(0):e>16?(alert("Max playback rate is 16!"),oe(16)):oe(e)},toggleKeyCheck:Ne,setFrameRate:function(e){if((tt=parseInt(e))>120)tt=120;else if(tt<=0)tt=1;else if(0==Number.isFinite(tt))return void(tt=1);if(console.log(Number.isFinite(tt)),console.log(tt),at=Math.round(P*tt),0==ft[0].length){st=P*e,console.log("Resetting frame_data and annotation_data"),mt=new Array(at),ft=new Array(at);for(var t=0;t<at;t++)mt[t]=[],ft[t]=[];a(Math.floor(999999999999*Math.random()))}else alert("There is data currently annotated! To change frame rate refresh the page and re-upload!")},frame_rate:tt,setDateTime:function(e){wt={name:Et,duration:P,horizontal_res:ut,vertical_res:dt,frame_rate:tt,time:jt=e},console.log(e)},fabricCanvas:ct,save_data:At,handle_visual_toggle:Re,handleInputType:function(e){0==e|1==e?ce(e):alert("ERROR VALUE SET - Please report this bug!\n")},image_frames:xt,toggle_segmentation:Oe}),o.a.createElement(u.a,{onClose:function(){return Y(!1)},show:z,delay:500,autohide:!0,style:{position:"absolute",top:"100",left:"100",zIndex:"100"}},o.a.createElement(u.a.Header,null,o.a.createElement("strong",{className:"mr-auto"},vt))),!0===ht&&o.a.createElement("div",{style:{display:"grid"},show:ht},o.a.createElement("div",{style:{gridColumn:1,gridRow:1,position:"relative",width:nt,height:ot,top:0,left:0,opacity:Tt}},0==re&&o.a.createElement(c.a,{onReady:function(e){0==St&&(De(),St=!0)},onSeek:function(e){De(),pt=de/(P*tt),a(Math.floor(999999999999*Math.random()))},ref:function(e){if(null!=e&&null!=e.player&&null!=e.player.player&&null!=e.player.player){ut=e.player.player.player.videoWidth,dt=e.player.player.player.videoHeight;var t=e.player.player.player.duration;wt={name:Et,duration:t,horizontal_res:ut,vertical_res:dt,frame_rate:tt,time:jt}}R(e)},onDuration:function(e){if(!0===ht&&null!=M){if(at=Math.round(e*tt),0==ft[0].length){console.log("Resetting frame_data and annotation_data"),mt=new Array(at),ft=new Array(at);for(var t=0;t<at;t++)mt[t]=[],ft[t]=[]}gt=!1}st=parseInt(e)*tt,F(parseInt(e))},url:_,width:"100%",height:"100%",playing:q,controls:!1,style:{position:"absolute",float:"left",top:0,left:0},volume:0,muted:!0,pip:!1,playbackRate:ne,id:"myvideo"})),o.a.createElement("div",{style:{gridColumn:1,gridRow:1,position:"relative",top:0,left:0,opacity:100-Tt}},o.a.createElement(he,{fabricCanvas:ct,currentFrame:de,save_data:At,scaling_factor_height:ot,scaling_factor_width:nt})),o.a.createElement("div",{style:{gridColumn:1,gridRow:2,position:"relative",width:nt,top:0,left:0}},o.a.createElement("input",{style:{width:nt},type:"range",min:0,max:.999999,step:"any",value:pt,onChange:function(e){pt=parseFloat(e.target.value),M.seekTo(pt)},onMouseDown:function(e){J(!0),pt=parseFloat(e.target.value)},onMouseUp:function(e){J(!1),pt=parseFloat(e.target.value)}})),o.a.createElement("div",{style:{gridColumn:2,gridRow:1,position:"relative",width:.4*nt,height:ot,top:0,left:0}},o.a.createElement(we,{annotation_data:ft,currentFrame:pe,toggleKeyCheck:Ne,columns:A,remove_table_index:function(e){if(void 0===e){for(var t=[],n=0;n<ft[de].length;n++)t.push(ft[de][n].id);t.map((function(e){return ye(e)}))}else ye(e);a(Math.floor(999999999999*Math.random()))},handleSetCurrentFrame:be}))))}var Mt=a(642),Rt=a(643),Nt=a(456);var Dt=function(){var e=Object(n.useState)(!1),t=Object(s.a)(e,2),a=t[0],l=t[1],i=function(){return l(!1)},r=Object(n.useState)(!1),c=Object(s.a)(r,2),u=c[0],d=c[1],m=Object(n.useState)(!1),f=Object(s.a)(m,2),h=f[0],g=f[1];return u?o.a.createElement(Qe,null):h?o.a.createElement(It,null):o.a.createElement("div",null,o.a.createElement(B.a,{show:a,onHide:i,size:"lg"},o.a.createElement(B.a.Header,{closeButton:!0},o.a.createElement(B.a.Title,null,"Instructions")),o.a.createElement(B.a.Body,null,o.a.createElement(L,null)),o.a.createElement(B.a.Footer,null,o.a.createElement(T.a,{variant:"secondary",onClick:i},"Close"))),o.a.createElement("main",null,o.a.createElement(Mt.a,{className:"text-center"},o.a.createElement(Rt.a,null,o.a.createElement("h1",{className:"jumbotron-heading"},"AVAT"),o.a.createElement("p",{className:"lead text-muted"}," Analysis tool to record data for livestock behavior and computer vision applications. "),o.a.createElement("p",null,o.a.createElement(T.a,{onClick:function(e){d(!u)},variant:"success",className:"mx-1 my-2"},"Video Upload"),o.a.createElement(T.a,{onClick:function(e){g(!h)},variant:"success"},"Multiview")))),o.a.createElement(le.a,{controls:!1,fade:!0,style:{width:"70%","margin-left":"auto","margin-right":"auto"}},Nt.map((function(e,t){return o.a.createElement(le.a.Item,{interval:e.slide_time},o.a.createElement(ie.a,{className:"mb-5 box-shadow",top:!0,width:"100%"},o.a.createElement(ie.a.Img,{width:"60%",variant:"top",src:"."+e.src}),o.a.createElement(ie.a.Body,{style:{"text-align":"center"}},o.a.createElement(ie.a.Title,null,e.altText),o.a.createElement(ie.a.Text,null,e.description))))})))))};var Pt=function(){return o.a.createElement("div",null,o.a.createElement(Dt,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(629),a(625);i.a.render(o.a.createElement(Pt,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[463,1,2]]]);
//# sourceMappingURL=main.5b6cd8aa.chunk.js.map