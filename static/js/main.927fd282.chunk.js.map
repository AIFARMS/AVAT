{"version":3,"sources":["annotations/bounding_box.js","processing/annotation-processing.js","processing/frame_extract.js","annotations/key_point.js","annotations/segmentation_edit.js","annotations/segmentation.js","static_data/behaviors.js","static_data/posture.js","static_data/status.js","static_data/columns.js","ui_elements/Components/instructions.js","processing/download.js","tensorflow/ObjectDetection.js","tensorflow/SemanticSegmentation.js","processing/exporting_annotation.js","ui_elements/Components/nav_bar.js","ui_elements/Components/fabric_canvas.js","ui_elements/Components/change_table.js","ui_elements/Pages/main_upload.js","static_data/constants.js","static_data/behaviors_LPS.js","ui_elements/Pages/main_muiltiview.js","ui_elements/Pages/selection_screen.js","App.js","serviceWorker.js","index.js"],"names":["fabric","require","BoundingBox","top","left","width","height","color","id","behavior","this","Rect","hasRotatingPoint","fill","opacity","Text","toString","fontSize","uniScaleTransform","canvas","group","Group","rectangle","id_text","borderColor","hasBorders","on","obj","text_box","target","item","scaleX","scaleY","set","temp","local_id","console","log","toJSON","isDown","origX","origY","o","pointer","getPointer","e","x","y","rect_temp","originX","originY","angle","transparentCorners","add","Math","abs","renderAll","off","ExtractingAnnotation","annotation_json","frame_data","annotation_data","metadata","scale_annotations","new_annotations","i","length","temp_data","curr_frame","j","parseInt","random","new_bbox","generate_no_behavior","push","KeyPoint","makeCircle","line1","line2","line3","line4","c","Circle","strokeWidth","radius","stroke","hasControls","makeLine","coords","Line","selectable","evented","Object","prototype","line","line5","line6","get","p","polygonPositionHandler","dim","finalMatrix","fabricObject","points","pointIndex","pathOffset","util","transformPoint","multiplyTransformMatrices","viewportTransform","calcTransformMatrix","actionHandler","eventData","transform","polygon","currentControl","controls","__corner","mouseLocalPosition","toLocalPoint","Point","polygonBaseSize","_getNonTransformedDimensions","size","_getTransformedDimensions","finalPointPosition","$","Segmentation","segmentation_flag","activeLine","polygonMode","pointArray","Array","lineArray","activeShape","generate_flag","forEachObject","object","selection","prototypefabric","options","generatePolygon","addPoint","class","x2","y2","drawPolygon","circle","layerX","getZoom","layerY","objectCaching","zindex","pos","Polygon","remove","polyPoint","each","index","point","po","cornerColor","lockMovementY","lockMovementX","display_text","centerX","grouppo","_objects","behaviors","value","label","posture","status","columns","remove_table_index","dataField","text","headerStyle","editable","editCellStyle","cell","row","rowIndex","colIndex","backgroundColor","editor","type","Type","SELECT","headerFormatter","Button","className","onClick","formatter","cellContent","Instructions","ANNOTATION_VIDEO_NAME","ANNOTATOR_NAME","VIDEO_METADATA","a","fileName","split","slice","join","json","JSON","stringify","blob","Blob","URL","createObjectURL","href","link","document","createElement","download","body","appendChild","click","removeChild","convert_data_csv","data","csv","vals","keys","map","key","model_type","alert","cocoSsd","dispose","base","deeplab","loadModel","load","quantizationBytes","fabricCanvas","currentFrame","save_data","refresh","image","getElementsByTagName","then","model","segment","segmentationMap","legend","getHeight","getWidth","seg_image","ImageData","setAttribute","getContext","putImageData","Image","fromURL","toDataURL","img","bringToFront","ExportingAnnotation","standard_annot","curr","frame_objects","undefined","raw_points","k","CustomNavBar","props","useState","show","setShow","uploadShow","setUploadShow","startDate","setStartDate","videoFormat","setVideoFormat","videoLink","setVideoLink","setModel","handleClose","handleUploadClose","Modal","onHide","Header","closeButton","Title","Body","Footer","variant","style","display","Form","float","gridColumn","gridRow","zIndex","Control","as","onChange","event","defaultValue","NavDropdown","Divider","toggleKeyCheck","onBlur","change_annotator_name","selected","date","setDateTime","floor","getTime","error","handleSetStartDate","timeInputLabel","dateFormat","showTimeInput","onClickOutside","onCalendarOpen","onCalendarClose","File","accept","custom","handleVideoUpload","disabled","disable_buttons","handleOldAnnotation","frame_rate","setFrameRate","change_skip_value","handleSetPlaybackRate","Navbar","sticky","bg","Brand","Nav","title","Item","converted_annot","get_frame_json","downloadFileJSON","downloadFileCSV","NavLink","handle_link_open","run_model_segment","handle_visual_toggle","getActiveObject","poly","destroy","setActiveObject","edit","lastControl","cornerStyle","reduce","acc","anchorIndex","fn","positionHandler","absolutePoint","actionPerformed","_setPositionDimensions","newX","newY","setPositionByOrigin","actionName","requestRenderAll","Edit","Dropdown","ButtonGroup","display_frame_num","Toggle","Menu","skip_frame_backward","handlePlaying","play_button_text","skip_frame_forward","drop","addToCanvas","change_annotation_type","FabricRender","el","ReactDOM","findDOMNode","initialize","scaling_factor_height","scaling_factor_width","React","Component","AnnotationTable","handler","expandRow","onlyOneExpanding","renderer","FormControl","aria-label","handleOnChange","txt_id","txt_global","frame_num","anno_count","local_ids","global_ids","getAnnotationTableCount","Tabs","defaultActiveKey","Tab","eventKey","keyField","table","noDataIndication","cellEdit","cellEditFactory","mode","blurToSave","afterSaveCell","oldValue","newValue","column","onStartEdit","columnIndex","pagination","paginationFactory","handleSetCurrentFrame","Storage","num_frames","skip_value","window","screen","current_screen_height","Canvas","uniformScaling","includeDefaultValues","video_width","video_height","upload","sliderPercent","toast_text","previous_annotation","previous_canvas_annotation","temp_flag","time_unix","getObjects","save_localstorage","MainUpload","setVisualToggle","annotationType","setAnnotationType","boxCount","setBoxCount","videoFilePath","setVideoFileURL","oldAnnotation","setOldAnnotation","player","setPlayer","duration","setDuration","save","changeSave","setSeeking","playing","setPlaying","setCurrentFrame","keyCheck","changeKeyCheck","playbackRate","setPlaybackRate","val","total_frames","new_skip","seekTo","frame_calc","removeRow","index_num","substring","current_objects","fire","splice","save_previous_data","annotation_type_txt","generate_stick","generate_polygon","toggle_segmentation","global_id","current","notes","useEffect","get_frame_data","get_annotation_data","downloadOldAnnotation","file","Promise","resolve","reject","reader","FileReader","onload","parse","result","readAsText","files","scrubbing","setScrubbing","frameVal","onKeyPress","annotext","addEventListener","removeEventListener","loadFromJSON","toggle_val","open","vid_location","video1El","getElementById","video_to_img","isNaN","framerate","Number","isFinite","round","time","name","horizontal_res","vertical_res","Toast","onClose","delay","autohide","position","onProgress","ref","videoWidth","videoHeight","onDuration","url","volume","muted","pip","onPlay","min","max","step","onMouseDown","parseFloat","onMouseUp","indiciesToDelete","current_screen_width","MainMultiview","CHECKBOX","visualToggle","videoFilePath1","setVideoFileURL1","handleSetPlayer","handleSetDuration","getCurrentTime","downloadFile","Link","SelectionScreen","setUpload","multiview","setMultiview","Jumbotron","Container","Row","selection_items","Col","md","Card","Img","src","process","altText","description","App","Boolean","location","hostname","match","render","navigator","serviceWorker","ready","registration","unregister","catch","message"],"mappings":"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","file":"static/js/main.927fd282.chunk.js","sourcesContent":["const fabric = require(\"fabric\").fabric;\n\nclass BoundingBox {\n    constructor(top, left, width, height, color, id, behavior) {\n        this.top = top;\n        this.left = left;\n        this.id = id;\n        this.behavior = behavior;\n        this.color = color;\n        this.width = width;\n        this.height = height;\n    }\n\n    rectangle(){\n        return new fabric.Rect({\n            hasRotatingPoint: false,\n            height: this.height,\n            width: this.width,\n            fill: this.color,\n            opacity: '.4',\n            top: this.top,\n            left: this.left,\n        });\n    } \n\n    //TODO Add text scaling\n    id_text(){\n        return new fabric.Text(this.id.toString(), {\n            fontSize: 20,\n            top: this.top,\n            left: this.left,\n            uniScaleTransform: false,\n          });\n    }\n\n    generate_no_behavior(canvas){\n        var group = new fabric.Group([this.rectangle(), this.id_text()],{\n            borderColor: '#000000',\n            hasBorders: true,\n            uniScaleTransform: true\n        });\n\n        function onChange(obj) {\n            var text_box = obj.target.item(1),\n                group = obj.target,\n                scaleX = group.width / (group.width * group.scaleX),\n                scaleY = group.height / (group.height * group.scaleY);\n            text_box.set('scaleX', scaleX);\n            text_box.set('scaleY', scaleY);\n        }\n        canvas.on({\n            'object:scaling': onChange\n        })\n\n        var temp = this.id \n        group.local_id = temp\n        console.log(group.toJSON())\n        return group.toJSON()\n    }\n\n    generate_mouse_no_behavior(canvas){\n        var group, isDown, origX, origY;\n\n        var temp_id = new fabric.Text(this.id.toString(), {\n            fontSize: 20,\n            top: this.top,\n            left: this.left,\n            uniScaleTransform: false,\n          });\n\n        canvas.on('mouse:down', function(o){\n            isDown = true;\n            var pointer = canvas.getPointer(o.e);\n            origX = pointer.x;\n            origY = pointer.y;\n            var pointer = canvas.getPointer(o.e);\n            var rect_temp = new fabric.Rect({\n                left: origX,\n                top: origY,\n                originX: 'left',\n                originY: 'top',\n                width: pointer.x-origX,\n                height: pointer.y-origY,\n                angle: 0,\n                fill: 'rgba(255,0,0,0.5)',\n                transparentCorners: false,\n                uniScaleTransform: true\n            });\n            group = rect_temp\n\n\n            canvas.add(group)\n        });\n        \n        canvas.on('mouse:move', function(o){\n            if (!isDown) return;\n            var pointer = canvas.getPointer(o.e);\n            \n            if(origX>pointer.x){\n                group.set({ left: Math.abs(pointer.x) });\n            }\n            if(origY>pointer.y){\n                group.set({ top: Math.abs(pointer.y) });\n            }\n            \n            group.set({ width: Math.abs(origX - pointer.x) });\n            group.set({ height: Math.abs(origY - pointer.y) });\n            \n            \n            canvas.renderAll();\n        });\n        \n        canvas.on('mouse:up', function(o){\n          isDown = false;\n          canvas.off('mouse:down')\n          canvas.off('mouse:up')\n        });\n    }\n\n}\n\nexport {BoundingBox}","import {BoundingBox} from '../annotations/bounding_box'\n\nexport default class ExtractingAnnotation{\n    constructor(annotation_json, canvas){\n        this.frame_data = annotation_json['annotations']\n        this.annotation_data = annotation_json['behavior_data']\n        this.canvas = canvas\n        this.metadata = annotation_json['vid_metadata']\n    }\n\n    get_frame_data(){\n        return this.scale_annotations()\n    }\n    \n    get_annotation_data(){\n        return this.annotation_data\n    }\n\n    scale_annotations(){\n        var new_annotations = []\n        console.log(this.frame_data)\n        for(var i = 0; i < this.frame_data.length; i++){\n            var temp_data = []\n            var curr_frame = this.frame_data[i]\n            if(curr_frame == null){\n                new_annotations.push([])\n                continue;\n            }\n            for(var j = 0; j < curr_frame.length; j++){\n                if(curr_frame[j]['type'] === \"bounding_box\"){\n                    var x = (parseInt(curr_frame[j]['x']) / parseInt(this.metadata['horizontal_res']) * this.canvas.width)\n                    var y = (curr_frame[j]['y'] / this.metadata['vertical_res'] * this.canvas.height)\n                    var width = ((curr_frame[j]['width']) / this.metadata['horizontal_res'] * this.canvas.width)\n                    var height = ((curr_frame[j]['height']) / this.metadata['vertical_res'] * this.canvas.height)\n                    console.log(x)\n                    //console.log(curr_frame[j])\n                    //console.log(this.metadata)\n                    //console.log(this.canvas.width)\n                    var color = \"#\" + ((1<<24)*Math.random() | 0).toString(16)\n                    var new_bbox = new BoundingBox(y, x, width, height, color, curr_frame[j]['local_id'], \"None\").generate_no_behavior(this.canvas)\n                    //this.canvas.add(new_bbox)\n                    temp_data.push(new_bbox)\n                }else if(curr_frame[j]['type'] === \"segmentation\"){\n\n                }\n            }\n            new_annotations.push({\"objects\": temp_data})\n        }\n        console.log(new_annotations)\n        return new_annotations\n    }\n}\n\n//This is the parser for the Multi-Camera pig tracking output JSON code. \n/*\nclass MCPT_Processing {\n    constructor(annotation_json){\n        this.objects = annotation_json['objects']\n        console.log(this.objects)\n    }\n\n    getObjects_MCPT() {\n        return this.objects\n    }\n\n    getObjectById_MCPT(id) {\n        return this.objects[id]\n    }\n    \n    getObjectByIdFrame(id, frame_num){\n        return this.objects[id][frame_num]\n    }\n\n    getAllObjectByFrame_MCPT(frame_num){\n        var i;\n        var objects_frame = []\n        for (i = 0; i < this.objects.length; i++){\n            var curr_obj = this.objects[i]\n            if(curr_obj['frames'][curr_obj['frames'].length-1]['frameNumber'] < frame_num){\n                continue;\n            }\n            var curr_obj_frames = curr_obj['frames'];\n            for (var j = 0; j < curr_obj_frames.length; j++){\n                if(curr_obj_frames[j]['frameNumber'] === frame_num){\n                    objects_frame.push(curr_obj_frames[j]);\n                    break;\n                }\n            }\n        }\n        console.log(objects_frame)\n        return objects_frame;\n    }\n}*/","const fabric = require(\"fabric\").fabric;\n\nexport function video_to_img(vid_location, fabricCanvas){\n    var video1El = document.getElementById('video1');\n   \n    var video1 = new fabric.Image(video1El, {\n      left: 200,\n      top: 300,\n      angle: -15,\n      originX: 'center',\n      originY: 'center',\n      objectCaching: false,\n    });\n\n    \n    //fabricCanvas.add(video1);\n    //video1.getElement().play();\n\n}","const fabric = require(\"fabric\").fabric;\n\nclass KeyPoint {\n    //TODO Optimize this code. Right now there is a significant performance penalty if there are multiple keypoints on the canvas\n    generate_stick(canvas){\n        fabric.Object.prototype.originX = fabric.Object.prototype.originY = 'center';\n\n        function makeCircle(left, top, line1, line2, line3, line4) {\n            var c = new fabric.Circle({\n            left: left,\n            top: top,\n            strokeWidth: 2.5,\n            radius: 6,\n            fill: '#fff',\n            stroke: '#666'\n            });\n            c.hasControls = c.hasBorders = false;\n\n            c.line1 = line1;\n            c.line2 = line2;\n            c.line3 = line3;\n            c.line4 = line4;\n\n            return c;\n        }\n\n        function makeLine(coords) {\n            return new fabric.Line(coords, {\n            fill: 'red',\n            stroke: 'red',\n            strokeWidth: 5,\n            selectable: true,\n            evented: false,\n            });\n        }\n\n        var line = makeLine([ 250, 200, 250, 175 ]),\n            line2 = makeLine([ 250, 175, 250, 250 ]),\n            line3 = makeLine([ 250, 250, 300, 350]),\n            line4 = makeLine([ 250, 250, 200, 350]),\n            line5 = makeLine([ 250, 175, 175, 225 ]),\n            line6 = makeLine([ 250, 175, 325, 225 ]);\n\n        canvas.add(line, line2, line3, line4, line5, line6);\n\n        canvas.add(\n            makeCircle(line.get('x1'), line.get('y1'), null, line),\n            makeCircle(line.get('x2'), line.get('y2'), line, line2, line5, line6),\n            makeCircle(line2.get('x2'), line2.get('y2'), line2, line3, line4),\n            makeCircle(line3.get('x2'), line3.get('y2'), line3),\n            makeCircle(line4.get('x2'), line4.get('y2'), line4),\n            makeCircle(line5.get('x2'), line5.get('y2'), line5),\n            makeCircle(line6.get('x2'), line6.get('y2'), line6)\n        );\n\n        canvas.on('object:moving', function(e) {\n            var p = e.target;\n            p.line1 && p.line1.set({ 'x2': p.left, 'y2': p.top });\n            p.line2 && p.line2.set({ 'x1': p.left, 'y1': p.top });\n            p.line3 && p.line3.set({ 'x1': p.left, 'y1': p.top });\n            p.line4 && p.line4.set({ 'x1': p.left, 'y1': p.top });\n            canvas.renderAll();\n        });\n    }   \n\n\n    generate_poly(canvas){\n        \n    }\n}\n\nexport {KeyPoint}","const fabric = require(\"fabric\").fabric;\nconst $ = require(\"jquery\")\n\n// define a function that can locate the controls.\n// this function will be used both for drawing and for interaction.\nfunction polygonPositionHandler(dim, finalMatrix, fabricObject) {\n    var x = (fabricObject.points[this.pointIndex].x - fabricObject.pathOffset.x),\n        y = (fabricObject.points[this.pointIndex].y - fabricObject.pathOffset.y);\n\n    return fabric.util.transformPoint(\n        { x: x, y: y },\n        fabric.util.multiplyTransformMatrices(\n            fabricObject.canvas.viewportTransform,\n            fabricObject.calcTransformMatrix()\n        )\n    );\n}\n\n// define a function that will define what the control does\n// this function will be called on every mouse move after a control has been\n// clicked and is being dragged.\n// The function receive as argument the mouse event, the current trasnform object\n// and the current position in canvas coordinate\n// transform.target is a reference to the current object being transformed,\nfunction actionHandler(eventData, transform, x, y) {\n    var polygon = transform.target,\n        currentControl = polygon.controls[polygon.__corner],\n        mouseLocalPosition = polygon.toLocalPoint(new fabric.Point(x, y), 'center', 'center'),\n    polygonBaseSize = polygon._getNonTransformedDimensions(),\n            size = polygon._getTransformedDimensions(0, 0),\n            finalPointPosition = {\n                x: mouseLocalPosition.x * polygonBaseSize.x / size.x + polygon.pathOffset.x,\n                y: mouseLocalPosition.y * polygonBaseSize.y / size.y + polygon.pathOffset.y\n            };\n    polygon.points[currentControl.pointIndex] = finalPointPosition;\n    return true;\n}\n\n// define a function that can keep the polygon in the same position when we change its\n// width/height/top/left.\nfunction anchorWrapper(anchorIndex, fn) {\n    return function(eventData, transform, x, y) {\n        var fabricObject = transform.target,\n            absolutePoint = fabric.util.transformPoint({\n                x: (fabricObject.points[anchorIndex].x - fabricObject.pathOffset.x),\n                y: (fabricObject.points[anchorIndex].y - fabricObject.pathOffset.y),\n            }, fabricObject.calcTransformMatrix()),\n            actionPerformed = fn(eventData, transform, x, y),\n            newDim = fabricObject._setPositionDimensions({}),\n            polygonBaseSize = fabricObject._getNonTransformedDimensions(),\n            newX = (fabricObject.points[anchorIndex].x - fabricObject.pathOffset.x) / polygonBaseSize.x,\n                newY = (fabricObject.points[anchorIndex].y - fabricObject.pathOffset.y) / polygonBaseSize.y;\n        fabricObject.setPositionByOrigin(absolutePoint, newX + 0.5, newY + 0.5);\n        return actionPerformed;\n    }\n}\n\nfunction Edit(canvas) {\n    // clone what are you copying since you\n    // may want copy and paste on different moment.\n    // and you do not want the changes happened\n    // later to reflect on the copy.\n    var group = canvas.getActiveObject();\n    if(group == undefined || group == null){\n        alert(\"Please select a segmentation\")\n        return\n    }\n    \n    if(group._objects == undefined && group.points == undefined){\n        alert(\"Please select a segmentation\")\n        return\n    }\n    var poly;\n    if(group.points == undefined){\n        poly = group._objects[0]\n        var text = group._objects[1]\n        group.destroy()\n        //canvas.remove(text)\n        //canvas.remove(poly)\n        //canvas.remove(group)\n        canvas.add(poly)\n    }else{\n        poly = group\n    }\n    \n\n    canvas.setActiveObject(poly);\n    poly.edit = !poly.edit;\n    if (poly.edit) {\n        var lastControl = poly.points.length - 1;\n        poly.cornerStyle = 'circle';\n        poly.cornerColor = 'rgba(0,0,255,0.5)';\n        poly.controls = poly.points.reduce(function(acc, point, index) {\n                acc['p' + index] = new fabric.Control({\n                    positionHandler: polygonPositionHandler,\n                    actionHandler: anchorWrapper(index > 0 ? index - 1 : lastControl, actionHandler),\n                    actionName: 'modifyPolygon',\n                    pointIndex: index\n                });\n                return acc;\n            }, { });\n    } else {\n        poly.cornerColor = 'blue';\n        poly.cornerStyle = 'rect';\n        poly.controls = fabric.Object.prototype.controls;\n        \n        var display_text = new fabric.Text(poly.local_id.toString(), {\n            fontSize: 20,\n            top: poly.points[0].y,\n            left: poly.points[0].x, \n            uniScaleTransform: false,\n            fill: \"white\",\n        })\n\n        var grouppo = new fabric.Group([poly, display_text]);\n        grouppo['local_id'] = poly.local_id;\n        grouppo.lockMovementY = true;\n        grouppo.lockMovementX = true;\n        canvas.remove(poly);\n        canvas.add(grouppo);\n        console.log(grouppo);\n\n    }\n    poly.hasBorders = !poly.edit;\n    canvas.requestRenderAll();\n}\n\nexport {Edit}","import { Edit } from \"./segmentation_edit\";\nconst fabric = require(\"fabric\").fabric;\nconst $ = require(\"jquery\")\n\nclass Segmentation {\n    generate_polygon(canvas, id, segmentation_flag){\n        var min = 99;\n        var max = 999999;\n        var polygonMode = true;\n        var pointArray = new Array();\n        var lineArray = new Array();\n\n        var activeLine;\n        var activeShape = false;\n\n        var generate_flag = false;\n\n        canvas.forEachObject(function(object){ \n            object.selectable = false; \n        });\n        canvas.selection = false;\n\n        var prototypefabric = new function () {\n                //canvas = window._canvas = new fabric.Canvas('c');\n                //canvas.setWidth($(window).width());\n                //canvas.setHeight($(window).height()-$('#nav-bar').height());\n                canvas.selection = false;\n        \n                canvas.on('mouse:down', function (options) {\n                    canvas.selection = false;\n\n                    if(options.target && options.target.id === pointArray[0].id){\n                        if(generate_flag == false){\n                            prototypefabric.polygon.generatePolygon(pointArray);\n                            generate_flag = true;\n                        }\n                    }\n                    if(polygonMode){\n                        prototypefabric.polygon.addPoint(options);\n                    }\n                });\n                canvas.on('mouse:up', function (options) {\n        \n                });\n                canvas.on('mouse:move', function (options) {\n                    if(activeLine && activeLine.class == \"line\"){\n                        var pointer = canvas.getPointer(options.e);\n                        activeLine.set({ x2: pointer.x, y2: pointer.y });\n        \n                        var points = activeShape.get(\"points\");\n                        points[pointArray.length] = {\n                            x:pointer.x,\n                            y:pointer.y\n                        }\n                        activeShape.set({\n                            points: points\n                        });\n                        canvas.renderAll();\n                    }\n                    //canvas.renderAll();\n                });\n        }();\n        \n        \n        \n        prototypefabric.polygon = {\n            drawPolygon : function() {\n                polygonMode = true;\n                pointArray = new Array();\n                lineArray = new Array();\n            },\n            addPoint : function(options) {\n                var CIRCLE_RADIUS = 2;\n                //var random = Math.floor(Math.random() * (max - min + 1)) + min;\n                //var id = new Date().getTime() + random;\n                var circle = new fabric.Circle({\n                    radius: 2,\n                    fill: '#ffffff',\n                    stroke: '#333333',\n                    strokeWidth: 0.5,\n                    left: (options.e.layerX/canvas.getZoom()),\n                    top: (options.e.layerY/canvas.getZoom()),\n                    selectable: false,\n                    hasBorders: false,\n                    hasControls: false,\n                    originX:'center',\n                    originY:'center',\n                    objectCaching:false\n                });\n                circle.selectable = false;\n                if(pointArray.length === 0){\n                    circle.set({\n                        fill:'red',\n                        zindex: 1\n                    })\n                }else{\n                    circle.set({\n                        zindex: 0\n                    })\n                }\n                \n\n                var points = [(options.e.layerX/canvas.getZoom()),(options.e.layerY/canvas.getZoom()),(options.e.layerX/canvas.getZoom()),(options.e.layerY/canvas.getZoom())];\n                var line = new fabric.Line(points, {\n                    strokeWidth: 2,\n                    fill: '#999999',\n                    stroke: '#999999',\n                    class:'line',\n                    originX:'center',\n                    originY:'center',\n                    selectable: false,\n                    hasBorders: false,\n                    hasControls: false,\n                    evented: false,\n                        objectCaching:false\n                });\n                if(activeShape){\n                    var pos = canvas.getPointer(options.e);\n                    var points = activeShape.get(\"points\");\n                    points.push({\n                        x: pos.x,\n                        y: pos.y\n                    });\n                    var polygon = new fabric.Polygon(points,{\n                        stroke:'#333333',\n                        strokeWidth:1,\n                        fill: '#cccccc',\n                        opacity: 0.3,\n                        selectable: false,\n                        hasBorders: false,\n                        hasControls: false,\n                        evented: false,\n                        objectCaching:false\n                    });\n                    canvas.remove(activeShape);\n                    canvas.add(polygon);\n                    activeShape = polygon;\n                    canvas.renderAll();\n                }\n                else{\n                    var polyPoint = [{x:(options.e.layerX/canvas.getZoom()),y:(options.e.layerY/canvas.getZoom())}];\n                    console.log(polyPoint)\n                    var polygon = new fabric.Polygon(polyPoint,{\n                        stroke:'#333333',\n                        strokeWidth:1,\n                        fill: '#cccccc',\n                        opacity: 0.3,\n                        selectable: false,\n                        hasBorders: false,\n                        hasControls: false,\n                        evented: false,\n                        objectCaching:false\n                    });\n                    activeShape = polygon;\n                    canvas.add(polygon);\n                }\n                activeLine = line;\n        \n                pointArray.push(circle);\n                lineArray.push(line);\n        \n                canvas.add(line);\n                canvas.add(circle);\n                canvas.selection = false;\n            },\n            generatePolygon : function(pointArray){\n                var points = new Array();\n                $.each(pointArray,function(index,point){\n                    points.push({\n                        x:point.left,\n                        y:point.top\n                    });\n                    canvas.remove(point);\n                });\n                $.each(lineArray,function(index,line){\n                    canvas.remove(line);\n                });\n\n                console.log(pointArray)\n                console.log(lineArray)\n\n                var po = new fabric.Polygon(points, {\n                    strokeWidth: 1,\n                    stroke: 'green',\n                    opacity: .5,\n                    scaleX: 1,\n                    scaleY: 1,\n                    objectCaching: false,\n                    transparentCorners: false,\n                    cornerColor: 'blue',\n                    originX: 'center',\n                    originY: 'center'\n                });\n\n                /*po.toObject = (function(toObject) {\n                    return function(propertiesToInclude) {\n                        return fabric.util.object.extend(toObject.call(this, propertiesToInclude), {\n                            local_id: id\n                        });\n                    };\n                })(po.toObject)*/\n                po['local_id'] = id\n                po.lockMovementY = true;\n                po.lockMovementX = true;\n                console.log(id)\n                console.log(po)\n\n                canvas.remove(activeShape);\n                //canvas.add(po);\n\n                segmentation_flag();\n\n                var display_text = new fabric.Text(id.toString(), {\n                    fontSize: 20,\n                    centerX: \"center\",\n                    top: pointArray[0].top,\n                    left: pointArray[0].left, \n                    uniScaleTransform: false,\n                    fill: \"white\",\n                })\n\n                var grouppo = new fabric.Group([po, display_text], {\n\n                })\n                grouppo.lockMovementY = true;\n                grouppo.lockMovementX = true;\n                grouppo['local_id'] = id\n\n                canvas.add(grouppo)\n                //canvas.setActiveObject(grouppo)\n                //Edit(canvas)\n                console.log(grouppo._objects[0])\n                console.log(grouppo)\n                  \n                canvas.remove(activeLine);\n                canvas.remove(activeShape)\n                //canvas.add(polygon);\n        \n                activeLine = null;\n                activeShape = null;\n                polygonMode = false;\n                //canvas.selection = true;\n\n                canvas.forEachObject(function(object){ \n                    object.selectable = true; \n                });\n\n                //return group\n            }\n        };\n        \n        \n        //return prototypefabric.polygon.drawPolygon();\n    }\n}\n\nexport {Segmentation}","const behaviors = [{\n  value: 'Person',\n  label: 'Person'\n},{\n  value: 'Breathing(ir)',\n  label: 'Breathing(ir)'\n},{\n  value: 'Head shake',\n  label: 'Head shake'\n},{\n  value: 'Feeding',\n  label: 'Feeding'\n},{\n  value: 'Nosing',\n  label: 'Nosing'\n},{\n  value: 'Cage biting',\n  label: 'Cage biting'\n},{\n  value: 'Sham chewing',\n  label: 'Sham chewing'\n},{\n  value: 'Foaming',\n  label: 'Foaming'\n},{\n  value: 'Scratching',\n  label: 'Scratching'\n},{\n  value: 'Pawing',\n  label: 'Pawing'\n},{\n  value: 'Rapid movement',\n  label: 'Rapid movement'\n},{\n  value: 'Yawning',\n  label: 'Yawning'\n},{\n  value: 'Resting',\n  label: 'Resting'\n},{\n  value: 'Drinking',\n  label: 'Drinking'\n},{\n  value: 'Elimination',\n  label: 'Elimination'\n},{\n  value: 'Grooming',\n  label: 'Grooming'\n},{\n  value: 'Other',\n  label: 'Other'\n},{\n  value: 'Unknown',\n  label: 'Unknown'\n},]\n\nexport {behaviors};\n","const posture = [{\n  value: 'Lying sternal',\n  label: 'Lying sternal'\n},{\n  value: 'Lying lateral',\n  label: 'Lying lateral'\n},{\n  value: 'Kneeling',\n  label: 'Kneeling'\n},{\n  value: 'Sitting',\n  label: 'Sitting'\n},{\n  value: 'Standing',\n  label: 'Standing'\n},{\n  value: 'Adjusting',\n  label: 'Adjusting'\n},{\n  value: 'Transition',\n  label: 'Transition'\n},]\n\n  export {posture}","const status = [{\n    value: 'Stationary',\n    label: 'Stationary'\n},{\n    value: 'Minor',\n    label: 'Minor'\n},{\n    value: 'Stationary Transition',\n    label: 'Stationary Transition'\n},{\n    value: 'Active Transition',\n    label: 'Active Transition'\n},{\n    value: 'Active',\n    label: 'Active'\n},{\n    value: 'Event',\n    label: 'Event'\n}]\n\nexport {status}","import React from \"react\"; \nimport { Type } from 'react-bootstrap-table2-editor';\nimport {behaviors} from './behaviors'\nimport {posture} from './posture'\nimport {status} from './status'\nimport Button from 'react-bootstrap/Button'\n\nconst columns = (remove_table_index) => [{\n  dataField: \"id\",\n  text: \"ID\",\n  headerStyle: () => { return { width: \"40px\", left: 0 }; },\n  editable: false,\n},{\n  dataField: \"global_id\",\n  text: \"Glo\",\n  headerStyle: () => { return { width: \"50px\", left: 0}; },\n  editCellStyle: (cell, row, rowIndex, colIndex) => {\n    const backgroundColor = cell > 2101 ? '#00BFFF' : '#00FFFF';\n    return { backgroundColor };\n  }\n},{\n  dataField: \"behavior\",\n  text: \"Behavior\",\n  editor: {\n      type: Type.SELECT,\n      options: behaviors,\n  }\n},\n{\n  dataField: \"posture\",\n  text: \"Posture\",\n  editor: {\n      type: Type.SELECT,\n      options: posture,\n  }\n},{\n  dataField: \"remove\",\n  text: \"Del\",\n  editable: false,\n  headerStyle: () => { return { width: \"50px\", left: 0}; },\n  headerFormatter: () => {return (\n    <div>\n      Del\n      <Button\n        className=\"btn btn-danger btn-xs\"\n        onClick={() => remove_table_index()}\n        label=\"Del\"\n      >\n      </Button>\n    </div>\n  );},\n  formatter: (cellContent, row) => {\n    return (\n      <div>        \n        <Button\n          className=\"btn btn-danger btn-xs\"\n            onClick={() => remove_table_index(row.id)}\n            label=\"Del\"\n          >\n        </Button>\n      </div>\n    );\n  },\n}\n]\nexport {columns}","import React from \"react\"; \n\nexport default function Instructions(){\n    return (\n        <div>\n        <h3>Keybinds:</h3>\n\n        There are preset keybinds setup to make it easier to use the tool without having to click around. If done properly a combination of mouse and keyboard actions speed up the annotation process. \n        <br></br><br></br>\n        * <kbd>1</kbd> : Mode Switch: Bounding Box<br></br>\n        * <kbd>2</kbd> : Mode Switch: Key Point<br></br>\n        * <kbd>3</kbd> : Mode Switch: Segmentation<br></br>\n        * <kbd>a</kbd> : Add annotation<br></br>\n        * <kbd>r</kbd> : Remove selected annotation<br></br>\n        * <kbd>q</kbd> : Skip backward frame(s)<br></br>\n        * <kbd>s</kbd> : Save annotation<br></br>\n        * <kbd>w</kbd> : Pause/Play<br></br>\n        * <kbd>e</kbd> : Skip forward frame(s)<br></br>\n        * <kbd>c</kbd> : Copy previous annotation<br></br>\n        * <kbd>f</kbd> : Activate/Deactivate scrub mode (Activated by default)<br></br>\n\n        <br></br><br></br>\n        <h3>Uploading Video:</h3>\n\n        Ensure that you know the framerate, vertical and horizontal resolution of the video chosen to be annotated. These values should be entered into the settings tab into their respective fields. \n        <br></br><br></br>\n        Click on the right side browse button. All other buttons on the screen shuold be disabled until the video has been uploaded. Currenntly ```.mp4``` format is the best choice and tested for. \n        <br></br><br></br>\n        <h3>Annotations</h3>\n        <br></br>\n        There are currently three kinds of annotations. \n        <br></br><br></br>\n        <h4>Bounding Box:</h4>\n\n        This forms a square around the desired object. There should be small squares at the edges of the bounding box which can be used to resize the box. The number on the top left of the box is used to identify the placement of the box in the table to the right.\n        <br></br><br></br>\n        <h4>Key Point:</h4>\n\n        This generates an object with multiple points and lines attached to each other. They should be arranged around the obejct where the singular circle with one connecting line is the head and progress to each of the other limbs. \n\n        ***Note: This feature is currently in development and there will be bugs in using this.***\n        <br></br><br></br>\n        <h4>Segmentation:</h4>\n\n        Upon generating this each click on the video generates a point which eventually will transform to a set of interconnected points. To complete the polygon click on the original point generated (which is the red colored point)\n\n        ***Note: Unline the Bounding Box, segmentation cant be edited after generated. To fix a mistake remove the annotation and continue from the start.***\n\n        </div>\n    )\n}","export async function downloadFileJSON (ANNOTATION_VIDEO_NAME, ANNOTATOR_NAME, frame_data, annotation_data, VIDEO_METADATA) {\n    var fileName = \"generated_annotations\";\n    if(ANNOTATION_VIDEO_NAME !== \"\" && ANNOTATOR_NAME !== \"\"){\n        fileName = ANNOTATION_VIDEO_NAME.split('.').slice(0, -1).join('.') + \"_\" +  ANNOTATOR_NAME\n    }\n    console.log(annotation_data)\n    //const json = JSON.stringify(fabricCanvas.getObjects());\n    const json = JSON.stringify({\"vid_metadata\": VIDEO_METADATA, \"annotations\": frame_data, \"behavior_data\": annotation_data})\n    //var json = JSON.stringify(frame_data);\n    var blob = new Blob([json],{type:'application/json'});\n    var href = await URL.createObjectURL(blob);\n    var link = document.createElement('a');\n    link.href = href;\n    link.download = fileName + \".json\";\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n}\n\nfunction convert_data_csv(data, columns){\n    console.log(columns)\n    var csv = new Array(data.length + 1)\n    for(var i = 0; i < csv.length; i++){\n        csv[i] = []\n    }\n    csv[0].push(\"frame_num\")\n    for(var i = 0; i < columns.length; i++){\n        csv[0].push(columns[i]['dataField'])\n    }\n    for(var i = 0; i < data.length; i++){\n        for(var j = 0; j < data[i].length; j++){\n            csv[i+1][j]=[];\n            var obj = data[i][j]\n            var vals = Object.keys((obj)).map(function (key) { return obj[key]; });\n            csv[i+1][j] = i + \",\" + vals.join(\",\")\n        }\n        csv[i+1] = csv[i+1].join(\"\\n\")\n    }\n    csv = csv.join(\"\\n\")\n    return csv\n}\n\nexport async function downloadFileCSV (ANNOTATION_VIDEO_NAME, ANNOTATOR_NAME, annotation_data, columns) {\n    var fileName = \"generated_annotations\";\n    if(ANNOTATION_VIDEO_NAME !== \"\" && ANNOTATOR_NAME !== \"\"){\n        fileName = ANNOTATION_VIDEO_NAME.split('.').slice(0, -1).join('.') + \"_\" +  ANNOTATOR_NAME\n    }\n    var csv = convert_data_csv(annotation_data, columns(\"\"))\n    var blob = new Blob([csv],{type:'application/octet-stream'});\n    var href = await URL.createObjectURL(blob);\n    var link = document.createElement('a');\n    link.href = href;\n    link.download = fileName + \".csv\";\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n}","import '@tensorflow/tfjs-backend-cpu';\nimport '@tensorflow/tfjs-backend-webgl';\nimport * as cocoSsd from '@tensorflow-models/coco-ssd';\n\nimport {BoundingBox} from '../annotations/bounding_box'\n\nlet modelPromise;\n\nexport async function load(model_type) {\n    alert(\"Loading model\\nThis might take a second or so...\")\n    const model = await cocoSsd.load();\n    model.dispose();\n    modelPromise = cocoSsd.load({base: model_type});\n}\n\nexport async function run_model(fabricCanvas, annotation_data, currentFrame, save_data, refresh) {\n    const image = document.getElementsByTagName(\"video\")[0]\n    console.log(image.height)\n\n    console.log(\"IMAGE CLASSIFICATION\")\n    const model = await modelPromise;\n    console.log('model loaded');\n    console.time('predict1');\n    const result = await model.detect(image);\n    console.timeEnd('predict1');\n\n    for (let i = 0; i < result.length; i++) {\n        var box = result[i].bbox\n        var color = \"#\" + ((1<<24)*Math.random() | 0).toString(16)\n        var new_bbox = new BoundingBox(box[1], box[0], box[2], box[3], color, i+'b', \"None\").generate_no_behavior(fabricCanvas)\n        fabricCanvas.add(new_bbox)\n        annotation_data[currentFrame].push({id: i+'b', global_id: i,status: \"\", current: \"\", behavior: \"\", posture: \"\", notes: \"\"})\n    } \n    save_data(currentFrame)\n    refresh()\n    /*\n    const c = document.getElementById('canvas');\n    const context = c.getContext('2d');\n    //context.drawImage(image, 0, 0);\n    context.font = '10px Arial';\n\n    console.log('number of detections: ', result.length);\n    for (let i = 0; i < result.length; i++) {\n        context.beginPath();\n        context.rect(...result[i].bbox);\n        context.lineWidth = 3;\n        context.strokeStyle = 'red';\n        context.fillStyle = 'red';\n        context.stroke();\n        context.fillText(\n            result[i].score.toFixed(3) + ' ' + result[i].class, result[i].bbox[0],\n            result[i].bbox[1] > 10 ? result[i].bbox[1] - 5 : 10);\n    }\n    console.log(result)\n    //alert(JSON.stringify(result))*/\n};\n","//const tf = require('@tensorflow-models/tfjs-node');\nconst deeplab = require('@tensorflow-models/deeplab');\nconst tfconv = require('@tensorflow/tfjs-converter');\n\nconst fabric = require(\"fabric\").fabric;\nconst $ = require(\"jquery\")\n\nconst loadModel = async () => {\n    const modelName = 'pascal';   // set to your preferred model, either `pascal`, `cityscapes` or `ade20k`\n    const quantizationBytes = 4;  // either 1, 2 or 4\n    return await deeplab.load({base: modelName, quantizationBytes});\n  };\n\n\nexport async function load(){\n\n}\n\nexport async function run_model_segment(fabricCanvas, annotation_data, currentFrame, save_data, refresh) {\n    const image = document.getElementsByTagName(\"video\")[0]\n    console.log(image.height)\n\n    loadModel()\n    .then((model) => model.segment(image))\n    .then(\n        ({segmentationMap, width, height, legend}) =>{\n\n            console.log(segmentationMap);\n            console.log(fabricCanvas.getHeight())\n            console.log(fabricCanvas.getWidth())\n            //let width = fabricCanvas.getWidth();\n            //let height = fabricCanvas.getHeight();\n            var seg_image = new ImageData(segmentationMap, width, height)\n            //fabricCanvas.Image(seg_image)\n\n            var c = document.createElement('canvas');\n\n            c.setAttribute('id', '_temp_canvas');\n            c.width = width;\n            c.height = height;\n\n            c.getContext('2d').putImageData(seg_image, 0, 0);\n\n            fabric.Image.fromURL(c.toDataURL(), function(img) {\n                img.left = 0;\n                img.top = 0;\n                img.opacity = .5;\n                img.scaleX = fabricCanvas.getHeight() / height;\n                img.scaleY = fabricCanvas.getWidth() / width;\n                fabricCanvas.add(img);\n                img.bringToFront();\n                c = null;\n                $('#_temp_canvas').remove();\n                fabricCanvas.renderAll();\n            });\n\n        });\n}\n","export default class ExportingAnnotation{\n    constructor(annotation_data, canvas, VIDEO_METADATA){\n        this.frame_data = annotation_data\n        this.canvas = canvas\n        this.metadata = VIDEO_METADATA\n    }\n\n    get_frame_json(){\n        var standard_annot = new Array(this.frame_data.length)\n        console.log(this.metadata)\n        for(var i = 0; i < this.frame_data.length; i++){\n            var curr = []\n            if(this.frame_data[i] == []){\n                continue;\n            }\n            var frame_objects = this.frame_data[i]['objects']\n            if(frame_objects == undefined){\n                continue;\n            }\n            for(var j = 0; j < frame_objects.length; j++){\n\n                if(frame_objects[j]['objects'][0]['type'] === \"rect\"){\n                    console.log(frame_objects[j])\n                    var x = (frame_objects[j]['left'] / this.canvas.width) * this.metadata['horizontal_res']\n                    var y = (frame_objects[j]['top'] / this.canvas.height) * this.metadata['vertical_res']\n                    var width = ((frame_objects[j]['width'] * frame_objects[j]['scaleX']) / this.canvas.width) * this.metadata['horizontal_res']\n                    var height = ((frame_objects[j]['height'] * frame_objects[j]['scaleY']) / this.canvas.height )* this.metadata['vertical_res']\n                    var local_id = frame_objects[j]['objects'][1]['text']\n                    curr.push({\"type\": \"bounding_box\",\"x\": x, \"y\": y, \"width\": width, \"height\": height, \"local_id\": local_id})\n                }else if (frame_objects[j]['objects'][0]['type'] === \"polygon\"){\n                    var raw_points = frame_objects[j]['objects'][0]['points']\n                    var points = []\n                    for(var k = 0; k < raw_points.length; k++){\n                        var x = (raw_points[k]['x'] / this.canvas.width) * this.metadata['horizontal_res']\n                        var y = (raw_points[k]['y'] / this.canvas.height) * this.metadata['vertical_res']\n                        points.push({\"x\": x, \"y\": y})\n                    }\n                    curr.push({\"type\": \"segmentation\", \"points\": points})\n                }\n\n            }\n            standard_annot[i] = curr\n        }\n        return standard_annot\n    }\n\n    get_frame_coco(){\n\n    }\n}","import React from 'react';\nimport { useState } from 'react';\nimport \"bootstrap/dist/css/bootstrap.min.css\";\n\nimport Navbar from 'react-bootstrap/Navbar'\nimport Nav from 'react-bootstrap/Nav'\nimport Button from 'react-bootstrap/Button'\nimport { NavDropdown, NavLink } from 'react-bootstrap';\nimport Form from 'react-bootstrap/Form'\nimport Dropdown from 'react-bootstrap/Dropdown'\nimport { ButtonGroup } from 'react-bootstrap';\nimport Modal from 'react-bootstrap/Modal'\n\nimport DatePicker from 'react-datepicker'\nimport \"react-datepicker/dist/react-datepicker.css\";\n\nimport Instructions from './instructions';\nimport { downloadFileJSON , downloadFileCSV} from '../../processing/download';\nimport { Edit } from '../../annotations/segmentation_edit';\n\nimport {run_model, load} from '../../tensorflow/ObjectDetection';\nimport { run_model_segment } from '../../tensorflow/SemanticSegmentation';\n\nimport ExportingAnnotation from '../../processing/exporting_annotation';\n\nexport default function CustomNavBar(props){\n\tconst [show, setShow] = useState(false);\n\tconst [uploadShow, setUploadShow] = useState(true);\n\tconst [startDate, setStartDate] = useState(0);\n\t//const [frameRate, setFrameRate] = useState(0)\n\t//const [skipValue, setSkipValue] = useState(0)\n\t//const [playbackRate, setPlaybackRate] = useState(0)\n\t//const [horizontalRes, setHorizontalRes] = useState(0)\n\t//const [verticalRes, setVerticalRes] = useState(0)\n\tconst [videoFormat, setVideoFormat] = useState(0)\n\tconst [videoLink, setVideoLink] = useState(\"\")\n\tconst [model, setModel] = useState(\"\")\n\n\tconst handleClose = () => setShow(false);\n\tconst handleShow = () => setShow(true);\n\tconst handleUploadClose = () => setUploadShow(false)\n\tconst handleUploadShow = () => setUploadShow(true)\n\n\tconst handleDownloadJSON = () => {\n\t\tvar converted_annot = new ExportingAnnotation(props.frame_data, props.fabricCanvas, props.VIDEO_METADATA).get_frame_json()\n\t\tdownloadFileJSON(props.ANNOTATION_VIDEO_NAME, props.ANNOTATOR_NAME, converted_annot, props.annotation_data, props.VIDEO_METADATA)\n\t}\n\n\tconst handleDownloadCSV = () => {\n\t\tdownloadFileCSV(props.ANNOTATION_VIDEO_NAME, props.ANNOTATOR_NAME, props.annotation_data, props.columns)\n\t}\n\n\tconst handleSetStartDate = (date) => {\n\t\tsetStartDate(date)\n\t\ttry { //Making sure that any garbage input taken care of\n\t\t\tprops.setDateTime(Math.floor((date.getTime() / 1000)))\n\t\t} catch (error) {\n\t\t\talert(\"Invalid date input!\")\n\t\t}\n\t}\n\n\tconst handleVideoFormat = (type) => {\n\t\tconsole.log(type)\n\t\tif(type === 0){\n\t\t\tsetVideoFormat(0)\n\t\t}else{\n\t\t\tsetVideoFormat(1)\n\t\t}\n\t}\n\n\tconst handleEnableModel = (event) => {\n\t\t//Defualt value is true which is disbaled. False turns it on!\n\t\tif(model === \"\"){\n\t\t\talert(\"Please select a model\")\n\t\t}\n\t\tload(model)\n\t}\n\n\tconst handleVideoLink = (event) => {\n\t\tsetVideoLink(event.target.value)\n\t\tconsole.log(event.target.value)\n\t}\n\n\tconst edit_click = (event) => {\n\t\tEdit(props.fabricCanvas)\n\t}\n\n\t/* TODO Add local storgae option\n\tif (localStorage.getItem('frame_data') != null){\n\t\talert(\"There is some data stored\")\n\t\tprops.annotation_data = localStorage.getItem('annotation_data');\n\t\tprops.frame_data = localStorage.getItem('frame_data');\n\t}*/\n\n\treturn (\n\t\t<div>\n\t\t<Modal show={show} onHide={handleClose} size='lg'>\n\t\t\t<Modal.Header closeButton>\n\t\t\t<Modal.Title>Instructions</Modal.Title>\n\t\t\t</Modal.Header>\n\t\t\t<Modal.Body><Instructions></Instructions></Modal.Body>\n\t\t\t<Modal.Footer>\n\t\t\t<Button variant=\"secondary\" onClick={handleClose}>Close</Button>\n\t\t\t</Modal.Footer>\n\t\t</Modal>\n\t\t<Modal show={uploadShow} onHide={handleUploadClose} size='lg'>\n\t\t\t<Modal.Header closeButton>\n\t\t\t\t<Modal.Title>Upload</Modal.Title>\n\t\t\t</Modal.Header>\n\t\t\t<Modal.Body>\n\t\t\t\t<div style={{display: \"grid\"}}>\n\t\t\t\t\t{/*onClick and onBlur events are for the sole purpose to stop the eventKeys from firing off*/}\n\t\t\t\t\t<Form style={{float: \"left\",gridColumn: 1, gridRow:1, zIndex:99}}>\n\t\t\t\t\t\tVideo Format: \n\t\t\t\t\t\t<Form.Control\n\t\t\t\t\t\t\tas=\"select\"\n\t\t\t\t\t\t\tid=\"inlineFormCustomSelect\"\n\t\t\t\t\t\t\tonChange={(event)=>{handleVideoFormat(event.target.value)}}\n\t\t\t\t\t\t\tdefaultValue={videoFormat}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<option value=\"0\">Upload</option>\n\t\t\t\t\t\t\t<option value=\"1\">Youtube</option>\n\t\t\t\t\t\t</Form.Control>\n\t\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\t</Form>\n\t\t\t\t\t<div style={{float: \"left\",gridColumn: 1, gridRow:2, zIndex:99}}>\n\t\t\t\t\t\tAnnotator Name: <input type='text' defaultValue={props.ANNOTATOR_NAME} onClick={(event) => {props.toggleKeyCheck(false)}} onBlur={(event) => {props.toggleKeyCheck(true)}} onChange={(event) => {props.change_annotator_name(event.target.value)}}></input>\n\t\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style={{float: \"left\",gridColumn: 1, gridRow:3, zIndex:99}}>\n\t\t\t\t\t\t<text>Date and Time: </text>\n\t\t\t\t\t\t<DatePicker\n\t\t\t\t\t\t\tselected={startDate}\n\t\t\t\t\t\t\tonChange={(date) => {handleSetStartDate(date)}}\n\t\t\t\t\t\t\ttimeInputLabel=\"Time:\"\n\t\t\t\t\t\t\tdateFormat=\"yyyy/MM/dd hh:mm\"\n\t\t\t\t\t\t\tshowTimeInput\n\t\t\t\t\t\t\tonClick={(event) => {props.toggleKeyCheck(false)}}\n\t\t\t\t\t\t\tonClickOutside={(event) => {props.toggleKeyCheck(true)}}\n\t\t\t\t\t\t\tonCalendarOpen={(event) => {props.toggleKeyCheck(false)}}\n\t\t\t\t\t\t\tonCalendarClose={(event) => {props.toggleKeyCheck(true)}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\t</div>\n\t\t\t\t\t{videoFormat === 0 && \n\t\t\t\t\t\t<Form style={{float: \"left\",gridColumn: 1, gridRow:4}}>\n\t\t\t\t\t\t\t<Form.File id=\"file\" label=\"Video Upload\" accept=\".mp4\" custom type=\"file\" onChange={props.handleVideoUpload} />\n\t\t\t\t\t\t</Form>\n\t\t\t\t\t}\n\t\t\t\t\t{videoFormat === 1 &&\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<text>Youtube URL: </text>\n\t\t\t\t\t\t\t<input onChange={handleVideoLink}></input>\n\t\t\t\t\t\t\t<Button onClick={(event) => {props.handleVideoUpload(videoLink)}}>Upload</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t}\n\t\t\t\t\t<Form style={{float: \"left\",gridColumn: 1, gridRow:5}}>\n\t\t\t\t\t\t<Form.File disabled={props.disable_buttons} accept=\".json\" id=\"file\" label=\"Annotation Upload\" custom type=\"file\" onChange={props.handleOldAnnotation}/>\n\t\t\t\t\t</Form>\n\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\tFrame Rate: <input type=\"number\" value={props.frame_rate} onClick={(event) => {props.toggleKeyCheck(false)}} onBlur={(event) => {props.toggleKeyCheck(true)}} onChange={(event) => {props.setFrameRate(parseInt(event.target.value))}}></input>\n\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\tSkip Value: <input type='number' defaultValue=\"1\" onChange={(event) => {props.change_skip_value(parseInt(event.target.value))}}></input>\n\t\t\t\t\tPlayback Rate: <input type='number' defaultValue=\"1\" onChange={(event) => {props.handleSetPlaybackRate(parseInt(event.target.value))}}></input>\n\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\t<div>\n\t\t\t\t\t\tEnable Object Detection Model:{' '}\n\t\t\t\t\t\t<select defaultValue={model} onChange={(event) => {setModel(event.target.value)}} id='base_model'>\n\t\t\t\t\t\t\t<option value=\"\">Select</option>\n\t\t\t\t\t\t\t<option value=\"lite_mobilenet_v2\">SSD Lite Mobilenet V2</option>\n\t\t\t\t\t\t\t<option value=\"mobilenet_v1\">SSD Mobilenet v1</option>\n\t\t\t\t\t\t\t<option value=\"mobilenet_v2\">SSD Mobilenet v2</option>\n\t\t\t\t\t\t</select>{' '}\n\t\t\t\t\t\t<Button size='sm' variant='outline-success' onClick={handleEnableModel}>Enable</Button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t</div>\n\t\t\t</Modal.Body>\n\t\t\t<Modal.Footer>\n\t\t\t<Button variant=\"secondary\" onClick={handleUploadClose}>Close</Button>\n\t\t\t</Modal.Footer>\n\t\t</Modal>\n\t\t<Navbar sticky=\"top\" bg=\"dark\" variant=\"dark\" className=\"bg-5\">\n\t\t\t\t<Navbar.Brand href=\"#home\">AVAT</Navbar.Brand>\n\t\t\t\t<Nav className=\"mr-auto\">\n\t\t\t\t\t\t<NavDropdown disabled={props.disable_buttons} title=\"Export\" id=\"basic-nav-dropdown\">\n\t\t\t\t\t\t\t<NavDropdown.Item onClick={handleDownloadJSON}>JSON</NavDropdown.Item>\n\t\t\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\t\t\t<NavDropdown.Item onClick={handleDownloadCSV}>CSV</NavDropdown.Item>\n\t\t\t\t\t\t</NavDropdown>\n\t\t\t\t\t\t<NavLink onClick={handleShow}>Instructions</NavLink>\n\t\t\t\t\t\t<NavLink onClick={props.handle_link_open}>Report</NavLink>\n\t\t\t\t</Nav>\n\t\t\t\t<div>\n\t\t\t\t\t{\n\t\t\t\t\t\tmodel.length > 0 &&\n\t\t\t\t\t\t<Button id=\"run\" variant=\"outline-info\" onClick={(event) => {run_model_segment(props.fabricCanvas, props.annotation_data, props.currentFrame, props.save_data, props.handle_visual_toggle); props.handle_visual_toggle();}}>Run model</Button>\n\t\t\t\t\t}\n\t\t\t\t\t<Button variant=\"outline-success\" onClick={handleUploadShow}>Upload</Button>{' '}\n\t\t\t\t\t<Button variant=\"outline-success\" onClick={edit_click}>Edit Seg</Button>{' '}\n\t\t\t\t\t<Dropdown as={ButtonGroup}>\n\t\t\t\t\t\t<Button variant=\"secondary\" disabled={true}>{props.display_frame_num}</Button>{' '}\n\t\t\t\t\t\t<Dropdown.Toggle split variant=\"secondary\" id=\"dropdown-split-basic\" />\n\t\t\t\t\t\t<Dropdown.Menu>\n\t\t\t\t\t\t\tSkip Value: <input type='number' defaultValue=\"1\" onChange={(event) => {props.change_skip_value(parseInt(event.target.value))}}></input>\n\t\t\t\t\t\t\tPlayback Rate: <input type='number' defaultValue=\"1\" onChange={(event) => {props.handleSetPlaybackRate(parseInt(event.target.value))}}></input>\n\t\t\t\t\t\t</Dropdown.Menu>\n\t\t\t\t\t</Dropdown>{' '}\n\t\t\t\t\t\n\t\t\t\t\t<Button variant=\"primary\" disabled={props.disable_buttons} onClick={props.skip_frame_backward}>Prev</Button>{' '}\n\t\t\t\t\t<Button variant=\"primary\" disabled={props.disable_buttons} onClick={props.handlePlaying}>{props.play_button_text}</Button>{' '}\n\t\t\t\t\t<Button variant=\"primary\" disabled={props.disable_buttons} onClick={props.skip_frame_forward}>Next</Button>{' '}\n\t\t\t\t\t<Dropdown as={ButtonGroup} drop='left'>\n\t\t\t\t\t\t<Button variant=\"success\" onClick={props.addToCanvas}>Add</Button>\n\t\t\t\t\t\t<Dropdown.Toggle split variant=\"success\" id=\"dropdown-split-basic\" />\n\t\t\t\t\t\t<Dropdown.Menu>\n\t\t\t\t\t\t\t<Dropdown.Item onClick={(event) =>{props.change_annotation_type(\"1\")}}>Behavior Annotation</Dropdown.Item>\n\t\t\t\t\t\t\t<Dropdown.Item onClick={(event) =>{props.change_annotation_type(\"2\")}}>BoundingBox</Dropdown.Item>\n\t\t\t\t\t\t\t<Dropdown.Item onClick={(event) =>{props.change_annotation_type(\"3\")}}>KeyPoint</Dropdown.Item>\n\t\t\t\t\t\t\t<Dropdown.Item onClick={(event) =>{props.change_annotation_type(\"4\")}}>Segmentation</Dropdown.Item>\n\t\t\t\t\t\t</Dropdown.Menu>\n\t\t\t\t\t</Dropdown>\n\t\t\t\t\t{/*<Button variant=\"danger\" onClick={remove} disabled={disable_buttons} style={{position:\"relative\"}}>Remove</Button>{' '}*/}\n\t\t\t\t</div>\n\t\t</Navbar>\n\t\t</div>\n\t)\n}","import React from 'react';\nimport ReactDOM from 'react-dom'\n\nexport default class FabricRender extends React.Component{\n    componentDidMount() {\n        var el = ReactDOM.findDOMNode(this);\n  \n      //alert(\"Loaded player: \\nHorizontal Resolution = \" + scaling_factor_width + \"\\nVertical Resolution = \" + scaling_factor_height)\n      // Here we have the canvas so we can initialize fabric\n      this.props.fabricCanvas.initialize(el, {\n          height: this.props.scaling_factor_height,\n        width: this.props.scaling_factor_width,\n        backgroundColor : null,\n      });\n      \n      // on mouse up lets save some state\n      this.props.fabricCanvas.on('mouse:up', () => {\n        this.props.save_data(this.props.currentFrame)\n      });\n  \n      this.props.fabricCanvas.on('object:added', this.props.save_data(this.props.currentFrame));\n      this.props.fabricCanvas.on('object:removed', this.props.save_data(this.props.currentFrame));\n      this.props.fabricCanvas.on('object:modified', this.props.save_data(this.props.currentFrame));\n      \n      // an event we will fire when we want to save state\n      this.props.fabricCanvas.on('saveData', () => {\n        this.props.fabricCanvas.renderAll(); // programatic changes we make will not trigger a render in fabric\n      });\n    }\n\n    render() {\n      return <canvas id=\"canvas\"></canvas>\n    }\n}","import React from \"react\"; \nimport 'bootstrap/dist/css/bootstrap.min.css';\n\nimport BootstrapTable from 'react-bootstrap-table-next';\nimport cellEditFactory, { Type } from 'react-bootstrap-table2-editor';\nimport 'react-bootstrap-table-next/dist/react-bootstrap-table2.min.css';\nimport paginationFactory from 'react-bootstrap-table2-paginator';\n\nimport Tabs from 'react-bootstrap/Tabs'\nimport Tab from 'react-bootstrap/Tab'\nimport Button from 'react-bootstrap/Button'\nimport { FormControl } from \"react-bootstrap\";\n\nconst anno_col = (handler) => [\n    {\n        dataField: \"frame_num\",\n        text: \"Frame\",\n        headerStyle: () => { return { width: \"40px\", left: 0 }; }\n    },{\n        dataField: \"anno_count\",\n        text: \"Count\",\n        headerStyle: () => { return { width: \"40px\", left: 0 }; }\n    },{\n        dataField: \"local_ids\",\n        text: \"Local ID\",\n        headerStyle: () => { return { width: \"40px\", left: 0 }; }\n    },{\n        dataField: \"global_ids\",\n        text: \"Global ID\",\n        headerStyle: () => { return { width: \"40px\", left: 0 }; }\n    },{\n        dataField: \"swap\",\n        text: \"Swap\",\n        editable: false,\n        headerStyle: () => { return { width: \"50px\", left: 0}; },\n        formatter: (cellContent, row) => {\n          return (\n            <Button\n                className=\"btn btn-confirm btn-xs\"\n                label=\"Del\"\n                onClick={() => {handler(row.frame_num)}}\n            >\n                Skip\n            </Button>\n          );\n        },\n      }\n]\n\nfunction getAnnotationTableCount(annotation_data) {\n    var data = []\n    for(var i = 0; i < annotation_data.length; i++){\n        if(annotation_data[i].length !== 0){\n            var txt_id = \"\"\n            var txt_global = \"\"\n            for(var j = 0; j < annotation_data[i].length; j++){\n                txt_id += (annotation_data[i][j]['id']) + ', '\n                txt_global += (annotation_data[i][j]['global_id']) + ', '\n            }\n            data.push({frame_num: i, anno_count: annotation_data[i].length, local_ids: txt_id, global_ids: txt_global})\n        }\n    }\n    return data\n}\n\n\nexport default function AnnotationTable(props){\n    const expandRow = {\n        onlyOneExpanding: true,\n        renderer: (row, rowIndex) => (\n          <div>\n            <FormControl \n                as=\"textarea\" aria-label=\"With textarea\" \n                defaultValue={props.annotation_data[props.currentFrame][rowIndex]['notes']} \n                onChange={(event)=> {handleOnChange(event, rowIndex)}}\n                onClick={(event) => {props.toggleKeyCheck(false)}} \n                onBlur={(event) => {props.toggleKeyCheck(true)}}\n            />\n          </div>\n        )\n    };\n\n    const handleOnChange = (event, rowIndex) => {\n        console.log(props.annotation_data[props.currentFrame]);\n        props.annotation_data[props.currentFrame][rowIndex]['notes'] = (event.target.value);\n        console.log(props.annotation_data[props.currentFrame]) \n    }\n\n    var data = getAnnotationTableCount(props.annotation_data)\n    //console.log(input.data)\n    return (\n        <Tabs defaultActiveKey=\"home\" id=\"uncontrolled-tab-example\">\n            <Tab eventKey=\"home\" title=\"Current\">\n                <BootstrapTable\n                    keyField='id'\n                    data={props.annotation_data[props.currentFrame]} \n                    columns={props.columns(props.remove_table_index)}\n                    table\n                    noDataIndication={ () => <div>No recorded annotations or behaviors for this frame<br/>Please add an annotation or behavior tag to start.</div> }\n                    cellEdit={\n                        cellEditFactory({ mode: 'click', blurToSave: true,\n                            afterSaveCell: (oldValue, newValue, row, column) => {\n                                console.log(row)\n                                //var notes = props.annotation_data[props.currentFrame][row['id']]['notes']\n                                //props.annotation_data[props.currentFrame][row['id']] = row\n                                //props.annotation_data[props.currentFrame][row['id']]['notes'] = notes\n                                props.toggleKeyCheck(true)\n                            },\n                            onStartEdit: (row, column, rowIndex, columnIndex) => {\n                                props.toggleKeyCheck(false)\n                            }\n                        }) \n                    }\n                    pagination={ paginationFactory() }\n                    expandRow={ expandRow }\n                />\n            </Tab>\n            <Tab eventKey=\"profile\" title=\"Previous\">\n                <BootstrapTable\n                    keyField='frame_num'\n                    data={data} \n                    columns={anno_col((props.handleSetCurrentFrame))}\n                    table\n                    noDataIndication={ () => <div>No recorded annotations or behaviors for this video.</div> }\n                    pagination={ paginationFactory() }\n                />\n            </Tab>\n        </Tabs>\n    )\n}","//Core imports\nimport React, { useEffect, useState } from \"react\"; \nimport ReactPlayer from 'react-player'\nimport 'bootstrap/dist/css/bootstrap.min.css';\n\n//UI Element imports\nimport Toast from 'react-bootstrap/Toast'\n\n//Processing\nimport ExtractingAnnotation from '../../processing/annotation-processing'\nimport {video_to_img} from '../../processing/frame_extract'\n\n//Annotations\nimport { BoundingBox } from '../../annotations/bounding_box'\nimport { KeyPoint } from '../../annotations/key_point'\nimport { Segmentation } from '../../annotations/segmentation'\nimport { Edit } from \"../../annotations/segmentation_edit\";\n\n//Column information + data structure\nimport {columns} from '../../static_data/columns'\n//import {columns_LPS} from '../../static_data/columns'\nimport {ANNOTATION_FRAME, ANNOTATION_BBOX, ANNOTATION_KEYPOINT, ANNOTATION_SEG} from '../../static_data/constants'\n\n//Components\nimport CustomNavBar from \"../Components/nav_bar\";\nimport FabricRender from \"../Components/fabric_canvas\";\nimport AnnotationTable from \"../Components/change_table\";\n\n//TODO add local storage functionality to auto-save\nif (typeof(Storage) === \"undefined\") {\n  // Code for localStorage/sessionStorage.\n  alert('Your browser does not support local storage. \\nSome autosaving features of the app will not work as intended.\\nPlease see the documentation to find supported browsers and their versions')\n}\n\nconst fabric = require(\"fabric\").fabric;\n\n//TODO ADD DYNAMIC SOLUTION \nvar frame_rate = 15;\nvar num_frames = -1;\nvar scaling_factor_width = 1920;\nvar scaling_factor_height = 1080;\nvar skip_value = 1;\n\nconsole.log(window.screen.width)\nconsole.log(window.screen.height)\n\n//var current_screen_width = window.screen.width;\nvar current_screen_height = window.screen.height;\n\n//Mappings are based off of https://en.wikipedia.org/wiki/List_of_common_resolutions make sure to use 1:1 and 16:9 aspect ratio\n/*if (current_screen_height >= 1440){\n  scaling_factor_width = 1920;\n  scaling_factor_height = 1080;\n}else */if(current_screen_height >= 1080){\n  scaling_factor_width = 1280;\n  scaling_factor_height = 720;\n}else if(current_screen_height >= 1024){\n  scaling_factor_width = 1152;\n  scaling_factor_height = 648;\n}else if(current_screen_height >= 768){\n  scaling_factor_width = 1024;\n  scaling_factor_height = 576;\n}\n\n// globally accessable fabricCanvas instance\nvar fabricCanvas = new fabric.Canvas('c', {\n\tuniScaleTransform: true,\n\tuniformScaling: false,\n\tincludeDefaultValues: false\n});\n\nfabricCanvas.on('mouse:over', function(e) {\n\tif(e.target == null){\n\t\treturn;\n\t}\n    e.target.set('fill', 'red');\n    fabricCanvas.renderAll();\n  });\n\nvar video_width = 0;\nvar video_height = 0;\nvar frame_data = [[]];\nvar annotation_data = [[]];\nvar upload = false;\nvar disable_buttons = true;\nvar sliderPercent = 0\nvar toast_text = \"\"\nvar previous_annotation = []\nvar previous_canvas_annotation = []\nvar ANNOTATOR_NAME = \"\"\nvar ANNOTATION_VIDEO_NAME = \"\"\nvar VIDEO_METADATA = {}\nvar play_button_text = \"ERROR\"\nvar temp_flag = false\nvar time_unix = 0;\nvar segmentation_flag = false;\n\n\nfunction save_data(frame_num){\n\tif(fabricCanvas.getObjects().length != 0){\n\t\tframe_data[frame_num] = fabricCanvas.toJSON()\n\t}else{\n\t\tframe_data[frame_num] = []\n\t}\n\tconsole.log(frame_data)\n\tconsole.log(\"SAVED\")\n}\n\nfunction save_localstorage(){\n\tconsole.log(frame_data)\n\ttry{\n\t\t//localStorage.setItem('frame_data', JSON.stringify(frame_data))\n\t\t//localStorage.setItem('annotation_data', JSON.stringify(annotation_data))\n\t} catch (error){\n\t\tconsole.log(\"Local storage failed!\")\n\t}\n}\n\n\n//Current frame counter\nexport default function MainUpload() {\n\tconst [visualToggle, setVisualToggle] = useState(0);\n\tconst [annotationType, setAnnotationType] = useState(\"1\")\n\tconst [boxCount, setBoxCount] = useState(0)\n\tconst [videoFilePath, setVideoFileURL] = useState(null);\n\tconst [videoFilePath1, setVideoFileURL1] = useState(null);\n\tconst [oldAnnotation, setOldAnnotation] = useState(null)\n\tconst [player, setPlayer] = useState(null)\n\tconst [duration, setDuration] = useState(0);\n\tconst [show, setShow] = useState(false);\n\tconst [save, changeSave] = useState(false);\n\tconst [seeking, setSeeking] = useState(false)\n\tconst [playing, setPlaying] = useState(false);\n\tconst [currentFrame, setCurrentFrame] = useState(0)\n\tconst [keyCheck, changeKeyCheck] = useState(true)\n\tconst [playbackRate, setPlaybackRate] = useState(1)\n\n\t\n\n\tconst handleSetCurrentFrame = (val) => {\n\t\tvar total_frames = duration * frame_rate\n\t\tif(typeof(val) === \"number\"){\n\t\t\tsetCurrentFrame(val)\n\t\t\tvar new_skip = val/(total_frames)\n\t\t\tif(new_skip > duration){\n\t\t\t\tnew_skip = duration\n\t\t\t}\n\t\t\tplayer.seekTo(new_skip)\n\t\t}else{\n\t\t\tconsole.log(val['played'])\n\t\t\tsave_data(currentFrame)\n\t\t\tvar frame_calc = (val['played']/total_frames)\n\t\t\tframe_calc = (Math.floor(val['played']*total_frames))\n\t\t\tif((play_button_text === \"Play\" && temp_flag === true) | play_button_text === \"Pause\"){\n\t\t\t\tif(frame_calc >= total_frames){\n\t\t\t\t\tsetCurrentFrame(total_frames-1)\n\t\t\t\t\ttemp_flag = false;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tsetCurrentFrame(frame_calc)\n\t\t\t\ttemp_flag = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tconst removeRow = (index) => {\n\t\tconsole.log(index)\n\t\tvar index_num = 0;\n\n\t\tfor(var i = 0; i < annotation_data[currentFrame].length; i++){\n\t\t\tif(annotation_data[currentFrame][i]['id'] == index){\n\t\t\t\tindex_num = i\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif(index.substring(index.length-1, index.length) !== \"f\"){\n\t\t\tvar current_objects = fabricCanvas.getObjects()\n\t\t\tconsole.log(current_objects)\n\t\t\tfor(var i = 0; i < current_objects.length; i++){\n\t\t\t\tif(current_objects[i]['_objects'][1]['text'] === index){\n\t\t\t\t\tfabricCanvas.remove(current_objects[i]);\n\t\t\t\t\tfabricCanvas.fire('saveData');\n\t\t\t\t\tconsole.log(fabricCanvas.getObjects())\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconsole.log(index_num)\n\t\tannotation_data[currentFrame].splice(index_num, 1)\n\t\tsave_data(currentFrame)\n\t\t\n\t}\n\n\tconst remove_table_index = (index) => {\n\t\tconsole.log(index)\n\t\tif (index === undefined) {\n\t\t\tconsole.log(annotation_data[currentFrame].length)\n\t\t\tvar indiciesToDelete = []\n\t\t\tfor(var i = 0; i < annotation_data[currentFrame].length; i++){\n\t\t\t\tindiciesToDelete.push(annotation_data[currentFrame][i]['id'])\n\t\t\t}\n\t\t\tconsole.log(indiciesToDelete)\n\t\t\tindiciesToDelete.map(x => removeRow(x))\n\t\t\t\n\t\t\tconsole.log(annotation_data[currentFrame].length)\n\t\t}else{\n\t\t\tremoveRow(index)\n\t\t}\n\t\t//TODO make this more elegant - Currently makes a random number since the state change using an incremental update to the integer caused a stop of state updates and did not respond to any changes. This forces the values to be changed on random and should not have any dependence of the previous value of the visual toggle state.\n\t\tsetVisualToggle(Math.floor(Math.random() * 999999999999))\n\t}\n\t\n\t\n\n\tconst save_previous_data = () => {\n\t\tif(annotation_data[currentFrame].length == 0){\n\t\t\treturn;\n\t\t}\n\t\tprevious_annotation = annotation_data[currentFrame]\n\t\tprevious_canvas_annotation = frame_data[currentFrame]\n\t}\n\n\tconst addToCanvas = () =>{\n\t\tvar color = \"#\" + ((1<<24)*Math.random() | 0).toString(16)\n\t\t\n\t\tif(annotation_data[currentFrame] == null){\n\t\t\tannotation_data[currentFrame] = []\n\t\t}\n\t\tif (segmentation_flag == true){\n\t\t\talert(\"Please finish your current segmentation!\")\n\t\t\treturn\n\t\t}\n\t\t\n\t\tvar annotation_type_txt = \"error\"\n\n\t\tif (annotationType === ANNOTATION_BBOX){\n\t\t\tannotation_type_txt = \"b\"\n\t\t\tvar new_bbox = new BoundingBox(fabricCanvas.height/2, fabricCanvas.width/2, 50, 50, color, boxCount+'b', \"None\").generate_no_behavior(fabricCanvas)\n\t\t\tfabricCanvas.add(new_bbox)\n\t\t}else if (annotationType === ANNOTATION_KEYPOINT){\n\t\t\t//TODO fix KeyPoint\n\t\t\talert(\"KeyPoint annotation are currently unavailable\")\n\t\t\tannotation_type_txt = \"k\"\n\t\t\tvar keyp = new KeyPoint().generate_stick(fabricCanvas)\n\t\t}else if (annotationType === ANNOTATION_SEG){\n\t\t\t//TODO Fix segmentation issues\n\t\t\tannotation_type_txt = \"s\"\t  \n\n\t\t\tvar segment = new Segmentation().generate_polygon(fabricCanvas, boxCount+'s', toggle_segmentation)\n\t\t\ttoggle_segmentation()\n\n\t\t}else if(annotationType === ANNOTATION_FRAME){\n\t\t\t//TODO Add annotation frame datapoint\n\t\t\tannotation_type_txt = \"f\"\n\t\t}\n\t\tannotation_data[currentFrame].push({id: boxCount+annotation_type_txt, global_id: -1,status: \"\", current: \"\", behavior: \"\", posture: \"\", notes: \"\"})\n\t\tconsole.log(annotation_data[currentFrame])\n\t\tsave_data(currentFrame)\n\t\tsetBoxCount(boxCount + 1);\n\t\tfabricCanvas.fire('saveData');\n\t}\n\n\tconst toggle_segmentation = (event) => {\n\t\tsegmentation_flag = !segmentation_flag\n\t}\n\n\tconst handleVideoUpload = (event) => {\n\t\tconsole.log(typeof(event))\n\t\t//Youtube upload\n\t\tif(typeof(event) === \"string\"){\n\t\t\tsetVideoFileURL(event)\n\t\t\tANNOTATION_VIDEO_NAME = event\n\t\t\t/*if(localStorage.getItem('ANNOTATION_VIDEO_NAME') != null){\n\t\t\t\tif(window.confirm(\"Past annotation for same video detected. Do you want to use the last saved annotations?\")){\n\t\t\t\t\tannotation_data = JSON.parse(localStorage.getItem('annotation_data'))\n\t\t\t\t\tframe_data = JSON.parse(localStorage.getItem('frame_data'))\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tlocalStorage.setItem('ANNOTATION_VIDEO_NAME', ANNOTATION_VIDEO_NAME)\n\t\t\t}*/\n\t\t\tupload = true;\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tANNOTATION_VIDEO_NAME = event.target.files[0]['name']\n\t\t//File upload\n\t\t/*if(localStorage.getItem('ANNOTATION_VIDEO_NAME') != null){\n\t\t\tif(window.confirm(\"Past annotation for same video detected. Do you want to use the last saved annotations?\")){\n\t\t\t\tannotation_data = JSON.parse(localStorage.getItem('annotation_data'))\n\t\t\t\tframe_data = JSON.parse(localStorage.getItem('frame_data'))\n\t\t\t\tconsole.log(frame_data)\n\t\t\t}\n\t\t}else{\n\t\t\tlocalStorage.setItem('ANNOTATION_VIDEO_NAME', ANNOTATION_VIDEO_NAME)\n\t\t}*/\n\t\tsetVideoFileURL(URL.createObjectURL(event.target.files[0]));\n\t\tvideo_to_img(event.target.files[0], fabricCanvas)\n\t\tupload = true;\n\t};\n\n\t//ASYNC Function  - To note that the data that comes out of this will be a bit delayed and this could cause some issues.\n\tconst handleOldAnnotation = (event) => {\n\t\tvar promise = downloadOldAnnotation(event)\n\t\tpromise.then(function (result) {\n\t\t\tif(result != null){\n\t\t\t\tsetOldAnnotation(new ExtractingAnnotation(result, fabricCanvas));\n\t\t\t}else{\n\t\t\t\talert(\"Error in processing Annotation\")\n\t\t\t}\n\t\t})\n\t}\n\n\tuseEffect(() => {\n\t\t//TODO Find a more elegant solution. This is a temporay patch work.\n\t\tif(oldAnnotation == null){\n\t\t\treturn;\n\t\t}\n\t\tframe_data = oldAnnotation.get_frame_data();\n\t\tannotation_data = oldAnnotation.get_annotation_data();\n\t\thandle_visual_toggle()\n\t}, oldAnnotation);\n\n\tconst downloadOldAnnotation = (file) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\tvar reader = new FileReader();\n\t\treader.onload = function(e) {\n\t\t\tresolve((JSON.parse(e.target.result)));\n\t\t}\n\t\treader.readAsText(file.target.files[0])\n\t\t})\n\t}\n  \n\n\tconst handlePlaying = (event) => {\n\t\t//if(window.confirm(\"Are you sure you want to use the play/pause functionality?\\n It is currenlty under development and WILL have unintentional bugs and glitches. \\nReload the page if any issues arise\") === true && play_button_text === \"Play\"){\n\t\t//}\n\t\tif(play_button_text === \"Pause\"){\n\t\t\ttemp_flag = true;\n\t\t}\n\t\tsetPlaying(!playing)\n\t\tsave_previous_data()\n\t}\n\n\n\tif(playing === true){\n\t\tplay_button_text = \"Pause\"\n\t}else{\n\t\tplay_button_text = \"Play\"\n\t}\n\n\tconst handleSeekChange = e => {\n\t\tsliderPercent = (parseFloat(e.target.value))\n\t\tconsole.log(sliderPercent)\n\t}\n\n\tconst handleSeekMouseDown = e => {\n\t\tsetSeeking(true)\n\t}\n\n\tconst handleSeekMouseUp = e => {\n\t\tsetSeeking(false)\n\t\tplayer.seekTo(parseFloat(e.target.value))\n\t}\n\n\tconst handleSetPlayer = val => {\n\t\tif(val != null){\n\t\tif(val['player'] != null){\n\t\t\tif(val['player']['player'] != null){\n\t\t\t\t\tif(val['player']['player'] != null){\n\t\t\t\t\t\tvideo_width = val['player']['player']['player'].videoWidth\n\t\t\t\t\t\tvideo_height = val['player']['player']['player'].videoHeight\n\t\t\t\t\t\tvar duration = val['player']['player']['player'].duration\n\t\t\t\t\t\tVIDEO_METADATA = {name: ANNOTATION_VIDEO_NAME, duration: duration, horizontal_res: video_width, vertical_res: video_height, frame_rate: frame_rate, time: time_unix}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tsetPlayer(val)\n\t}\n\n\tconst handleSetDuration = val => {\n\t\tif(upload === true && player != null){      \n\t\t\tnum_frames = Math.round(val * frame_rate);\n\n\t\t\tif(annotation_data[0].length == 0){\n\t\t\t\tconsole.log(\"Resetting frame_data and annotation_data\")\n\t\t\t\tframe_data = new Array(num_frames)\n\t\t\t\tannotation_data = new Array(num_frames)\n\t\t\t\t//TODO Update this later\n\t\t\t\tfor (var i = 0; i < num_frames; i++){\n\t\t\t\t\tframe_data[i] = []\n\t\t\t\t\tannotation_data[i] = []\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//upload = false;\n\t\t\tdisable_buttons = false\n\t\t}\n\t\tsetDuration(parseInt(val))\n\t}\n\n\tconst [scrubbing, setScrubbing] = useState(true);\n\n\tconst skip_frame_forward = e =>{\n\t\tsave_previous_data()\n\t\tif(scrubbing === false){\n\t\t\tif (annotation_data[currentFrame+skip_value].length === 0){\n\t\t\t\tannotation_data[currentFrame+skip_value] = JSON.parse(JSON.stringify(annotation_data[currentFrame]));\n\t\t\t\tframe_data[currentFrame+skip_value] = frame_data[currentFrame];\n\t\t\t}\n\t\t}\n\n\t\tvar total_frames = duration * frame_rate\n\t\t//player.seekTo((((player.getCurrentTime()/duration)*total_frames))/(total_frames) + (skip_value/total_frames))\n\n\t\tvar frameVal = currentFrame + skip_value\n\t\tif(frameVal >= total_frames){\n\t\t\thandleSetCurrentFrame(total_frames-1)\n\t\t}else{\n\t\t\thandleSetCurrentFrame(frameVal)\n\t\t}\n\t}\n\n\tconst skip_frame_backward = e => {\n\t\tsave_previous_data()\n\t\tvar total_frames = duration * frame_rate\n\n\t\tvar frameVal = currentFrame - skip_value\n\t\tif(frameVal < 0){\n\t\t\thandleSetCurrentFrame(0)\n\t\t}else{\n\t\t\thandleSetCurrentFrame(frameVal)\n\t\t}\n\t\t//player.seekTo((frameVal/total_frames) * duration)\n\t\t//player.seekTo((((player.getCurrentTime()/duration)*total_frames))/(total_frames) - (skip_value/total_frames))\n\t}\n\n\tconst change_skip_value = (event) => {\n\t\tskip_value = event\n\t}\n\n\tconst change_annotation_type = (event) => {\n\t\tconsole.log(event)\n\t\tsetAnnotationType(event)\n\t}\n\n\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\tconst onKeyPress = (event) =>{\n\t\t//Making sure input for textbox doesnt get counted as a mode change\n\t\tif(keyCheck === false){\n\t\t\treturn;\n\t\t}\n\n\t\tif (event.key === ANNOTATION_BBOX){\n\t\t\ttoast_text = \"Mode Switch: Bounding Box\"\n\t\t\tchangeSave(true)\n\t\t\tsetAnnotationType(ANNOTATION_BBOX)\n\t\t}else if (event.key === ANNOTATION_KEYPOINT){\n\t\t\ttoast_text = \"Mode Switch: Key Point\"\n\t\t\tchangeSave(true)\n\t\t\tsetAnnotationType(ANNOTATION_KEYPOINT)\n\t\t}else if(event.key === ANNOTATION_SEG) {\n\t\t\ttoast_text = \"Mode Switch: Segmentation\"\n\t\t\tchangeSave(true)\n\t\t\tsetAnnotationType(ANNOTATION_SEG)\n\t\t}else if(event.key === ANNOTATION_FRAME){\n\t\t\ttoast_text = \"Mode Switch: Behavior Annotation\"\n\t\t\tchangeSave(true)\n\t\t\tsetAnnotationType(ANNOTATION_FRAME)\n\t\t}else if (event.key === \"a\"){\n\t\t\tvar annotext = \"\"\n\t\t\tif(annotationType === ANNOTATION_BBOX){\n\t\t\t\tannotext = \"Bounding Box\"\n\t\t\t}else if(annotationType === ANNOTATION_FRAME){\n\t\t\t\tannotext = \"Behavior Data\"\n\t\t\t}else if (annotationType === ANNOTATION_KEYPOINT){\n\t\t\t\tannotext = \"Keypoint\"\n\t\t\t}else if (annotationType === ANNOTATION_SEG){\n\t\t\t\tannotext = \"Segmentation\"\n\t\t\t}\n\t\t\ttoast_text = \"Added Annotation - \" + annotext\n\t\t\tif(annotationType !== ANNOTATION_SEG){\n\t\t\t\tchangeSave(true)\n\t\t\t}\n\t\t\taddToCanvas()\n\t\t}else if (event.key === \"q\"){\n\t\t\tsave_localstorage()\n\t\t\tskip_frame_backward()\n\t\t}else if (event.key === \"w\"){\n\t\t\thandlePlaying()\n\t\t}else if (event.key === \"e\"){\n\t\t\tsave_localstorage()\n\t\t\tskip_frame_forward()\n\t\t}else if (event.key === \"s\"){\n\t\t\ttoast_text = \"Annotation Saved\"\n\t\t\tchangeSave(true)\n\t\t\tframe_data[currentFrame] = fabricCanvas.toJSON()\n\t\t}else if (event.key === \"f\"){\n\t\t\tif(scrubbing === false){\n\t\t\t\ttoast_text = \"Scrubbing Mode Activated\"\n\t\t\t\tsetScrubbing(true)\n\t\t\t\tchangeSave(true)\n\t\t\t}else{\n\t\t\t\ttoast_text = \"Scrubbing Mode Deactivated\"\n\t\t\t\tsetScrubbing(false)\n\t\t\t\tchangeSave(true)\n\t\t\t}\n\t\t}else if(event.key === \"c\"){\n\t\t\ttoast_text = \"Copying previous frame annotation\"\n\t\t\tannotation_data[currentFrame] = JSON.parse(JSON.stringify(previous_annotation))\n\t\t\tframe_data[currentFrame] = JSON.parse(JSON.stringify(previous_canvas_annotation))\n\t\t\tchangeSave(true)\n\t\t}\n\t}  \n\n\tuseEffect(() => {\n\t\tdocument.addEventListener(\"keydown\", onKeyPress);\n\t\treturn () => document.removeEventListener(\"keydown\", onKeyPress);\n\t}, [onKeyPress]);\n\t\n\tfabricCanvas.loadFromJSON(frame_data[currentFrame], function() {\n\t\tfabricCanvas.renderAll();\n\t});\n\n\tconst handle_link_open = () => {\n\t\twindow.open(\"https://forms.gle/CrJuYEoT39uFgnR17\", \"_blank\")\n\t}\n\n\tconst change_annotator_name = (event) => {\n\t\tANNOTATOR_NAME = event\n\t\tconsole.log(ANNOTATOR_NAME)\n\t}\n\n\tconst handle_visual_toggle = () => {\n\t\tsetVisualToggle(Math.floor(Math.random() * 999999999999))\n\t}\n\n\tconst handleSetPlaybackRate = (playbackRate) => {\n\t\tconsole.log(playbackRate)\n\t\tif(isNaN(playbackRate)){\n\t\t\tsetPlaybackRate(0)\n\t\t}else if(playbackRate > 16){\n\t\t\talert(\"Max playback rate is 16!\")\n\t\t\tsetPlaybackRate(16)\n\t\t}\t\n\t\telse{\n\t\t\tsetPlaybackRate(playbackRate)\n\t\t}\n\t}\n\n\tconst handleOnPlay = () => {\n\t\tconsole.log(player)\n\n\t}\n\n\tconst toggleKeyCheck = (toggle_val) => {\n\t\tconsole.log(\"Keycheck activated\")\n\t\tconsole.log(toggle_val)\n\t\tif(toggle_val === undefined){\n\t\t\tchangeKeyCheck(!keyCheck)\n\t\t}else{\n\t\t\tchangeKeyCheck(toggle_val)\n\t\t}\n\t}\n\n\tconst setFrameRate = (framerate) => {\n\t\tframe_rate = parseInt(framerate)\n\t\tif (frame_rate > 120){\n\t\t\tframe_rate = 120;\n\t\t}else if(frame_rate <= 0){\n\t\t\tframe_rate = 1;\n\t\t}else if(Number.isFinite(frame_rate) == false){\n\t\t\tframe_rate = 1;\n\t\t\treturn;\n\t\t}\n\t\tconsole.log(Number.isFinite(frame_rate))\n\t\tconsole.log(frame_rate)\n\n\t\tnum_frames = Math.round(duration * frame_rate);\n\t\tif(annotation_data[0].length == 0){\n\t\t\tconsole.log(\"Resetting frame_data and annotation_data\")\n\t\t\tframe_data = new Array(num_frames)\n\t\t\tannotation_data = new Array(num_frames)\n\t\t\t//TODO Update this later\n\t\t\tfor (var i = 0; i < num_frames; i++){\n\t\t\t\tframe_data[i] = []\n\t\t\t\tannotation_data[i] = []\n\t\t\t}\n\t\t\t//TODO make this more elegant - Currently makes a random number since the state change using an incremental update to the integer caused a stop of state updates and did not respond to any changes. This forces the values to be changed on random and should not have any dependence of the previous value of the visual toggle state.\n\t\t\tsetVisualToggle(Math.floor(Math.random() * 999999999999))\n\n\t\t}else{\n\t\t\talert(\"There is data currently annotated! To change frame rate refresh the page and re-upload!\")\n\t\t}\n\t}\n\n\tconst setDateTime = (time) => {\n\t\ttime_unix = time;\n\t\tVIDEO_METADATA = {name: ANNOTATION_VIDEO_NAME, duration: duration, horizontal_res: video_width, vertical_res: video_height, frame_rate: frame_rate, time: time_unix}\n\t\tconsole.log(time)\n\t}\n\n\treturn (\n\t\t<div>\n\t\t\t<CustomNavBar \n\t\t\t\tdisable_buttons={disable_buttons} \n\t\t\t\tvideo_width={video_width} \n\t\t\t\tvideo_height={video_height} \n\t\t\t\tskip_value={skip_value} \n\t\t\t\tANNOTATOR_NAME={ANNOTATOR_NAME}\n\t\t\t\thandle_link_open={handle_link_open}\n\t\t\t\thandleOldAnnotation={handleOldAnnotation}\n\t\t\t\thandleVideoUpload={handleVideoUpload}\n\t\t\t\tcurrentFrame={currentFrame}\n\t\t\t\tdisplay_frame_num={\"Frame #\" + parseInt(currentFrame+1)+' / '+parseInt(duration * frame_rate)}\n\t\t\t\tskip_frame_forward={skip_frame_forward}\n\t\t\t\tskip_frame_backward={skip_frame_backward}\n\t\t\t\thandlePlaying={handlePlaying}\n\t\t\t\tplay_button_text={play_button_text}\n\t\t\t\taddToCanvas={addToCanvas}\n\t\t\t\tANNOTATION_VIDEO_NAME={ANNOTATION_VIDEO_NAME}\n\t\t\t\tframe_data={frame_data}\n\t\t\t\tchange_skip_value={change_skip_value}\n\t\t\t\tchange_annotator_name={change_annotator_name}\n\t\t\t\tchange_annotation_type={change_annotation_type}\n\t\t\t\tannotation_data={annotation_data}\n\t\t\t\tVIDEO_METADATA={VIDEO_METADATA}\n\t\t\t\tscaling_factor_height={scaling_factor_height}\n\t\t\t\tscaling_factor_width={scaling_factor_width}\n\t\t\t\tcolumns={columns}\n\t\t\t\thandleSetPlaybackRate={handleSetPlaybackRate}\n\t\t\t\ttoggleKeyCheck={toggleKeyCheck}\n\t\t\t\tsetFrameRate={setFrameRate}\n\t\t\t\tframe_rate={frame_rate}\n\t\t\t\tsetDateTime={setDateTime}\n\t\t\t\tfabricCanvas={fabricCanvas}\n\t\t\t\tsave_data={save_data}\n\t\t\t\thandle_visual_toggle={handle_visual_toggle}\n\t\t\t/>\n\t\t\t<Toast \n\t\t\t\tonClose={() => changeSave(false)} \n\t\t\t\tshow={save} delay={500} autohide\n\t\t\t\tstyle={{ position: 'absolute', top: '100', left: '100', zIndex: '100'}}\n\t\t\t>\n\t\t\t\t<Toast.Header>\n\t\t\t\t\t<strong className=\"mr-auto\">{toast_text}</strong>\n\t\t\t\t</Toast.Header>\n\t\t\t</Toast>\n\t\t\t{\n\t\t\t\tupload === true && \n\t\t\t\t<div style={{display: \"grid\"}} show={upload}>\n\t\t\t\t\t<div style={{gridColumn: 1, gridRow:1, position: \"relative\", width: scaling_factor_width, height: scaling_factor_height, top: 0, left: 0}}>\n\t\t\t\t\t\t<ReactPlayer \n\t\t\t\t\t\t\tonProgress={handleSetCurrentFrame} \n\t\t\t\t\t\t\tref={handleSetPlayer} \n\t\t\t\t\t\t\tonDuration={handleSetDuration} \n\t\t\t\t\t\t\turl={videoFilePath} \n\t\t\t\t\t\t\twidth='100%'\n\t\t\t\t\t\t\theight='100%'\n\t\t\t\t\t\t\tplaying={playing} \n\t\t\t\t\t\t\tcontrols={false} \n\t\t\t\t\t\t\tstyle={{position:'absolute', float:'left', top:0, left:0}}\n\t\t\t\t\t\t\tvolume={0}\n\t\t\t\t\t\t\tmuted={true}\n\t\t\t\t\t\t\tpip={false}\n\t\t\t\t\t\t\tplaybackRate={playbackRate}\n\t\t\t\t\t\t\tonPlay={handleOnPlay}\n\t\t\t\t\t\t\tid=\"myvideo\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style={{gridColumn: 1, gridRow:1, position: \"relative\",  top: 0, left: 0}}>\n\t\t\t\t\t\t<FabricRender \n\t\t\t\t\t\t\tfabricCanvas={fabricCanvas}\n\t\t\t\t\t\t\tcurrentFrame={currentFrame}\n\t\t\t\t\t\t\tsave_data={save_data}\n\t\t\t\t\t\t\tscaling_factor_height={scaling_factor_height}\n\t\t\t\t\t\t\tscaling_factor_width={scaling_factor_width}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style={{gridColumn: 1, gridRow:2, position: \"relative\", width: scaling_factor_width, top: 0, left: 0}}>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tstyle={{width: scaling_factor_width}}\n\t\t\t\t\t\t\ttype='range' min={0} max={0.999999} step='any'\n\t\t\t\t\t\t\tvalue={sliderPercent}\n\t\t\t\t\t\t\tonMouseDown={handleSeekMouseDown}\n\t\t\t\t\t\t\tonChange={handleSeekChange}\n\t\t\t\t\t\t\tonMouseUp={handleSeekMouseUp}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style={{gridColumn: 2, gridRow:1, position: \"relative\",width: scaling_factor_width*.4, height: scaling_factor_height, top: 0, left: 0}}>\n\t\t\t\t\t\t<AnnotationTable\n\t\t\t\t\t\t\tannotation_data={annotation_data}\n\t\t\t\t\t\t\tcurrentFrame={currentFrame}\n\t\t\t\t\t\t\ttoggleKeyCheck={toggleKeyCheck}\n\t\t\t\t\t\t\tcolumns={columns}\n\t\t\t\t\t\t\tremove_table_index={remove_table_index}\n\t\t\t\t\t\t\thandleSetCurrentFrame={handleSetCurrentFrame}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t}\n\t\t</div>\n\t);\n}\n\n\n","export const ANNOTATION_FRAME = \"1\"\nexport const ANNOTATION_BBOX = \"2\"\nexport const ANNOTATION_KEYPOINT = \"3\"\nexport const ANNOTATION_SEG = \"4\"\n\n","const behaviors = [{\n    value: 'Other',\n    label: 'Other'\n},{\n    value: 'Lying',\n    label: 'Lying'\n},{\n    value: 'Standing',\n    label: 'Standing'\n},{\n    value: 'Sitting',\n    label: 'Sitting'\n},{\n    value: 'Kneeling',\n    label: 'Kneeling'\n},{\n    value: 'Scar',\n    label: 'Scar'\n},{\n    value: 'Facial',\n    label: 'Facial'\n},{\n    value: 'Skin',\n    label: 'Skin'\n},{\n    value: 'Walking',\n    label: 'Walking'\n},{\n    value: 'Running',\n    label: 'Running'\n},{\n    value: 'Transitioning',\n    label: 'Transitioning'\n},{\n    value: 'Exploring',\n    label: 'Exploring'\n},{\n    value: 'Selfplay',\n    label: 'Selfplay'\n},{\n    value: 'Aggression',\n    label: 'Aggression'\n},{\n    value: 'Defecation',\n    label: 'Defecation'\n},{\n    value: 'Urination',\n    label: 'Urination'\n},{\n    value: 'Drinking',\n    label: 'Drinking'\n},{\n    value: 'Feeding',\n    label: 'Feeding'\n}\n]\n\nexport {behaviors};","import React, { useEffect, useState } from \"react\"; \nimport ReactPlayer from 'react-player'\nimport 'bootstrap/dist/css/bootstrap.min.css';\n\nimport Button from 'react-bootstrap/Button'\nimport Navbar from 'react-bootstrap/Navbar'\nimport Nav from 'react-bootstrap/Nav'\nimport Modal from 'react-bootstrap/Modal'\nimport Form from 'react-bootstrap/Form'\nimport Toast from 'react-bootstrap/Toast'\n\n\nimport ExtractingAnnotation from '../../processing/annotation-processing'\n//import ChangeTable from '../Components/change_table'\nimport { NavDropdown } from \"react-bootstrap\";\n\n//Custom implemented classes\nimport { BoundingBox } from '../../annotations/bounding_box'\n//import { KeyPoint } from '../../annotations/key_point'\n//import { Segmentation } from '../../annotations/segmentation'\nimport Instructions from \"../Components/instructions\";\n\nimport BootstrapTable from 'react-bootstrap-table-next';\nimport cellEditFactory, { Type } from 'react-bootstrap-table2-editor';\nimport 'react-bootstrap-table-next/dist/react-bootstrap-table2.min.css';\nimport paginationFactory from 'react-bootstrap-table2-paginator';\n//import { CSVExport } from 'react-bootstrap-table2-toolkit';\n\nimport {behaviors} from '../../static_data/behaviors_LPS'\nimport {posture} from '../../static_data/posture'\nimport {status} from '../../static_data/status'\n//import {columns} from '../../static_data/columns' //TODO re-add columns\n\n//TODO add local storage functionality to auto-save\nif (typeof(Storage) === \"undefined\") {\n  // Code for localStorage/sessionStorage.\n  alert('Your browser does not support local storage. \\nSome autosaving features of the app will not work as intended.\\nPlease see the documentation to find supported browsers and their versions')\n}\n\nconst ANNOTATION_FRAME = \"1\"\nconst ANNOTATION_BBOX = \"2\"\nconst ANNOTATION_KEYPOINT = \"3\"\nconst ANNOTATION_SEG = \"4\"\n\nconst fabric = require(\"fabric\").fabric;\n\n\n//TODO ADD DYNAMIC SOLUTION \nvar frame_rate = 15;\nvar num_frames = -1;\nvar scaling_factor_width = 1920;\nvar scaling_factor_height = 1080;\nvar skip_value = 1;\n\nconsole.log(window.screen.width)\nconsole.log(window.screen.height)\n\nvar current_screen_width = window.screen.width;\nvar current_screen_height = window.screen.height;\n\n//Mappings are based off of https://en.wikipedia.org/wiki/List_of_common_resolutions make sure to use 1:1 and 16:9 aspect ratio\nif (current_screen_height >= 1440){\n  scaling_factor_width = 1920;\n  scaling_factor_height = 1080;\n}else if(current_screen_height >= 1080){\n  scaling_factor_width = 1280;\n  scaling_factor_height = 720;\n}else if(current_screen_height >= 1024){\n  scaling_factor_width = 1152;\n  scaling_factor_height = 648;\n}else if(current_screen_height >= 768){\n  scaling_factor_width = 1024;\n  scaling_factor_height = 576;\n}\n\n\n// globally accessable fabricCanvas instance\nvar fabricCanvas = new fabric.Canvas('c', {uniScaleTransform: true});\n\nvar video_width = 0;\nvar video_height = 0;\n\nvar frame_data = [[]];\nvar annotation_data = [[]];\nvar upload = false;\nvar disable_buttons = true;\nvar currentFrame = 0;\nvar sliderPercent = 0\nvar toast_text = \"\"\nvar previous_annotation = []\nvar previous_canvas_annotation = []\nvar ANNOTATOR_NAME = \"\"\nvar ANNOTATION_VIDEO_NAME = \"\"\n\n\nfunction save_data(frame_num){\n  frame_data[frame_num] = fabricCanvas.toJSON()\n  console.log(\"SAVED\")\n}\n\n\n//Current frame counter\nfunction MainMultiview() {\n  const columns = [{\n    dataField: \"id\",\n    text: \"ID\",\n    headerStyle: () => { return { width: \"40px\", left: 0 }; }\n  },{\n    dataField: \"global_id\",\n    text: \"Glo\",\n    headerStyle: () => { return { width: \"50px\", left: 0}; },\n    editCellStyle: (cell, row, rowIndex, colIndex) => {\n      const backgroundColor = cell > 2101 ? '#00BFFF' : '#00FFFF';\n      return { backgroundColor };\n    }\n  },{\n    dataField: \"status\",\n    text: \"Status\",\n    editor: {\n        type: Type.SELECT,\n        options: status\n      }\n  },{\n    dataField: \"current\",\n    text: \"Curr\",\n    editor: {\n      type: Type.CHECKBOX,\n      value: 'Start:Stop'\n    },\n    headerStyle: () => { return { width: \"60px\", left: 0}; },\n  },{\n    dataField: \"behavior\",\n    text: \"Behavior\",\n    editor: {\n        type: Type.SELECT,\n        options: behaviors,\n    }\n  },\n  {\n    dataField: \"posture\",\n    text: \"Posture\",\n    editor: {\n        type: Type.SELECT,\n        options: posture,\n    }\n  },{\n    dataField: \"remove\",\n    text: \"Del\",\n    editable: false,\n    headerStyle: () => { return { width: \"50px\", left: 0}; },\n    formatter: (cellContent, row) => {\n      return (\n        <button\n          className=\"btn btn-danger btn-xs\"\n            onClick={() => remove_table_index(row.id)}\n            label=\"Del\"\n          >\n        </button>\n      );\n    },\n  }\n  ]\n  \n  const remove_table_index = (index) => {\n    var index_num = 0;\n\n    for(var i = 0; i < annotation_data[currentFrame].length; i++){\n      if(annotation_data[currentFrame][i]['id'] == index){\n        index_num = i\n        break;\n      }\n    }\n\n    if(index.substring(index.length-1, index.length) !== \"f\"){\n      for(var i = 0; i < fabricCanvas.getObjects().length; i++){\n        if(fabricCanvas.getObjects()[i]['_objects'][1]['text'] === index){\n          fabricCanvas.remove(fabricCanvas.getObjects()[i]);\n          fabricCanvas.fire('saveData');\n          break;\n        }\n      }\n    }\n    console.log(annotation_data[currentFrame])\n    annotation_data[currentFrame].splice(index_num, 1)\n    console.log(annotation_data[currentFrame])\n    save_data(currentFrame)\n    //TODO make this more elegant - Currently makes a random number since the state change using an incremental update to the integer caused a stop of state updates and did not respond to any changes. This forces the values to be changed on random and should not have any dependence of the previous value of the visual toggle state.\n    setVisualToggle(Math.floor(Math.random() * 999999999999))\n  }\n  \n  const [visualToggle, setVisualToggle] = useState(0);\n  \n  console.log(visualToggle)\n\n  const save_previous_data = () => {\n    if(annotation_data[currentFrame].length == 0){\n      return;\n    }\n    console.log(annotation_data[currentFrame].length === 0)\n    console.log(\"saved annotation\")\n    previous_annotation = annotation_data[currentFrame]\n    previous_canvas_annotation = frame_data[currentFrame]\n  }\n\n  const [annotationType, setAnnotationType] = useState(\"1\")\n  const handleAnnotationType = (event) => {\n    console.log(event.target.value)\n  }\n  \n  const [boxCount, setBoxCount] = useState(0)\n  const addToCanvas = () =>{\n    var color = \"#\" + ((1<<24)*Math.random() | 0).toString(16)\n    \n    if(annotation_data[currentFrame] == null){\n      annotation_data[currentFrame] = []\n    }\n    \n    if (annotationType === ANNOTATION_BBOX){\n      annotation_data[currentFrame].push({id: boxCount+'b', global_id: null,status: \"\", current: \"Start\", behavior: \"None\"})\n      var new_bbox = new BoundingBox(fabricCanvas.height/2, fabricCanvas.width/2, 50, 50, color, boxCount+'b', \"None\").generate_no_behavior(fabricCanvas)\n      fabricCanvas.add(new_bbox)\n    }else if (annotationType === ANNOTATION_KEYPOINT){\n      //TODO fix KeyPoint\n      alert(\"KeyPoint annotation are currently unavailable\")\n      //annotation_data[currentFrame].push({id: boxCount+'k', behavior: \"None\", is_hidden: 0, posture: \"None\"})\n      //var keyp = new KeyPoint().generate_stick(fabricCanvas)\n    }else if (annotationType === ANNOTATION_SEG){\n      alert(\"Segmentation annotation is currently under development\")\n      //TODO Fix segmentation issues\n      annotation_data[currentFrame].push({id: boxCount+'s', global_id:null, status: \"None\", current: \"Start\", behavior: \"None\"})\n//      var segment = new Segmentation().generate_polygon(fabricCanvas, boxCount+'s')\n    }else if(annotationType === ANNOTATION_FRAME){\n      //TODO Add annotation frame datapoint\n      annotation_data[currentFrame].push({id: boxCount+'f', global_id: null,status: \"\", current: \"Start\", behavior: \"None\"})\n    }\n    save_data(currentFrame)\n    setBoxCount(boxCount + 1);\n    fabricCanvas.fire('saveData');\n  }\n\n  const remove = () => {\n    setBoxCount(boxCount + 1)\n    if(fabricCanvas.getActiveObject() === null){\n      console.log(fabricCanvas.getObjects())\n      alert(\"Please select a bounding box / segmentation from the screen to delete.\")\n      //return\n    }\n    console.log(fabricCanvas.getActiveObject())\n    var index = fabricCanvas.getActiveObject().toJSON()['local_id']\n    for(var i = 0; i < annotation_data[currentFrame].length; i++){\n      if (annotation_data[currentFrame][i]['id'] === index){\n        annotation_data[currentFrame].splice(i, 1)\n        break;\n      }\n    }\n    fabricCanvas.remove(fabricCanvas.getActiveObject());\n    fabricCanvas.fire('saveData');\n  }\n\n  const [videoFilePath, setVideoFileURL] = useState(null);\n  const handleVideoUpload = (event) => {\n    setVideoFileURL(URL.createObjectURL(event.target.files[0]));\n    console.log(event.target.files[0])\n    ANNOTATION_VIDEO_NAME = event.target.files[0]['name']\n    upload = true;\n  };\n\n  //Code for dual video upload option. Currently disabled\n  const [videoFilePath1, setVideoFileURL1] = useState(null);\n  const handleVideoUpload1 = (event) => {\n    setVideoFileURL1(URL.createObjectURL(event.target.files[0]));\n  };\n  \n  //ASYNC Function  - To note that the data that comes out of this will be a bit delayed and this could cause some issues.\n  const [oldAnnotation, setOldAnnotation] = useState(null)\n  const handleOldAnnotation = (event) => {\n      var promise = downloadOldAnnotation(event)\n      promise.then(function (result) {\n        if(result != null){\n          setOldAnnotation(new ExtractingAnnotation(result));\n        }else{\n          console.log(\"ERROR in upload old_annotation\")\n        }\n      })\n  }\n\n  useEffect(() => {\n    //TODO Find a more elegant solution. This is a temporay patch work.\n    if(oldAnnotation == null){\n      return;\n    }\n    alert(\"Annotation upload processed.\\nAny existing annotations will be deleted and replaced with uploaded ones.\")\n    console.log(oldAnnotation)\n    console.log(oldAnnotation.get_frame_data());\n    frame_data = oldAnnotation.get_frame_data();\n    annotation_data = oldAnnotation.get_annotation_data();\n    handle_visual_toggle()\n  }, oldAnnotation);\n\n  const downloadOldAnnotation = (file) => {\n    return new Promise((resolve, reject) => {\n      var reader = new FileReader();\n      reader.onload = function(e) {\n         resolve((JSON.parse(e.target.result)));\n      }\n      reader.readAsText(file.target.files[0])\n    })\n  }\n  \n\n  const [playing, setPlaying] = useState(false);\n  const handlePlaying = (event) => {\n    setPlaying(!playing)\n  }\n\n  var play_button_text = \"ERROR\"\n  if(playing === true){\n    play_button_text = \"Pause\"\n  }else{\n  play_button_text = \"Play\"\n  }\n\n  const [seeking, setSeeking] = useState(false)\n\n\n  const handleSeekChange = e => {\n    sliderPercent = (parseFloat(e.target.value))\n  }\n\n  const handleSeekMouseDown = e => {\n    setSeeking(true)\n  }\n\n  const handleSeekMouseUp = e => {\n    setSeeking(false)\n    player.seekTo(parseFloat(e.target.value))\n  }\n\n  const [player, setPlayer] = useState(null)\n  const handleSetPlayer = val => {\n    //console.log(val)\n    if(val != null){\n      if(val['player'] != null){\n        if(val['player']['player'] != null){\n          if(val['player']['player'] != null){\n            video_width = val['player']['player']['player'].videoWidth\n            video_height = val['player']['player']['player'].videoHeight\n            var duration = val['player']['player']['player'].duration\n            //alert(\"*Loaded player* \\nHorizontal Resolution = \" + video_width + \"\\nVertical Resolution = \" + video_height + \"\\nFrame Rate: \" + frame_rate + \" FPS\\nDuration: \" + duration + \" seconds\")\n          }\n        }\n      }\n    }\n    setPlayer(val)\n  }\n\n  //TODO Autoset resolution\n  \n\n\n  const [duration, setDuration] = useState(0);\n  const handleSetDuration = val => {\n    if(upload === true && player != null){      \n      console.log(\"Initializing...\")\n      num_frames = Math.round(val * frame_rate);\n\n      frame_data = new Array(num_frames)\n      annotation_data = new Array(num_frames)\n\n      //TODO Update this later\n      for (var i = 0; i < num_frames; i++){\n        frame_data[i] = []\n        annotation_data[i] = []\n      }\n      upload = false;\n      disable_buttons = false\n    }\n    setDuration(parseInt(val))\n    console.log(val)\n  }\n\n\n  const handleSetCurrentFrame = val => {\n    save_data(currentFrame)\n    var total_frames = duration * frame_rate\n    currentFrame = (val['played']/total_frames)\n    currentFrame = (Math.round(val['played']*total_frames))\n    handle_visual_toggle()\n    /*if(oldAnnotation != null){ //ANNOTATIONS FOR MCPT (Multi Camera Pig Tracking) additions. TODO add in another class to process all instead of doing per-frame basis which is slow and inefficient.)\n      //fabricCanvas.clear();\n      var bbox = new FrameBoundingBox(oldAnnotation.getAllObjectByFrame(currentFrame), scaling_factor_width, scaling_factor_height).generate_frame()\n      for(var i = 0; i < bbox.length; i++){\n        var curr_obj = bbox[i]\n        console.log(curr_obj)\n        fabricCanvas.add(curr_obj);\n        fabricCanvas.setActiveObject(curr_obj);\n        fabricCanvas.fire('saveData');\n      }\n    }*/\n\n  }\n\n  const [scrubbing, setScrubbing] = useState(true);\n\n  const skip_frame_forward = e =>{\n    save_previous_data()\n    if(scrubbing === false){\n      if (annotation_data[currentFrame+skip_value].length == 0){\n        annotation_data[currentFrame+skip_value] = JSON.parse(JSON.stringify(annotation_data[currentFrame]));\n        frame_data[currentFrame+skip_value] = frame_data[currentFrame];\n        console.log(\"Carryover annotation\")\n      }\n    }\n\n    var total_frames = duration * frame_rate\n    console.log((((player.getCurrentTime()/duration)*total_frames))/(total_frames) + (skip_value/total_frames))\n    player.seekTo((((player.getCurrentTime()/duration)*total_frames))/(total_frames) + (skip_value/total_frames))\n  }\n\n  const skip_frame_backward = e => {\n    save_previous_data()\n    var total_frames = duration * frame_rate\n    player.seekTo((((player.getCurrentTime()/duration)*total_frames))/(total_frames) - (skip_value/total_frames))\n  }\n\n  const downloadFile = async () => {\n    var fileName = \"generated_annotations\";\n    if(ANNOTATION_VIDEO_NAME !== \"\" && ANNOTATOR_NAME !== \"\"){\n      fileName = ANNOTATION_VIDEO_NAME.split('.').slice(0, -1).join('.') + \"_\" +  ANNOTATOR_NAME\n    }\n    //const json = JSON.stringify(fabricCanvas.getObjects());\n    const json = JSON.stringify({\"annotations\": frame_data, \"behavior_data\": annotation_data})\n    //var json = JSON.stringify(frame_data);\n    var blob = new Blob([json],{type:'application/json'});\n    var href = await URL.createObjectURL(blob);\n    var link = document.createElement('a');\n    link.href = href;\n    link.download = fileName + \".json\";\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n\n\n  }\n\n  const [show, setShow] = useState(false);\n\n  const handleClose = () => setShow(false);\n  const handleShow = () => setShow(true);\n\n  const [save, changeSave] = useState(false);\n  \n  const [keyCheck, changeKeyCheck] = useState(true)\n  const handle_key_check = (event) => {\n    changeKeyCheck(!keyCheck)\n    console.log(\"Changing keyCheck to: \" + keyCheck)\n  }\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const onKeyPress = (event) =>{\n    //Making sure input for textbox doesnt get counted as a mode change\n    if(keyCheck == false){\n      return;\n    }\n    //TODO Add keystroke disabling when typing in values in other parts\n\n    if (event.key === ANNOTATION_BBOX){\n      toast_text = \"Mode Switch: Bounding Box\"\n      changeSave(true)\n      setAnnotationType(ANNOTATION_BBOX)\n    }else if (event.key === ANNOTATION_KEYPOINT){\n      toast_text = \"Mode Switch: Key Point\"\n      changeSave(true)\n      setAnnotationType(ANNOTATION_KEYPOINT)\n    }else if(event.key === ANNOTATION_SEG) {\n      toast_text = \"Mode Switch: Segmentation\"\n      changeSave(true)\n      setAnnotationType(ANNOTATION_SEG)\n    }else if(event.key === ANNOTATION_FRAME){\n      toast_text = \"Mode Switch: Behavior Annotation\"\n      changeSave(true)\n      setAnnotationType(ANNOTATION_FRAME)\n    }else if (event.key === \"a\"){\n      var annotext = \"\"\n      if(annotationType === ANNOTATION_BBOX){\n        annotext = \"Bounding Box\"\n      }else if(annotationType === ANNOTATION_FRAME){\n        annotext = \"Behavior Data\"\n      }else if (annotationType === ANNOTATION_KEYPOINT){\n        annotext = \"Keypoint\"\n      }else if (annotationType === ANNOTATION_SEG){\n        annotext = \"Segmentation\"\n      }\n      toast_text = \"Added Annotation - \" + annotext\n      changeSave(true)\n      addToCanvas()\n    }else if (event.key === \"r\"){\n      //TODO Determine if having a remove key is efficient or the deletion can be done directly from UI\n      //toast_text = \"Removed Annotation\"\n      //changeSave(true)\n      //remove()\n    }else if (event.key === \"q\"){\n      skip_frame_backward()\n    }else if (event.key === \"w\"){\n      handlePlaying()\n    }else if (event.key === \"e\"){\n      skip_frame_forward()\n    }else if (event.key === \"s\"){\n      toast_text = \"Annotation Saved\"\n      changeSave(true)\n      frame_data[currentFrame] = fabricCanvas.toJSON()\n    }else if (event.key === \"f\"){\n      if(scrubbing === false){\n        toast_text = \"Scrubbing Mode Activated\"\n        setScrubbing(true)\n        changeSave(true)\n      }else{\n        toast_text = \"Scrubbing Mode Deactivated\"\n        setScrubbing(false)\n        changeSave(true)\n      }\n    }else if(event.key === \"c\"){\n      toast_text = \"Copying previous frame annotation\"\n      annotation_data[currentFrame] = JSON.parse(JSON.stringify(previous_annotation))\n      frame_data[currentFrame] = JSON.parse(JSON.stringify(previous_canvas_annotation))\n      changeSave(true)\n    }\n  }  \n\n  const [test, changeTest] = useState(false);\n \n  useEffect(() => {\n    document.addEventListener(\"keydown\", onKeyPress);\n    return () => document.removeEventListener(\"keydown\", onKeyPress);\n  }, [onKeyPress]);\n  \n  fabricCanvas.loadFromJSON(frame_data[currentFrame], function() {\n    fabricCanvas.renderAll();\n  });\n\n  const handle_link_open = () => {\n    window.open(\"https://forms.gle/CrJuYEoT39uFgnR17\", \"_blank\")\n  }\n\n  /*\n    <NavDropdown disabled={disable_buttons} title=\"Mode\" id=\"basic-nav-dropdown\">\n    <NavDropdown.Item onClick={setAnnotationType(ANNOTATION_BBOX)} >Square Box</NavDropdown.Item>\n    <NavDropdown.Divider />\n    <NavDropdown.Item onClick={setAnnotationType(ANNOTATION_KEYPOINT)}>Key Point</NavDropdown.Item>\n    <NavDropdown.Divider />\n    <NavDropdown.Item onClick={setAnnotationType(ANNOTATION_SEG)}>Segmentation</NavDropdown.Item>\n  </NavDropdown>\n  */ \n  const handle_visual_toggle = () => {\n    setVisualToggle(visualToggle+1)\n  }\n\n  return (\n    <div>\n      <Navbar bg=\"dark\" variant=\"dark\" className=\"bg-5\">\n          <Navbar.Brand href=\"#home\">AVAT</Navbar.Brand>\n          <Nav className=\"mr-auto\">\n              <Nav.Link onClick={handleShow}>Instructions</Nav.Link>\n\n\n\n              <NavDropdown disabled={disable_buttons} title=\"Export\" id=\"basic-nav-dropdown\">\n                <NavDropdown.Item onClick={downloadFile}>JSON</NavDropdown.Item>\n                <NavDropdown.Divider />\n                <NavDropdown.Item >CSV</NavDropdown.Item>\n              </NavDropdown>\n\n              <NavDropdown title=\"Settings\" id=\"basic-nav-dropdown\">\n                <NavDropdown.Divider />\n                Frame Rate: <input type=\"number\" defaultValue=\"15\"></input>\n                <NavDropdown.Divider />\n                Horizontal Res: <input type='number' defaultValue={video_width}></input>\n                <NavDropdown.Divider />\n                Vertical Res: <input type='number' defaultValue={video_height}></input>\n                <NavDropdown.Divider />\n                Skip Value: <input type='number' defaultValue=\"1\" onChange={(event) => {skip_value = parseInt(event.target.value)}}></input>\n                <NavDropdown.Divider />\n                Annotator Name: <input type='text' defaultValue=\"\" onChange={(event) => {ANNOTATOR_NAME = (event.target.value)}}></input>\n              </NavDropdown>\n\n              <Nav.Link onClick={handle_link_open}>Report</Nav.Link>\n          </Nav>\n\n          <div>\n            <Form style={{float: \"left\", width: 80}}>\n              <Form.File disabled={disable_buttons} id=\"file\" label=\"Annotation Upload\" custom type=\"file\" onChange={handleOldAnnotation}/>\n            </Form>\n            <Form style={{float: \"left\", width: 80}}>\n              <Form.File id=\"file\" label=\"Video Upload\" accept=\".mp4\" custom type=\"file\" onChange={handleVideoUpload} />\n            </Form>\n            <Form style={{float: \"left\", width: 80}}>\n              <Form.File id=\"file\" label=\"Video Upload\" accept=\".mp4\" custom type=\"file\" onChange={handleVideoUpload1} />\n            </Form>\n            <Button variant=\"secondary\" disabled={true}>Frame # {parseInt(currentFrame)+' / '+parseInt(duration * frame_rate)}</Button>{' '}\n            <Button variant=\"primary\" disabled={disable_buttons} onClick={skip_frame_backward}>Prev</Button>{' '}\n            <Button variant=\"primary\" disabled={disable_buttons} onClick={handlePlaying}>{play_button_text}</Button>{' '}\n            <Button variant=\"primary\" disabled={disable_buttons} onClick={skip_frame_forward}>Next</Button>{' '}\n            <Button variant=\"success\" disabled={disable_buttons} onClick={addToCanvas} style={{position:\"relative\"}}>Add</Button>{' '}\n            {/*<Button variant=\"danger\" onClick={remove} disabled={disable_buttons} style={{position:\"relative\"}}>Remove</Button>{' '}*/}\n          </div>\n      </Navbar>\n      <Toast onClose={() => changeSave(false)} show={save} delay={500} autohide\n          style={{\n            position: 'absolute',\n            top: 0,\n            left: '40%',\n            zIndex: 100\n          }}>\n        <Toast.Header>\n          <strong className=\"mr-auto\">{toast_text}</strong>\n        </Toast.Header>\n      </Toast>\n      <Modal show={show} onHide={handleClose} size='lg'>\n          <Modal.Header closeButton>\n          <Modal.Title>Instructions</Modal.Title>\n          </Modal.Header>\n          <Modal.Body><Instructions></Instructions></Modal.Body>\n          <Modal.Footer>\n          <Button variant=\"secondary\" onClick={handleClose}>Close</Button>\n          </Modal.Footer>\n      </Modal>\n      <div style={{display: \"grid\"}}>\n        <div style={{gridColumn: 1, gridRow:1, position: \"relative\", height: current_screen_height*.4}}>\n          <ReactPlayer \n            onProgress={handleSetCurrentFrame} \n            ref={handleSetPlayer} \n            onDuration={handleSetDuration} \n            url={videoFilePath} \n            width='100%'\n            height='99.999%'\n            playing={playing} \n            controls={false} \n            volume={0}\n            muted={true}\n            pip={false}\n          />\n        </div>\n        <div style={{gridColumn: 1, gridRow:2, position: \"relative\",height: current_screen_height*.4}}>\n          <ReactPlayer \n            onProgress={handleSetCurrentFrame} \n            ref={handleSetPlayer} \n            onDuration={handleSetDuration} \n            url={videoFilePath1} \n            width='100%'\n            height='99.999%'\n            playing={playing} \n            controls={false} \n            volume={0}\n            muted={true}\n            pip={false}\n          />\n        </div>\n        <div style={{gridColumn: 1, gridRow:3, position: \"relative\", top: 0, left: 0}}>\n          <input\n            style={{width: scaling_factor_width*.5}}\n            type='range' min={0} max={0.999999} step='any'\n            value={sliderPercent}\n            onMouseDown={handleSeekMouseDown}\n            onChange={handleSeekChange}\n            onMouseUp={handleSeekMouseUp}\n          />\n        </div>\n        <div style={{gridColumn: 2, gridRow:1, position: \"relative\",width: current_screen_width*.4, top: 0, left: 0}}>\n          <div>\n            <BootstrapTable\n              keyField='id'\n              data={annotation_data[currentFrame]} \n              columns={ columns }\n              table\n              noDataIndication={ () => <div>No recorded annotations or behaviors for this frame<br/>Please add an annotation or behavior tag to start.</div> }\n              cellEdit={\n                cellEditFactory({ mode: 'click', blurToSave: true,\n                  afterSaveCell: (oldValue, newValue, row, column) => {\n                    //console.log(annotation_data[currentFrame][row['id']])\n                    annotation_data[currentFrame][row['id']] = row\n                    changeKeyCheck(true)\n                  },\n                  onStartEdit: (row, column, rowIndex, columnIndex) => {\n                    changeKeyCheck(false)\n                  }\n                }) \n              }\n              pagination={ paginationFactory() }\n            />\n            </div>\n        </div>\n        \n      </div>\n    </div>\n  );\n}\n\n\nexport default MainMultiview;","\nimport React, { useState } from \"react\";\nimport 'bootstrap/dist/css/bootstrap.min.css';\n\nimport Button from 'react-bootstrap/Button'\nimport Modal from 'react-bootstrap/Modal'\n\nimport MainUpload from './main_upload'\nimport MainMultiview from './main_muiltiview'\nimport { Container, Jumbotron, Col, Row, Card} from \"react-bootstrap\";\nimport Instructions from \"../Components/instructions\";\n\nimport selection_items from '../../static_data/selectionscreen_info.json'\n\n//<img src={process.env.PUBLIC_URL + '/favicon.ico'} alt=\"logo\" style={{width: \"30%\"}} />\nfunction SelectionScreen(){\n    const [show, setShow] = useState(false);\n    const handleClose = () => setShow(false);\n\tconst handleShow = () => setShow(true);\n    const [upload, setUpload] = useState(false)\n    const handleUpload = (event) => {\n        setUpload(!upload)\n    }\n\n    const [multiview, setMultiview] = useState(false)\n    const handleMultiview = (event) => {\n        setMultiview(!multiview)\n    }\n\n    if(upload){\n        return (<MainUpload/>)\n    }else if(multiview){\n        return (<MainMultiview/>)\n    }else{\n        return (\n            <div>\n                <Modal show={show} onHide={handleClose} size='lg'>\n                    <Modal.Header closeButton>\n                    <Modal.Title>Instructions</Modal.Title>\n                    </Modal.Header>\n                    <Modal.Body><Instructions></Instructions></Modal.Body>\n                    <Modal.Footer>\n                    <Button variant=\"secondary\" onClick={handleClose}>Close</Button>\n                    </Modal.Footer>\n                </Modal>\n                <main>\n                    <Jumbotron className=\"text-center\">\n                        <Container>\n                            <h1 className=\"jumbotron-heading\">AVAT</h1>\n                            <p className=\"lead text-muted\"> Analysis tool to record data for livestock behavior and computer vision applications. </p>\n                            <p>\n                                <Button onClick={handleUpload} variant=\"success\" className=\"mx-1 my-2\">Video Upload</Button>\n                                <Button onClick={handleMultiview} variant=\"success\">Multiview</Button>\n                            </p>\n                        </Container>\n                    </Jumbotron>\n                        <Row>\n                            {\n                                selection_items.map((item, key) => {\n                                    return(\n                                        <Col md='6' class>\n                                            <Card \n                                                className=\"mb-5 box-shadow\" \n                                                top\n                                                width='100%'\n                                            >\n                                                <Card.Img variant=\"top\" src={process.env.PUBLIC_URL + item.src} />\n                                                <Card.Body>\n                                                    <Card.Title>{item.altText}</Card.Title>\n                                                    <Card.Text>{item.description}</Card.Text>\n                                                </Card.Body>\n                                            </Card>\n                                        </Col>\n                                    )\n                                })\n                            }\n                        </Row>\n                </main>\n            </div>\n        )\n    }\n}\n\nexport default SelectionScreen;","/**\n * @author Pradeep Senthil (pradeepsen99@gmail.com)\n * @\n */\n\n import React, { useState } from \"react\"; \n import ReactDOM from 'react-dom'\n import './App.css';\n import ReactPlayer from 'react-player'\n import 'bootstrap/dist/css/bootstrap.min.css';\n \n import FrontEnd from './ui_elements/Pages/main_upload'\n import SelectionScreen from './ui_elements/Pages/selection_screen'\n \n //<FrontEnd></FrontEnd>\n function App() {\n   return (\n     <div>\n       <SelectionScreen></SelectionScreen>    \n     </div>\n   );\n }\n       //<ActiveObject />\n       //<input type=\"file\" onChange={handleVideoUpload1} />\n       //<div>\n         //<ReactPlayer url={videoFilePath1} width=\"50%\" height=\"50%\" controls={true} style={{position:'relative', float:'left'}}/>\n         //<Fabric/>\n       //</div>\n \n export default App;","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\n\nReactDOM.render(\n    <App/>,\n    document.getElementById('root')\n);\n\n/**\n * IF NEED TO RE-ENABLE STRICT MODE THEN UNNCOMMENT AND ADD BACK\n * \n *   <React.StrictMode>\n    <MainUpload></MainUpload>\n  </React.StrictMode>,\n */\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}