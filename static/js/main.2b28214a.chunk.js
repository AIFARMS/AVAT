(this.webpackJsonpannotation_tool=this.webpackJsonpannotation_tool||[]).push([[0],{104:function(e,t,a){},105:function(e,t,a){},178:function(e,t){},179:function(e,t){},180:function(e,t){},186:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),l=a(13),r=a.n(l),o=(a(104),a(105),a(36)),c=a.n(o),s=(a(45),a(44)),u=a(12),d=a(42),m=a.n(d),f=a(55),h=a(8),b=a(11),v=a(35),g=a(34),p=a(22),E=a(26),y=a(37),O=a(38),j=function(){function e(t){Object(y.a)(this,e),this.objects=t.objects,console.log(this.objects)}return Object(O.a)(e,[{key:"getObjects",value:function(){return this.objects}},{key:"getObjectById",value:function(e){return this.objects[e]}},{key:"getObjectByIdFrame",value:function(e,t){return this.objects[e][t]}},{key:"getAllObjectByFrame",value:function(e){var t,a=[];for(t=0;t<this.objects.length;t++){var n=this.objects[t];if(!(n.frames[n.frames.length-1].frameNumber<e))for(var i=n.frames,l=0;l<i.length;l++)if(i[l].frameNumber===e){a.push(i[l]);break}}return console.log(a),a}}]),e}(),w=a(94),S=a.n(w),k=a(70),C=a.n(k),D=(a(173),[{dataField:"id",text:"ID"},{dataField:"behavior",text:"Beh",editor:{type:k.Type.SELECT,options:[{value:"Lying",label:"lying"},{value:"Sitting",label:"sitting"},{value:"Standing",label:"standing"},{value:"Locomotion",label:"locomotion"},{value:"Consumption",label:"consumption"}]}},{dataField:"is_hidden",text:"Hid"},{dataField:"posture",text:"Pos",editor:{type:k.Type.SELECT,options:{posture:[{value:"Lying sternally",label:"lying_sternally"},{value:"Sitting",label:"sitting"},{value:"Standing",label:"standing"},{value:"Walking ",label:"walking"},{value:"Consumption",label:"consumption"}]}}}]);var T=function(e){var t=function(e){var t=[];if(null==e)return[];for(var a=0;a<e.objects.length;a++){var n=a+1,i=e.objects[a];console.log(i.left),t.push({id:n.toString(),behavior:"None",is_hidden:"False",posture:"None"})}return t}(e.data);return i.a.createElement("div",{style:{width:"15%"}},i.a.createElement(S.a,{condensed:!0,keyField:"id",data:t,columns:D,cellEdit:C()({mode:"click",blurToSave:!0})}))},A=a(193),x=a(78).fabric,R=function(){function e(t,a,n,i,l,r,o){Object(y.a)(this,e),this.top=t,this.left=a,this.id=r,this.behavior=o,this.color=l,this.width=n,this.height=i}return Object(O.a)(e,[{key:"rectangle",value:function(){return new x.Rect({hasRotatingPoint:!1,uniScaleTransform:!0,height:this.height,width:this.width,fill:this.color,borderColor:"#000",opacity:".4",top:this.top,left:this.left})}},{key:"id_text",value:function(){return new x.Text(this.id.toString(),{fontSize:20,top:this.top,left:this.left,uniScaleTransform:!1})}},{key:"behavior",value:function(){}},{key:"generate_no_behavior",value:function(){return new x.Group([this.rectangle(),this.id_text()],{left:this.left,top:this.top,uniScaleTransform:!0})}},{key:"generate_with_behavior",value:function(){}}]),e}();var F=function(){function e(t,a,n){Object(y.a)(this,e),this.frame_data=t,this.canvas_width=a,this.canvas_height=n,this.windowWidth=3840,this.windowHeight=2178}return Object(O.a)(e,[{key:"generate_frame",value:function(){for(var e=[],t=0;t<this.frame_data.length;t++){var a="#"+((1<<24)*Math.random()|0).toString(16);console.log(this.frame_data[t]);var n=new R(this.getTop(this.frame_data[t]),this.getLeft(this.frame_data[t]),this.getWidth(this.frame_data[t]),this.getHeight(this.frame_data[t]),a,t,"TEST").generate_no_behavior();e.push(n)}return e}},{key:"getID",value:function(e){return e.id}},{key:"getWidth",value:function(e){return Math.floor(e.bbox.width/this.windowWidth*this.canvas_width)}},{key:"getHeight",value:function(e){return Math.floor(e.bbox.height/this.windowHeight*this.canvas_height)}},{key:"getTop",value:function(e){return Math.floor(e.bbox.y/this.windowHeight*this.canvas_height)}},{key:"getLeft",value:function(e){return Math.floor(e.bbox.x/this.windowWidth*this.canvas_width)}}]),e}(),I=a(78).fabric,_=(a(91),a(92)),N=new I.Canvas("c",{uniScaleTransform:!0}),M=_({displayName:"Fabric",componentDidMount:function(){var e=r.a.findDOMNode(this);N.initialize(e,{height:1080,width:1920,backgroundColor:null}),N.on("mouse:up",(function(){B[P]=N.toJSON()})),N.on("saveData",(function(){N.renderAll()}))},render:function(){return i.a.createElement("canvas",null)}}),B=[],L=!1,P=0;var U=function(){var e=Object(n.useState)(0),t=Object(h.a)(e,2),a=t[0],l=t[1],r=Object(n.useState)(null),o=Object(h.a)(r,2),s=o[0],u=o[1],d=Object(n.useState)(null),y=Object(h.a)(d,2),O=(y[0],y[1],Object(n.useState)(null)),w=Object(h.a)(O,2),S=w[0],k=w[1];Object(n.useEffect)((function(){null!=S&&(console.log(S),console.log(S.getAllObjectByFrame(2)))}),S);var C=function(e){return new Promise((function(t,a){var n=new FileReader;n.onload=function(e){t(JSON.parse(e.target.result))},n.readAsText(e.target.files[0])}))},D=Object(n.useState)(!1),x=Object(h.a)(D,2),I=x[0],_=x[1],U="ERROR";U=!0===I?"Pause":"Play";var H=Object(n.useState)(!1),J=Object(h.a)(H,2),W=(J[0],J[1]),z=Object(n.useState)(0),V=Object(h.a)(z,2),q=V[0],Y=V[1],X=Object(n.useState)(null),K=Object(h.a)(X,2),G=K[0],$=K[1],Q=Object(n.useState)(0),Z=Object(h.a)(Q,2),ee=Z[0],te=Z[1],ae=Object(n.useState)(0),ne=Object(h.a)(ae,2),ie=ne[0],le=ne[1],re=Object(n.useState)(0),oe=Object(h.a)(re,2);oe[0],oe[1],B[ie]=N.toJSON();var ce=function(){var e=Object(f.a)(m.a.mark((function e(){var t,a,n,i,l;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="generated_annotations",a=JSON.stringify(B),n=new Blob([a],{type:"application/json"}),e.next=5,URL.createObjectURL(n);case 5:i=e.sent,(l=document.createElement("a")).href=i,l.download=t+".json",document.body.appendChild(l),l.click(),document.body.removeChild(l);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),se=Object(n.useState)(!1),ue=Object(h.a)(se,2),de=ue[0],me=ue[1],fe=function(){return me(!1)};return i.a.createElement("div",null,i.a.createElement(v.a,{bg:"dark",variant:"dark",className:"bg-5"},i.a.createElement(v.a.Brand,{href:"#home"},"Annotation Tool"),i.a.createElement(g.a,{className:"mr-auto"},i.a.createElement(g.a.Link,{onClick:function(){return me(!0)}},"Instructions"),i.a.createElement(A.a,{title:"Annotation Type",id:"basic-nav-dropdown"},i.a.createElement(A.a.Item,null,"Square Box"),i.a.createElement(A.a.Divider,null),i.a.createElement(A.a.Item,null,"Key Point"),i.a.createElement(A.a.Divider,null),i.a.createElement(A.a.Item,null,"Wire Frame")),i.a.createElement(A.a,{title:"Export",id:"basic-nav-dropdown"},i.a.createElement(A.a.Item,{onClick:ce},"JSON"),i.a.createElement(A.a.Divider,null),i.a.createElement(A.a.Item,null,"CSV")),i.a.createElement(A.a,{title:"Settings",id:"basic-nav-dropdown"},i.a.createElement(A.a.Divider,null),i.a.createElement(A.a.Item,{disabled:!0},"Input Frame-Rate: ",i.a.createElement("input",{type:"text"})))),i.a.createElement("div",null,i.a.createElement(b.a,{variant:"secondary",disabled:"true"},"Frame # ",parseInt(ie)+" / "+parseInt(15*ee)),i.a.createElement(E.a,{style:{float:"left",width:80}},i.a.createElement(E.a.File,{id:"file",label:"Annotation Upload",custom:!0,type:"file",onChange:function(e){C(e).then((function(e){null!=e?k(new j(e)):console.log("ERROR in upload old_annotation")}))}})),i.a.createElement(E.a,{style:{float:"left",width:80}},i.a.createElement(E.a.File,{id:"file",label:"Video Upload",custom:!0,type:"file",onChange:function(e){u(URL.createObjectURL(e.target.files[0])),L=!0}})),i.a.createElement(b.a,{variant:"primary",onClick:function(e){var t=15*ee;G.seekTo((G.getCurrentTime()/ee*t-1)/t)}},"Prev")," ",i.a.createElement(b.a,{variant:"primary",onClick:function(e){_(!I)}},U)," ",i.a.createElement(b.a,{variant:"primary",onClick:function(e){var t=15*ee;B[ie]=N.toJSON(),console.log(ie),console.log(B),G.seekTo((G.getCurrentTime()/ee*t+1)/t)}},"Next")," ",i.a.createElement("div",{style:{float:"right"}},i.a.createElement(b.a,{onClick:function(){var e="#"+((1<<24)*Math.random()|0).toString(16),t=new R(N.height/2,N.width/2,50,50,e,1,"id: 1").generate_no_behavior();l(a+1),N.add(t),N.setActiveObject(t),N.fire("saveData")},style:{position:"relative"}},"Add")," ",i.a.createElement(b.a,{onClick:function(){l(a+1),N.remove(N.getActiveObject()),N.fire("saveData")},style:{position:"relative"}},"Remove")," "))),i.a.createElement(p.a,{show:de,onHide:fe},i.a.createElement(p.a.Header,{closeButton:!0},i.a.createElement(p.a.Title,null,"Instructions")),i.a.createElement(p.a.Body,null,"TODO: Add instructions"),i.a.createElement(p.a.Footer,null,i.a.createElement(b.a,{variant:"secondary",onClick:fe},"Close"))),i.a.createElement("div",{style:{display:"grid"}},i.a.createElement("div",{style:{gridColumn:1,gridRow:1,position:"relative",width:1920,height:1080,top:0,left:0}},i.a.createElement(c.a,{onProgress:function(e){console.log(e);var t=15*ee;if(t,Y(ie/t),le(Math.round(e.played*t)),P=ie,null!=S){N.clear();for(var a=new F(S.getAllObjectByFrame(ie),1920,1080).generate_frame(),n=0;n<a.length;n++){var i=a[n];console.log(i),N.add(i),N.setActiveObject(i),N.fire("saveData")}}},ref:function(e){$(e),!0===L&&null!=G&&(console.log("RESET VALUES"),B=new Array(7200),L=!1)},onDuration:function(e){te(parseInt(e)),console.log(e)},url:s,width:"100%",height:"99.999%",playing:I,controls:!1,style:{position:"absolute",float:"left",top:0,left:0},volume:0,muted:!0,pip:!1})),i.a.createElement("div",{style:{gridColumn:1,gridRow:1,position:"relative",width:1920,height:1080,top:0,left:0}},i.a.createElement(M,null)),i.a.createElement("div",{style:{gridColumn:1,gridRow:2,position:"relative",width:1920,height:1080,top:0,left:0}},i.a.createElement("input",{style:{width:1920},type:"range",min:0,max:.999999,step:"any",value:q,onMouseDown:function(e){W(!0)},onChange:function(e){Y(parseFloat(e.target.value))},onMouseUp:function(e){W(!1),G.seekTo(parseFloat(e.target.value))}})),i.a.createElement("div",{style:{gridColumn:2,gridRow:1,position:"relative",width:1920,height:1080,top:0,left:0}},i.a.createElement(T,{data:B[ie],style:{float:"right"}}))))},H=a(96),J=a(78).fabric,W=a(91),z=a(92),V=new W.Reactor({debug:!0}),q=function(e){var t,a={};if(!(e instanceof Object)||Array.isArray(e))throw new Error("keyMirror(...): Argument must be an object.");for(t in e)e.hasOwnProperty(t)&&(a[t]=t);return a}({fabricData:null,activeObject:null}),Y=new J.Canvas,X=W.Store({getInitialState:function(){return W.toImmutable({fabricData:{objects:[]},activeObject:!1})},initialize:function(){this.on(q.fabricData,this.saveFabricData),this.on(q.activeObject,this.saveActiveObject)},saveFabricData:function(e,t){return e.set("fabricData",W.toImmutable(t))},saveActiveObject:function(e,t){return e.set("activeObject",t)}});V.registerStores({fabricStore:X});var K=z({displayName:"Fabric",componentDidMount:function(){var e=r.a.findDOMNode(this);alert("Please use the upload functionality. This is a Alpha version and some features may be missing or broken. The video upload option should have the latest features and bug fixes. This sign will be updated when the youtube option is functional. "),Y.initialize(e,{height:.8*window.innerHeight,width:.8*window.innerWidth,backgroundColor:null}),Y.on("mouse:up",(function(){V.dispatch(q.fabricData,Y.toObject()),V.dispatch(q.activeObject,!!Y.getActiveObject())})),Y.on("saveData",(function(){V.dispatch(q.fabricData,Y.toObject()),V.dispatch(q.activeObject,!!Y.getActiveObject()),Y.renderAll()}))},render:function(){return i.a.createElement("canvas",null)}}),G=z({displayName:"NewObjects",mixins:[V.ReactMixin],getDataBindings:function(){return{fabricData:["fabricStore","fabricData"],activeObject:["fabricStore","activeObject"]}},render:function(){return this.state.fabricData.get("objects").size,i.a.createElement("div",{style:{float:"right"}},i.a.createElement(b.a,{onClick:this.addSquare,style:{position:"relative"}},"Add Square")," ",i.a.createElement(b.a,{onClick:this.remove,style:{position:"relative"}},"Remove")," ")},addSquare:function(){var e="#"+((1<<24)*Math.random()|0).toString(16),t=new J.Rect({hasRotatingPoint:!1,uniScaleTransform:!0,height:50,width:50,originX:"center",originY:"center",fill:e,borderColor:"#000",opacity:".4",top:Y.height/2,left:Y.width/2},(function(e){console.log(e)}));Y.add(t),Y.setActiveObject(t),Y.fire("saveData")},remove:function(){Y.remove(Y.getActiveObject()),Y.fire("saveData")}});z({displayName:"ActiveObject",mixins:[V.ReactMixin],getDataBindings:function(){return{fabricObject:["fabricStore","fabricData","objects",0],activeObject:["fabricStore","activeObject"]}},render:function(){if(console.log(this.state.activeObject),this.state.fabricObject){var e=this.state.fabricObject.get("fill");return console.log(Y.getActiveObject()),i.a.createElement("div",null,i.a.createElement("div",null,i.a.createElement("b",null,"Active Object")),i.a.createElement("div",null,"fill: ",i.a.createElement("span",{style:{color:e}},this.state.fabricObject.get("fill"))),i.a.createElement("div",null,"top: ",this.state.fabricObject.get("top")),i.a.createElement("div",null,"left: ",this.state.fabricObject.get("left")),i.a.createElement("div",null,"angle: ",this.state.fabricObject.get("angle")),i.a.createElement("div",null,"scaleX: ",this.state.fabricObject.get("scaleX")),i.a.createElement("div",null,"scaleY: ",this.state.fabricObject.get("scaleY")))}return console.log(Y.getActiveObject()),null}});var $=[],Q=!1;var Z=function(){var e=Object(n.useState)(null),t=Object(h.a)(e,2),a=(t[0],t[1]),l=Object(n.useState)(null),r=Object(h.a)(l,2),o=(r[0],r[1],Object(n.useState)(null)),s=Object(h.a)(o,2),u=(s[0],s[1]),d=Object(n.useState)(!1),y=Object(h.a)(d,2),O=y[0],j=y[1],w="ERROR";w=!0===O?"Pause":"Play";var S=Object(n.useState)(!1),k=Object(h.a)(S,2),C=(k[0],k[1]),D=Object(n.useState)(0),x=Object(h.a)(D,2),R=x[0],F=x[1],I=Object(n.useState)(null),_=Object(h.a)(I,2),N=_[0],M=_[1],B=Object(n.useState)(0),L=Object(h.a)(B,2),P=L[0],U=L[1],H=Object(n.useState)(0),J=Object(h.a)(H,2),W=J[0],z=J[1],V=function(){var e=Object(f.a)(m.a.mark((function e(){var t,a,n,i,l;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="generated_annotations",a=JSON.stringify($),n=new Blob([a],{type:"application/json"}),e.next=5,URL.createObjectURL(n);case 5:i=e.sent,(l=document.createElement("a")).href=i,l.download=t+".json",document.body.appendChild(l),l.click(),document.body.removeChild(l);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),q=Object(n.useState)(!1),X=Object(h.a)(q,2),Z=X[0],ee=X[1],te=function(){return ee(!1)};return i.a.createElement("div",null,i.a.createElement(v.a,{bg:"dark",variant:"dark",class:"bg-5"},i.a.createElement(v.a.Brand,{href:"#home"},"Annotation Tool"),i.a.createElement(g.a,{className:"mr-auto"},i.a.createElement(g.a.Link,{onClick:function(){return ee(!0)}},"Instructions"),i.a.createElement(A.a,{title:"Annotation Type",id:"basic-nav-dropdown"},i.a.createElement(A.a.Item,null,"Square Box"),i.a.createElement(A.a.Divider,null),i.a.createElement(A.a.Item,null,"Key Point"),i.a.createElement(A.a.Divider,null),i.a.createElement(A.a.Item,null,"Wire Frame")),i.a.createElement(A.a,{title:"Export",id:"basic-nav-dropdown"},i.a.createElement(A.a.Item,{onClick:V},"JSON"),i.a.createElement(A.a.Divider,null),i.a.createElement(A.a.Item,null,"CSV")),i.a.createElement(A.a,{title:"Settings",id:"basic-nav-dropdown"},i.a.createElement(A.a.Divider,null),i.a.createElement(A.a.Item,{disabled:!0},"Input Frame-Rate: ",i.a.createElement("input",{type:"text"})))),i.a.createElement("div",null,i.a.createElement(b.a,{variant:"secondary",disabled:"true"},"Frame # ",parseInt(W)+" / "+parseInt(15*P)),i.a.createElement(E.a,{style:{float:"left",width:80}},i.a.createElement(E.a.File,{id:"file",label:"Annotation Upload",custom:!0,type:"file",onChange:function(e){return new Promise((function(t,a){var n=new FileReader;n.onload=function(e){t(u(JSON.parse(e.target.result)))},n.readAsText(e.target.files[0])}))}})),i.a.createElement(E.a,{style:{float:"left",width:80}},i.a.createElement(E.a.File,{id:"file",label:"Video Upload",custom:!0,type:"file",onChange:function(e){a(URL.createObjectURL(e.target.files[0])),Q=!0}})),i.a.createElement(b.a,{variant:"primary",onClick:function(e){var t=15*P;N.seekTo((N.getCurrentTime()/P*t-1)/t)}},"Prev Frame")," ",i.a.createElement(b.a,{variant:"primary",onClick:function(e){j(!O)}},w)," ",i.a.createElement(b.a,{variant:"primary",onClick:function(e){var t=15*P;$[W]=Y.toJSON(),console.log(W),console.log($),N.seekTo((N.getCurrentTime()/P*t+1)/t)}},"Next Frame")," ",i.a.createElement(G,null))),i.a.createElement(p.a,{show:Z,onHide:te},i.a.createElement(p.a.Header,{closeButton:!0},i.a.createElement(p.a.Title,null,"Instructions")),i.a.createElement(p.a.Body,null,"TODO: Add instructions"),i.a.createElement(p.a.Footer,null,i.a.createElement(b.a,{variant:"secondary",onClick:te},"Close"))),i.a.createElement("div",{style:{display:"flex"}},i.a.createElement("div",{style:{position:"relative"}},i.a.createElement(c.a,{onProgress:function(e){console.log(e);var t=15*P;t,F(W/t),z(Math.round(e.played*t))},ref:function(e){M(e),!0===Q&&null!=N&&(console.log("RESET VALUES"),$=new Array(7200),Q=!1)},onDuration:function(e){U(parseInt(e)),console.log(e)},url:"https://www.youtube.com/watch?v=MF6J2H983HY",width:.8*window.innerWidth,height:.8*window.innerHeight,playing:O,controls:!1,style:{position:"realtive",float:"left"},volume:0,muted:!0,pip:!1}),i.a.createElement(K,null),i.a.createElement("input",{style:{width:.8*window.innerWidth},type:"range",min:0,max:.999999,step:"any",value:R,onMouseDown:function(e){C(!0)},onChange:function(e){F(parseFloat(e.target.value))},onMouseUp:function(e){C(!1),N.seekTo(parseFloat(e.target.value))}})),i.a.createElement(T,{data:$[W],style:{float:"right"}})))},ee=a(191),te=a(192);var ae=function(){var e=Object(n.useState)(!1),t=(Object(H.a)(e),Object(n.useState)(!1)),a=Object(h.a)(t,2),l=a[0],r=(a[1],Object(n.useState)(!1)),o=Object(h.a)(r,2),c=o[0];return o[1],l?i.a.createElement(Z,null):c?i.a.createElement(U,null):i.a.createElement(s.a,null,i.a.createElement("div",null,i.a.createElement(ee.a,{fluid:!0},i.a.createElement(te.a,null,i.a.createElement("div",{class:"row align-items-center"},i.a.createElement("div",{class:"pb-4 col-md-6 col-lg-7"},i.a.createElement("h0",{style:{fontSize:"50px"}},"Annotation Tool ","  ",i.a.createElement("img",{class:"",src:"/pig-annotation-tool/favicon.ico",alt:"logo",style:{width:"9%"}})),i.a.createElement("h5",null," Online tool to mass annotate videos for AI/ML "),i.a.createElement(b.a,{size:"lg"},"Instructions")),i.a.createElement("div",{class:"col-md-6 col-lg-5"},i.a.createElement("div",{class:"row"},i.a.createElement("div",{class:"col"},i.a.createElement("div",{class:"card my-2"},i.a.createElement(s.b,{to:"/upload",variant:"btn-primary outline-success"},"Video Upload"))),i.a.createElement("div",{class:"col-12"},i.a.createElement("div",{class:"card my-2"},i.a.createElement(s.b,{to:"/youtube",variant:"btn-primary outline-success"},"Youtube"))))))),i.a.createElement("div",{class:"container"},i.a.createElement("div",{class:"row align-items-center"}))),i.a.createElement(u.c,null,i.a.createElement(u.a,{path:"/youtube",component:Z}),i.a.createElement(u.a,{path:"/upload",component:U}))))};var ne=function(){return i.a.createElement(s.a,null,i.a.createElement("div",null,i.a.createElement(u.c,null,i.a.createElement(u.a,{exact:!0,path:"/",component:ae}),i.a.createElement(u.a,{path:"/youtube",component:Z}),i.a.createElement(u.a,{path:"/upload",component:U}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(ne,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},99:function(e,t,a){e.exports=a(186)}},[[99,1,2]]]);
//# sourceMappingURL=main.2b28214a.chunk.js.map