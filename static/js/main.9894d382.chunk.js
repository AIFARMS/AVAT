(this.webpackJsonpannotation_tool=this.webpackJsonpannotation_tool||[]).push([[0],{104:function(e,t,a){},105:function(e,t,a){},178:function(e,t){},179:function(e,t){},180:function(e,t){},186:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),o=a(13),r=a.n(o),l=(a(104),a(105),a(38)),c=a.n(l),s=(a(45),a(44),a(12),a(42)),u=a.n(s),d=a(56),f=a(8),h=a(11),b=a(37),g=a(36),v=a(22),m=a(26),p=a(29),y=a(30),j=function(){function e(t){Object(p.a)(this,e),this.objects=t.objects,console.log(this.objects)}return Object(y.a)(e,[{key:"getObjects",value:function(){return this.objects}},{key:"getObjectById",value:function(e){return this.objects[e]}},{key:"getObjectByIdFrame",value:function(e,t){return this.objects[e][t]}},{key:"getAllObjectByFrame",value:function(e){var t,a=[];for(t=0;t<this.objects.length;t++){var n=this.objects[t];if(!(n.frames[n.frames.length-1].frameNumber<e))for(var i=n.frames,o=0;o<i.length;o++)if(i[o].frameNumber===e){a.push(i[o]);break}}return console.log(a),a}}]),e}(),O=a(94),w=a.n(O),E=a(71),k=a.n(E),S=(a(173),[{dataField:"id",text:"ID"},{dataField:"behavior",text:"Beh",editor:{type:E.Type.SELECT,options:[{value:"Lying",label:"lying"},{value:"Sitting",label:"sitting"},{value:"Standing",label:"standing"},{value:"Locomotion",label:"locomotion"},{value:"Consumption",label:"consumption"}]}},{dataField:"is_hidden",text:"Hid"},{dataField:"posture",text:"Pos",editor:{type:E.Type.SELECT,options:{posture:[{value:"Lying sternally",label:"lying_sternally"},{value:"Sitting",label:"sitting"},{value:"Standing",label:"standing"},{value:"Walking ",label:"walking"},{value:"Consumption",label:"consumption"}]}}}]);var x=function(e){var t=function(e){var t=[];if(null==e)return[];for(var a=0;a<e.objects.length;a++){var n=a+1,i=e.objects[a];console.log(i.left),t.push({id:n.toString(),behavior:"None",is_hidden:"False",posture:"None"})}return t}(e.data);return i.a.createElement("div",{style:{width:"15%"}},i.a.createElement(w.a,{condensed:!0,keyField:"id",data:t,columns:S,cellEdit:k()({mode:"click",blurToSave:!0})}))},C=a(193),_=a(54).fabric,D=function(){function e(t,a,n,i,o,r,l){Object(p.a)(this,e),this.top=t,this.left=a,this.id=r,this.behavior=l,this.color=o,this.width=n,this.height=i}return Object(y.a)(e,[{key:"rectangle",value:function(){return new _.Rect({hasRotatingPoint:!1,uniScaleTransform:!0,height:this.height,width:this.width,fill:this.color,borderColor:"#000",opacity:".4",top:this.top,left:this.left})}},{key:"id_text",value:function(){return new _.Text(this.id.toString(),{fontSize:20,top:this.top,left:this.left,uniScaleTransform:!1})}},{key:"behavior",value:function(){}},{key:"generate_no_behavior",value:function(){return new _.Group([this.rectangle(),this.id_text()],{left:this.left,top:this.top,uniScaleTransform:!0})}},{key:"generate_with_behavior",value:function(){}}]),e}();var A=function(){function e(t,a,n){Object(p.a)(this,e),this.frame_data=t,this.canvas_width=a,this.canvas_height=n,this.windowWidth=3840,this.windowHeight=2178}return Object(y.a)(e,[{key:"generate_frame",value:function(){for(var e=[],t=0;t<this.frame_data.length;t++){var a="#"+((1<<24)*Math.random()|0).toString(16);console.log(this.frame_data[t]);var n=new D(this.getTop(this.frame_data[t]),this.getLeft(this.frame_data[t]),this.getWidth(this.frame_data[t]),this.getHeight(this.frame_data[t]),a,t,"TEST").generate_no_behavior();e.push(n)}return e}},{key:"getID",value:function(e){return e.id}},{key:"getWidth",value:function(e){return Math.floor(e.bbox.width/this.windowWidth*this.canvas_width)}},{key:"getHeight",value:function(e){return Math.floor(e.bbox.height/this.windowHeight*this.canvas_height)}},{key:"getTop",value:function(e){return Math.floor(e.bbox.y/this.windowHeight*this.canvas_height)}},{key:"getLeft",value:function(e){return Math.floor(e.bbox.x/this.windowWidth*this.canvas_width)}}]),e}(),T=a(54).fabric,R=function(){function e(){Object(p.a)(this,e)}return Object(y.a)(e,[{key:"generate_stick",value:function(e){function t(e,t,a,n,i,o){var r=new T.Circle({left:e,top:t,strokeWidth:5,radius:12,fill:"#fff",stroke:"#666"});return r.hasControls=r.hasBorders=!1,r.line1=a,r.line2=n,r.line3=i,r.line4=o,r}function a(e){return new T.Line(e,{fill:"red",stroke:"red",strokeWidth:5,selectable:!1,evented:!1})}T.Object.prototype.originX=T.Object.prototype.originY="center";var n=a([250,125,250,175]),i=a([250,175,250,250]),o=a([250,250,300,350]),r=a([250,250,200,350]),l=a([250,175,175,225]),c=a([250,175,325,225]);e.add(n,i,o,r,l,c),e.add(t(n.get("x1"),n.get("y1"),null,n),t(n.get("x2"),n.get("y2"),n,i,l,c),t(i.get("x2"),i.get("y2"),i,o,r),t(o.get("x2"),o.get("y2"),o),t(r.get("x2"),r.get("y2"),r),t(l.get("x2"),l.get("y2"),l),t(c.get("x2"),c.get("y2"),c)),e.on("object:moving",(function(t){var a=t.target;a.line1&&a.line1.set({x2:a.left,y2:a.top}),a.line2&&a.line2.set({x1:a.left,y1:a.top}),a.line3&&a.line3.set({x1:a.left,y1:a.top}),a.line4&&a.line4.set({x1:a.left,y1:a.top}),e.renderAll()}))}},{key:"generate_poly",value:function(e){}}]),e}(),F=a(54).fabric,I=(a(91),a(92)),N=new F.Canvas("c",{uniScaleTransform:!0}),M=I({displayName:"Fabric",componentDidMount:function(){var e=r.a.findDOMNode(this);N.initialize(e,{height:1080,width:1920,backgroundColor:null}),N.on("mouse:up",(function(){B[W]=N.toJSON()})),N.on("saveData",(function(){N.renderAll()}))},render:function(){return i.a.createElement("canvas",null)}}),B=[],L=!1,W=0;var P=function(){var e=Object(n.useState)(0),t=Object(f.a)(e,2),a=t[0],o=t[1],r=Object(n.useState)(null),l=Object(f.a)(r,2),s=l[0],p=l[1],y=Object(n.useState)(null),O=Object(f.a)(y,2),w=(O[0],O[1],Object(n.useState)(null)),E=Object(f.a)(w,2),k=E[0],S=E[1];Object(n.useEffect)((function(){null!=k&&(console.log(k),console.log(k.getAllObjectByFrame(2)))}),k);var _=function(e){return new Promise((function(t,a){var n=new FileReader;n.onload=function(e){t(JSON.parse(e.target.result))},n.readAsText(e.target.files[0])}))},T=Object(n.useState)(!1),F=Object(f.a)(T,2),I=F[0],P=F[1],H="ERROR";H=!0===I?"Pause":"Play";var J=Object(n.useState)(!1),U=Object(f.a)(J,2),z=(U[0],U[1]),q=Object(n.useState)(0),X=Object(f.a)(q,2),Y=X[0],V=X[1],G=Object(n.useState)(null),K=Object(f.a)(G,2),$=K[0],Q=K[1],Z=Object(n.useState)(0),ee=Object(f.a)(Z,2),te=ee[0],ae=ee[1],ne=Object(n.useState)(0),ie=Object(f.a)(ne,2),oe=ie[0],re=ie[1],le=Object(n.useState)(0),ce=Object(f.a)(le,2);ce[0],ce[1],B[oe]=N.toJSON();var se=function(){var e=Object(d.a)(u.a.mark((function e(){var t,a,n,i,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="generated_annotations",a=JSON.stringify(B),n=new Blob([a],{type:"application/json"}),e.next=5,URL.createObjectURL(n);case 5:i=e.sent,(o=document.createElement("a")).href=i,o.download=t+".json",document.body.appendChild(o),o.click(),document.body.removeChild(o);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ue=Object(n.useState)(!1),de=Object(f.a)(ue,2),fe=de[0],he=de[1],be=function(){return he(!1)};return i.a.createElement("div",null,i.a.createElement(b.a,{bg:"dark",variant:"dark",className:"bg-5"},i.a.createElement(b.a.Brand,{href:"#home"},"Annotation Tool"),i.a.createElement(g.a,{className:"mr-auto"},i.a.createElement(g.a.Link,{onClick:function(){return he(!0)}},"Instructions"),i.a.createElement(C.a,{title:"Annotation Type",id:"basic-nav-dropdown"},i.a.createElement(C.a.Item,null,"Square Box"),i.a.createElement(C.a.Divider,null),i.a.createElement(C.a.Item,null,"Key Point"),i.a.createElement(C.a.Divider,null),i.a.createElement(C.a.Item,null,"Wire Frame")),i.a.createElement(C.a,{title:"Export",id:"basic-nav-dropdown"},i.a.createElement(C.a.Item,{onClick:se},"JSON"),i.a.createElement(C.a.Divider,null),i.a.createElement(C.a.Item,null,"CSV")),i.a.createElement(C.a,{title:"Settings",id:"basic-nav-dropdown"},i.a.createElement(C.a.Divider,null),i.a.createElement(C.a.Item,{disabled:!0},"Input Frame-Rate: ",i.a.createElement("input",{type:"text"})))),i.a.createElement("div",null,i.a.createElement(h.a,{variant:"secondary",disabled:"true"},"Frame # ",parseInt(oe)+" / "+parseInt(15*te)),i.a.createElement(m.a,{style:{float:"left",width:80}},i.a.createElement(m.a.File,{id:"file",label:"Annotation Upload",custom:!0,type:"file",onChange:function(e){_(e).then((function(e){null!=e?S(new j(e)):console.log("ERROR in upload old_annotation")}))}})),i.a.createElement(m.a,{style:{float:"left",width:80}},i.a.createElement(m.a.File,{id:"file",label:"Video Upload",custom:!0,type:"file",onChange:function(e){p(URL.createObjectURL(e.target.files[0])),L=!0}})),i.a.createElement(h.a,{variant:"primary",onClick:function(e){var t=15*te;$.seekTo(($.getCurrentTime()/te*t-1)/t)}},"Prev")," ",i.a.createElement(h.a,{variant:"primary",onClick:function(e){P(!I)}},H)," ",i.a.createElement(h.a,{variant:"primary",onClick:function(e){var t=15*te;B[oe]=N.toJSON(),console.log(oe),console.log(B),$.seekTo(($.getCurrentTime()/te*t+1)/t)}},"Next")," ",i.a.createElement("div",{style:{float:"right"}},i.a.createElement(h.a,{onClick:function(){var e="#"+((1<<24)*Math.random()|0).toString(16),t=new D(N.height/2,N.width/2,50,50,e,1,"id: 1").generate_no_behavior();o(a+1);(new R).generate_stick(N);N.add(t),N.setActiveObject(t),N.fire("saveData")},style:{position:"relative"}},"Add")," ",i.a.createElement(h.a,{onClick:function(){o(a+1),N.remove(N.getActiveObject()),N.fire("saveData")},style:{position:"relative"}},"Remove")," "))),i.a.createElement(v.a,{show:fe,onHide:be},i.a.createElement(v.a.Header,{closeButton:!0},i.a.createElement(v.a.Title,null,"Instructions")),i.a.createElement(v.a.Body,null,"TODO: Add instructions"),i.a.createElement(v.a.Footer,null,i.a.createElement(h.a,{variant:"secondary",onClick:be},"Close"))),i.a.createElement("div",{style:{display:"grid"}},i.a.createElement("div",{style:{gridColumn:1,gridRow:1,position:"relative",width:1920,height:1080,top:0,left:0}},i.a.createElement(c.a,{onProgress:function(e){console.log(e);var t=15*te;if(t,V(oe/t),re(Math.round(e.played*t)),W=oe,null!=k){N.clear();for(var a=new A(k.getAllObjectByFrame(oe),1920,1080).generate_frame(),n=0;n<a.length;n++){var i=a[n];console.log(i),N.add(i),N.setActiveObject(i),N.fire("saveData")}}},ref:function(e){Q(e),!0===L&&null!=$&&(console.log("RESET VALUES"),B=new Array(7200),L=!1)},onDuration:function(e){ae(parseInt(e)),console.log(e)},url:s,width:"100%",height:"99.999%",playing:I,controls:!1,style:{position:"absolute",float:"left",top:0,left:0},volume:0,muted:!0,pip:!1})),i.a.createElement("div",{style:{gridColumn:1,gridRow:1,position:"relative",width:1920,height:1080,top:0,left:0}},i.a.createElement(M,null)),i.a.createElement("div",{style:{gridColumn:1,gridRow:2,position:"relative",width:1920,height:1080,top:0,left:0}},i.a.createElement("input",{style:{width:1920},type:"range",min:0,max:.999999,step:"any",value:Y,onMouseDown:function(e){z(!0)},onChange:function(e){V(parseFloat(e.target.value))},onMouseUp:function(e){z(!1),$.seekTo(parseFloat(e.target.value))}})),i.a.createElement("div",{style:{gridColumn:2,gridRow:1,position:"relative",width:1920,height:1080,top:0,left:0}},i.a.createElement(x,{data:B[oe],style:{float:"right"}}))))},H=(a(96),a(54).fabric),J=a(91),U=a(92),z=new J.Reactor({debug:!0}),q=function(e){var t,a={};if(!(e instanceof Object)||Array.isArray(e))throw new Error("keyMirror(...): Argument must be an object.");for(t in e)e.hasOwnProperty(t)&&(a[t]=t);return a}({fabricData:null,activeObject:null}),X=new H.Canvas,Y=J.Store({getInitialState:function(){return J.toImmutable({fabricData:{objects:[]},activeObject:!1})},initialize:function(){this.on(q.fabricData,this.saveFabricData),this.on(q.activeObject,this.saveActiveObject)},saveFabricData:function(e,t){return e.set("fabricData",J.toImmutable(t))},saveActiveObject:function(e,t){return e.set("activeObject",t)}});z.registerStores({fabricStore:Y});U({displayName:"Fabric",componentDidMount:function(){var e=r.a.findDOMNode(this);alert("Please use the upload functionality. This is a Alpha version and some features may be missing or broken. The video upload option should have the latest features and bug fixes. This sign will be updated when the youtube option is functional. "),X.initialize(e,{height:.8*window.innerHeight,width:.8*window.innerWidth,backgroundColor:null}),X.on("mouse:up",(function(){z.dispatch(q.fabricData,X.toObject()),z.dispatch(q.activeObject,!!X.getActiveObject())})),X.on("saveData",(function(){z.dispatch(q.fabricData,X.toObject()),z.dispatch(q.activeObject,!!X.getActiveObject()),X.renderAll()}))},render:function(){return i.a.createElement("canvas",null)}}),U({displayName:"NewObjects",mixins:[z.ReactMixin],getDataBindings:function(){return{fabricData:["fabricStore","fabricData"],activeObject:["fabricStore","activeObject"]}},render:function(){return this.state.fabricData.get("objects").size,i.a.createElement("div",{style:{float:"right"}},i.a.createElement(h.a,{onClick:this.addSquare,style:{position:"relative"}},"Add Square")," ",i.a.createElement(h.a,{onClick:this.remove,style:{position:"relative"}},"Remove")," ")},addSquare:function(){var e="#"+((1<<24)*Math.random()|0).toString(16),t=new H.Rect({hasRotatingPoint:!1,uniScaleTransform:!0,height:50,width:50,originX:"center",originY:"center",fill:e,borderColor:"#000",opacity:".4",top:X.height/2,left:X.width/2},(function(e){console.log(e)}));X.add(t),X.setActiveObject(t),X.fire("saveData")},remove:function(){X.remove(X.getActiveObject()),X.fire("saveData")}}),U({displayName:"ActiveObject",mixins:[z.ReactMixin],getDataBindings:function(){return{fabricObject:["fabricStore","fabricData","objects",0],activeObject:["fabricStore","activeObject"]}},render:function(){if(console.log(this.state.activeObject),this.state.fabricObject){var e=this.state.fabricObject.get("fill");return console.log(X.getActiveObject()),i.a.createElement("div",null,i.a.createElement("div",null,i.a.createElement("b",null,"Active Object")),i.a.createElement("div",null,"fill: ",i.a.createElement("span",{style:{color:e}},this.state.fabricObject.get("fill"))),i.a.createElement("div",null,"top: ",this.state.fabricObject.get("top")),i.a.createElement("div",null,"left: ",this.state.fabricObject.get("left")),i.a.createElement("div",null,"angle: ",this.state.fabricObject.get("angle")),i.a.createElement("div",null,"scaleX: ",this.state.fabricObject.get("scaleX")),i.a.createElement("div",null,"scaleY: ",this.state.fabricObject.get("scaleY")))}return console.log(X.getActiveObject()),null}});a(191),a(192);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(P,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},99:function(e,t,a){e.exports=a(186)}},[[99,1,2]]]);
//# sourceMappingURL=main.9894d382.chunk.js.map