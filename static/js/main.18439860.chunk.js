(this.webpackJsonpannotation_tool=this.webpackJsonpannotation_tool||[]).push([[0],{448:function(e,t,a){e.exports=a(618)},453:function(e,t,a){},454:function(e,t,a){},478:function(e,t){},479:function(e,t){},480:function(e,t){},493:function(e,t){},494:function(e,t){},502:function(e,t){},618:function(e,t,a){"use strict";a.r(t);var n=a(1),o=a.n(n),l=a(58),r=a.n(l),i=(a(453),a(454),a(122)),c=a.n(i),s=(a(147),a(6)),u=a(131),d=a(8),f=a(20),m=function(){function e(t){Object(d.a)(this,e),this.frame_data=t.annotations,this.annotation_data=t.behavior_data}return Object(f.a)(e,[{key:"get_frame_data",value:function(){return this.frame_data}},{key:"get_annotation_data",value:function(){return this.annotation_data}}]),e}(),g=a(148).fabric;a(295);var h=a(148).fabric,b=function(){function e(t,a,n,o,l,r,i){Object(d.a)(this,e),this.top=t,this.left=a,this.id=r,this.behavior=i,this.color=l,this.width=n,this.height=o}return Object(f.a)(e,[{key:"rectangle",value:function(){return new h.Rect({hasRotatingPoint:!1,uniScaleTransform:!0,height:this.height,width:this.width,fill:this.color,opacity:".4",top:this.top,left:this.left})}},{key:"id_text",value:function(){return new h.Text(this.id.toString(),{fontSize:20,top:this.top,left:this.left,uniScaleTransform:!1})}},{key:"behavior",value:function(){}},{key:"generate_no_behavior",value:function(e){var t=new h.Group;t.addWithUpdate(this.rectangle()),t.addWithUpdate(this.id_text()),t.borderColor="#000000",t.hasBorders=!0;var a,n=this.id;return t.toObject=(a=t.toObject,function(e){return h.util.object.extend(a.call(this,e),{local_id:n})}),console.log(t.toJSON()),e.on({"object:scaling":function(e){var t=e.target.item(1),a=e.target,n=a.width/(a.width*a.scaleX),o=a.height/(a.height*a.scaleY);t.set("scaleX",n),t.set("scaleY",o)}}),t}},{key:"generate_mouse_no_behavior",value:function(e){var t,a,n,o;new h.Text(this.id.toString(),{fontSize:20,top:this.top,left:this.left,uniScaleTransform:!1});e.on("mouse:down",(function(l){a=!0;var r=e.getPointer(l.e);n=r.x,o=r.y;r=e.getPointer(l.e);var i=new h.Rect({left:n,top:o,originX:"left",originY:"top",width:r.x-n,height:r.y-o,angle:0,fill:"rgba(255,0,0,0.5)",transparentCorners:!1,uniScaleTransform:!0});t=i,e.add(t)})),e.on("mouse:move",(function(l){if(a){var r=e.getPointer(l.e);n>r.x&&t.set({left:Math.abs(r.x)}),o>r.y&&t.set({top:Math.abs(r.y)}),t.set({width:Math.abs(n-r.x)}),t.set({height:Math.abs(o-r.y)}),e.renderAll()}})),e.on("mouse:up",(function(t){a=!1,e.off("mouse:down"),e.off("mouse:up")}))}},{key:"generate_with_behavior",value:function(){}}]),e}();var p=a(148).fabric,v=function(){function e(){Object(d.a)(this,e)}return Object(f.a)(e,[{key:"generate_stick",value:function(e){function t(e,t,a,n,o,l){var r=new p.Circle({left:e,top:t,strokeWidth:2.5,radius:6,fill:"#fff",stroke:"#666"});return r.hasControls=r.hasBorders=!1,r.line1=a,r.line2=n,r.line3=o,r.line4=l,r}function a(e){return new p.Line(e,{fill:"red",stroke:"red",strokeWidth:5,selectable:!0,evented:!1})}p.Object.prototype.originX=p.Object.prototype.originY="center";var n=a([250,200,250,175]),o=a([250,175,250,250]),l=a([250,250,300,350]),r=a([250,250,200,350]),i=a([250,175,175,225]),c=a([250,175,325,225]);e.add(n,o,l,r,i,c),e.add(t(n.get("x1"),n.get("y1"),null,n),t(n.get("x2"),n.get("y2"),n,o,i,c),t(o.get("x2"),o.get("y2"),o,l,r),t(l.get("x2"),l.get("y2"),l),t(r.get("x2"),r.get("y2"),r),t(i.get("x2"),i.get("y2"),i),t(c.get("x2"),c.get("y2"),c)),e.on("object:moving",(function(t){var a=t.target;a.line1&&a.line1.set({x2:a.left,y2:a.top}),a.line2&&a.line2.set({x1:a.left,y1:a.top}),a.line3&&a.line3.set({x1:a.left,y1:a.top}),a.line4&&a.line4.set({x1:a.left,y1:a.top}),e.renderAll()}))}},{key:"generate_poly",value:function(e){}}]),e}(),y=a(148).fabric,E=a(295),w=function(){function e(){Object(d.a)(this,e)}return Object(f.a)(e,[{key:"generate_polygon",value:function(e,t){var a,n=!0,o=new Array,l=new Array,r=!1;e.forEachObject((function(e){e.selectable=!1}));var i=new function(){e.selection=!1,e.on("mouse:down",(function(e){e.target&&e.target.id===o[0].id&&i.polygon.generatePolygon(o),n&&i.polygon.addPoint(e)})),e.on("mouse:up",(function(e){})),e.on("mouse:move",(function(t){if(a&&"line"==a.class){var n=e.getPointer(t.e);a.set({x2:n.x,y2:n.y});var l=r.get("points");l[o.length]={x:n.x,y:n.y},r.set({points:l}),e.renderAll()}e.renderAll()}))};i.polygon={drawPolygon:function(){n=!0,o=new Array,l=new Array},addPoint:function(t){var n=Math.floor(999901*Math.random())+99,i=(new Date).getTime()+n,c=new y.Circle({radius:5,fill:"#ffffff",stroke:"#333333",strokeWidth:.5,left:t.e.layerX/e.getZoom(),top:t.e.layerY/e.getZoom(),selectable:!1,hasBorders:!1,hasControls:!1,originX:"center",originY:"center",id:i,objectCaching:!1});0===o.length?c.set({fill:"red",zindex:1}):c.set({zindex:0});var s=[t.e.layerX/e.getZoom(),t.e.layerY/e.getZoom(),t.e.layerX/e.getZoom(),t.e.layerY/e.getZoom()],u=new y.Line(s,{strokeWidth:2,fill:"#999999",stroke:"#999999",class:"line",originX:"center",originY:"center",selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1});if(r){var d=e.getPointer(t.e);(s=r.get("points")).push({x:d.x,y:d.y});var f=new y.Polygon(s,{stroke:"#333333",strokeWidth:1,fill:"#cccccc",opacity:.3,selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1});e.remove(r),e.add(f),r=f,e.renderAll()}else{var m=[{x:t.e.layerX/e.getZoom(),y:t.e.layerY/e.getZoom()}];f=new y.Polygon(m,{stroke:"#333333",strokeWidth:1,fill:"#cccccc",opacity:.3,selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1});r=f,e.add(f)}a=u,o.push(c),l.push(u),e.add(u),e.add(c),e.selection=!1},generatePolygon:function(o){var i=new Array;E.each(o,(function(t,a){i.push({x:a.left,y:a.top}),e.remove(a)})),E.each(l,(function(t,a){e.remove(a)})),console.log(o),console.log(l);for(var c,s=new y.Group,u=0;u<o.length;u++)s.addWithUpdate(o[u]),s.addWithUpdate(l[u]);return s.toObject=(c=s.toObject,function(e){return y.util.object.extend(c.call(this,e),{local_id:t})}),e.add(s),e.remove(a),e.remove(r),a=null,r=null,n=!1,e.selection=!0,e.forEachObject((function(e){e.selectable=!0})),s}}}}]),e}(),O=a(91),S=a.n(O),k=[{value:"Moving (slow)",label:"Moving (slow)"},{value:"Moving (stdy)",label:"Moving (stdy)"},{value:"Resting",label:"Resting"},{value:"Drinking",label:"Drinking"},{value:"Elimination",label:"Elimination"},{value:"Grooming",label:"Grooming"},{value:"Other",label:"Other"},{value:"Unknown",label:"Unknown"},{value:"Person",label:"Person"},{value:"Scratching",label:"Scratching"},{value:"Pawing",label:"Pawing"},{value:"Adjusting",label:"Adjusting"},{value:"Head tossing",label:"Head tossing"},{value:"Ear twitching",label:"Ear twitching"},{value:"Feeding",label:"Feeding"},{value:"Nosing",label:"Nosing"},{value:"Cage biting",label:"Cage biting"},{value:"Sham chewing",label:"Sham chewing"},{value:"Foaming",label:"Foaming"},{value:"Yawning",label:"Yawning"},{value:"Breathing (m)",label:"Breathing (m)"}],_=[{value:"Lying sternal (s)",label:"Lying sternal (s)"},{value:"Lying sternal (rm)",label:"Lying sternal (rm)"},{value:"Lying lateral (s)",label:"Lying lateral (s)"},{value:"Lying Lateral (rm)",label:"Lying Lateral (rm)"},{value:"Kneeling",label:"Kneeling"},{value:"Sitting",label:"Sitting"},{value:"Standing (p)",label:"Standing (p)"},{value:"Standing (d)",label:"Standing (d)"}],j=[{value:"Stationary",label:"Stationary"},{value:"Minor",label:"Minor"},{value:"Stationary Transition",label:"Stationary Transition"},{value:"Active Transition",label:"Active Transition"},{value:"Active",label:"Active"},{value:"Event",label:"Event"}],C=a(43),x=function(e){return[{dataField:"id",text:"ID",headerStyle:function(){return{width:"40px",left:0}},editable:!1},{dataField:"global_id",text:"Glo",headerStyle:function(){return{width:"50px",left:0}},editCellStyle:function(e,t,a,n){return{backgroundColor:e>2101?"#00BFFF":"#00FFFF"}}},{dataField:"behavior",text:"Behavior",editor:{type:O.Type.SELECT,options:k}},{dataField:"posture",text:"Posture",editor:{type:O.Type.SELECT,options:_}},{dataField:"remove",text:"Del",editable:!1,headerStyle:function(){return{width:"50px",left:0}},headerFormatter:function(){return o.a.createElement("div",null,"Del",o.a.createElement(C.a,{className:"btn btn-danger btn-xs",onClick:function(){return e()},label:"Del"}))},formatter:function(t,a){return o.a.createElement(C.a,{className:"btn btn-danger btn-xs",onClick:function(){return e(a.id)},label:"Del"})}}]},A=a(144),T=a(115),N=a(630),F=a(194),R=a(78),M=a(69),D=a(631),I=a(46),P=a(441),B=a.n(P);a(490);function L(){return o.a.createElement("div",null,o.a.createElement("h3",null,"Keybinds:"),"There are preset keybinds setup to make it easier to use the tool without having to click around. If done properly a combination of mouse and keyboard actions speed up the annotation process.",o.a.createElement("br",null),o.a.createElement("br",null),"* ",o.a.createElement("kbd",null,"1")," : Mode Switch: Bounding Box",o.a.createElement("br",null),"* ",o.a.createElement("kbd",null,"2")," : Mode Switch: Key Point",o.a.createElement("br",null),"* ",o.a.createElement("kbd",null,"3")," : Mode Switch: Segmentation",o.a.createElement("br",null),"* ",o.a.createElement("kbd",null,"a")," : Add annotation",o.a.createElement("br",null),"* ",o.a.createElement("kbd",null,"r")," : Remove selected annotation",o.a.createElement("br",null),"* ",o.a.createElement("kbd",null,"q")," : Skip backward frame(s)",o.a.createElement("br",null),"* ",o.a.createElement("kbd",null,"s")," : Save annotation",o.a.createElement("br",null),"* ",o.a.createElement("kbd",null,"w")," : Pause/Play",o.a.createElement("br",null),"* ",o.a.createElement("kbd",null,"e")," : Skip forward frame(s)",o.a.createElement("br",null),"* ",o.a.createElement("kbd",null,"c")," : Copy previous annotation",o.a.createElement("br",null),"* ",o.a.createElement("kbd",null,"f")," : Activate/Deactivate scrub mode (Activated by default)",o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("h3",null,"Uploading Video:"),"Ensure that you know the framerate, vertical and horizontal resolution of the video chosen to be annotated. These values should be entered into the settings tab into their respective fields.",o.a.createElement("br",null),o.a.createElement("br",null),"Click on the right side browse button. All other buttons on the screen shuold be disabled until the video has been uploaded. Currenntly ```.mp4``` format is the best choice and tested for.",o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("h3",null,"Annotations"),o.a.createElement("br",null),"There are currently three kinds of annotations.",o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("h4",null,"Bounding Box:"),"This forms a square around the desired object. There should be small squares at the edges of the bounding box which can be used to resize the box. The number on the top left of the box is used to identify the placement of the box in the table to the right.",o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("h4",null,"Key Point:"),"This generates an object with multiple points and lines attached to each other. They should be arranged around the obejct where the singular circle with one connecting line is the head and progress to each of the other limbs. ***Note: This feature is currently in development and there will be bugs in using this.***",o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("h4",null,"Segmentation:"),"Upon generating this each click on the video generates a point which eventually will transform to a set of interconnected points. To complete the polygon click on the original point generated (which is the red colored point) ***Note: Unline the Bounding Box, segmentation cant be edited after generated. To fix a mistake remove the annotation and continue from the start.***")}var U=a(9),V=a.n(U),J=a(16);function K(){return(K=Object(J.a)(V.a.mark((function e(t,a,n,o,l){var r,i,c,s,u;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="generated_annotations",""!==t&&""!==a&&(r=t.split(".").slice(0,-1).join(".")+"_"+a),console.log(o),i=JSON.stringify({vid_metadata:l,annotations:n,behavior_data:o}),c=new Blob([i],{type:"application/json"}),e.next=7,URL.createObjectURL(c);case 7:s=e.sent,(u=document.createElement("a")).href=s,u.download=r+".json",document.body.appendChild(u),u.click(),document.body.removeChild(u);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e,t){console.log(t);for(var a=new Array(e.length+1),n=0;n<a.length;n++)a[n]=[];a[0].push("frame_num");for(n=0;n<t.length;n++)a[0].push(t[n].dataField);for(n=0;n<e.length;n++){for(var o=0;o<e[n].length;o++){a[n+1][o]=[];var l=e[n][o],r=Object.keys(l).map((function(e){return l[e]}));a[n+1][o]=n+","+r.join(",")}a[n+1]=a[n+1].join("\n")}return a=a.join("\n")}function H(){return(H=Object(J.a)(V.a.mark((function e(t,a,n,o){var l,r,i,c,s;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l="generated_annotations",""!==t&&""!==a&&(l=t.split(".").slice(0,-1).join(".")+"_"+a),r=z(n,o("")),i=new Blob([r],{type:"application/octet-stream"}),e.next=6,URL.createObjectURL(i);case 6:c=e.sent,(s=document.createElement("a")).href=c,s.download=l+".csv",document.body.appendChild(s),s.click(),document.body.removeChild(s);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}a(616),a(615);var Y,W=a(313);function X(){return(X=Object(J.a)(V.a.mark((function e(t){return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return alert("Loading model\nThis might take a second or so..."),e.next=3,W.load();case 3:e.sent.dispose(),Y=W.load({base:t});case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(){return(G=Object(J.a)(V.a.mark((function e(t,a,n,o,l){var r,i,c,s,u,d,f;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=document.getElementsByTagName("video")[0],console.log(r.height),console.log("IMAGE CLASSIFICATION"),e.next=5,Y;case 5:return i=e.sent,console.log("model loaded"),console.time("predict1"),e.next=10,i.detect(r);case 10:for(c=e.sent,console.timeEnd("predict1"),s=0;s<c.length;s++)u=c[s].bbox,d="#"+((1<<24)*Math.random()|0).toString(16),f=new b(u[1],u[0],u[2],u[3],d,s+"b","None").generate_no_behavior(t),t.add(f),a[n].push({id:s+"b",global_id:s,status:"",current:"",behavior:"",posture:"",notes:""});o(n),l();case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){var t=Object(n.useState)(!1),a=Object(s.a)(t,2),l=a[0],r=a[1],i=Object(n.useState)(!0),c=Object(s.a)(i,2),u=c[0],d=c[1],f=Object(n.useState)(0),m=Object(s.a)(f,2),g=m[0],h=m[1],b=Object(n.useState)(0),p=Object(s.a)(b,2),v=(p[0],p[1],Object(n.useState)(0)),y=Object(s.a)(v,2),E=(y[0],y[1],Object(n.useState)(0)),w=Object(s.a)(E,2),O=(w[0],w[1],Object(n.useState)(0)),S=Object(s.a)(O,2),k=(S[0],S[1],Object(n.useState)(0)),_=Object(s.a)(k,2),j=(_[0],_[1],Object(n.useState)(0)),x=Object(s.a)(j,2),P=x[0],U=x[1],V=Object(n.useState)(""),J=Object(s.a)(V,2),z=J[0],Y=J[1],W=Object(n.useState)(""),Z=Object(s.a)(W,2),q=Z[0],$=Z[1],Q=function(){return r(!1)},ee=function(){return d(!1)};return o.a.createElement("div",null,o.a.createElement(I.a,{show:l,onHide:Q,size:"lg"},o.a.createElement(I.a.Header,{closeButton:!0},o.a.createElement(I.a.Title,null,"Instructions")),o.a.createElement(I.a.Body,null,o.a.createElement(L,null)),o.a.createElement(I.a.Footer,null,o.a.createElement(C.a,{variant:"secondary",onClick:Q},"Close"))),o.a.createElement(I.a,{show:u,onHide:ee,size:"lg"},o.a.createElement(I.a.Header,{closeButton:!0},o.a.createElement(I.a.Title,null,"Upload")),o.a.createElement(I.a.Body,null,o.a.createElement("div",{style:{display:"grid"}},o.a.createElement(R.a,{style:{float:"left",gridColumn:1,gridRow:1,zIndex:99}},"Video Format:",o.a.createElement(R.a.Control,{as:"select",id:"inlineFormCustomSelect",onChange:function(e){var t;t=e.target.value,console.log(t),U(0===t?0:1)},defaultValue:P},o.a.createElement("option",{value:"0"},"Upload"),o.a.createElement("option",{value:"1"},"Youtube")),o.a.createElement(N.a.Divider,null)),o.a.createElement("div",{style:{float:"left",gridColumn:1,gridRow:2,zIndex:99}},"Annotator Name: ",o.a.createElement("input",{type:"text",defaultValue:e.ANNOTATOR_NAME,onClick:function(t){e.toggleKeyCheck(!1)},onBlur:function(t){e.toggleKeyCheck(!0)},onChange:function(t){e.change_annotator_name(t.target.value)}}),o.a.createElement(N.a.Divider,null)),o.a.createElement("div",{style:{float:"left",gridColumn:1,gridRow:3,zIndex:99}},o.a.createElement("text",null,"Date and Time: "),o.a.createElement(B.a,{selected:g,onChange:function(t){!function(t){h(t);try{e.setDateTime(Math.floor(t.getTime()/1e3))}catch(a){alert("Invalid date input!")}}(t)},timeInputLabel:"Time:",dateFormat:"yyyy/MM/dd hh:mm",showTimeInput:!0,onClick:function(t){e.toggleKeyCheck(!1)},onClickOutside:function(t){e.toggleKeyCheck(!0)},onCalendarOpen:function(t){e.toggleKeyCheck(!1)},onCalendarClose:function(t){e.toggleKeyCheck(!0)}}),o.a.createElement(N.a.Divider,null)),0===P&&o.a.createElement(R.a,{style:{float:"left",gridColumn:1,gridRow:4}},o.a.createElement(R.a.File,{id:"file",label:"Video Upload",accept:".mp4",custom:!0,type:"file",onChange:e.handleVideoUpload})),1===P&&o.a.createElement("div",null,o.a.createElement("text",null,"Youtube URL: "),o.a.createElement("input",{onChange:function(e){Y(e.target.value),console.log(e.target.value)}}),o.a.createElement(C.a,{onClick:function(t){e.handleVideoUpload(z)}},"Upload")),o.a.createElement(R.a,{style:{float:"left",gridColumn:1,gridRow:5}},o.a.createElement(R.a.File,{disabled:e.disable_buttons,accept:".json",id:"file",label:"Annotation Upload",custom:!0,type:"file",onChange:e.handleOldAnnotation})),o.a.createElement(N.a.Divider,null),"Frame Rate: ",o.a.createElement("input",{type:"number",value:e.frame_rate,onChange:function(t){e.setFrameRate(parseInt(t.target.value))}}),o.a.createElement(N.a.Divider,null),"Skip Value: ",o.a.createElement("input",{type:"number",defaultValue:"1",onChange:function(t){e.change_skip_value(parseInt(t.target.value))}}),"Playback Rate: ",o.a.createElement("input",{type:"number",defaultValue:"1",onChange:function(t){e.handleSetPlaybackRate(parseInt(t.target.value))}}),o.a.createElement(N.a.Divider,null),o.a.createElement("div",null,"Enable Object Detection Model:"," ",o.a.createElement("select",{defaultValue:q,onChange:function(e){$(e.target.value)},id:"base_model"},o.a.createElement("option",{value:""},"Select"),o.a.createElement("option",{value:"lite_mobilenet_v2"},"SSD Lite Mobilenet V2"),o.a.createElement("option",{value:"mobilenet_v1"},"SSD Mobilenet v1"),o.a.createElement("option",{value:"mobilenet_v2"},"SSD Mobilenet v2"))," ",o.a.createElement(C.a,{size:"sm",variant:"outline-success",onClick:function(e){""===q&&alert("Please select a model"),function(e){X.apply(this,arguments)}(q)}},"Enable")),o.a.createElement(N.a.Divider,null))),o.a.createElement(I.a.Footer,null,o.a.createElement(C.a,{variant:"secondary",onClick:ee},"Close"))),o.a.createElement(A.a,{sticky:"top",bg:"dark",variant:"dark",className:"bg-5"},o.a.createElement(A.a.Brand,{href:"#home"},"AVAT"),o.a.createElement(T.a,{className:"mr-auto"},o.a.createElement(N.a,{disabled:e.disable_buttons,title:"Export",id:"basic-nav-dropdown"},o.a.createElement(N.a.Item,{onClick:function(){!function(e,t,a,n,o){K.apply(this,arguments)}(e.ANNOTATION_VIDEO_NAME,e.ANNOTATOR_NAME,e.frame_data,e.annotation_data,e.VIDEO_METADATA)}},"JSON"),o.a.createElement(N.a.Divider,null),o.a.createElement(N.a.Item,{onClick:function(){!function(e,t,a,n){H.apply(this,arguments)}(e.ANNOTATION_VIDEO_NAME,e.ANNOTATOR_NAME,e.annotation_data,e.columns)}},"CSV")),o.a.createElement(F.a,{onClick:function(){return r(!0)}},"Instructions"),o.a.createElement(F.a,{onClick:e.handle_link_open},"Report")),o.a.createElement("div",null,q.length>0&&o.a.createElement(C.a,{id:"run",variant:"outline-info",onClick:function(t){!function(e,t,a,n,o){G.apply(this,arguments)}(e.fabricCanvas,e.annotation_data,e.currentFrame,e.save_data,e.handle_visual_toggle),e.handle_visual_toggle()}},"Run model"),o.a.createElement(C.a,{variant:"outline-success",onClick:function(){return d(!0)}},"Upload")," ",o.a.createElement(M.a,{as:D.a},o.a.createElement(C.a,{variant:"secondary",disabled:!0},e.display_frame_num)," ",o.a.createElement(M.a.Toggle,{split:!0,variant:"secondary",id:"dropdown-split-basic"}),o.a.createElement(M.a.Menu,null,"Skip Value: ",o.a.createElement("input",{type:"number",defaultValue:"1",onChange:function(t){e.change_skip_value(parseInt(t.target.value))}}),"Playback Rate: ",o.a.createElement("input",{type:"number",defaultValue:"1",onChange:function(t){e.handleSetPlaybackRate(parseInt(t.target.value))}})))," ",o.a.createElement(C.a,{variant:"primary",disabled:e.disable_buttons,onClick:e.skip_frame_backward},"Prev")," ",o.a.createElement(C.a,{variant:"primary",disabled:e.disable_buttons,onClick:e.handlePlaying},e.play_button_text)," ",o.a.createElement(C.a,{variant:"primary",disabled:e.disable_buttons,onClick:e.skip_frame_forward},"Next")," ",o.a.createElement(M.a,{as:D.a,drop:"left"},o.a.createElement(C.a,{variant:"success",onClick:e.addToCanvas},"Add"),o.a.createElement(M.a.Toggle,{split:!0,variant:"success",id:"dropdown-split-basic"}),o.a.createElement(M.a.Menu,null,o.a.createElement(M.a.Item,{onClick:function(t){e.change_annotation_type("1")}},"Behavior Annotation"),o.a.createElement(M.a.Item,{onClick:function(t){e.change_annotation_type("2")}},"BoundingBox"),o.a.createElement(M.a.Item,{onClick:function(t){e.change_annotation_type("3")}},"KeyPoint"),o.a.createElement(M.a.Item,{onClick:function(t){e.change_annotation_type("4")}},"Segmentation"))))))}var q=a(53),$=a(52),Q=function(e){Object(q.a)(a,e);var t=Object($.a)(a);function a(){return Object(d.a)(this,a),t.apply(this,arguments)}return Object(f.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=r.a.findDOMNode(this);this.props.fabricCanvas.initialize(t,{height:this.props.scaling_factor_height,width:this.props.scaling_factor_width,backgroundColor:null}),this.props.fabricCanvas.on("mouse:up",(function(){e.props.save_data(e.props.currentFrame)})),this.props.fabricCanvas.on("object:added",this.props.save_data(this.props.currentFrame)),this.props.fabricCanvas.on("object:removed",this.props.save_data(this.props.currentFrame)),this.props.fabricCanvas.on("object:modified",this.props.save_data(this.props.currentFrame)),this.props.fabricCanvas.on("saveData",(function(){e.props.fabricCanvas.renderAll()}))}},{key:"render",value:function(){return o.a.createElement("canvas",{id:"canvas"})}}]),a}(o.a.Component),ee=a(162),te=a.n(ee),ae=(a(302),a(163)),ne=a.n(ae),oe=a(442),le=a(314),re=a(440);function ie(e){var t,a={onlyOneExpanding:!0,renderer:function(t,a){return o.a.createElement("div",null,o.a.createElement(re.a,{as:"textarea","aria-label":"With textarea",defaultValue:e.annotation_data[e.currentFrame][a].notes,onChange:function(e){n(e,a)},onClick:function(t){e.toggleKeyCheck(!1)},onBlur:function(t){e.toggleKeyCheck(!0)}}))}},n=function(t,a){console.log(e.annotation_data[e.currentFrame]),e.annotation_data[e.currentFrame][a].notes=t.target.value,console.log(e.annotation_data[e.currentFrame])},l=function(e){for(var t=[],a=0;a<e.length;a++)if(0!==e[a].length){for(var n="",o="",l=0;l<e[a].length;l++)n+=e[a][l].id+", ",o+=e[a][l].global_id+", ";t.push({frame_num:a,anno_count:e[a].length,local_ids:n,global_ids:o})}return t}(e.annotation_data);return o.a.createElement(oe.a,{defaultActiveKey:"home",id:"uncontrolled-tab-example"},o.a.createElement(le.a,{eventKey:"home",title:"Current"},o.a.createElement(te.a,{keyField:"id",data:e.annotation_data[e.currentFrame],columns:e.columns(e.remove_table_index),table:!0,noDataIndication:function(){return o.a.createElement("div",null,"No recorded annotations or behaviors for this frame",o.a.createElement("br",null),"Please add an annotation or behavior tag to start.")},cellEdit:S()({mode:"click",blurToSave:!0,afterSaveCell:function(t,a,n,o){console.log(n),e.toggleKeyCheck(!0)},onStartEdit:function(t,a,n,o){e.toggleKeyCheck(!1)}}),pagination:ne()(),expandRow:a})),o.a.createElement(le.a,{eventKey:"profile",title:"Previous"},o.a.createElement(te.a,{keyField:"frame_num",data:l,columns:(t=e.handleSetCurrentFrame,[{dataField:"frame_num",text:"Frame",headerStyle:function(){return{width:"40px",left:0}}},{dataField:"anno_count",text:"Count",headerStyle:function(){return{width:"40px",left:0}}},{dataField:"local_ids",text:"Local ID",headerStyle:function(){return{width:"40px",left:0}}},{dataField:"global_ids",text:"Global ID",headerStyle:function(){return{width:"40px",left:0}}},{dataField:"swap",text:"Swap",editable:!1,headerStyle:function(){return{width:"50px",left:0}},formatter:function(e,a){return o.a.createElement(C.a,{className:"btn btn-confirm btn-xs",label:"Del",onClick:function(){t(a.frame_num)}},"Skip")}}]),table:!0,noDataIndication:function(){return o.a.createElement("div",null,"No recorded annotations or behaviors for this video.")},pagination:ne()()})))}"undefined"===typeof Storage&&alert("Your browser does not support local storage. \nSome autosaving features of the app will not work as intended.\nPlease see the documentation to find supported browsers and their versions");var ce=a(148).fabric,se=15,ue=-1,de=1920,fe=1080,me=1;console.log(window.screen.width),console.log(window.screen.height);window.screen.width;var ge=window.screen.height;ge>=1080?(de=1280,fe=720):ge>=1024?(de=1152,fe=648):ge>=768&&(de=1024,fe=576);var he=new ce.Canvas("c",{uniScaleTransform:!0}),be=0,pe=0,ve=[[]],ye=[[]],Ee=!1,we=!0,Oe=0,Se="",ke=[],_e=[],je="",Ce="",xe={},Ae="ERROR",Te=!1,Ne=0;function Fe(e){ve[e]=he.toJSON(),console.log("SAVED")}function Re(){var e=Object(n.useState)(0),t=Object(s.a)(e,2),a=(t[0],t[1]),l=Object(n.useState)("1"),r=Object(s.a)(l,2),i=r[0],d=r[1],f=Object(n.useState)(0),h=Object(s.a)(f,2),p=h[0],y=h[1],E=Object(n.useState)(null),O=Object(s.a)(E,2),S=O[0],k=O[1],_=Object(n.useState)(null),j=Object(s.a)(_,2),C=(j[0],j[1],Object(n.useState)(null)),A=Object(s.a)(C,2),T=A[0],N=A[1],F=Object(n.useState)(null),R=Object(s.a)(F,2),M=R[0],D=R[1],I=Object(n.useState)(0),P=Object(s.a)(I,2),B=P[0],L=P[1],U=Object(n.useState)(!1),V=Object(s.a)(U,2),J=(V[0],V[1],Object(n.useState)(!1)),K=Object(s.a)(J,2),z=K[0],H=K[1],Y=Object(n.useState)(!1),W=Object(s.a)(Y,2),X=(W[0],W[1]),G=Object(n.useState)(!1),q=Object(s.a)(G,2),$=q[0],ee=q[1],te=Object(n.useState)(0),ae=Object(s.a)(te,2),ne=ae[0],oe=ae[1],le=Object(n.useState)(!0),re=Object(s.a)(le,2),ce=re[0],ge=re[1],Re=Object(n.useState)(1),Me=Object(s.a)(Re,2),De=Me[0],Ie=Me[1],Pe=function(e){var t=B*se;if("number"===typeof e)oe(e),M.seekTo(e/t);else{console.log(e.played),Fe(ne);var a=e.played;a=Math.floor(e.played*t),("Play"===Ae&&!0===Te)|"Pause"===Ae&&(oe(a),Te=!1)}},Be=function(e){console.log(e);for(var t=0,a=0;a<ye[ne].length;a++)if(ye[ne][a].id==e){t=a;break}if("f"!==e.substring(e.length-1,e.length))for(a=0;a<he.getObjects().length;a++)if(he.getObjects()[a]._objects[1].text===e){he.remove(he.getObjects()[a]),he.fire("saveData");break}ye[ne].splice(t,1),Fe(ne)},Le=function(){0!=ye[ne].length&&(ke=ye[ne],_e=ve[ne])},Ue=function(){var e="#"+((1<<24)*Math.random()|0).toString(16);null==ye[ne]&&(ye[ne]=[]);var t="error";if("2"===i){t="b";var a=new b(he.height/2,he.width/2,50,50,e,p+"b","None").generate_no_behavior(he);he.add(a)}else if("3"===i){alert("KeyPoint annotation are currently unavailable"),t="k";(new v).generate_stick(he)}else if("4"===i){alert("Segmentation annotation is currently under development"),t="s";(new w).generate_polygon(he,p+"s")}else"1"===i&&(t="f");ye[ne].push({id:p+t,global_id:-1,status:"",current:"",behavior:"",posture:"",notes:""}),console.log(ye[ne]),Fe(ne),y(p+1),he.fire("saveData")};Object(n.useEffect)((function(){null!=T&&(ve=T.get_frame_data(),ye=T.get_annotation_data(),Ze())}),T);var Ve=function(e){return new Promise((function(t,a){var n=new FileReader;n.onload=function(e){t(JSON.parse(e.target.result))},n.readAsText(e.target.files[0])}))},Je=function(e){"Pause"===Ae&&(Te=!0),ee(!$),Le()};Ae=!0===$?"Pause":"Play";var Ke=Object(n.useState)(!0),ze=Object(s.a)(Ke,2),He=ze[0],Ye=ze[1],We=function(e){Le(),!1===He&&0===ye[ne+me].length&&(ye[ne+me]=JSON.parse(JSON.stringify(ye[ne])),ve[ne+me]=ve[ne]);Pe(ne+me)},Xe=function(e){Le();var t=ne-me;Pe(t<0?0:t)},Ge=function(e){if(!1!==ce)if("2"===e.key)Se="Mode Switch: Bounding Box",H(!0),d("2");else if("3"===e.key)Se="Mode Switch: Key Point",H(!0),d("3");else if("4"===e.key)Se="Mode Switch: Segmentation",H(!0),d("4");else if("1"===e.key)Se="Mode Switch: Behavior Annotation",H(!0),d("1");else if("a"===e.key){var t="";"2"===i?t="Bounding Box":"1"===i?t="Behavior Data":"3"===i?t="Keypoint":"4"===i&&(t="Segmentation"),Se="Added Annotation - "+t,H(!0),Ue()}else"q"===e.key?Xe():"w"===e.key?Je():"e"===e.key?We():"s"===e.key?(Se="Annotation Saved",H(!0),ve[ne]=he.toJSON()):"f"===e.key?!1===He?(Se="Scrubbing Mode Activated",Ye(!0),H(!0)):(Se="Scrubbing Mode Deactivated",Ye(!1),H(!0)):"c"===e.key&&(Se="Copying previous frame annotation",ye[ne]=JSON.parse(JSON.stringify(ke)),ve[ne]=JSON.parse(JSON.stringify(_e)),H(!0))};Object(n.useEffect)((function(){return document.addEventListener("keydown",Ge),function(){return document.removeEventListener("keydown",Ge)}}),[Ge]),he.loadFromJSON(ve[ne],(function(){he.renderAll()}));var Ze=function(){a(Math.floor(999999999999*Math.random()))},qe=function(e){console.log("Keycheck activated"),console.log(e),ge(void 0===e?!ce:e)};return o.a.createElement("div",null,o.a.createElement(Z,{disable_buttons:we,video_width:be,video_height:pe,skip_value:me,ANNOTATOR_NAME:je,handle_link_open:function(){window.open("https://forms.gle/CrJuYEoT39uFgnR17","_blank")},handleOldAnnotation:function(e){Ve(e).then((function(e){null!=e?N(new m(e)):alert("Error in processing Annotation")}))},handleVideoUpload:function(e){if(console.log(typeof e),"string"===typeof e)return k(e),Ce=e,void(Ee=!0);k(URL.createObjectURL(e.target.files[0])),function(e,t){var a=document.getElementById("video1");new g.Image(a,{left:200,top:300,angle:-15,originX:"center",originY:"center",objectCaching:!1})}(e.target.files[0]),Ce=e.target.files[0].name,Ee=!0},currentFrame:ne,display_frame_num:"Frame #"+parseInt(ne)+" / "+parseInt(B*se),skip_frame_forward:We,skip_frame_backward:Xe,handlePlaying:Je,play_button_text:Ae,addToCanvas:Ue,ANNOTATION_VIDEO_NAME:Ce,frame_data:ve,change_skip_value:function(e){me=e},change_annotator_name:function(e){je=e,console.log(je)},change_annotation_type:function(e){console.log(e),d(e)},annotation_data:ye,VIDEO_METADATA:xe,scaling_factor_height:fe,scaling_factor_width:de,columns:x,handleSetPlaybackRate:function(e){console.log(e),isNaN(e)?Ie(0):e>16?(alert("Max playback rate is 16!"),Ie(16)):Ie(e)},toggleKeyCheck:qe,setFrameRate:function(e){se=e},frame_rate:se,setDateTime:function(e){Ne=e,console.log(e)},fabricCanvas:he,save_data:Fe,handle_visual_toggle:Ze}),o.a.createElement(u.a,{onClose:function(){return H(!1)},show:z,delay:500,autohide:!0,style:{position:"absolute",top:0,left:"40%",zIndex:100}},o.a.createElement(u.a.Header,null,o.a.createElement("strong",{className:"mr-auto"},Se))),!0===Ee&&o.a.createElement("div",{style:{display:"grid"},show:Ee},o.a.createElement("div",{style:{gridColumn:1,gridRow:1,position:"relative",width:de,height:fe,top:0,left:0}},o.a.createElement(c.a,{onProgress:Pe,ref:function(e){if(null!=e&&null!=e.player&&null!=e.player.player&&null!=e.player.player){be=e.player.player.player.videoWidth,pe=e.player.player.player.videoHeight;var t=e.player.player.player.duration;xe={name:Ce,duration:t,horizontal_res:be,vertical_res:pe,frame_rate:se,time:Ne}}D(e)},onDuration:function(e){if(!0===Ee&&null!=M){ue=Math.round(e*se),ve=new Array(ue),ye=new Array(ue);for(var t=0;t<ue;t++)ve[t]=[],ye[t]=[];we=!1}L(parseInt(e))},url:S,width:"100%",height:"100%",playing:$,controls:!1,style:{position:"absolute",float:"left",top:0,left:0},volume:0,muted:!0,pip:!1,playbackRate:De,onPlay:function(){console.log(M)},id:"myvideo"})),o.a.createElement("div",{style:{gridColumn:1,gridRow:1,position:"relative",top:0,left:0}},o.a.createElement(Q,{fabricCanvas:he,currentFrame:ne,save_data:Fe,scaling_factor_height:fe,scaling_factor_width:de})),o.a.createElement("div",{style:{gridColumn:1,gridRow:2,position:"relative",width:de,top:0,left:0}},o.a.createElement("input",{style:{width:de},type:"range",min:0,max:.999999,step:"any",value:Oe,onMouseDown:function(e){X(!0)},onChange:function(e){Oe=parseFloat(e.target.value),console.log(Oe)},onMouseUp:function(e){X(!1),M.seekTo(parseFloat(e.target.value))}})),o.a.createElement("div",{style:{gridColumn:2,gridRow:1,position:"relative",width:.4*de,height:fe,top:0,left:0}},o.a.createElement(ie,{annotation_data:ye,currentFrame:ne,toggleKeyCheck:qe,columns:x,remove_table_index:function(e){if(console.log(e),void 0===e){console.log(ye[ne].length);for(var t=[],n=0;n<ye[ne].length;n++)t.push(ye[ne][n].id);console.log(t),t.map((function(e){return Be(e)})),console.log(ye[ne].length)}else Be(e);a(Math.floor(999999999999*Math.random()))},handleSetCurrentFrame:Pe}))))}"undefined"===typeof Storage&&alert("Your browser does not support local storage. \nSome autosaving features of the app will not work as intended.\nPlease see the documentation to find supported browsers and their versions");var Me=a(148).fabric,De=-1,Ie=1920,Pe=1080;console.log(window.screen.width),console.log(window.screen.height);window.screen.width;var Be=window.screen.height;Be>=1440?(Ie=1920,Pe=1080):Be>=1080?(Ie=1280,Pe=720):Be>=1024?(Ie=1152,Pe=648):Be>=768&&(Ie=1024,Pe=576);var Le=new Me.Canvas("c",{uniScaleTransform:!0}),Ue=0,Ve=0,Je=[[]],Ke=[[]],ze=!1,He=!0,Ye=0,We=0,Xe="",Ge=[],Ze=[];function qe(e){Je[e]=Le.toJSON(),console.log("SAVED")}var $e=function(){var e=Object(n.useState)(0),t=Object(s.a)(e,2),a=t[0],l=t[1];console.log(a);var r=function(){0!==Ke[Ye].length&&(console.log(0===Ke[Ye].length),console.log("saved annotation"),Ge=Ke[Ye],Ze=Je[Ye])},i=Object(n.useState)("1"),d=Object(s.a)(i,2),f=d[0],g=d[1],h=Object(n.useState)(0),p=Object(s.a)(h,2),v=p[0],y=p[1],E=function(){var e="#"+((1<<24)*Math.random()|0).toString(16);if(null==Ke[Ye]&&(Ke[Ye]=[]),"2"===f){Ke[Ye].push({id:v+"b",global_id:null,status:"",current:"Start",behavior:"None"});var t=new b(Le.height/2,Le.width/2,50,50,e,v+"b","None").generate_no_behavior(Le);Le.add(t)}else if("3"===f)alert("KeyPoint annotation are currently unavailable");else if("4"===f){alert("Segmentation annotation is currently under development"),Ke[Ye].push({id:v+"s",global_id:null,status:"None",current:"Start",behavior:"None"});(new w).generate_polygon(Le,v+"s")}else"1"===f&&Ke[Ye].push({id:v+"f",global_id:null,status:"",current:"Start",behavior:"None"});qe(Ye),y(v+1),Le.fire("saveData")},O=Object(n.useState)(null),k=Object(s.a)(O,2),_=(k[0],k[1]),j=Object(n.useState)(null),A=Object(s.a)(j,2),T=(A[0],A[1],Object(n.useState)(null)),N=Object(s.a)(T,2),F=N[0],R=N[1];Object(n.useEffect)((function(){null!=F&&(alert("Annotation upload processed.\nAny existing annotations will be deleted and replaced with uploaded ones."),console.log(F),console.log(F.get_frame_data()),Je=F.get_frame_data(),Ke=F.get_annotation_data(),Ce())}),F);var M=function(e){return new Promise((function(t,a){var n=new FileReader;n.onload=function(e){t(JSON.parse(e.target.result))},n.readAsText(e.target.files[0])}))},D=Object(n.useState)(!1),P=Object(s.a)(D,2),B=P[0],U=P[1],K=function(e){U(!B)},z="ERROR";z=!0===B?"Pause":"Play";var H=Object(n.useState)(!1),Y=Object(s.a)(H,2),W=(Y[0],Y[1]),X=Object(n.useState)(null),G=Object(s.a)(X,2),q=G[0],$=G[1],ee=Object(n.useState)(0),ae=Object(s.a)(ee,2),oe=ae[0],le=ae[1],re=Object(n.useState)(!0),ie=Object(s.a)(re,2),ce=ie[0],se=ie[1],ue=function(e){r(),!1===ce&&0==Ke[Ye+1].length&&(Ke[Ye+1]=JSON.parse(JSON.stringify(Ke[Ye])),Je[Ye+1]=Je[Ye],console.log("Carryover annotation"));var t=15*oe;console.log(q.getCurrentTime()/oe*t/t+1/t),q.seekTo(q.getCurrentTime()/oe*t/t+1/t)},de=function(e){r();var t=15*oe;q.seekTo(q.getCurrentTime()/oe*t/t-1/t)},fe=function(){var e=Object(J.a)(V.a.mark((function e(){var t,a,n,o,l;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="generated_annotations",a=JSON.stringify({annotations:Je,behavior_data:Ke}),n=new Blob([a],{type:"application/json"}),e.next=6,URL.createObjectURL(n);case 6:o=e.sent,(l=document.createElement("a")).href=o,l.download=t+".json",document.body.appendChild(l),l.click(),document.body.removeChild(l);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),me=Object(n.useState)(!1),ge=Object(s.a)(me,2),he=ge[0],be=ge[1],pe=function(){return be(!1)},ve=Object(n.useState)(!1),ye=Object(s.a)(ve,2),Ee=ye[0],we=ye[1],Oe=Object(n.useState)(!0),Se=Object(s.a)(Oe,2),ke=Se[0],_e=Se[1],je=function(e){if(0!=ke)if("2"===e.key)Xe="Mode Switch: Bounding Box",we(!0),g("2");else if("3"===e.key)Xe="Mode Switch: Key Point",we(!0),g("3");else if("4"===e.key)Xe="Mode Switch: Segmentation",we(!0),g("4");else if("1"===e.key)Xe="Mode Switch: Behavior Annotation",we(!0),g("1");else if("a"===e.key){var t="";"2"===f?t="Bounding Box":"1"===f?t="Behavior Data":"3"===f?t="Keypoint":"4"===f&&(t="Segmentation"),Xe="Added Annotation - "+t,we(!0),E()}else"r"===e.key||("q"===e.key?de():"w"===e.key?K():"e"===e.key?ue():"s"===e.key?(Xe="Annotation Saved",we(!0),Je[Ye]=Le.toJSON()):"f"===e.key?!1===ce?(Xe="Scrubbing Mode Activated",se(!0),we(!0)):(Xe="Scrubbing Mode Deactivated",se(!1),we(!0)):"c"===e.key&&(Xe="Copying previous frame annotation",Ke[Ye]=JSON.parse(JSON.stringify(Ge)),Je[Ye]=JSON.parse(JSON.stringify(Ze)),we(!0)))};Object(n.useEffect)((function(){return document.addEventListener("keydown",je),function(){return document.removeEventListener("keydown",je)}}),[je]),Le.loadFromJSON(Je[Ye],(function(){Le.renderAll()}));var Ce=function(){l(a+1)};return o.a.createElement("div",null,o.a.createElement(Z,{disable_buttons:He,downloadFile:fe,video_width:Ue,video_height:Ve,skip_value:1,ANNOTATOR_NAME:"",handle_link_open:function(){window.open("https://forms.gle/CrJuYEoT39uFgnR17","_blank")},handleOldAnnotation:function(e){M(e).then((function(e){null!=e?R(new m(e)):console.log("ERROR in upload old_annotation")}))},handleVideoUpload:function(e){_(URL.createObjectURL(e.target.files[0])),console.log(e.target.files[0]),e.target.files[0].name,ze=!0},currentFrame:Ye,display_frame_num:"Frame #"+parseInt(Ye)+" / "+parseInt(15*oe),skip_frame_forward:ue,skip_frame_backward:de,handlePlaying:K,play_button_text:z,addToCanvas:E}),o.a.createElement(u.a,{onClose:function(){return we(!1)},show:Ee,delay:500,autohide:!0,style:{position:"absolute",top:0,left:"40%",zIndex:100}},o.a.createElement(u.a.Header,null,o.a.createElement("strong",{className:"mr-auto"},Xe))),o.a.createElement(I.a,{show:he,onHide:pe,size:"lg"},o.a.createElement(I.a.Header,{closeButton:!0},o.a.createElement(I.a.Title,null,"Instructions")),o.a.createElement(I.a.Body,null,o.a.createElement(L,null)),o.a.createElement(I.a.Footer,null,o.a.createElement(C.a,{variant:"secondary",onClick:pe},"Close"))),o.a.createElement("div",{style:{display:"grid"}},o.a.createElement("div",{style:{gridColumn:1,gridRow:1,position:"relative",width:Ie,height:Pe,top:0,left:0}},o.a.createElement(c.a,{onProgress:function(e){qe(Ye);var t=15*oe;Ye=e.played/t,Ye=Math.round(e.played*t),Ce()},ref:function(e){if(null!=e&&null!=e.player&&null!=e.player.player&&null!=e.player.player){Ue=e.player.player.player.videoWidth,Ve=e.player.player.player.videoHeight;e.player.player.player.duration}$(e)},onDuration:function(e){if(!0===ze&&null!=q){console.log("Initializing..."),De=Math.round(15*e),Je=new Array(De),Ke=new Array(De);for(var t=0;t<De;t++)Je[t]=[],Ke[t]=[];ze=!1,He=!1}le(parseInt(e)),console.log(e)},url:"https://www.youtube.com/watch?v=MF6J2H983HY",width:"100%",height:"99.999%",playing:B,controls:!1,style:{position:"absolute",float:"left",top:0,left:0},volume:0,muted:!0,pip:!1})),o.a.createElement("div",{style:{gridColumn:1,gridRow:1,position:"relative",top:0,left:0}},o.a.createElement(Q,{fabricCanvas:Le,currentFrame:Ye,save_data:qe,scaling_factor_height:Pe,scaling_factor_width:Ie})),o.a.createElement("div",{style:{gridColumn:1,gridRow:2,position:"relative",width:Ie,top:0,left:0}},o.a.createElement("input",{style:{width:Ie},type:"range",min:0,max:.999999,step:"any",value:We,onMouseDown:function(e){W(!0)},onChange:function(e){We=parseFloat(e.target.value)},onMouseUp:function(e){W(!1),q.seekTo(parseFloat(e.target.value))}})),o.a.createElement("div",{style:{gridColumn:2,gridRow:1,position:"relative",width:.4*Ie,height:Pe,top:0,left:0}},o.a.createElement("div",null,o.a.createElement(te.a,{keyField:"id",data:Ke[Ye],columns:x((function(e){for(var t=0,a=0;a<Ke[Ye].length;a++)if(Ke[Ye][a].id===e){t=a;break}if("f"!==e.substring(e.length-1,e.length))for(a=0;a<Le.getObjects().length;a++)if(Le.getObjects()[a]._objects[1].text===e){Le.remove(Le.getObjects()[a]),Le.fire("saveData");break}console.log(Ke[Ye]),Ke[Ye].splice(t,1),console.log(Ke[Ye]),qe(Ye),l(Math.floor(999999999999*Math.random()))})),table:!0,noDataIndication:function(){return o.a.createElement("div",null,"No recorded annotations or behaviors for this frame",o.a.createElement("br",null),"Please add an annotation or behavior tag to start.")},cellEdit:S()({mode:"click",blurToSave:!0,afterSaveCell:function(e,t,a,n){Ke[Ye][a.id]=a,_e(!0)},onStartEdit:function(e,t,a,n){_e(!1)}}),pagination:ne()()})))))},Qe=(a(600),[{value:"Other",label:"Other"},{value:"Lying",label:"Lying"},{value:"Standing",label:"Standing"},{value:"Sitting",label:"Sitting"},{value:"Kneeling",label:"Kneeling"},{value:"Scar",label:"Scar"},{value:"Facial",label:"Facial"},{value:"Skin",label:"Skin"},{value:"Walking",label:"Walking"},{value:"Running",label:"Running"},{value:"Transitioning",label:"Transitioning"},{value:"Exploring",label:"Exploring"},{value:"Selfplay",label:"Selfplay"},{value:"Aggression",label:"Aggression"},{value:"Defecation",label:"Defecation"},{value:"Urination",label:"Urination"},{value:"Drinking",label:"Drinking"},{value:"Feeding",label:"Feeding"}]);"undefined"===typeof Storage&&alert("Your browser does not support local storage. \nSome autosaving features of the app will not work as intended.\nPlease see the documentation to find supported browsers and their versions");var et=a(148).fabric,tt=-1,at=1920,nt=1;console.log(window.screen.width),console.log(window.screen.height);var ot=window.screen.width,lt=window.screen.height;lt>=1440?at=1920:lt>=1080?at=1280:lt>=1024?at=1152:lt>=768&&(at=1024);var rt=new et.Canvas("c",{uniScaleTransform:!0}),it=0,ct=0,st=[[]],ut=[[]],dt=!1,ft=!0,mt=0,gt=0,ht="",bt=[],pt=[],vt="",yt="";function Et(e){st[e]=rt.toJSON(),console.log("SAVED")}var wt=function(){var e=[{dataField:"id",text:"ID",headerStyle:function(){return{width:"40px",left:0}}},{dataField:"global_id",text:"Glo",headerStyle:function(){return{width:"50px",left:0}},editCellStyle:function(e,t,a,n){return{backgroundColor:e>2101?"#00BFFF":"#00FFFF"}}},{dataField:"status",text:"Status",editor:{type:O.Type.SELECT,options:j}},{dataField:"current",text:"Curr",editor:{type:O.Type.CHECKBOX,value:"Start:Stop"},headerStyle:function(){return{width:"60px",left:0}}},{dataField:"behavior",text:"Behavior",editor:{type:O.Type.SELECT,options:Qe}},{dataField:"posture",text:"Posture",editor:{type:O.Type.SELECT,options:_}},{dataField:"remove",text:"Del",editable:!1,headerStyle:function(){return{width:"50px",left:0}},formatter:function(e,a){return o.a.createElement("button",{className:"btn btn-danger btn-xs",onClick:function(){return t(a.id)},label:"Del"})}}],t=function(e){for(var t=0,a=0;a<ut[mt].length;a++)if(ut[mt][a].id==e){t=a;break}if("f"!==e.substring(e.length-1,e.length))for(a=0;a<rt.getObjects().length;a++)if(rt.getObjects()[a]._objects[1].text===e){rt.remove(rt.getObjects()[a]),rt.fire("saveData");break}console.log(ut[mt]),ut[mt].splice(t,1),console.log(ut[mt]),Et(mt),i(Math.floor(999999999999*Math.random()))},a=Object(n.useState)(0),l=Object(s.a)(a,2),r=l[0],i=l[1];console.log(r);var d=function(){0!=ut[mt].length&&(console.log(0===ut[mt].length),console.log("saved annotation"),bt=ut[mt],pt=st[mt])},f=Object(n.useState)("1"),g=Object(s.a)(f,2),h=g[0],p=g[1],v=Object(n.useState)(0),y=Object(s.a)(v,2),E=y[0],k=y[1],x=function(){var e="#"+((1<<24)*Math.random()|0).toString(16);if(null==ut[mt]&&(ut[mt]=[]),"2"===h){ut[mt].push({id:E+"b",global_id:null,status:"",current:"Start",behavior:"None"});var t=new b(rt.height/2,rt.width/2,50,50,e,E+"b","None").generate_no_behavior(rt);rt.add(t)}else if("3"===h)alert("KeyPoint annotation are currently unavailable");else if("4"===h){alert("Segmentation annotation is currently under development"),ut[mt].push({id:E+"s",global_id:null,status:"None",current:"Start",behavior:"None"});(new w).generate_polygon(rt,E+"s")}else"1"===h&&ut[mt].push({id:E+"f",global_id:null,status:"",current:"Start",behavior:"None"});Et(mt),k(E+1),rt.fire("saveData")},F=Object(n.useState)(null),M=Object(s.a)(F,2),D=M[0],P=M[1],B=Object(n.useState)(null),U=Object(s.a)(B,2),K=U[0],z=U[1],H=Object(n.useState)(null),Y=Object(s.a)(H,2),W=Y[0],X=Y[1];Object(n.useEffect)((function(){null!=W&&(alert("Annotation upload processed.\nAny existing annotations will be deleted and replaced with uploaded ones."),console.log(W),console.log(W.get_frame_data()),st=W.get_frame_data(),ut=W.get_annotation_data(),Ve())}),W);var G=function(e){return new Promise((function(t,a){var n=new FileReader;n.onload=function(e){t(JSON.parse(e.target.result))},n.readAsText(e.target.files[0])}))},Z=Object(n.useState)(!1),q=Object(s.a)(Z,2),$=q[0],Q=q[1],ee=function(e){Q(!$)},ae="ERROR";ae=!0===$?"Pause":"Play";var oe=Object(n.useState)(!1),le=Object(s.a)(oe,2),re=(le[0],le[1]),ie=Object(n.useState)(null),ce=Object(s.a)(ie,2),se=ce[0],ue=ce[1],de=function(e){if(null!=e&&null!=e.player&&null!=e.player.player&&null!=e.player.player){it=e.player.player.player.videoWidth,ct=e.player.player.player.videoHeight;e.player.player.player.duration}ue(e)},fe=Object(n.useState)(0),me=Object(s.a)(fe,2),ge=me[0],he=me[1],be=function(e){if(!0===dt&&null!=se){console.log("Initializing..."),tt=Math.round(15*e),st=new Array(tt),ut=new Array(tt);for(var t=0;t<tt;t++)st[t]=[],ut[t]=[];dt=!1,ft=!1}he(parseInt(e)),console.log(e)},pe=function(e){Et(mt);var t=15*ge;mt=e.played/t,mt=Math.round(e.played*t),Ve()},ve=Object(n.useState)(!0),ye=Object(s.a)(ve,2),Ee=ye[0],we=ye[1],Oe=function(e){d(),!1===Ee&&0==ut[mt+nt].length&&(ut[mt+nt]=JSON.parse(JSON.stringify(ut[mt])),st[mt+nt]=st[mt],console.log("Carryover annotation"));var t=15*ge;console.log(se.getCurrentTime()/ge*t/t+nt/t),se.seekTo(se.getCurrentTime()/ge*t/t+nt/t)},Se=function(e){d();var t=15*ge;se.seekTo(se.getCurrentTime()/ge*t/t-nt/t)},ke=function(){var e=Object(J.a)(V.a.mark((function e(){var t,a,n,o,l;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="generated_annotations",""!==yt&&""!==vt&&(t=yt.split(".").slice(0,-1).join(".")+"_"+vt),a=JSON.stringify({annotations:st,behavior_data:ut}),n=new Blob([a],{type:"application/json"}),e.next=6,URL.createObjectURL(n);case 6:o=e.sent,(l=document.createElement("a")).href=o,l.download=t+".json",document.body.appendChild(l),l.click(),document.body.removeChild(l);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_e=Object(n.useState)(!1),je=Object(s.a)(_e,2),Ce=je[0],xe=je[1],Ae=function(){return xe(!1)},Te=Object(n.useState)(!1),Ne=Object(s.a)(Te,2),Fe=Ne[0],Re=Ne[1],Me=Object(n.useState)(!0),De=Object(s.a)(Me,2),Ie=De[0],Pe=De[1],Be=function(e){if(0!=Ie)if("2"===e.key)ht="Mode Switch: Bounding Box",Re(!0),p("2");else if("3"===e.key)ht="Mode Switch: Key Point",Re(!0),p("3");else if("4"===e.key)ht="Mode Switch: Segmentation",Re(!0),p("4");else if("1"===e.key)ht="Mode Switch: Behavior Annotation",Re(!0),p("1");else if("a"===e.key){var t="";"2"===h?t="Bounding Box":"1"===h?t="Behavior Data":"3"===h?t="Keypoint":"4"===h&&(t="Segmentation"),ht="Added Annotation - "+t,Re(!0),x()}else"r"===e.key||("q"===e.key?Se():"w"===e.key?ee():"e"===e.key?Oe():"s"===e.key?(ht="Annotation Saved",Re(!0),st[mt]=rt.toJSON()):"f"===e.key?!1===Ee?(ht="Scrubbing Mode Activated",we(!0),Re(!0)):(ht="Scrubbing Mode Deactivated",we(!1),Re(!0)):"c"===e.key&&(ht="Copying previous frame annotation",ut[mt]=JSON.parse(JSON.stringify(bt)),st[mt]=JSON.parse(JSON.stringify(pt)),Re(!0)))},Le=Object(n.useState)(!1),Ue=Object(s.a)(Le,2);Ue[0],Ue[1],Object(n.useEffect)((function(){return document.addEventListener("keydown",Be),function(){return document.removeEventListener("keydown",Be)}}),[Be]),rt.loadFromJSON(st[mt],(function(){rt.renderAll()}));var Ve=function(){i(r+1)};return o.a.createElement("div",null,o.a.createElement(A.a,{bg:"dark",variant:"dark",className:"bg-5"},o.a.createElement(A.a.Brand,{href:"#home"},"AVAT"),o.a.createElement(T.a,{className:"mr-auto"},o.a.createElement(T.a.Link,{onClick:function(){return xe(!0)}},"Instructions"),o.a.createElement(N.a,{disabled:ft,title:"Export",id:"basic-nav-dropdown"},o.a.createElement(N.a.Item,{onClick:ke},"JSON"),o.a.createElement(N.a.Divider,null),o.a.createElement(N.a.Item,null,"CSV")),o.a.createElement(N.a,{title:"Settings",id:"basic-nav-dropdown"},o.a.createElement(N.a.Divider,null),"Frame Rate: ",o.a.createElement("input",{type:"number",defaultValue:"15"}),o.a.createElement(N.a.Divider,null),"Horizontal Res: ",o.a.createElement("input",{type:"number",defaultValue:it}),o.a.createElement(N.a.Divider,null),"Vertical Res: ",o.a.createElement("input",{type:"number",defaultValue:ct}),o.a.createElement(N.a.Divider,null),"Skip Value: ",o.a.createElement("input",{type:"number",defaultValue:"1",onChange:function(e){nt=parseInt(e.target.value)}}),o.a.createElement(N.a.Divider,null),"Annotator Name: ",o.a.createElement("input",{type:"text",defaultValue:"",onChange:function(e){vt=e.target.value}})),o.a.createElement(T.a.Link,{onClick:function(){window.open("https://forms.gle/CrJuYEoT39uFgnR17","_blank")}},"Report")),o.a.createElement("div",null,o.a.createElement(R.a,{style:{float:"left",width:80}},o.a.createElement(R.a.File,{disabled:ft,id:"file",label:"Annotation Upload",custom:!0,type:"file",onChange:function(e){G(e).then((function(e){null!=e?X(new m(e)):console.log("ERROR in upload old_annotation")}))}})),o.a.createElement(R.a,{style:{float:"left",width:80}},o.a.createElement(R.a.File,{id:"file",label:"Video Upload",accept:".mp4",custom:!0,type:"file",onChange:function(e){P(URL.createObjectURL(e.target.files[0])),console.log(e.target.files[0]),yt=e.target.files[0].name,dt=!0}})),o.a.createElement(R.a,{style:{float:"left",width:80}},o.a.createElement(R.a.File,{id:"file",label:"Video Upload",accept:".mp4",custom:!0,type:"file",onChange:function(e){z(URL.createObjectURL(e.target.files[0]))}})),o.a.createElement(C.a,{variant:"secondary",disabled:!0},"Frame # ",parseInt(mt)+" / "+parseInt(15*ge))," ",o.a.createElement(C.a,{variant:"primary",disabled:ft,onClick:Se},"Prev")," ",o.a.createElement(C.a,{variant:"primary",disabled:ft,onClick:ee},ae)," ",o.a.createElement(C.a,{variant:"primary",disabled:ft,onClick:Oe},"Next")," ",o.a.createElement(C.a,{variant:"success",disabled:ft,onClick:x,style:{position:"relative"}},"Add")," ")),o.a.createElement(u.a,{onClose:function(){return Re(!1)},show:Fe,delay:500,autohide:!0,style:{position:"absolute",top:0,left:"40%",zIndex:100}},o.a.createElement(u.a.Header,null,o.a.createElement("strong",{className:"mr-auto"},ht))),o.a.createElement(I.a,{show:Ce,onHide:Ae,size:"lg"},o.a.createElement(I.a.Header,{closeButton:!0},o.a.createElement(I.a.Title,null,"Instructions")),o.a.createElement(I.a.Body,null,o.a.createElement(L,null)),o.a.createElement(I.a.Footer,null,o.a.createElement(C.a,{variant:"secondary",onClick:Ae},"Close"))),o.a.createElement("div",{style:{display:"grid"}},o.a.createElement("div",{style:{gridColumn:1,gridRow:1,position:"relative",height:.4*lt}},o.a.createElement(c.a,{onProgress:pe,ref:de,onDuration:be,url:D,width:"100%",height:"99.999%",playing:$,controls:!1,volume:0,muted:!0,pip:!1})),o.a.createElement("div",{style:{gridColumn:1,gridRow:2,position:"relative",height:.4*lt}},o.a.createElement(c.a,{onProgress:pe,ref:de,onDuration:be,url:K,width:"100%",height:"99.999%",playing:$,controls:!1,volume:0,muted:!0,pip:!1})),o.a.createElement("div",{style:{gridColumn:1,gridRow:3,position:"relative",top:0,left:0}},o.a.createElement("input",{style:{width:.5*at},type:"range",min:0,max:.999999,step:"any",value:gt,onMouseDown:function(e){re(!0)},onChange:function(e){gt=parseFloat(e.target.value)},onMouseUp:function(e){re(!1),se.seekTo(parseFloat(e.target.value))}})),o.a.createElement("div",{style:{gridColumn:2,gridRow:1,position:"relative",width:.4*ot,top:0,left:0}},o.a.createElement("div",null,o.a.createElement(te.a,{keyField:"id",data:ut[mt],columns:e,table:!0,noDataIndication:function(){return o.a.createElement("div",null,"No recorded annotations or behaviors for this frame",o.a.createElement("br",null),"Please add an annotation or behavior tag to start.")},cellEdit:S()({mode:"click",blurToSave:!0,afterSaveCell:function(e,t,a,n){ut[mt][a.id]=a,Pe(!0)},onStartEdit:function(e,t,a,n){Pe(!1)}}),pagination:ne()()})))))},Ot=a(632),St=a(633);var kt=function(){var e=Object(n.useState)(!1),t=Object(s.a)(e,2),a=t[0],l=t[1],r=function(){return l(!1)},i=Object(n.useState)(!1),c=Object(s.a)(i,2),u=c[0],d=(c[1],Object(n.useState)(!1)),f=Object(s.a)(d,2),m=f[0],g=f[1],h=Object(n.useState)(!1),b=Object(s.a)(h,2),p=b[0],v=b[1];return u?o.a.createElement($e,null):m?o.a.createElement(Re,null):p?o.a.createElement(wt,null):o.a.createElement("div",null,o.a.createElement(I.a,{show:a,onHide:r,size:"lg"},o.a.createElement(I.a.Header,{closeButton:!0},o.a.createElement(I.a.Title,null,"Instructions")),o.a.createElement(I.a.Body,null,o.a.createElement(L,null)),o.a.createElement(I.a.Footer,null,o.a.createElement(C.a,{variant:"secondary",onClick:r},"Close"))),o.a.createElement(Ot.a,{fluid:!0},o.a.createElement(St.a,null,o.a.createElement("div",{class:"row align-items-center"},o.a.createElement("div",{class:"pb-4 col-md-6 col-lg-7"},o.a.createElement("h0",{style:{fontSize:"50px"}},"AVAT - Animal Video Analysis Tool","  ",o.a.createElement("img",{class:"",src:"/AVAT/favicon.ico",alt:"logo",style:{width:"9%"}})),o.a.createElement("h5",null," Online tool to mass annotate videos for AI/ML Research"),o.a.createElement(C.a,{size:"lg",onClick:function(){return l(!0)}},"Instructions")),o.a.createElement("div",{class:"col-md-6 col-lg-5"},o.a.createElement("div",{class:"row"},o.a.createElement("div",{class:"col"},o.a.createElement("div",{class:"card my-2"},o.a.createElement(C.a,{onClick:function(e){g(!m)},variant:"outline-success"},"Video Upload"))),o.a.createElement("div",{class:"col-12"},o.a.createElement("div",{class:"card my-2"},o.a.createElement(C.a,{onClick:function(e){v(!p)},variant:"outline-success"},"Multiview")))))))))};var _t=function(){return o.a.createElement("div",null,o.a.createElement(kt,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(_t,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[448,1,2]]]);
//# sourceMappingURL=main.18439860.chunk.js.map