(this.webpackJsonpavat=this.webpackJsonpavat||[]).push([[0],{114:function(e){e.exports=JSON.parse('[{"src":"/assets/tensorflow.gif","altText":"Model assisted annotation","description":"Supports integration with pre-trained Tensorflow models to accelerate annotation","slide_time":10000},{"src":"/assets/add_remove.gif","altText":"Quickly add and remove annotations","description":"Add and remove annotations with ease with individual edits or whole frame edits","slide_time":8000},{"src":"/assets/bounding_box.png","altText":"Bounding Box","description":"Rectangle that serves as a point of refrence for training object detection AI models. This annotation can be coupled with behavior data.","slide_time":4000},{"src":"/assets/annotation_count.png","altText":"Keep track of multiple annotations accross frames","description":"Full frame data summary helps keep track of multiple annotations by local and global id.","slide_time":4000},{"src":"/assets/youtube.png","altText":"Video Support","description":"Supports videos from Local Files, Youtube, Vimeo and Dailymotion","slide_time":4000}]')},116:function(e,t,a){e.exports=a(215)},121:function(e,t,a){},122:function(e,t,a){},148:function(e,t){},149:function(e,t){},150:function(e,t){},215:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),o=a(16),l=a.n(o);a(121),a(122),a(123),a(37);var r=a(91);const s=a(50).fabric;s.util.createClass(s.Rect,{type:"boundingbox",initialize:function(e){e||(e={}),this.callSuper("initialize",e),this.set("label",e.label||"")},toObject:function(){return s.util.object.extend(this.callSuper("toObject"),{label:this.get("label")})},_render:function(e){this.callSuper("_render",e),e.font="10px Helvetica",e.fillStyle="#333",e.fillText(this.label,-this.width/2,-this.height/2+20),e.uniScaleTransform=!1}});const c=a(50).fabric;class d{constructor(e,t,a,n,i,o,l){this.top=e,this.left=t,this.id=o,this.behavior=l,this.color=i,this.width=a,this.height=n}rectangle(){return new c.Rect({hasRotatingPoint:!1,height:this.height,width:this.width,fill:this.color,opacity:".4",top:this.top,left:this.left})}id_text(){return new c.Text(this.id.toString(),{fontSize:20,top:this.top,left:this.left,uniScaleTransform:!1})}generate_no_behavior(){var e=new c.Group([this.rectangle(),this.id_text()],{borderColor:"#000000",hasBorders:!0,uniScaleTransform:!0});var t=this.id;return e.local_id=t,e.toJSON()}generate_mouse_no_behavior(e){var t,a,n,i;new c.Text(this.id.toString(),{fontSize:20,top:this.top,left:this.left,uniScaleTransform:!1});e.on("mouse:down",(function(o){a=!0;var l=e.getPointer(o.e);n=l.x,i=l.y;l=e.getPointer(o.e);var r=new c.Rect({left:n,top:i,originX:"left",originY:"top",width:l.x-n,height:l.y-i,angle:0,fill:"rgba(255,0,0,0.5)",transparentCorners:!1,uniScaleTransform:!0});t=r,e.add(t)})),e.on("mouse:move",(function(o){if(a){var l=e.getPointer(o.e);n>l.x&&t.set({left:Math.abs(l.x)}),i>l.y&&t.set({top:Math.abs(l.y)}),t.set({width:Math.abs(n-l.x)}),t.set({height:Math.abs(i-l.y)}),e.renderAll()}})),e.on("mouse:up",(function(t){a=!1,e.off("mouse:down"),e.off("mouse:up")}))}}const m=a(50).fabric;a(151);class u{constructor(e,t,a){this.frame_data=e.annotations,this.annotation_data=e.behavior_data,this.width=t,this.height=a,this.metadata=e.vid_metadata}get_frame_data(){return this.scale_annotations()}get_frame_rate(){try{return this.metadata.frame_rate}catch(e){return 1}}get_annotation_data(){return this.annotation_data}find_highest_localid(){for(var e=[],t=0;t<this.annotation_data.length;t++)for(var a=0;a<this.annotation_data[t].length;a++)e.push(parseInt(this.annotation_data[t][a].id.replace(/\D/g,"")));return Math.max(...e)+1}scale_annotations(){for(var e=[],t=0;t<this.frame_data.length;t++){var a=[],n=this.frame_data[t];if(null!=n){for(var i=0;i<n.length;i++)if("bounding_box"===n[i].type){var o=parseInt(n[i].x)/parseInt(this.metadata.horizontal_res)*this.width,l=n[i].y/this.metadata.vertical_res*this.height,r=n[i].width/this.metadata.horizontal_res*this.width,s=n[i].height/this.metadata.vertical_res*this.height,c="#"+((1<<24)*Math.random()|0).toString(16),u=new d(l,o,r,s,c,n[i].local_id,"None").generate_no_behavior(this);u.local_id=n[i].local_id,a.push(u)}else if("segmentation"===n[i].type){for(var h=[],p=n[i].points,f=0;f<p.length;f++){var g=parseInt(p[f].x)/parseInt(this.metadata.horizontal_res)*this.width,v=p[f].y/this.metadata.vertical_res*this.height;h.push({x:g,y:v})}var y=new m.Polygon(h,{strokeWidth:1,stroke:"green",opacity:.5,scaleX:1,scaleY:1,objectCaching:!1,transparentCorners:!1,cornerColor:"blue",originX:"center",originY:"center"}),b=new m.Text(n[i].local_id,{fontSize:20,centerX:"center",top:h[0].y,left:h[0].x,uniScaleTransform:!1,fill:"white"}),_=new m.Group([y,b],{perPixelTargetFind:!0});_.lockMovementY=!0,_.lockMovementX=!0,_.selectable=!1,_.local_id=n[i].local_id,a.push(_)}e.push(a)}else e.push([])}return e}}var h=a(57);const p=[{value:"Feeding",label:"Feeding"},{value:"Drinking",label:"Drinking"},{value:"Exploratory",label:"Exploratory"},{value:"Social",label:"Social"},{value:"Locomotion",label:"Locomotion"},{value:"Proximity",label:"Proximity"},{value:"Others",label:"Others"}],f=[{value:"Lying",label:"Lying"},{value:"Sitting",label:"Sitting"},{value:"Kneeling",label:"Kneeling"},{value:"Standing",label:"Standing"}],g=[{value:"No occlusion",label:"No occlusion"},{value:"Minor occlusion",label:"Minor occlusion"},{value:"Split occlusion",label:"Split occlusion"},{value:"End occlusion",label:"End occlusion"},{value:"Critical occlusion",label:"Critical occlusion"}];var v=a(11);const y=e=>[{dataField:"id",text:"ID",headerStyle:()=>({width:"40px",left:0}),editable:!1},{dataField:"global_id",text:"Glo",headerStyle:()=>({width:"70px",left:0})},{dataField:"posture",text:"Posture",editor:{type:h.Type.SELECT,options:f}},{dataField:"behavior",text:"Behavior",editor:{type:h.Type.SELECT,options:p}},{dataField:"confidence",text:"Confidence",editor:{type:h.Type.SELECT,options:g}},{dataField:"remove",text:"Del",editable:!1,headerStyle:()=>({width:"50px",left:0}),headerFormatter:()=>i.a.createElement("div",null,"Del",i.a.createElement(v.a,{className:"btn btn-danger btn-xs",onClick:()=>e(),label:"Del"})),formatter:(t,a)=>i.a.createElement("div",null,i.a.createElement(v.a,{className:"btn btn-danger btn-xs",onClick:()=>e(a.id),label:"Del"}))}];var b=a(79),_=a(56),E=a(220),w=a(47),k=a(13),S=a(15),T=a(221),j=a(10);a(96);function x(){return i.a.createElement("div",null,i.a.createElement("h1",{id:"instructions-for-using-the-avat-platform"},"Instructions for Using the AVAT Platform"),i.a.createElement("p",null,"The AVAT platform is designed to be accessible for users across various academic disciplines, providing a robust interface for efficient video annotation. This document outlines the key features of the platform, including user interface details, key bindings, and the process for uploading media and annotating videos."),i.a.createElement("p",null,"For a system that spans multiple academic disciplines, ensuring a robust interface allows a person of any experience to efficiently annotate videos. A potential user should be able to identify animals of interest easily and have a method to track them across frames in an easy and efficient manner. For a more efficient workflow, a series of key bindings was implemented to expedite each operation within the platform, therefore allowing unexperienced users to familiarize themselves with a predetermined workflow efficiently."),i.a.createElement("h2",{id:"overview"},"Overview"),i.a.createElement("p",null,"AVAT aims to simplify the video annotation process, allowing users to easily identify and track animals of interest across frames. A significant challenge addressed was conditioning users to adopt a predetermined workflow for increased efficiency, even without prior intensive training on our system."),i.a.createElement("h2",{id:"browser-support"},"Browser Support"),i.a.createElement("p",null,"The following browsers are supported by the AVAT platform. If you encounter any errors, we recommend using the latest version of Chrome or Firefox, as these have been extensively tested:"),i.a.createElement("ul",null,i.a.createElement("li",null,"Chrome 49 (release: 2/3/2016)"),i.a.createElement("li",null,"Firefox 50 (release: 11/15/2016)"),i.a.createElement("li",null,"Safari 10 (release: 9/20/2016)"),i.a.createElement("li",null,"Edge 14 (release: 2/18/2016)")),i.a.createElement("h2",{id:"direct-access-recommended-"},"Direct Access (Recommended)"),i.a.createElement("p",null,"Access AVAT via ",i.a.createElement("a",{href:"https://aifarms.github.io/AVAT/"},"https://aifarms.github.io/AVAT/"),"."),i.a.createElement("h2",{id:"local-deployment-frontend-"},"Local Deployment (Frontend)"),i.a.createElement("p",null,"These instructions will help you set up a local copy of the project for development and testing purposes."),i.a.createElement("h3",{id:"prerequisites"},"Prerequisites"),i.a.createElement("p",null,"You will need to have npm, firefox/chrome, and git installed on your system."),i.a.createElement("h3",{id:"installing-and-building"},"Installing and Building"),i.a.createElement("ol",null,i.a.createElement("li",null,"Clone the repository to your desired location: ```bash git clone ",i.a.createElement("a",{href:"https://github.com/AIFARMS/AVAT"},"https://github.com/AIFARMS/AVAT")),i.a.createElement("li",null,"Install the required node_modules: ```bash npm install"),i.a.createElement("li",null,"Start the project locally. The website will be accessible at ",i.a.createElement("a",{href:"http://localhost:4000/"},"http://localhost:4000/"),". This command starts the front-end portion of the dashboard: ```bash npm start"),i.a.createElement("li",null,"To simply access the website, navigate to the build folder and open ",i.a.createElement("code",null,"index.html"),".")),i.a.createElement("h2",{id:"key-bindings"},"Key Bindings"),i.a.createElement("p",null,"The platform has a series of built in key binds that allow the user to employ different sampling strategies. Skipping through frames is accomplished with \u201ce\u201d for forward and \u201cq\u201d for backward, while \u201cw\u201d toggles the pause/play function. The \u201cc\u201d key is particularly useful for copying the previous annotation, thereby reducing repetitive tasks when annotating sequences with minimal changes. The \u201cf\u201d key is used to toggle the scrub mode, which is activated by default to allow for quick navigation through the video timeline."),i.a.createElement("ul",null,i.a.createElement("li",null,i.a.createElement("code",null,"e"),": Skip forward to the next frame."),i.a.createElement("li",null,i.a.createElement("code",null,"q"),": Skip backward to the previous frame."),i.a.createElement("li",null,i.a.createElement("code",null,"w"),": Toggle pause/play for the video."),i.a.createElement("li",null,i.a.createElement("code",null,"c"),": Copy the previous annotation, useful for sequences with minimal changes."),i.a.createElement("li",null,i.a.createElement("code",null,"f"),": Toggle scrub mode for quick video timeline navigation."),i.a.createElement("li",null,i.a.createElement("code",null,"a"),": Add a new annotation."),i.a.createElement("li",null,i.a.createElement("code",null,"r"),": Remove the selected annotation.")),i.a.createElement("h2",{id:"user-interface"},"User Interface"),i.a.createElement("h3",{id:"video-playback-and-annotation-area"},"Video Playback and Annotation Area"),i.a.createElement("ul",null,i.a.createElement("li",null,"The user interface of the AVAT platform is divided into two main sections. The left section features the video playback area, where the media is displayed for annotation. This primary area is designed for clear visibility and interaction with the video content. On the right side of the video playback area, there is a structured annotation table. This table is organized to display a list of annotations corresponding to the video frames. Each entry in the table is associated with a specific annotation created within the video playback area. The table columns include details such as the local ID , the global ID(Glo), and descriptors such as posture, behavior, and a confidence score. There is also a deletion option (Del) for removing annotations as needed. The \u201cPrevious\u201d tab allows users to visualize annotations from the previous frames. Above the video playback area, there is a navigation bar with options such as \u201cExport\u201d and \u201cInstructions\u201d, which contains functionality for data export and accessing user guidelines. The top right corner includes a frame indicator, showing the current frame out of the total number of frames, and playback control buttons like \u201cPrev\u201d for previous frame, \u201cPlay\u201d for starting the video, and \u201cNext\u201d for advancing to the next frame of interest. On the right side of the navigation bar, there is an \u201cAdd\u201d button, indicating a quick action to insert new annotations.")),i.a.createElement("h3",{id:"navigation-and-functionality"},"Navigation and Functionality"),i.a.createElement("ul",null,i.a.createElement("li",null,"Above the video playback area, a navigation bar includes options for data export and accessing guidelines through the \u201cExport\u201d and \u201cInstructions\u201d tabs."),i.a.createElement("li",null,"A frame indicator in the top right corner displays the current frame number."),i.a.createElement("li",null,"Playback control buttons include \u201cPrev\u201d for the previous frame, \u201cPlay\u201d for starting the video, and \u201cNext\u201d for advancing to the next frame."),i.a.createElement("li",null,"An \u201cAdd\u201d button allows for quick insertion of new annotations.")),i.a.createElement("h2",{id:"media-upload-and-initialization"},"Media Upload and Initialization"),i.a.createElement("h3",{id:"uploading-videos"},"Uploading Videos"),i.a.createElement("ol",null,i.a.createElement("li",null,"Access the \u201cUpload\u201d tab to start."),i.a.createElement("li",null,"Select the media type to be annotated from the Format dropdown."),i.a.createElement("li",null,"Specify the number of video streams in the \u201cStream Number\u201d field."),i.a.createElement("li",null,"Click \u201cBrowse\u201d next to \u201cVideo Upload\u201d and choose the file from the local directory."),i.a.createElement("li",null,"Pre-defined ethogram labels or existing annotations can be uploaded using the \u201cColumn Upload\u201d and \u201cAnnotation Upload\u201d buttons."),i.a.createElement("li",null,"Ensure the \u201cFrame Rate\u201d matches the video\u2019s frame rate."),i.a.createElement("li",null,"Set the \u201cSkip Value\u201d to determine the frame sampling interval."),i.a.createElement("li",null,"Click \u201cUpload\u201d to process and display the first frame, indicating readiness for annotation.")),i.a.createElement("h3",{id:"uploading-images"},"Uploading Images"),i.a.createElement("ul",null,i.a.createElement("li",null,"Ensure images are in a 16:9 aspect ratio for optimal performance.")),i.a.createElement("h3",{id:"initialization-workflow"},"Initialization workflow"),i.a.createElement("ul",null,i.a.createElement("li",null,"Initiating the annotation platform starts with accessing the \u201cUpload\u201d tab. First, users select the type of media Format dropdown to denote the type of media to be annotated. Then, they specify the number of video streams for upload in the \u201cStream Number\u201d field, inputting \u201c1\u201d for a single video. Users upload their video by clicking \u201cBrowse\u201d next to \u201cVideo Upload\u201d and choosing the file from their local directory. If there are pre-defined ethogram labels or existing annotations, these can be uploaded using the \u201cColumn Upload\u201d and \u201cAnnotation Upload\u201d buttons, respectively. The \u201cFrame Rate\u201d field should match the video\u2019s frame rate to synchronize the annotations with the video. The \u201cSkip Value\u201d determines the frame sampling interval. A default value of \u201c1\u201d means every frame will be sampled; a higher value will skip frames and reduce the sampling frequency. After selecting the files and setting the parameters, users click the \u201cUpload\u201d button to start the upload process. The platform processes the videos or images, and upon completion, the first frame of the video is displayed in the playback area, indicating readiness to begin annotation work. This process is designed to be simple and efficient, ensuring users can quickly start annotating their videos with minimal setup.")),i.a.createElement("h2",{id:"annotation-types-and-process"},"Annotation Types and Process"),i.a.createElement("ul",null,i.a.createElement("li",null,i.a.createElement("strong",null,"Behavior Annotation"),": For labeling behaviors or postures. Keybinds: ",i.a.createElement("code",null,"1")," and ",i.a.createElement("code",null,"a"),"."),i.a.createElement("li",null,i.a.createElement("strong",null,"Bounding Box and Segmentation"),": For bounding boxes, users click and drag the mouse to draw a rectangle around the object of interest. Resizing is easily done by dragging the small squares at the corners of the bounding box. Each box is automatically assigned a number which links it to a corresponding entry in the table on the interface for easy tracking. For segmentation, users click to place points on the periphery of the object, which are then joined to form a polygon. Clicking on the first point closes and completes the shape. Should adjustments be required, selecting \u201cEdit Segmentation\u201d enables the editing mode, allowing users to move existing points for precise placement."),i.a.createElement("li",null,i.a.createElement("strong",null,"Upload a custom ethogram"),": To incorporate existing ethogram labels into the annotation process, users must modify the template file named data_column.json. This file acts as a template for the ethogram and posture labels within the system. Users can add or remove labels by editing this JSON file, which allows the system to display the customized ethogram for annotators. This step is essential for ensuring that behavior scoring and annotation processes align with the specific ethogram developed for the study.")),i.a.createElement("h2",{id:"customizing-the-ethogram-with-data_column-json-"},"Customizing the Ethogram with ",i.a.createElement("code",null,"data_column.json")),i.a.createElement("p",null,"To tailor the AVAT platform's annotation system to your study's specific needs, you'll need to modify the ",i.a.createElement("code",null,"data_column.json")," template. This file dictates the structure of the annotation table and the options available in dropdown menus for annotating videos. Follow the steps below to customize this file."),i.a.createElement("h3",{id:"step-1-accessing-the-template"},"Step 1: Accessing the Template"),i.a.createElement("p",null,"The template can be found at the AVAT GitHub repository: ",i.a.createElement("a",{href:"https://github.com/AIFARMS/AVAT/data_column.json"},"data_column.json"),". Download or view this file to begin customization."),i.a.createElement("h3",{id:"step-2-understanding-the-file-structure"},"Step 2: Understanding the File Structure"),i.a.createElement("p",null,"The ",i.a.createElement("code",null,"data_column.json")," consists of two primary sections:"),i.a.createElement("ul",null,i.a.createElement("li",null,i.a.createElement("code",null,"columns"),": Defines the headers and accessors for data columns in the annotation interface."),i.a.createElement("li",null,i.a.createElement("code",null,"select_data"),": Specifies options for dropdown menus in the annotation tool, such as confidence levels, behaviors, and postures.")),i.a.createElement("h3",{id:"step-3-editing-the-file"},"Step 3: Editing the File"),i.a.createElement("h2",{id:"annotation-workflow"},"Annotation Workflow"),i.a.createElement("ol",null,i.a.createElement("li",null,i.a.createElement("p",null,i.a.createElement("strong",null,"Preparation")),i.a.createElement("ul",null,i.a.createElement("li",null,"Before starting, ensure that your media files are ready for upload. This includes having videos in supported formats and images, if applicable, prepared in a 16:9 aspect ratio ",i.a.createElement("code",null,".mp4")," to ensure maximum compatibility with the AVAT platform."))),i.a.createElement("li",null,i.a.createElement("p",null,i.a.createElement("strong",null,"Uploading Media")),i.a.createElement("ul",null,i.a.createElement("li",null,"Navigate to the \u201cUpload\u201d tab on the platform's interface."),i.a.createElement("li",null,"For videos, select the type of media to be annotated from the Format dropdown menu. Specify the number of video streams for upload in the \u201cStream Number\u201d field."),i.a.createElement("li",null,"Click \u201cBrowse\u201d next to \u201cVideo Upload\u201d and select the file from your local directory. If you have predefined ethogram labels or existing annotations, use the \u201cColumn Upload\u201d and \u201cAnnotation Upload\u201d buttons to upload these files."),i.a.createElement("li",null,"Ensure the \u201cFrame Rate\u201d field matches the video\u2019s frame rate for synchronization. Adjust the \u201cSkip Value\u201d to set the frame sampling interval according to your needs."),i.a.createElement("li",null,"Click \u201cUpload\u201d to initiate the processing of the videos or images. Once complete, the first frame of the video will be displayed in the playback area, indicating readiness for annotation."))),i.a.createElement("li",null,i.a.createElement("p",null,i.a.createElement("strong",null,"Starting the Annotation Process")),i.a.createElement("ul",null,i.a.createElement("li",null,"Begin annotating the video by using the key binds to navigate through frames and manage annotations. You can switch between different annotation modes (e.g., behavior annotation, bounding box) as needed to accurately label the video content."),i.a.createElement("li",null,"For behavior annotations, use the ",i.a.createElement("code",null,"1")," and ",i.a.createElement("code",null,"a")," keys to add labels for behaviors or postures that don't have visual attributes."),i.a.createElement("li",null,"To create bounding boxes around objects of interest, switch to the bounding box mode with the ",i.a.createElement("code",null,"2")," key and use the ",i.a.createElement("code",null,"a")," key to add a new bounding box. Resize and position the box using your mouse, ensuring it accurately encompasses the object."))),i.a.createElement("li",null,i.a.createElement("p",null,i.a.createElement("strong",null,"Reviewing and Adjusting Annotations")),i.a.createElement("ul",null,i.a.createElement("li",null,"Periodically review your annotations to ensure accuracy and completeness. Use the navigation controls and key bindings to revisit previous frames and adjust annotations as necessary."),i.a.createElement("li",null,"If you need to remove or edit an annotation, utilize the corresponding key bindings (",i.a.createElement("code",null,"r")," for removal, ",i.a.createElement("code",null,"e")," and ",i.a.createElement("code",null,"q")," for navigation) and mouse actions to make precise adjustments."))),i.a.createElement("li",null,i.a.createElement("p",null,i.a.createElement("strong",null,"Exporting Annotated Data")),i.a.createElement("ul",null,i.a.createElement("li",null,'Once you have completed the annotation process, you can export your annotated data for further analysis or sharing with your team. Use the "Export" option in the navigation bar to save your work in the desired format.')))),i.a.createElement("h2",{id:"sampling-rate"},"Sampling rate"),i.a.createElement("p",null,"Ensure video frame rates are accurately inputted for synchronization. Adjust sampling values as needed for your project's requirements. Given that manually labeling every image or frame of a video is an inefficient process, our system adopts an approach that requires users to annotate a sparse set of frames, also referred to as the sampling rate. The sampling rate is dependent on the research question, and we recommend two sampling rate methods: static sampling and dynamic sampling. "),i.a.createElement("p",null,i.a.createElement("code",null,"Static sampling")," is a simple strategy that aims to annotate animals on a static interval where the N intermediate frames are skipped. This strategy is perfect for videos where an set of ethogram labels has already been specified as the user is not looking out for odd or new behaviors that might occur. For videos that have a lot of movement, we set N to be low, whereas, for videos that have small amounts of movement, we can set N to be higher. As such, the primary goal of the user is to minimize N such that key elements of the video are not left out by the skipped frames. Having N too low will result in the user wasting time annotating frames that could easily be interpolated and having a high N will result in key frames being skipped causing the user to comb through the individual frames manually, wasting time. Assuming a suitable ethogram is provided, one can determine the N as the minimum time t it takes for a single event to happen between frames. Specifically, N would be set relative to the activity level of the animals in the video. For example, if the animals were extremely active and engaging in lots of social behaviors through the course of the video, N would be set low as it helps capture nuanced behaviors that would be missed with a high N. Likewise, if the animals were docile and not social, N would set high since not much activity would have happened between frames and the ethogram would only track behaviors that occur through the course of several frames. Functionally, static sampling involves asking the user for N. This value should be set at the start and should be manually set by the user at all times. We recommend a default value of 1 frame per second of video as a baseline N value. "),i.a.createElement("p",null,i.a.createElement("code",null,"Dynamic sampling")," is a strategy that aims to annotate animals for use in the creation of an ethogram. This strategy allows the user to decide when to annotate based on the happenings in the video. This allows the collection of new behaviors and adds the ability for the user to add notes about what is occurring for help in ethogram development. Since the choice of which frames to annotate is on the user, it adds variance in the results and time were taken to complete annotations. For a trained annotator, using dynamic sampling is beneficial since it allows for frames that are not of interest to be skipped in favor of more data-rich frames. However, this sampling strategy requires a seasoned annotator. Unskilled annotators are likely to be less efficient while employing a dynamic sampling strategy since they are not aware of which frames contain the most important features. We recommend using this strategy only if the user is a trained annotator. Functionally, dynamic sampling is implemented by a pause/play option and the ability to scrub through the video. Adding functionality such as playback speed significantly helps the user as they are able to skip through the irrelevant frames with ease. Allowing the user to control the frame level is key as some frames might have changes in between single frames. The platform has a series of built in keybinds that allow the user to employ different sampling strategies. Skipping through frames is accomplished with \u201ce\u201d for forward and \u201cq\u201d for backward, while \u201cw\u201d toggles the pause/play function. The \u201cc\u201d key is particularly useful for copying the previous annotation, thereby reducing repetitive tasks when annotating sequences with minimal changes. The \u201cf\u201d key is used to toggle the scrub mode, which is activated by default to allow for quick navigation through the video timeline."),i.a.createElement("h2",{id:"troubleshooting-and-feedback"},"Troubleshooting and Feedback"),i.a.createElement("p",null,'For any issues or feedback, please use the "Report" button in the top toolbar to submit a detailed report.'))}var O=a(18);const A=Object(O.b)({name:"frame_data",initialState:{data:[]},reducers:{init(e,t){for(var a=[],n=0;n<t.payload;n++)a.push([]);e.data=a},initOldAnnotation(e,t){e.data=t.payload},modifyFrame(e,t){var a=e.data;a[t.payload.currentFrame]=t.payload.data,e.data=a},middleware:e=>e({serializableCheck:!1})}}),{init:C,modifyFrame:F}=A.actions;var N=A.reducer;const I=Object(O.b)({name:"annotation_data",initialState:{data:[]},reducers:{init(e,t){console.log(t.payload);for(var a=[],n=0;n<t.payload;n++)a.push([]);e.data=a},initOldAnnotation(e,t){e.data=t.payload},modifyFrame(e,t){var a=e.data;a[t.payload.currentFrame]=t.payload.data,e.data=a},middleware:e=>e({serializableCheck:!1})}}),{init:z,modifyFrame:R}=I.actions;var P=I.reducer;const V={data:void 0},U=Object(O.b)({name:"column_annot",initialState:V,reducers:{init(e,t){console.log(t.payload.data),e.data=t.payload.data},middleware:e=>e({serializableCheck:!1})}}),{init:B}=U.actions;var D=U.reducer;const M={data:void 0},q=Object(O.b)({name:"current_frame",initialState:M,reducers:{init(e,t){console.log(t.payload.data),e.data=t.payload.data},changeFrame(e,t){e.data=t.payload.data},middleware:e=>e({serializableCheck:!1})}}),{init:L}=q.actions;var H=q.reducer;const J=Object(O.b)({name:"media_data",initialState:{data:[]},reducers:{init(e,t){for(var a=[],n=0;n<t.payload;n++)a.push([]);e.data=a},addMedia(e,t){var a=e.data,n=t.payload.media;a[t.payload.stream_num]=n,e.data=a},middleware:e=>e({serializableCheck:!1})}}),{init:Y,modifyFrame:X}=J.actions;var K=J.reducer;function G(e){ke.dispatch({type:"frame_data/init",payload:e})}function W(e,t){ke.dispatch({type:"frame_data/modifyFrame",payload:{currentFrame:e,data:t}})}function Q(e){return console.log(ke.getState()),JSON.parse(JSON.stringify(ke.getState().frame_data.data[e]))}function Z(e){ke.dispatch({type:"annotation_data/init",payload:e})}function $(e,t){ke.dispatch({type:"annotation_data/modifyFrame",payload:{currentFrame:e,data:t}})}function ee(e){return JSON.parse(JSON.stringify(ke.getState().annotation_data.data[e]))}function te(e){ke.dispatch({type:"column_annot/init",payload:{data:e}})}function ae(){return JSON.parse(JSON.stringify(ke.getState().current_frame)).data}function ne(e){ke.dispatch({type:"current_frame/changeFrame",payload:{data:e}})}function ie(e,t){ke.dispatch({type:"media_data/addMedia",payload:{stream_num:e,media:t}})}function oe(e){ke.dispatch({type:"metadata/setFrameRate",payload:{frame_rate:e}})}function le(e){ke.dispatch({type:"metadata/setMediaType",payload:{media_type:e}})}function re(e){ke.dispatch({type:"metadata/setTotalFrames",payload:{total_frames:e}})}function se(e){ke.dispatch({type:"metadata/setSkipValue",payload:{skip_value:e}})}function ce(){return JSON.parse(JSON.stringify(ke.getState().metadata))}function de(){ke.dispatch({type:"play_status/togglePlay",payload:{}})}const me=Object(O.b)({name:"metadata",initialState:{horizontal_res:0,vertical_res:0,frame_rate:1,media_type:"in_video",total_frames:0,skip_value:null},reducers:{init(e,t){e.horizontal_res=t.payload.horizontal_res,e.vertical_res=t.payload.vertical_res,e.frame_rate=t.payload.frame_rate,e.media_type=t.payload.media_type,e.total_frames=t.payload.total_frames},setRes(e,t){e.horizontal_res=t.payload.horizontal_res,e.vertical_res=t.payload.vertical_res},setFrameRate(e,t){"in_image"!=e.media_type&&(e.frame_rate=t.payload.frame_rate)},setMediaType(e,t){e.media_type=t.payload.media_type},setTotalFrames(e,t){e.total_frames=t.payload.total_frames},setSkipValue(e,t){e.skip_value=t.payload.skip_value},middleware:e=>e({serializableCheck:!1})}}),{init:ue,setRes:he,setFrameRate:pe,setMediaType:fe,setTotalFrames:ge,setSkipValue:ve}=me.actions;var ye=me.reducer;const be=Object(O.b)({name:"play_status",initialState:{play:!1},reducers:{init(e,t){e.play=!1},togglePlay(e,t){e.play=!e.play},middleware:e=>e({serializableCheck:!1})}}),{init:_e,togglePlay:Ee}=be.actions;var we=be.reducer,ke=Object(O.a)({reducer:{frame_data:N,annotation_data:P,column_annot:D,current_frame:H,media_data:K,metadata:ye,play_status:we},devTools:!1});class Se{constructor(e,t,a,n,i){console.log(t),console.log(a),this.frame_data=e,this.width=t,this.height=a,this.metadata=n,this.image_data=i}get_frame_json(){var e=new Array(this.frame_data.length);console.log(this.metadata),console.log(this.frame_data);for(var t=0;t<this.frame_data.length;t++){var a=[];if(this.frame_data[t]!=[]){var n=this.frame_data[t];if(void 0!=n){for(var i=0;i<n.length;i++)try{if(console.log(n[i]),void 0==n[i]||"group"!==n[i].type)continue;if(void 0==n[i]._objects)continue;if("rect"===n[i]._objects[0].type){console.log(n[i]);var o=n[i].left/this.width*this.metadata.horizontal_res,l=n[i].top/this.height*this.metadata.vertical_res,r=n[i].width*n[i].scaleX/this.width*this.metadata.horizontal_res,s=n[i].height*n[i].scaleY/this.height*this.metadata.vertical_res,c=n[i]._objects[1].text;"in_image"==this.metadata.media_type?a.push({type:"bounding_box",x:o,y:l,width:r,height:s,local_id:c,"fileName:":this.image_data[t].name,dataType:"image"}):a.push({type:"bounding_box",x:o,y:l,width:r,height:s,local_id:c,"fileName:":this.metadata.name,dataType:"video"})}else if("polygon"===n[i]._objects[0].type){var d=n[i]._objects[0].points,m=[];console.log(this.metadata),console.log(this.metadata.horizontal_res),console.log(this.width),console.log(this.height);for(var u=0;u<d.length;u++){o=d[u].x/this.width*this.metadata.horizontal_res,l=d[u].y/this.height*this.metadata.vertical_res;m.push({x:o,y:l})}c=n[i]._objects[1].text;"in_image"==this.metadata.media_type?a.push({type:"segmentation",points:m,local_id:c,"fileName:":this.image_data[t].name,dataType:"image"}):a.push({type:"segmentation",points:m,local_id:c,"fileName:":this.metadata.name,dataType:"video"})}else alert("Error in exporting annotation. Please check the annotation and try again.")}catch(h){console.log(h)}e[t]=a}else console.log("Exporting error")}else console.log("Exporting error")}return e}get_frame_json_fullCanvas(){var e=new Array(this.frame_data.length);console.log(this.metadata);for(var t=0;t<this.frame_data.length;t++){var a=[];if(this.frame_data[t]!=[]){var n=this.frame_data[t].objects;if(void 0!=n){for(var i=0;i<n.length;i++)if(console.log(n[i]),"group"===n[i].type)if("rect"===n[i].objects[0].type){console.log(n[i]);var o=n[i].left/this.width*this.metadata.horizontal_res,l=n[i].top/this.height*this.metadata.vertical_res,r=n[i].width*n[i].scaleX/this.width*this.metadata.horizontal_res,s=n[i].height*n[i].scaleY/this.height*this.metadata.vertical_res,c=n[i].objects[1].text;0!=this.image_data.length?a.push({type:"bounding_box",x:o,y:l,width:r,height:s,local_id:c,"fileName:":this.image_data[t].name,dataType:"image"}):a.push({type:"bounding_box",x:o,y:l,width:r,height:s,local_id:c,"fileName:":this.metadata.name,dataType:"video"})}else if("polygon"===n[i].objects[0].type){for(var d=n[i].objects[0].points,m=[],u=0;u<d.length;u++){o=d[u].x/this.width*this.metadata.horizontal_res,l=d[u].y/this.height*this.metadata.vertical_res;m.push({x:o,y:l})}c=n[i].objects[1].text;0!=this.image_data.length?a.push({type:"segmentation",points:m,local_id:c,"fileName:":this.image_data[t].name,dataType:"image"}):a.push({type:"segmentation",points:m,local_id:c,"fileName:":this.metadata.name,dataType:"video"})}e[t]=a}}}return e}get_frame_coco(){}}var Te=a(49),je=a(224);var xe,Oe=a(14),Ae=a(28),Ce=a(35),Fe=a(61);function Ne(e){const[t,a]=Object(n.useState)(!1),[o,l]=Object(n.useState)("in_video"),[r,s]=Object(n.useState)(!1),[c,d]=Object(n.useState)(null),[m,u]=Object(n.useState)(null),[h,p]=Object(n.useState)(null),[f,g]=Object(n.useState)(!1),y=Object(Oe.b)(e=>e.metadata.total_frames),b=Object(Oe.b)(e=>e.metadata.frame_rate),_=e=>{ie(parseInt(e.target.id),e.target.files)};return i.a.createElement(j.a,{show:e.uploadShow,size:"lg",backdrop:"static"},i.a.createElement(j.a.Header,null,i.a.createElement(j.a.Title,null,"Upload")),i.a.createElement(j.a.Body,null,i.a.createElement("div",{style:{display:"grid"}},i.a.createElement(k.a.Row,null,i.a.createElement(Ae.a,null,i.a.createElement(k.a.Control,{as:"select",id:"inlineFormCustomSelect",onChange:e=>{var t;"in_video"===(t=e.target.value)?(l("in_video"),le("in_video")):"in_image"===t?(l("in_image"),le("in_image")):alert("Wrong input detected - please report this bug.")},defaultValue:o,htmlSize:2,custom:!0,disabled:r},i.a.createElement("option",{value:"in_video"},"Video"),i.a.createElement("option",{value:"in_image"},"Image"))),i.a.createElement(Ae.a,null,(()=>{for(var e=[],t=0;t<1;t++){let a=i.a.createElement(k.a,{key:t,style:{float:"left",gridColumn:1,gridRow:4}},i.a.createElement(k.a.File,{multiple:!0,id:t+"",key:t,label:"Image Upload",accept:"image/*",custom:!0,type:"file",onChange:e=>{_(e)},disabled:r})),n=i.a.createElement(k.a,{key:t,style:{float:"left",gridColumn:1,gridRow:4}},i.a.createElement(k.a.File,{id:t+"",key:t,label:"Video Upload",accept:".mp4",custom:!0,type:"file",onChange:e=>{_(e)},disabled:r}));"in_image"===o?e.push(a):"in_video"===o&&e.push(n)}return i.a.createElement("div",null,e.map((e,t)=>e))})())),i.a.createElement(E.a.Divider,null),i.a.createElement(k.a.Row,null,i.a.createElement(Ae.a,null,i.a.createElement(k.a.Group,null,i.a.createElement(Ce.a,{className:"mb-3"},i.a.createElement(Ce.a.Prepend,null,i.a.createElement(Ce.a.Text,null,"Frame Rate")),i.a.createElement(k.a.Control,{type:"number",onChange:e=>{d(e.target.value?e.target.value:1)},disabled:"in_image"===o||r,isInvalid:(null==c||void 0==c||""==c)&&"in_image"!==o,defaultValue:c}),i.a.createElement(k.a.Control.Feedback,{type:"invalid"},"Please enter a frame rate.")))),i.a.createElement(Ae.a,null,i.a.createElement(k.a.Group,null,i.a.createElement(Ce.a,{className:"mb-3"},i.a.createElement(Ce.a.Prepend,null,i.a.createElement(Ce.a.Text,null,"Skip Value")),i.a.createElement(k.a.Control,{type:"number",onChange:e=>{u(e.target.value?e.target.value:1)},isInvalid:null==m||void 0==m||""==m,defaultValue:m}),i.a.createElement(k.a.Control.Feedback,{type:"invalid"},"Please enter a skip value."))))),i.a.createElement(E.a.Divider,null),i.a.createElement(k.a.Row,null,i.a.createElement(Ae.a,null,i.a.createElement(k.a.File,{disabled:e.disable_buttons||r,accept:".json",id:"file",label:"Column Upload",custom:!0,type:"file",onChange:e=>{var t;(t=e,new Promise((e,a)=>{var n=new FileReader;n.onload=function(t){e(JSON.parse(t.target.result))},n.readAsText(t.target.files[0])})).then((function(e){void 0!=e.columns&&null!=e?p(e):alert("Error in processing columns. Please check the file and try again.")}))}})),i.a.createElement(Ae.a,null,i.a.createElement(k.a.File,{accept:".json",id:"file",label:"Annotation Upload",custom:!0,type:"file",onChange:t=>{e.handleOldAnnotation(t),g(!0)},disabled:e.disable_buttons||r}))),i.a.createElement(E.a.Divider,null))),i.a.createElement(j.a.Footer,null,i.a.createElement(v.a,{variant:"success",onClick:()=>{if(e.handleUploadToggle(),se(parseInt(m)),r||f){if(f&&(te(h),"in_video"===o)){re(parseInt(parseInt(b)*parseInt(y)))}}else{s(!0);let e=-1;"in_video"===o?(oe(parseInt(c)),e=parseInt(parseInt(c)*y)):e=y,re(e),G(e),te(null==h?Fe:h),Z(e)}},disabled:(null==c||""==c)&&"in_image"!==o||null==m||""==m||e.disable_buttons},r?"Save":"Upload")))}function Ie(e){const[t,a]=Object(n.useState)(!1),[o,l]=Object(n.useState)(!0),[r,s]=Object(n.useState)("in_video"),[c,d]=Object(n.useState)(!1),[m,u]=Object(n.useState)(!1),[h,p]=Object(n.useState)(!1),[f,g]=Object(n.useState)(null),[y,O]=Object(n.useState)(null),A=Object(Oe.b)(e=>e.play_status.play),C=()=>a(!1),F=()=>{l(!o)};return Object(n.useEffect)(()=>{u(0==A?"Play":"Pause")},[A]),i.a.createElement("div",null,i.a.createElement(j.a,{show:t,onHide:C,size:"lg",backdrop:"static"},i.a.createElement(j.a.Header,{closeButton:!0},i.a.createElement(j.a.Title,null,"Instructions")),i.a.createElement(j.a.Body,null,i.a.createElement(x,null)),i.a.createElement(j.a.Footer,null,i.a.createElement(v.a,{variant:"secondary",onClick:C},"Close"))),i.a.createElement(Ne,{handleOldAnnotation:e.handleOldAnnotation,handleUploadToggle:F,uploadShow:o}),i.a.createElement(b.a,{sticky:"top",bg:"dark",variant:"dark",className:"bg-5"},i.a.createElement(b.a.Brand,{href:"#home"},"AVAT"),i.a.createElement(_.a,{className:"mr-auto"},i.a.createElement(E.a,{disabled:e.disable_buttons,title:"Export",id:"basic-nav-dropdown"},i.a.createElement(E.a.Item,{onClick:()=>{var t=new Se(ke.getState().frame_data.data,e.video_width,e.video_height,ce(),ke.getState().media_data.data[0]).get_frame_json();console.log(t),async function(e,t){const a=JSON.stringify({vid_metadata:t,annotations:e,behavior_data:ke.getState().annotation_data.data});var n=new Blob([a],{type:"application/json"}),i=await URL.createObjectURL(n),o=document.createElement("a");o.href=i,o.download="generated_annotations.json",document.body.appendChild(o),o.click(),document.body.removeChild(o)}(t,ce())}},"JSON"),i.a.createElement(E.a.Divider,null)),i.a.createElement(w.a,{onClick:()=>a(!0)},"Instructions"),i.a.createElement(w.a,{onClick:e.handle_link_open},"Report")),i.a.createElement("div",null,i.a.createElement(v.a,{variant:"outline-success",onClick:F},"Settings")," "," ",i.a.createElement(S.a,{as:T.a},i.a.createElement(v.a,{variant:"secondary",disabled:!0},e.display_frame_num)," ",i.a.createElement(S.a.Toggle,{split:!0,variant:"secondary",id:"dropdown-split-basic"}),i.a.createElement(S.a.Menu,null,i.a.createElement(k.a,null,i.a.createElement(k.a.Label,null,"Skip Value"),i.a.createElement(k.a.Control,{placeholder:"Skip Value",type:"number",onChange:e=>{se(e.target.value)},onClick:e.toggleKeyCheck(!1),onBlur:e.toggleKeyCheck(!0),defaultValue:e.skip_value}))))," ",i.a.createElement(v.a,{variant:"primary",disabled:e.disable_buttons,onClick:e.skip_frame_backward},"Prev")," ","in_video"===r&&i.a.createElement(v.a,{variant:"primary",disabled:e.disable_buttons,onClick:e=>{de()}},m)," ",i.a.createElement(v.a,{variant:"primary",disabled:e.disable_buttons,onClick:e.skip_frame_forward},"Next")," ",i.a.createElement(S.a,{as:T.a,drop:"left"},i.a.createElement(v.a,{variant:"success",onClick:e.addToCanvas},"Add"),i.a.createElement(S.a.Toggle,{split:!0,variant:"success",id:"dropdown-split-basic"}),i.a.createElement(S.a.Menu,null,i.a.createElement(S.a.Item,{onClick:t=>{e.change_annotation_type("1")}},"Behavior Annotation"),i.a.createElement(S.a.Item,{onClick:t=>{e.change_annotation_type("2")}},"BoundingBox"),i.a.createElement(S.a.Item,{onClick:t=>{e.change_annotation_type("3")}},"Segmentation"))))))}xe=1,ke.dispatch({type:"media_data/init",payload:xe});const ze=a(50).fabric,Re=function(e,t,a,n,i,o){let l=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if("in_image"==t){var r=new Image;return r.onload=function(){l&&o.clear(),void 0!=e&&ze.util.enlivenObjects(e,(function(e){e.forEach((function(e,t){o.add(e)})),o.renderAll()}));var t=new ze.Image(r,{objectCaching:!1,scaleX:n/r.width,scaleY:i/r.height});o.setBackgroundImage(t),o.renderAll()},void(r.src=URL.createObjectURL(a))}l&&o.remove(...o.getObjects()),void 0!=e&&ze.util.enlivenObjects(e,(function(e){e.forEach((function(e,t){o.add(e)})),o.renderAll()})),o.renderAll()};function Pe(e){const[t,a]=Object(n.useState)(null),[o,r]=Object(n.useState)(0),[s,c]=Object(n.useState)(!1),[d,m]=Object(n.useState)(0),u=Object(Oe.b)(e=>e.metadata),h=Object(Oe.b)(e=>e.frame_data),p=Object(Oe.b)(e=>e.media_data),f=Object(Oe.b)(e=>e.current_frame),g=f.data,v=Object(Oe.b)(e=>e.play_status.play),y=p.data[e.stream_num];if(Object(n.useEffect)(()=>{var t,n=new ze.Canvas("c",{uniScaleTransform:!0,uniformScaling:!1,includeDefaultValues:!1});ze.Image.prototype.toObject=(t=ze.Image.prototype.toObject,function(){return ze.util.object.extend(t.call(this),{src:this.toDataURL()})}),n.on("mouse:wheel",(function(e){var t=e.e.deltaY,a=n.getZoom();(a*=.999**t)>20&&(a=20),a<.01&&(a=.01),n.zoomToPoint({x:e.e.offsetX,y:e.e.offsetY},a),e.e.preventDefault(),e.e.stopPropagation()})),n.on("object:modified",(function(e){this.objDrag=!0;W(ke.getState().current_frame.data,n.getObjects())})),n.on("mouse:down",(function(e){var t=e.e;!0===t.altKey&&(this.isDragging=!0,this.selection=!1,this.lastPosX=t.clientX,this.lastPosY=t.clientY)})),n.on("mouse:move",(function(e){if(this.isDragging){var t=e.e,a=this.viewportTransform;a[4]+=t.clientX-this.lastPosX,a[5]+=t.clientY-this.lastPosY,this.requestRenderAll(),this.lastPosX=t.clientX,this.lastPosY=t.clientY}})),n.on("mouse:up",(function(e){this.objDrag&&(this.objDrag=!1),this.setViewportTransform(this.viewportTransform),this.isDragging=!1,this.selection=!0}));l.a.findDOMNode(this);var i=document.getElementsByTagName("canvas")[2*e.stream_num];n.initialize(i,{height:e.scaling_factor_height,width:e.scaling_factor_width,backgroundColor:null}),a(n)},[]),Object(n.useEffect)(()=>{if(t){m(g);var a=document.getElementsByTagName("video")[e.stream_num];1==s&&(a.currentTime=a.duration*((g+1)/u.total_frames)),"in_video"==u.media_type?Re(Q(g),"in_video",y[0],e.scaling_factor_width,e.scaling_factor_height,t):"in_image"==u.media_type&&Re(Q(g),"in_image",y[g],e.scaling_factor_width,e.scaling_factor_height,t)}},[f]),Object(n.useEffect)(()=>{if(0!=s){var a,n,i=document.getElementsByTagName("video")[e.stream_num];if(v)a=d,n="play",t&&(console.log("SAVING DATA FOR FRAME",a,n),W(a,t.getObjects())),i.play(),ze.util.requestAnimFrame((function e(){t.renderAll(),ze.util.requestAnimFrame(e)}));else{i.pause();let e=Math.ceil(i.currentTime/i.duration*u.total_frames);console.log("FRAME NUMBER",e),ne(e)}}},[v]),Object(n.useEffect)(()=>{t&&Re(Q(g),u.media_type,y[g],e.scaling_factor_width,e.scaling_factor_height,t)},[h]),null!=t&&void 0!=y&&!1===s&&!1===v&&y.length>0)if("in_video"==u.media_type){var b=document.getElementsByTagName("video")[e.stream_num],_=document.createElement("source");_.src=URL.createObjectURL(y[0]),_.type="video/mp4",b.appendChild(_),b.onloadedmetadata=function(){Z(parseInt(b.duration)),G(parseInt(b.duration)),re(parseInt(b.duration)),b.currentTime=0},b.oncanplaythrough=function(){if(!1===s){var a=new ze.Image(b,{objectCaching:!1,scaleX:e.scaling_factor_width/b.videoWidth,scaleY:e.scaling_factor_height/b.videoHeight});b.width=b.videoWidth,b.height=b.videoHeight,t.setBackgroundImage(a),t.renderAll()}c(!0)}}else"in_image"==u.media_type&&Re(Q(g),"in_image",y[g],e.scaling_factor_width,e.scaling_factor_height,t);return i.a.createElement("div",{style:{display:"grid"}},i.a.createElement("div",{style:{gridColumn:1,gridRow:1,position:"relative",width:e.scaling_factor_width,height:e.scaling_factor_height,top:0,left:0,opacity:0}},i.a.createElement("video",null)),i.a.createElement("div",{style:{gridColumn:1,gridRow:1,position:"relative",top:0,left:0}},i.a.createElement("canvas",{id:e.stream_num})))}a(165),a(203),a(204);var Ve=a(112),Ue=a(113),Be=a(75);function De(e){let{columns:t,data:a,select_data:n,current_frame:o,change_annot:l}=e;const{getTableProps:r,getTableBodyProps:s,headerGroups:c,rows:d,prepareRow:m}=Object(Be.useTable)({columns:t,data:a});return t?i.a.createElement("table",Object.assign({},r(),{style:{border:"solid 1px blue"}}),i.a.createElement("thead",null,c.map(e=>i.a.createElement("tr",e.getHeaderGroupProps(),e.headers.map(e=>i.a.createElement("th",Object.assign({},e.getHeaderProps(),{style:{background:"#657",color:"white",fontWeight:"bold"}}),e.render("Header")))))),i.a.createElement("tbody",s(),d.map((e,a)=>{m(e);const{id:l,global_id:r,posture:s,behavior:c,confidence:d}=e;return function(e,t,a,n,o){var l=[];console.log(o);for(var r=0;r<a[0].columns.length;r++){var s=a[0].columns[r].accessor;if(!Le(t,s))continue;let c=i.a.createElement("select",{id:n,"data-type":s,"data-curr":o,defaultValue:e[s],onChange:Me},i.a.createElement("option",{value:""}),t[s].map((e,t)=>i.a.createElement("option",{value:e.value},e.value)));l.push(c)}return i.a.createElement("tr",{key:e.id},i.a.createElement("td",null,e.id),i.a.createElement("td",null,i.a.createElement("input",{type:"text",style:{width:"50%"},defaultValue:e.global_id,id:n,"data-type":"global_id","data-curr":o,onChange:Me})),l.map((e,t)=>i.a.createElement("td",{id:t},e)),i.a.createElement("td",null,i.a.createElement("input",{type:"button",style:{backgroundColor:"#f44336"},defaultValue:e.global_id,id:n,"data-type":"global_id","data-curr":o,onClick:qe})))}(e.original,n,t,a,o)}))):i.a.createElement("div",null,"No column upload detected.")}const Me=e=>{var t=ee(e.target.dataset.curr);0!==t.length?(t[e.target.id][e.target.dataset.type]=e.target.value,$(parseInt(e.target.dataset.curr),t)):alert("Row changing value failed - please report this bug.")},qe=e=>{var t=ee(e.target.dataset.curr);if(0!==t.length){var a=t[e.target.id].id;console.log(a),t.splice(e.target.id,1),$(parseInt(e.target.dataset.curr),t);for(var n=Q(e.target.dataset.curr),i=0;i<n.length;i++)n[i].objects[1].text==a&&n.splice(i,1);W(parseInt(e.target.dataset.curr),n)}else alert("Row deletion failed - please report this bug.")};function Le(e,t){let a=Object.keys(e);for(var n=0;n<a.length;n++)if(a[n]===t)return!0;return!1}function He(e){var t=e.annotation_data,a=[],n=[],o=void 0;void 0!=ke.getState().column_annot.data&&(n=ke.getState().column_annot.data.columns,o=ke.getState().column_annot.data.select_data,a.push(n));i.a.useMemo(()=>[{Header:"Name",columns:[{Header:"Frame",accessor:"frame_num"},{Header:"Count",accessor:"anno_count"},{Header:"Local ID",accessor:"local_id"},{Header:"Global ID",accessor:"global_ids"}]}],[]);return i.a.createElement("div",null,0!=n.length&&i.a.createElement(Ve.a,{defaultActiveKey:"home",id:"uncontrolled-tab-example"},i.a.createElement(Ue.a,{eventKey:"home",title:"Current"},i.a.createElement(De,{columns:a,data:t,select_data:o,current_frame:e.currentFrame,change_annot:e.handleChangeAnnot}))))}a(50).fabric;var Je=1920,Ye=1080,Xe=window.screen.height;Xe>=1080?(Je=1280,Ye=720):Xe>=1024?(Je=1152,Ye=648):Xe>=768&&(Je=1024,Ye=576);var Ke,Ge,We,Qe,Ze,$e,et=!1,tt=!0,at="",nt={},it=!1;function ot(){const[e,t]=Object(n.useState)(0),[a,o]=Object(n.useState)("1"),[l,s]=Object(n.useState)(0),[c,m]=Object(n.useState)(null),[h,p]=Object(n.useState)(!1),[f,g]=Object(n.useState)(!0),[v,b]=Object(n.useState)(!0),[_,E]=Object(n.useState)([]),w=Object(Oe.b)(e=>e.annotation_data.data),k=Object(Oe.b)(e=>e.column_annot.data),S=Object(Oe.b)(e=>e.current_frame).data,T=Object(Oe.b)(e=>e.media_data.data),j=Object(Oe.b)(e=>e.metadata);var x=j.media_type,O=parseInt(j.skip_value);Object(n.useEffect)(()=>{if(1==et){var e=ee(S);E(e)}},[S]),Object(n.useEffect)(()=>{1===w.length&&(Z(j.total_frames),G(j.total_frames))},[j]),Object(n.useEffect)(()=>{if(0!=T[0].length)if("in_image"==j.media_type){re(T[0].length),et=!0,tt=!1,Z(T[0].length),G(T[0].length);var e=T[0][0],a=new Image;a.onload=function(){nt={horizontal_res:a.width,vertical_res:a.height},URL.revokeObjectURL(a.src)},a.src=e,t(10)}else"in_video"==j.media_type&&(et=!0,tt=!1,Z(T[0].length),G(T[0].length),t(10));Je=1920,Ye=1080,Xe>=1080?(Je=1280,Ye=720):Xe>=1024?(Je=1152,Ye=648):Xe>=768&&(Je=1024,Ye=576),Ye*=1/T.length,Je*=1/T.length},[T]);const A=()=>{var e="#"+((1<<24)*Math.random()|0).toString(16);null==_&&E([]);var t="error";if("2"===a){t="b";var n=new d(50,50,50,50,e,l+"b","None").generate_no_behavior(),i=Q(ae());(i=Object.assign([],i)).push(n),W(S,i)}else"1"===a&&(t="f");var o,r=ee(ae());o=C(l+t),(r=Object.assign([],r)).push(o),$(S,r),s(l+1)};Object(n.useEffect)(()=>{1==et&&E(ee(S))},[w]);const C=e=>{var t=JSON.parse(JSON.stringify(ke.getState().column_annot)),a={};t=t.data.columns.columns;for(var n=0;n<t.length;n++){a[t[n].accessor]=""}return"in_image"===x?(a.dataType="image",a.fileName="temp"):(a.dataType="video",a.fileName="frame_"+S),a.id=e,a};Object(n.useEffect)(()=>{null!=c&&(ke.dispatch({type:"frame_data/initOldAnnotation",payload:c.get_frame_data()}),ke.dispatch({type:"annotation_data/initOldAnnotation",payload:c.get_annotation_data()}),oe(c.get_frame_rate()),E(c.get_annotation_data()[0]),s(c.find_highest_localid()))},[c]),Object(n.useEffect)(()=>{b(!1)},[k]);const F=e=>new Promise((t,a)=>{var n=new FileReader;n.onload=function(e){t(JSON.parse(e.target.result))},n.readAsText(e.target.files[0])}),N=e=>{var t=S+O;if(t>=j.total_frames){if("in_image"===x)return void ne(j.total_frames-1);ne(j.total_frames-1)}else{if("in_image"===x)return void ne(t);ne(t)}},I=e=>{var t=S-O;if(t<0){if("in_image"===x)return void ne(0);ne(0)}else{if("in_image"===x)return void ne(t);ne(t)}},z=e=>{if(!1!==f)if(!0!==it)if("2"===e.key)at="Mode Switch: Bounding Box",p(!0),o("2");else if("4"===e.key)at="Mode Switch: Key Point",p(!0),o("4");else if("3"===e.key);else if("1"===e.key)at="Mode Switch: Behavior Annotation",p(!0),o("1");else if("a"===e.key){var t="";"2"===a?t="Bounding Box":"1"===a?t="Behavior Data":"4"===a?t="Keypoint":"3"===a&&(t="Segmentation"),at="Added Annotation - "+t,"3"!==a&&p(!0),A()}else"q"===e.key?I():"e"===e.key?N():"w"===e.key&&de();else alert("Please finish your current action!")};Object(n.useEffect)(()=>(document.addEventListener("keydown",z),()=>document.removeEventListener("keydown",z)),[z]);const R=e=>{console.log("Keycheck activated"),g(void 0===e?!f:e)};return i.a.createElement("div",null,i.a.createElement(Ie,{disable_buttons:tt,video_width:Je,video_height:Ye,skip_value:O,handleOldAnnotation:e=>{F(e).then((function(e){null!=e?(m(new u(e,Je,Ye)),function(e,t){ke.dispatch({type:"metadata/setRes",payload:{horizontal_res:e,vertical_res:t}})}(e.vid_metadata.horizontal_res,e.vid_metadata.vertical_res)):alert("Error in processing Annotation. Please check the file and try again.")}))},currentFrame:S,display_frame_num:"Frame #"+parseInt(S+1)+" / "+parseInt(j.total_frames),skip_frame_forward:N,skip_frame_backward:I,addToCanvas:A,ANNOTATION_VIDEO_NAME:"",change_annotation_type:e=>{o(e)},VIDEO_METADATA:nt,toggleKeyCheck:R,handle_visual_toggle:()=>{t(Math.floor(999999999999*Math.random()))}}),i.a.createElement(r.a,{onClose:()=>p(!1),show:h,delay:500,autohide:!0,style:{position:"absolute",top:"100",left:"100",zIndex:"100"}},i.a.createElement(r.a.Header,null,i.a.createElement("strong",{className:"mr-auto"},at))),!0===et&&i.a.createElement("div",{style:{display:"grid"}},(()=>{for(var e=[],t=0;t<T.length;t++){let a=i.a.createElement("div",{style:{gridColumn:1,gridRow:t+1,position:"relative",top:0,left:0}},i.a.createElement(Pe,{currentFrame:S,scaling_factor_height:Ye,scaling_factor_width:Je,stream_num:t}));e.push(a)}return i.a.createElement("div",null,e.map((e,t)=>e))})(),i.a.createElement("div",{style:{gridColumn:2,gridRow:1,position:"relative",top:0,left:0}},i.a.createElement(He,{annotation_data:_,change_annotation_data:e=>{E(e)},currentFrame:S,toggleKeyCheck:R,columns:y}))),!1===et&&i.a.createElement("div",null,'"Video/Image upload not detected. Please upload."'))}Ke=0,ke.dispatch({type:"current_frame/init",payload:{data:Ke}}),Ge=Je,We=Ye,Qe=null,Ze="in_video",$e=1,ke.dispatch({type:"metadata/init",payload:{horizontal_res:Ge,vertical_res:We,frame_rate:Qe,media_type:Ze,total_frames:$e}}),ke.dispatch({type:"play_status/init",payload:{}}),console.log(Fe),te(Fe);var lt=a(222),rt=a(223),st=a(114);var ct=function(){const[e,t]=Object(n.useState)(!1),a=()=>t(!1),[o,l]=Object(n.useState)(!1),r=e=>{l(!o)},[s,c]=Object(n.useState)(!1);return o?i.a.createElement(ot,null):i.a.createElement("div",null,i.a.createElement(j.a,{show:e,onHide:a,size:"lg"},i.a.createElement(j.a.Header,{closeButton:!0},i.a.createElement(j.a.Title,null,"Instructions")),i.a.createElement(j.a.Body,null,i.a.createElement(x,null)),i.a.createElement(j.a.Footer,null,i.a.createElement(v.a,{variant:"secondary",onClick:a},"Close"))),i.a.createElement("main",null,i.a.createElement(lt.a,{className:"text-center"},i.a.createElement(rt.a,null,i.a.createElement("h1",{className:"jumbotron-heading"},"AVAT"),i.a.createElement("p",{className:"lead text-muted"}," Analysis tool to record data for livestock behavior and computer vision applications. "),i.a.createElement("p",null,i.a.createElement(v.a,{onClick:r,variant:"success",className:"mx-1 my-2"},"Video Upload")))),i.a.createElement(Te.a,{controls:!1,fade:!0,style:{width:"70%",marginLeft:"auto",marginRight:"auto"}},st.map((e,t)=>i.a.createElement(Te.a.Item,{key:t,interval:e.slide_time},i.a.createElement(je.a,{className:"mb-5 box-shadow",top:"true",width:"100%"},i.a.createElement(je.a.Img,{width:"60%",variant:"top",src:"."+e.src}),i.a.createElement(je.a.Body,{style:{textAlign:"center"}},i.a.createElement(je.a.Title,null,e.altText),i.a.createElement(je.a.Text,null,e.description))))))))};var dt=function(){return i.a.createElement("div",null,i.a.createElement(ct,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(i.a.createElement(Oe.a,{store:ke},i.a.createElement(dt,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{e.unregister()}).catch(e=>{console.error(e.message)})},61:function(e){e.exports=JSON.parse('{"columns":{"Header":"Annotations","columns":[{"Header":"Local ID","accessor":"id"},{"Header":"Global ID","accessor":"global_id"}]},"select_data":{}}')}},[[116,1,2]]]);
//# sourceMappingURL=main.3348e8de.chunk.js.map