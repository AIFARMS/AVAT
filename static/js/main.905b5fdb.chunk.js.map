{"version":3,"sources":["fabric_types/fabric_boundingbox.js","annotations/bounding_box.js","processing/annotation-processing.js","static_data/behaviors.js","static_data/posture.js","static_data/confidence.js","static_data/columns.js","ui_elements/Components/instructions.js","reducer/frame_data.js","reducer/annotation_data.js","reducer/column_annot.js","reducer/current_frame.js","reducer/media_data.js","processing/actions.js","reducer/metadata.js","reducer/play_status.js","store.js","processing/exporting_annotation.js","ui_elements/Components/nav_bar.js","static_data/const.js","processing/download.js","ui_elements/Components/fabric_canvas.js","ui_elements/Components/annot_table.js","ui_elements/Components/change_table.js","ui_elements/Pages/main_upload.js","static_data/constants.js","ui_elements/Pages/selection_screen.js","App.js","serviceWorker.js","index.js"],"names":["fabric","require","util","createClass","Rect","type","initialize","options","this","callSuper","set","label","toObject","object","extend","get","_render","ctx","font","fillStyle","fillText","width","height","uniScaleTransform","BoundingBox","constructor","top","left","color","id","behavior","rectangle","hasRotatingPoint","fill","opacity","id_text","Text","toString","fontSize","generate_no_behavior","group","Group","borderColor","hasBorders","temp","local_id","toJSON","generate_mouse_no_behavior","canvas","isDown","origX","origY","on","o","pointer","getPointer","e","x","y","rect_temp","originX","originY","angle","transparentCorners","add","Math","abs","renderAll","off","ExtractingAnnotation","annotation_json","frame_data","annotation_data","metadata","get_frame_data","scale_annotations","get_frame_rate","error","get_annotation_data","find_highest_localid","localid","i","length","j","push","parseInt","replace","max","new_annotations","temp_data","curr_frame","random","new_bbox","points","curr_points","k","x_scaled","y_scaled","po","Polygon","strokeWidth","stroke","scaleX","scaleY","objectCaching","cornerColor","display_text","centerX","grouppo","perPixelTargetFind","lockMovementY","lockMovementX","selectable","behaviors","value","posture","confidence","columns","remove_table_index","dataField","text","headerStyle","editable","editor","Type","SELECT","headerFormatter","React","createElement","Button","className","onClick","formatter","cellContent","row","Instructions","frameDataSlice","createSlice","name","initialState","data","reducers","init","state","payload","initOldAnnotation","modifyFrame","currentFrame","middleware","getDefaultMiddleware","serializableCheck","actions","annotationDataSlice","console","log","undefined","columnDataSlice","currFrameDataSlice","changeFrame","mediaDataSlice","addMedia","media","stream_num","initFrameData","frame_count","store","dispatch","updateFrameData","frame_number","getFrameData","getState","JSON","parse","stringify","initAnnotationData","updateAnnotationData","getAnnotationData","initColumnData","column_dat","getCurrentFrame","current_frame","setCurrentFrame","frame_num","initMedia","num_streams","setMedia","setFrameRate","frame_rate","setMediaType","media_type","setTotalFrames","total_frames","setSkipValue","skip_val","skip_value","getMetaData","metadataSlice","horizontal_res","vertical_res","setRes","curr_framerate","playStatusSlice","play","togglePlay","configureStore","reducer","column_annot","media_data","play_status","devTools","process","ExportingAnnotation","VIDEO_METADATA","image_data","get_frame_json","standard_annot","Array","curr","frame_objects","_objects","raw_points","alert","get_frame_json_fullCanvas","get_frame_coco","CustomNavBar","props","show","setShow","useState","uploadShow","setUploadShow","videoFormat","setVideoFormat","setProcess","columnLoad","setColumnLoad","numStrems","setNumStreams","playText","setPlayText","handleClose","handleUploadClose","play_redux","useSelector","handleMediaUpload","event","target","files","downloadColumn","file","Promise","resolve","reject","reader","FileReader","onload","result","readAsText","useEffect","Modal","onHide","size","Header","closeButton","Title","Body","Footer","variant","backdrop","style","display","Form","Control","as","onChange","defaultValue","NavDropdown","Divider","toggleKeyCheck","onBlur","generateUploadButtons","uploadButtons","button_image","key","float","gridColumn","gridRow","File","multiple","accept","custom","button_video","map","but","_","disabled","disable_buttons","then","handleOldAnnotation","Navbar","sticky","bg","Brand","href","Nav","title","Item","handleDownloadJSON","converted_annot","video_width","video_height","async","json","blob","Blob","URL","createObjectURL","link","document","download","fileName","body","appendChild","click","removeChild","downloadFileJSON","NavLink","handleShow","handle_link_open","handleUploadShow","Dropdown","ButtonGroup","display_frame_num","Toggle","split","Menu","skip_frame_backward","skip_frame_forward","drop","addToCanvas","change_annotation_type","canvasBackgroundUpdate","currFrameData","inputType","image_url","scaling_factor_width","scaling_factor_height","fabricCanvas","remove_obj","arguments","img","Image","clear","enlivenObjects","enlivenedObjects","forEach","obj","index","f_img","setBackgroundImage","src","remove","getObjects","FabricRender","setFabricCanvas","currindex","setCurrindex","upload","setUpload","frameToUpdate","setFrameToUpdate","metadata_redux","frame_redux","image_data_store","currFrame","currframe_redux","save_data","reason","temp_fabricCanvas","Canvas","uniformScaling","includeDefaultValues","prototype","call","toDataURL","opt","delta","deltaY","zoom","getZoom","zoomToPoint","offsetX","offsetY","preventDefault","stopPropagation","objDrag","evt","altKey","isDragging","selection","lastPosX","clientX","lastPosY","clientY","vpt","viewportTransform","requestRenderAll","setViewportTransform","ReactDOM","findDOMNode","canvas_elem","getElementsByTagName","backgroundColor","video","currentTime","duration","requestAnimFrame","renderLoop","pause","ceil","source","onloadedmetadata","oncanplaythrough","new_vid","videoWidth","videoHeight","position","AnnotTable","_ref","select_data","change_annot","getTableProps","getTableBodyProps","headerGroups","rows","prepareRow","useTable","Object","assign","border","headerGroup","getHeaderGroupProps","headers","column","getHeaderProps","background","fontWeight","render","global_id","elem","curr_idx","row_vals","curr_elem","check_keys","data-type","data-curr","change_row","beh","delete_row","genSelection","original","curr_data","dataset","annot_delte","splice","curr_img_data","objects","obj_keys","keys","AnnotationTable","col","useMemo","accessor","Tabs","defaultActiveKey","Tab","eventKey","handleChangeAnnot","current_screen_height","window","screen","toast_text","segmentation_flag","MainUpload","visualToggle","setVisualToggle","annotationType","setAnnotationType","boxCount","setBoxCount","oldAnnotation","setOldAnnotation","save","changeSave","keyCheck","changeKeyCheck","isLoading","setIsLoading","currAnnotationData","setCurrAnnotationData","annot_redux","column_redux","imagedata_redux","annot","url","revokeObjectURL","annotation_type_txt","frame_dat","generated_annotation","saved_annot","create_annotation","new_data","downloadOldAnnotation","frameVal","onKeyPress","annotext","addEventListener","removeEventListener","toggle_val","vid_metadata","ANNOTATION_VIDEO_NAME","handle_visual_toggle","floor","Toast","onClose","delay","autohide","zIndex","genFabricCanvas","fcanvas","canv","can","change_annotation_data","val","default_column","SelectionScreen","handleUpload","multiview","setMultiview","Jumbotron","Container","Carousel","controls","fade","selection_items","item","interval","slide_time","Card","Img","altText","description","App","Boolean","location","hostname","match","Provider","getElementById","navigator","serviceWorker","ready","registration","unregister","catch","message"],"mappings":"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","file":"static/js/main.905b5fdb.chunk.js","sourcesContent":["const fabric = require(\"fabric\").fabric;\n\nvar boundingbox = fabric.util.createClass(fabric.Rect, {\n    type: 'boundingbox',\n    initialize: function(options) {\n        options || (options = { });\n\n        this.callSuper('initialize', options);\n        this.set('label', options.label || '');\n    },\n\n    toObject: function() {\n        return fabric.util.object.extend(this.callSuper('toObject'), {\n            label: this.get('label')\n        });\n    },\n\n    _render: function(ctx) {\n        this.callSuper('_render', ctx);\n\n        ctx.font = '10px Helvetica';\n        ctx.fillStyle = '#333';\n        /* scaleX = this.width / (this.width * this.scaleX),\n        scaleY = this.height / (this.height * this.scaleY); */\n        ctx.fillText(this.label, (-this.width/2), (-this.height/2 + 20));\n        ctx.uniScaleTransform = false;\n    }\n});\n  \nexport {boundingbox};","import { boundingbox } from '../fabric_types/fabric_boundingbox'\nconst fabric = require(\"fabric\").fabric;\n\nclass BoundingBox {\n    constructor(top, left, width, height, color, id, behavior) {\n        this.top = top;\n        this.left = left;\n        this.id = id;\n        this.behavior = behavior;\n        this.color = color;\n        this.width = width;\n        this.height = height;\n    }\n\n    rectangle(){\n        return new fabric.Rect({\n            hasRotatingPoint: false,\n            height: this.height,\n            width: this.width,\n            fill: this.color,\n            opacity: '.4',\n            top: this.top,\n            left: this.left,\n        });\n    } \n\n    //TODO Add text scaling\n    id_text(){\n        return new fabric.Text(this.id.toString(), {\n            fontSize: 20,\n            top: this.top,\n            left: this.left,\n            uniScaleTransform: false,\n          });\n    }\n\n    generate_no_behavior(){\n        var group = new fabric.Group([this.rectangle(), this.id_text()],{\n            borderColor: '#000000',\n            hasBorders: true,\n            uniScaleTransform: true\n        });\n        /* var box = new boundingbox({\n            hasRotatingPoint: false,\n            height: this.height,\n            width: this.width,\n            fill: this.color,\n            opacity: '.4',\n            top: this.top,\n            left: this.left,\n            label: this.id.toString()\n        }) */\n\n        function onChange(obj) {\n            var text_box = obj.target.item(1),\n                group = obj.target,\n                scaleX = group.width / (group.width * group.scaleX),\n                scaleY = group.height / (group.height * group.scaleY);\n            text_box.set('scaleX', scaleX);\n            text_box.set('scaleY', scaleY);\n        }\n        /* canvas.on({\n            'object:scaling': onChange\n        }) */\n\n        var temp = this.id \n        group.local_id = temp\n        //canvas.add(group)\n        //console.log(group.toJSON())\n        return group.toJSON()\n    }\n\n    generate_mouse_no_behavior(canvas){\n        var group, isDown, origX, origY;\n\n        var temp_id = new fabric.Text(this.id.toString(), {\n            fontSize: 20,\n            top: this.top,\n            left: this.left,\n            uniScaleTransform: false,\n          });\n\n        canvas.on('mouse:down', function(o){\n            isDown = true;\n            var pointer = canvas.getPointer(o.e);\n            origX = pointer.x;\n            origY = pointer.y;\n            var pointer = canvas.getPointer(o.e);\n            var rect_temp = new fabric.Rect({\n                left: origX,\n                top: origY,\n                originX: 'left',\n                originY: 'top',\n                width: pointer.x-origX,\n                height: pointer.y-origY,\n                angle: 0,\n                fill: 'rgba(255,0,0,0.5)',\n                transparentCorners: false,\n                uniScaleTransform: true\n            });\n            group = rect_temp\n\n\n            canvas.add(group)\n        });\n        \n        canvas.on('mouse:move', function(o){\n            if (!isDown) return;\n            var pointer = canvas.getPointer(o.e);\n            \n            if(origX>pointer.x){\n                group.set({ left: Math.abs(pointer.x) });\n            }\n            if(origY>pointer.y){\n                group.set({ top: Math.abs(pointer.y) });\n            }\n            \n            group.set({ width: Math.abs(origX - pointer.x) });\n            group.set({ height: Math.abs(origY - pointer.y) });\n            \n            \n            canvas.renderAll();\n        });\n        \n        canvas.on('mouse:up', function(o){\n          isDown = false;\n          canvas.off('mouse:down')\n          canvas.off('mouse:up')\n        });\n    }\n\n}\n\nexport {BoundingBox}","import {BoundingBox} from '../annotations/bounding_box'\nconst fabric = require(\"fabric\").fabric;\nconst $ = require(\"jquery\")\n\nexport default class ExtractingAnnotation{\n    constructor(annotation_json, width, height){\n        this.frame_data = annotation_json['annotations']\n        this.annotation_data = annotation_json['behavior_data']\n        this.width = width\n        this.height = height\n        this.metadata = annotation_json['vid_metadata']\n    }\n\n    get_frame_data(){\n        return this.scale_annotations()\n    }\n\n    get_frame_rate(){\n        try{\n            return this.metadata['frame_rate']\n        }catch (error){\n            return 1\n        }\n    }\n    \n    get_annotation_data(){\n        return this.annotation_data;\n    }\n\n    find_highest_localid(){\n        var localid = []\n        for(var i = 0; i < this.annotation_data.length; i++){\n            for(var j = 0; j < this.annotation_data[i].length; j++){\n                localid.push(parseInt(this.annotation_data[i][j]['id'].replace(/\\D/g, \"\")))\n            }\n        }\n        return Math.max(...localid)+1\n    }\n\n    scale_annotations(){\n        var new_annotations = []\n        for(var i = 0; i < this.frame_data.length; i++){\n            var temp_data = []\n            var curr_frame = this.frame_data[i]\n            if(curr_frame == null){\n                new_annotations.push([])\n                continue;\n            }\n            for(var j = 0; j < curr_frame.length; j++){\n                if(curr_frame[j]['type'] === \"bounding_box\"){\n                    var x = (parseInt(curr_frame[j]['x']) / parseInt(this.metadata['horizontal_res']) * this.width) \n                    var y = (curr_frame[j]['y'] / this.metadata['vertical_res'] * this.height)\n                    var width = ((curr_frame[j]['width']) / this.metadata['horizontal_res'] * this.width)\n                    var height = ((curr_frame[j]['height']) / this.metadata['vertical_res'] * this.height)\n\n                    var color = \"#\" + ((1<<24)*Math.random() | 0).toString(16)\n                    var new_bbox = new BoundingBox(y, x, width, height, color, curr_frame[j]['local_id'], \"None\").generate_no_behavior(this)\n                    //this.add(new_bbox)\n                    new_bbox.local_id = curr_frame[j]['local_id']\n                    temp_data.push(new_bbox)\n                }else if(curr_frame[j]['type'] === \"segmentation\"){\n                    var points = []\n                    var curr_points = curr_frame[j]['points']\n                    for(var k = 0; k < curr_points.length; k++){\n                        var x_scaled = (parseInt(curr_points[k]['x']) / parseInt(this.metadata['horizontal_res']) * this.width)\n                        var y_scaled = (curr_points[k]['y'] / this.metadata['vertical_res'] * this.height)\n                        points.push({x: x_scaled, y: y_scaled})\n                    }\n                    var po = new fabric.Polygon(points, {\n                        strokeWidth: 1,\n                        stroke: 'green',\n                        opacity: .5,\n                        scaleX: 1,\n                        scaleY: 1,\n                        objectCaching: false,\n                        transparentCorners: false,\n                        cornerColor: 'blue',\n                        originX: 'center',\n                        originY: 'center'\n                    });\n                    var display_text = new fabric.Text(curr_frame[j]['local_id'], {\n                        fontSize: 20,\n                        centerX: \"center\",\n                        top: points[0].y,\n                        left: points[0].x, \n                        uniScaleTransform: false,\n                        fill: \"white\",\n                    })\n                    var grouppo = new fabric.Group([po, display_text], {perPixelTargetFind: true})\n                    grouppo.lockMovementY = true;\n                    grouppo.lockMovementX = true;\n                    grouppo.selectable = false;\n                    grouppo.local_id = curr_frame[j]['local_id']\n                    //this.add(grouppo)\n                    temp_data.push(grouppo)\n                }\n            }\n            new_annotations.push(temp_data)\n        }\n        return new_annotations\n    }\n}\n\n//This is the parser for the Multi-Camera pig tracking output JSON code. \n/*\nclass MCPT_Processing {\n    constructor(annotation_json){\n        this.objects = annotation_json['objects']\n    }\n\n    getObjects_MCPT() {\n        return this.objects\n    }\n\n    getObjectById_MCPT(id) {\n        return this.objects[id]\n    }\n    \n    getObjectByIdFrame(id, frame_num){\n        return this.objects[id][frame_num]\n    }\n\n    getAllObjectByFrame_MCPT(frame_num){\n        var i;\n        var objects_frame = []\n        for (i = 0; i < this.objects.length; i++){\n            var curr_obj = this.objects[i]\n            if(curr_obj['frames'][curr_obj['frames'].length-1]['frameNumber'] < frame_num){\n                continue;\n            }\n            var curr_obj_frames = curr_obj['frames'];\n            for (var j = 0; j < curr_obj_frames.length; j++){\n                if(curr_obj_frames[j]['frameNumber'] === frame_num){\n                    objects_frame.push(curr_obj_frames[j]);\n                    break;\n                }\n            }\n        }\n        return objects_frame;\n    }\n}*/","const behaviors = [{\n  value: 'Feeding',\n  label: 'Feeding'\n},{\n  value: 'Drinking',\n  label: 'Drinking'\n},{\n  value: 'Exploratory',\n  label: 'Exploratory'\n},{\n  value: 'Social',\n  label: 'Social'\n},{\n  value: 'Locomotion',\n  label: 'Locomotion'\n},{\n  value: 'Proximity',\n  label: 'Proximity'\n},{\n  value: 'Others',\n  label: 'Others'\n}]\n\nexport {behaviors};\n","const posture = [{\n  value: 'Lying',\n  label: 'Lying'\n},{\n  value: 'Sitting',\n  label: 'Sitting'\n},{\n  value: 'Kneeling',\n  label: 'Kneeling'\n},{\n  value: 'Standing',\n  label: 'Standing'\n}]\n\n  export {posture}","const confidence = [{\n    value: 'No occlusion',\n    label: 'No occlusion'\n  },{\n    value: 'Minor occlusion',\n    label: 'Minor occlusion'\n  },{\n    value: 'Split occlusion',\n    label: 'Split occlusion'\n  },{\n    value: 'End occlusion',\n    label: 'End occlusion'\n  },{\n    value: 'Critical occlusion',\n    label: 'Critical occlusion'\n  }\n]\nexport {confidence};\n","import React from \"react\"; \nimport { Type } from 'react-bootstrap-table2-editor';\nimport {behaviors} from './behaviors'\nimport {posture} from './posture'\nimport {status} from './status'\nimport {confidence} from './confidence'\nimport Button from 'react-bootstrap/Button'\n\nconst columns = (remove_table_index) => [{\n  dataField: \"id\",\n  text: \"ID\",\n  headerStyle: () => { return { width: \"40px\", left: 0 }; },\n  editable: false,\n},{\n  dataField: \"global_id\",\n  text: \"Glo\",\n  headerStyle: () => { return { width: \"70px\", left: 0}; }\n},{\n  dataField: \"posture\",\n  text: \"Posture\",\n  editor: {\n      type: Type.SELECT,\n      options: posture,\n  }\n},\n{\n  dataField: \"behavior\",\n  text: \"Behavior\",\n  editor: {\n      type: Type.SELECT,\n      options: behaviors,\n  }\n},{\n  dataField: \"confidence\",\n  text: \"Confidence\",\n  editor: {\n      type: Type.SELECT,\n      options: confidence,\n  }\n},{\n  dataField: \"remove\",\n  text: \"Del\",\n  editable: false,\n  headerStyle: () => { return { width: \"50px\", left: 0}; },\n  headerFormatter: () => {return (\n    <div>\n      Del\n      <Button\n        className=\"btn btn-danger btn-xs\"\n        onClick={() => remove_table_index()}\n        label=\"Del\"\n      >\n      </Button>\n    </div>\n  );},\n  formatter: (cellContent, row) => {\n    return (\n      <div>        \n        <Button\n          className=\"btn btn-danger btn-xs\"\n            onClick={() => remove_table_index(row.id)}\n            label=\"Del\"\n          >\n        </Button>\n      </div>\n    );\n  },\n}\n]\nexport {columns}\n \n","import React from \"react\"; \n\nexport default function Instructions(){\n    return (\n        <div>\n        <h3>Keybinds:</h3>\n\n        There are preset keybinds setup to make it easier to use the tool without having to click around. If done properly a combination of mouse and keyboard actions speed up the annotation process. \n        <br></br><br></br>\n        * <kbd>1</kbd> : Mode Switch: Behavior<br></br>\n        * <kbd>2</kbd> : Mode Switch: Bounding Box<br></br>\n        * <kbd>3</kbd> : Mode Switch: Segmentation (Currently Disabled)<br></br>\n        * <kbd>a</kbd> : Add annotation<br></br>\n        * <kbd>e</kbd> : Skip forward frame(s)<br></br>\n        * <kbd>q</kbd> : Skip backward frame(s)<br></br>\n        * <kbd>w</kbd> : Pause/Play<br></br>\n\n        <br></br><br></br>\n        <h3>Uploading Video:</h3>\n\n        Ensure that you know the framerate of the video chosen to be annotated. These values should be entered into the settings tab into their \"frame rate\" fields. \n        <br></br><br></br>\n        Click on the right side browse button. All other buttons on the screen shuold be disabled until the video has been uploaded. Currenntly ```.mp4``` format is the best choice and tested for. Other file types such as .avi are supported but might have unintended bugs.\n        <br></br>\n        Please note that videos SHOULD be in 16:9 aspect ratio for best results. Extraneous behavior may occur if resolution is different.\n        <br></br><br></br>\n\n        <h3>Uploading Image:</h3>\n        Select all of the image files needed for the various inputs. To select a group of images, they should be in the same folder.\n        <br></br>\n        Please note that images SHOULD be in 16:9 aspect ratio for best results. Extraneous behavior may occur if resolution is different.\n        <br></br><br></br>\n        <h3>Annotations</h3>\n        <br></br>\n        There are currently two kinds of annotations. \n        <br></br><br></br>\n        <h4>Behavior Annotation:</h4>\n\n        This is for having annotations that do not have any visual attribute attached to it. This annotation is also attached by default when the bounding box or segmentation annotation is created. \n\n        <br></br><br></br>\n        <h4>Bounding Box:</h4>\n\n        This forms a square around the desired object. There should be small squares at the edges of the bounding box which can be used to resize the box. The number on the top left of the box is used to identify the placement of the box in the table to the right.\n        <br></br><br></br>\n        </div>\n    )\n}","import {createSlice} from '@reduxjs/toolkit'\n\nconst initialState = {data: []}\n\nconst frameDataSlice = createSlice({\n    name: 'frame_data',\n    initialState,\n    reducers:{\n        init(state, payload){\n            var data = [];\n            for(var i = 0; i < payload.payload; i++){\n                data.push([]);\n            }\n            state.data = data;\n        },\n        initOldAnnotation(state, payload){\n            state.data = payload.payload\n        },\n        modifyFrame(state, payload){\n            var temp = state.data\n            temp[payload.payload.currentFrame] = payload.payload.data\n            state.data = temp\n        },\n        middleware: (getDefaultMiddleware) => getDefaultMiddleware({\n            serializableCheck: false\n        })\n    }\n})\n\nexport const {init, modifyFrame} = frameDataSlice.actions\nexport default frameDataSlice.reducer\n","import {createSlice} from '@reduxjs/toolkit'\n\nconst initialState = {data: []}\n\nconst annotationDataSlice = createSlice({\n    name: 'annotation_data',\n    initialState,\n    reducers:{\n        init(state, payload){\n            console.log(payload.payload)\n            var data = [];\n            for(var i = 0; i < payload.payload; i++){\n                data.push([]);\n            }\n            state.data = data;\n        },\n        initOldAnnotation(state, payload){\n            state.data = payload.payload\n        },\n        modifyFrame(state, payload){\n            var temp = state.data\n            temp[payload.payload.currentFrame] = payload.payload.data\n            state.data = temp\n        },\n        middleware: (getDefaultMiddleware) => getDefaultMiddleware({\n            serializableCheck: false\n        })\n    }\n})\n\nexport const {init, modifyFrame} = annotationDataSlice.actions\nexport default annotationDataSlice.reducer","import {createSlice} from '@reduxjs/toolkit'\n\nconst initialState = {data: undefined}\n\nconst columnDataSlice = createSlice({\n    name: 'column_annot',\n    initialState,\n    reducers:{\n        init(state, payload){\n            console.log(payload.payload.data)\n            state.data = payload.payload.data\n        },\n        middleware: (getDefaultMiddleware) => getDefaultMiddleware({\n            serializableCheck: false\n        })\n    }\n})\n\nexport const {init} = columnDataSlice.actions\nexport default columnDataSlice.reducer","import {createSlice} from '@reduxjs/toolkit'\n\nconst initialState = {data: undefined}\n\nconst currFrameDataSlice = createSlice({\n    name: 'current_frame',\n    initialState,\n    reducers:{\n        init(state, payload){\n            console.log(payload.payload.data)\n            state.data = payload.payload.data\n        },\n        changeFrame(state, payload){\n            state.data = payload.payload.data\n        },\n        middleware: (getDefaultMiddleware) => getDefaultMiddleware({\n            serializableCheck: false\n        })\n    }\n})\n\nexport const {init} = currFrameDataSlice.actions\nexport default currFrameDataSlice.reducer","import {createSlice} from '@reduxjs/toolkit'\n\nconst initialState = {data: []}\n\nconst mediaDataSlice = createSlice({\n    name: 'media_data',\n    initialState,\nreducers:{\n        init(state, payload){\n            var data = [];\n            for(var i = 0; i < payload.payload; i++){\n                data.push([]);\n            }\n            state.data = data;\n        },\n        addMedia(state, payload){\n            var temp = state.data\n            var media = payload.payload.media\n            temp[payload.payload.stream_num] = media\n            state.data = temp\n        },\n        middleware: (getDefaultMiddleware) => getDefaultMiddleware({\n            serializableCheck: false\n        })\n    }\n})\n\nexport const {init, modifyFrame} = mediaDataSlice.actions\nexport default mediaDataSlice.reducer","import store from '../store'\n\n/*\nAction functions for frame_data\n*/\nfunction initFrameData(frame_count){\n\tstore.dispatch({\n\t\ttype: \"frame_data/init\",\n\t\tpayload: frame_count\n\t})\n}\nfunction updateFrameData(frame_number, data){\n\tstore.dispatch({\n\t\ttype: \"frame_data/modifyFrame\",\n\t\tpayload: {currentFrame: frame_number, data: data}\n\t})\n}\nfunction getFrameData(frame_number){\n\tconsole.log(store.getState())\n\treturn JSON.parse(JSON.stringify(store.getState().frame_data.data[frame_number]))\n} \n\n/*\nAction functions for annotation_data\n*/\nfunction initAnnotationData(frame_count){\n    store.dispatch({\n\t\ttype: \"annotation_data/init\",\n\t\tpayload: frame_count\n\t})\n}\nfunction updateAnnotationData(frame_number, data){\n    store.dispatch({\n\t\ttype: \"annotation_data/modifyFrame\",\n\t\tpayload: {currentFrame: frame_number, data: data}\n\t})\n}\nfunction getAnnotationData(frame_number){\n    return JSON.parse(JSON.stringify(store.getState().annotation_data.data[frame_number]))\n}\n\n/*\nAction functions for column uploading\n*/\nfunction initColumnData(column_dat){\n\tstore.dispatch({\n\t\ttype: \"column_annot/init\",\n\t\tpayload: {data: column_dat}\n\t})\n}\n\nfunction getColumnData(){\n\treturn JSON.parse(JSON.stringify(store.getState().column_annot))\n}\n\nfunction initCurrentFrame(frame_num){\n\tstore.dispatch({\n\t\ttype: \"current_frame/init\",\n\t\tpayload: {data: frame_num}\n\t})\n}\n\nfunction getCurrentFrame(){\n\treturn JSON.parse(JSON.stringify(store.getState().current_frame))['data']\n}\n\nfunction setCurrentFrame(frame_num){\n\tstore.dispatch({\n\t\ttype: \"current_frame/changeFrame\",\n\t\tpayload: {data: frame_num}\n\t})\n}\n\nfunction initMedia(num_streams){\n\tstore.dispatch({\n\t\ttype: \"media_data/init\",\n\t\tpayload: num_streams\n\t})\n}\n\nfunction setMedia(stream_num, media){\n\tstore.dispatch({\n\t\ttype: \"media_data/addMedia\",\n\t\tpayload: {stream_num: stream_num, media: media}\n\t})\n}\n\nfunction initMetadata(horizontal_res, vertical_res, frame_rate, media_type, total_frames){\n\tstore.dispatch({\n\t\ttype: \"metadata/init\",\n\t\tpayload: {horizontal_res: horizontal_res, vertical_res: vertical_res, frame_rate: frame_rate, media_type: media_type, total_frames: total_frames}\n\t})\n}\n\nfunction setRes(horizontal_res, vertical_res){\n\tstore.dispatch({\n\t\ttype: \"metadata/setRes\",\n\t\tpayload: {horizontal_res: horizontal_res, vertical_res: vertical_res}\n\t})\n}\n\nfunction setFrameRate(frame_rate){\n\tstore.dispatch({\n\t\ttype: \"metadata/setFrameRate\",\n\t\tpayload: {frame_rate: frame_rate}\n\t})\n}\n\nfunction setMediaType(media_type){\n\tstore.dispatch({\n\t\ttype: \"metadata/setMediaType\",\n\t\tpayload: {media_type: media_type}\n\t})\n}\n\nfunction setTotalFrames(total_frames){\n\tstore.dispatch({\n\t\ttype: \"metadata/setTotalFrames\",\n\t\tpayload: {total_frames: total_frames}\n\t})\n}\n\nfunction setSkipValue(skip_val){\n\tstore.dispatch({\n\t\ttype: \"metadata/setSkipValue\",\n\t\tpayload: {skip_value: skip_val}\n\t})\n}\n\nfunction getMetaData(){\n\treturn JSON.parse(JSON.stringify(store.getState().metadata))\n}\n\nfunction togglePlay(){\n\tstore.dispatch({\n\t\ttype:  \"play_status/togglePlay\",\n\t\tpayload: {}\n\t})\n}\n\nfunction initPlay(){\n\tstore.dispatch({\n\t\ttype:  \"play_status/init\",\n\t\tpayload: {}\n\t})\n}\n\nexport {initFrameData, \n\t\tupdateFrameData, \n\t\tgetFrameData, \n\t\tinitAnnotationData, \n\t\tupdateAnnotationData, \n\t\tgetAnnotationData, \n\t\tinitColumnData, \n\t\tgetColumnData,\n\t\tinitCurrentFrame,\n\t\tgetCurrentFrame,\n\t\tsetCurrentFrame,\n\t\tinitMedia,\n\t\tsetMedia, \n\t\tinitMetadata,\n\t\tsetRes, \n\t\tsetFrameRate,\n\t\tsetMediaType,\n\t\tsetTotalFrames,\n\t\tsetSkipValue,\n\t\tgetMetaData,\n\t\ttogglePlay,\n\t\tinitPlay\n\t}\n","import {createSlice} from '@reduxjs/toolkit'\nimport {initFrameData, updateFrameData, getFrameData, initAnnotationData, updateAnnotationData, getAnnotationData, initColumnData, setMedia, initMedia} from '../processing/actions'\n\n\nconst initialState = {horizontal_res: 0, vertical_res: 0, frame_rate: 1, media_type: \"in_video\", total_frames: 0, skip_value: 1}\n\nconst metadataSlice = createSlice({\n    name: 'metadata',\n    initialState,\n    reducers:{\n        init(state, payload){\n            state.horizontal_res = payload.payload.horizontal_res\n            state.vertical_res = payload.payload.vertical_res\n            state.frame_rate = payload.payload.frame_rate\n            state.media_type = payload.payload.media_type\n            state.total_frames = payload.payload.total_frames\n        },\n        setRes(state, payload){\n            state.horizontal_res = payload.payload.horizontal_res\n            state.vertical_res = payload.payload.vertical_res\n        },\n        setFrameRate(state, payload){\n\t    // When the frame rate is changed, we first calculate the current frame rate and then multiply the total frames by the ratio of the new frame rate to the old frame rate\n\t    if (state.media_type != \"in_image\") { // only for videos\n\t\t    var curr_framerate =  JSON.parse(JSON.stringify(state))['frame_rate']\n\t\t    state.total_frames = state.total_frames / curr_framerate\n\t\t    state.total_frames = state.total_frames * payload.payload.frame_rate\n\t\t    state.frame_rate = payload.payload.frame_rate\n\t    }\n        },\n        setMediaType(state, payload){\n            state.media_type = payload.payload.media_type\n        },\n        setTotalFrames(state, payload){\n            state.total_frames = payload.payload.total_frames\n        },\n        setSkipValue(state, payload){\n            state.skip_value = payload.payload.skip_value\n        },\n        middleware: (getDefaultMiddleware) => getDefaultMiddleware({\n            serializableCheck: false\n        })\n    }\n})\n\nexport const {init, setRes, setFrameRate, setMediaType, setTotalFrames, setSkipValue} = metadataSlice.actions\nexport default metadataSlice.reducer\n","import {createSlice} from '@reduxjs/toolkit'\n\nconst initialState = {play: false}\n\nconst playStatusSlice = createSlice({\n    name: 'play_status',\n    initialState,\n    reducers:{\n        init(state, payload){\n            state.play = false;\n        },\n        togglePlay(state, payload){\n            state.play = !state.play\n        },\n        middleware: (getDefaultMiddleware) => getDefaultMiddleware({\n            serializableCheck: false\n        })\n    }\n})\n\nexport const {init, togglePlay} = playStatusSlice.actions\nexport default playStatusSlice.reducer\n","import { configureStore } from '@reduxjs/toolkit'\nimport frameDataSlice from './reducer/frame_data'\nimport annotationDataSlice from './reducer/annotation_data'\nimport columnDataSlice from './reducer/column_annot'\nimport currFrameDataSlice from './reducer/current_frame'\nimport mediaDataSlice from './reducer/media_data'\nimport metadataSlice from './reducer/metadata'\nimport playStatusSlice from './reducer/play_status'\n\nexport default configureStore({\n  reducer: {\n    frame_data: frameDataSlice,\n    annotation_data: annotationDataSlice,\n    column_annot: columnDataSlice,\n    current_frame: currFrameDataSlice,\n    media_data: mediaDataSlice,\n    metadata: metadataSlice,\n    play_status: playStatusSlice,\n  },\n  devTools: process.env.NODE_ENV !== 'production',\n})\n","export default class ExportingAnnotation{\n    constructor(annotation_data, width, height, VIDEO_METADATA, image_data){\n        console.log(width)\n        console.log(height)\n        this.frame_data = annotation_data\n        this.width = width\n        this.height = height\n        this.metadata = VIDEO_METADATA\n        this.image_data = image_data\n    }\n\n    get_frame_json(){\n        var standard_annot = new Array(this.frame_data.length)\n        console.log(this.metadata)\n        console.log(this.frame_data)\n        for(var i = 0; i < this.frame_data.length; i++){\n            var curr = []\n            if(this.frame_data[i] == []){\n                console.log(\"Exporting error\")\n                continue;\n            }\n            var frame_objects = this.frame_data[i]\n            if(frame_objects == undefined){\n                console.log(\"Exporting error\")\n                continue;\n            }\n            \n            for(var j = 0; j < frame_objects.length; j++){\n                try {\n                    console.log(frame_objects[j])\n                    if(frame_objects[j] == undefined || frame_objects[j]['type'] !== \"group\"){\n                        continue;\n                    }\n                    if (frame_objects[j]._objects == undefined){\n                        continue;\n                    }\n                    if(frame_objects[j]._objects[0]['type'] === \"rect\"){\n                        console.log(frame_objects[j])\n                        var x = (frame_objects[j]['left'] / this.width) * this.metadata['horizontal_res']\n                        var y = (frame_objects[j]['top'] / this.height) * this.metadata['vertical_res']\n                        var width = ((frame_objects[j]['width'] * frame_objects[j]['scaleX']) / this.width) * this.metadata['horizontal_res']\n                        var height = ((frame_objects[j]['height'] * frame_objects[j]['scaleY']) / this.height )* this.metadata['vertical_res']\n                        var local_id = frame_objects[j]._objects[1]['text']\n                        if(this.metadata.media_type == \"in_image\"){\n                            curr.push({\"type\": \"bounding_box\",\"x\": x, \"y\": y, \"width\": width, \"height\": height, \"local_id\": local_id,\"fileName:\": this.image_data[i]['name'], \"dataType\": \"image\"})\n                        }else{\n                            curr.push({\"type\": \"bounding_box\",\"x\": x, \"y\": y, \"width\": width, \"height\": height, \"local_id\": local_id, \"fileName:\": this.metadata['name'], \"dataType\": \"video\"})\n                        }\n                        //curr.push({\"type\": \"bounding_box\",\"x\": x, \"y\": y, \"width\": width, \"height\": height, \"local_id\": local_id})\n                    }else if (frame_objects[j]._objects[0]['type'] === \"polygon\"){\n                        var raw_points = frame_objects[j]._objects[0]['points']\n                        var points = []\n                        console.log(this.metadata)\n                        console.log(this.metadata['horizontal_res'])\n                        console.log(this.width)\n                        console.log(this.height)\n                        for(var k = 0; k < raw_points.length; k++){\n                            var x = (raw_points[k]['x'] / this.width) * this.metadata['horizontal_res']\n                            var y = (raw_points[k]['y'] / this.height) * this.metadata['vertical_res']\n                            points.push({\"x\": x, \"y\": y})\n                        }\n                        var local_id = frame_objects[j]._objects[1]['text']\n\n                        if(this.metadata.media_type == \"in_image\"){\n                            curr.push({\"type\": \"segmentation\", \"points\": points, \"local_id\": local_id, \"fileName:\": this.image_data[i]['name'], \"dataType\": \"image\"})\n                        }else{\n                            curr.push({\"type\": \"segmentation\", \"points\": points, \"local_id\": local_id, \"fileName:\": this.metadata['name'], \"dataType\": \"video\"})\n                        }\n                        //curr.push({\"type\": \"segmentation\", \"points\": points, \"local_id\": local_id})\n                    }else{\n                        alert(\"Error in exporting annotation. Please check the annotation and try again.\")\n                    }\n                } catch (error) {\n                    console.log(error)\n                }\n\n            }\n\n            standard_annot[i] = curr\n        }\n        return standard_annot\n    }\n\n    get_frame_json_fullCanvas(){\n        var standard_annot = new Array(this.frame_data.length)\n        console.log(this.metadata)\n        for(var i = 0; i < this.frame_data.length; i++){\n            var curr = []\n\n            if(this.frame_data[i] == []){\n                continue;\n            }\n            var frame_objects = this.frame_data[i]['objects']\n            if(frame_objects == undefined){\n                continue;\n            }\n            \n            for(var j = 0; j < frame_objects.length; j++){\n                console.log(frame_objects[j])\n                if(frame_objects[j]['type'] !== \"group\"){\n                    continue;\n                }\n                if(frame_objects[j]['objects'][0]['type'] === \"rect\"){\n                    console.log(frame_objects[j])\n                    var x = (frame_objects[j]['left'] / this.width) * this.metadata['horizontal_res']\n                    var y = (frame_objects[j]['top'] / this.height) * this.metadata['vertical_res']\n                    var width = ((frame_objects[j]['width'] * frame_objects[j]['scaleX']) / this.width) * this.metadata['horizontal_res']\n                    var height = ((frame_objects[j]['height'] * frame_objects[j]['scaleY']) / this.height )* this.metadata['vertical_res']\n                    var local_id = frame_objects[j]['objects'][1]['text']\n                    if(this.image_data.length != 0){\n                        curr.push({\"type\": \"bounding_box\",\"x\": x, \"y\": y, \"width\": width, \"height\": height, \"local_id\": local_id,\"fileName:\": this.image_data[i]['name'], \"dataType\": \"image\"})\n                    }else{\n                        curr.push({\"type\": \"bounding_box\",\"x\": x, \"y\": y, \"width\": width, \"height\": height, \"local_id\": local_id, \"fileName:\": this.metadata['name'], \"dataType\": \"video\"})\n                    }\n                    //curr.push({\"type\": \"bounding_box\",\"x\": x, \"y\": y, \"width\": width, \"height\": height, \"local_id\": local_id})\n                }else if (frame_objects[j]['objects'][0]['type'] === \"polygon\"){\n                    var raw_points = frame_objects[j]['objects'][0]['points']\n                    var points = []\n                    for(var k = 0; k < raw_points.length; k++){\n                        var x = (raw_points[k]['x'] / this.width) * this.metadata['horizontal_res']\n                        var y = (raw_points[k]['y'] / this.height) * this.metadata['vertical_res']\n                        points.push({\"x\": x, \"y\": y})\n                    }\n                    var local_id = frame_objects[j]['objects'][1]['text']\n\n                    if(this.image_data.length != 0){\n                        curr.push({\"type\": \"segmentation\", \"points\": points, \"local_id\": local_id, \"fileName:\": this.image_data[i]['name'], \"dataType\": \"image\"})\n                    }else{\n                        curr.push({\"type\": \"segmentation\", \"points\": points, \"local_id\": local_id, \"fileName:\": this.metadata['name'], \"dataType\": \"video\"})\n                    }\n                    //curr.push({\"type\": \"segmentation\", \"points\": points, \"local_id\": local_id})\n                }\n\n            }\n\n            standard_annot[i] = curr\n        }\n        return standard_annot\n    }\n\n    get_frame_coco(){\n\n    }\n}","import React, { useEffect } from 'react';\nimport { useState } from 'react';\nimport \"bootstrap/dist/css/bootstrap.min.css\";\n\nimport Navbar from 'react-bootstrap/Navbar'\nimport Nav from 'react-bootstrap/Nav'\nimport Button from 'react-bootstrap/Button'\nimport { NavDropdown, NavLink } from 'react-bootstrap';\nimport Form from 'react-bootstrap/Form'\nimport Dropdown from 'react-bootstrap/Dropdown'\nimport { ButtonGroup } from 'react-bootstrap';\nimport Modal from 'react-bootstrap/Modal'\n\nimport \"react-datepicker/dist/react-datepicker.css\";\n\nimport Instructions from './instructions';\nimport { downloadFileJSON} from '../../processing/download';\n\nimport ExportingAnnotation from '../../processing/exporting_annotation';\nimport ProcessVideo from './process_video';\nimport store from '../../store' \nimport {INPUT_IMAGE, INPUT_VIDEO} from '../../static_data/const'\nimport { useSelector } from \"react-redux\";\n\nimport {initFrameData, updateFrameData, getFrameData, initAnnotationData, updateAnnotationData, getAnnotationData, initColumnData, setMedia, initMedia, setFrameRate, setMediaType, setSkipValue, getMetaData, togglePlay} from '../../processing/actions'\n\ninitMedia(1)\nexport default function CustomNavBar(props){\n\tconst [show, setShow] = useState(false);\n\tconst [uploadShow, setUploadShow] = useState(true);\n\tconst [videoFormat, setVideoFormat] = useState(INPUT_VIDEO)\n\tconst [process, setProcess] = useState(false)\n\tconst [columnLoad, setColumnLoad] = useState(false)\n\tconst [numStrems, setNumStreams] = useState(1)\n\tconst [playText, setPlayText] = useState(false)\n\n\tconst handleClose = () => setShow(false);\n\tconst handleShow = () => setShow(true);\n\tconst handleUploadClose = () => {setUploadShow(false); setProcess(true)}\n\tconst handleUploadShow = () => {\n\t\tsetUploadShow(true)\n\t}\n\tconst play_redux = useSelector(state => state.play_status.play)\n\n\tconst handleDownloadJSON = () => {\n\t\tvar converted_annot = new ExportingAnnotation(store.getState().frame_data.data, props.video_width, props.video_height, getMetaData(), store.getState().media_data.data[0]).get_frame_json()\n\t\tconsole.log(converted_annot)\n\t\tdownloadFileJSON(converted_annot, getMetaData())\n\t}\n\tconst handleVideoFormat = (type) => {\n\t\t//TODO Make sure bug is resolved and simply have video format equal type\n\t\t//type = parseInt(type)\n\t\tif(type === INPUT_VIDEO){\n\t\t\tsetVideoFormat(INPUT_VIDEO)\n\t\t\tsetMediaType(INPUT_VIDEO)\n\t\t}else if (type === INPUT_IMAGE){\n\t\t\tsetVideoFormat(INPUT_IMAGE)\n\t\t\tsetMediaType(INPUT_IMAGE)\n\t\t}else {\n\t\t\talert(\"Wrong input detected - please report this bug.\")\n\t\t}\n\t}\n\n\tconst convertFileToURLBlob = (file) => {\n\t\treturn URL.createObjectURL(file)\t\n\t}\n\n\tconst handleMediaUpload = (event) => {\n\t\tif(videoFormat == INPUT_VIDEO){\n\t\t\tsetMedia(parseInt(event.target.id), event.target.files)\n\t\t}else{\n\t\t\tsetMedia(parseInt(event.target.id), event.target.files)\n\t\t}\n\t}\n\n\tconst handleColumnUpload = (event) => {\n\t\tvar promise = downloadColumn(event)\n\t\tpromise.then(function (result) {\n\t\t\tif(result['columns'] == undefined){\n\t\t\t\talert(\"Error in processing columns. Please check the file and try again.\")\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif(result != null){\n\t\t\t\tsetColumnLoad(true);\n\t\t\t\tinitColumnData(result)\n\t\t\t}else{\n\t\t\t\talert(\"Error in processing columns. Please check the file and try again.\")\n\t\t\t\treturn;\n\t\t\t}\n\t\t})\n\t}\n\n\tconst downloadColumn = (file) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tvar reader = new FileReader();\n\t\t\treader.onload = function(e) {\n\t\t\t\tresolve((JSON.parse(e.target.result)));\n\t\t\t}\n\t\t\treader.readAsText(file.target.files[0])\n\t\t})\n\t}\n\n\tconst handleStreamNumChange = (event) => {\n\t\tsetNumStreams(event.target.value)\n\t\tinitMedia(event.target.value)\n\t}\n\n\tconst generateUploadButtons = () => {\n\t\tvar uploadButtons = []\n\t\tfor(var i = 0; i < numStrems; i++){\n\t\t\tlet button_image = (\n\t\t\t\t<Form key={i} style={{float: \"left\",gridColumn: 1, gridRow:4}}>\n\t\t\t\t\t<Form.File multiple id={i+\"\"} key={i} label={\"Image Upload \" + i} accept=\"image/*\" custom type=\"file\" onChange={(event) => {handleMediaUpload(event)}} />\n\t\t\t\t</Form>\n\t\t\t)\n\t\t\tlet button_video = (\n\t\t\t\t<Form key={i} style={{float: \"left\",gridColumn: 1, gridRow:4}}>\n\t\t\t\t\t<Form.File id={i+\"\"} key={i} label={\"Video Upload \" + i} accept=\".mp4\" custom type=\"file\" onChange={(event) => {handleMediaUpload(event)}} />\n\t\t\t\t</Form>\n\t\t\t)\n\t\t\tif (videoFormat === INPUT_IMAGE){\n\t\t\t\tuploadButtons.push(button_image)\n\t\t\t}else if (videoFormat === INPUT_VIDEO){\n\t\t\t\tuploadButtons.push(button_video)\n\t\t\t}\n\t\t}\n\t\treturn (\n\t\t\t<div>\n\t\t\t{\n\t\t\t\tuploadButtons.map((but, _) => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\tbut\n\t\t\t\t\t)\n\t\t\t\t})\n\t\t\t}\n\t\t\t</div>\n\t\t)\n\t}\n\n\tconst handlePlaying = (event) => {\n\t\ttogglePlay()\n\t}\n\n\tuseEffect(() => {\n\t\tif (play_redux == false){\n\t\t\tsetPlayText(\"Play\")\n\t\t}else {\n\t\t\tsetPlayText(\"Pause\")\n\t\t}\n\t}, [play_redux])\n\n\treturn (\n\t\t<div>\n\t\t<Modal show={show} onHide={handleClose} size='lg'>\n\t\t\t<Modal.Header closeButton>\n\t\t\t<Modal.Title>Instructions</Modal.Title>\n\t\t\t</Modal.Header>\n\t\t\t<Modal.Body><Instructions></Instructions></Modal.Body>\n\t\t\t<Modal.Footer>\n\t\t\t<Button variant=\"secondary\" onClick={handleClose}>Close</Button>\n\t\t\t</Modal.Footer>\n\t\t</Modal>\n\t\t<Modal show={uploadShow} onHide={handleUploadClose} size='lg' backdrop='static'>\n\t\t\t<Modal.Header>\n\t\t\t\t<Modal.Title>Upload</Modal.Title>\n\t\t\t</Modal.Header>\n\t\t\t<Modal.Body>\n\t\t\t\t<div style={{display: \"grid\"}}>\n\t\t\t\t\t{/*onClick and onBlur events are for the sole purpose to stop the eventKeys from firing off*/}\n\t\t\t\t\t<Form >\n\t\t\t\t\t\tMedia Format: \n\t\t\t\t\t\t<Form.Control\n\t\t\t\t\t\t\tas=\"select\"\n\t\t\t\t\t\t\tid=\"inlineFormCustomSelect\"\n\t\t\t\t\t\t\tonChange={(event)=>{handleVideoFormat(event.target.value)}}\n\t\t\t\t\t\t\tdefaultValue={videoFormat}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<option value={INPUT_VIDEO}>Video</option>\n\t\t\t\t\t\t\t<option value={INPUT_IMAGE}>Image</option>\n\t\t\t\t\t\t</Form.Control>\n\t\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\t</Form>\n\t\t\t\t\t<div>\n\t\t\t\t\t\tStream Num: <input type=\"number\" defaultValue={1} onClick={(event) => {props.toggleKeyCheck(false)}} onBlur={(event) => {props.toggleKeyCheck(true)}} onChange={handleStreamNumChange}></input>\n\t\t\t\t\t</div>\n\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\t{\n\t\t\t\t\t\tgenerateUploadButtons()\n\t\t\t\t\t}\n\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\t<Form >\n\t\t\t\t\t\t<Form.File disabled={props.disable_buttons} accept=\".json\" id=\"file\" label=\"Column Upload\" custom type=\"file\" onChange={handleColumnUpload}/>\n\t\t\t\t\t</Form>\n\t\t\t\t\t<Form >\n\t\t\t\t\t\t<Form.File accept=\".json\" id=\"file\" label=\"Annotation Upload\" custom type=\"file\" onChange={props.handleOldAnnotation}/>\n\t\t\t\t\t</Form>\n\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\tFrame Rate: <input type=\"number\" onClick={(event) => {props.toggleKeyCheck(false)}} onBlur={(event) => {props.toggleKeyCheck(true)}} onChange={(event) => {setFrameRate(event.target.value);}}></input>\n\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\tSkip Value: <input type='number' defaultValue=\"1\" onChange={(event) => {setSkipValue(event.target.value)}}></input>\n\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t</div>\n\t\t\t</Modal.Body>\n\t\t\t<Modal.Footer>\n\t\t\t<Button variant=\"success\"  onClick={handleUploadClose}>Upload</Button>\n\t\t\t</Modal.Footer>\n\t\t</Modal>\n\t\t<Navbar sticky=\"top\" bg=\"dark\" variant=\"dark\" className=\"bg-5\">\n\t\t\t\t<Navbar.Brand href=\"#home\">AVAT</Navbar.Brand>\n\t\t\t\t<Nav className=\"mr-auto\">\n\t\t\t\t\t\t<NavDropdown disabled={props.disable_buttons} title=\"Export\" id=\"basic-nav-dropdown\">\n\t\t\t\t\t\t\t<NavDropdown.Item onClick={handleDownloadJSON}>JSON</NavDropdown.Item>\n\t\t\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\t\t</NavDropdown>\n\t\t\t\t\t\t<NavLink onClick={handleShow}>Instructions</NavLink>\n\t\t\t\t\t\t<NavLink onClick={props.handle_link_open}>Report</NavLink>\n\t\t\t\t</Nav>\n\t\t\t\t<div>\n\t\t\t\t\t<Button variant=\"outline-success\" onClick={handleUploadShow}>Upload</Button>{' '}\n\t\t\t\t\t{' '}\n\t\t\t\t\t<Dropdown as={ButtonGroup}>\n\t\t\t\t\t\t<Button variant=\"secondary\" disabled={true}>{props.display_frame_num}</Button>{' '}\n\t\t\t\t\t\t<Dropdown.Toggle split variant=\"secondary\" id=\"dropdown-split-basic\" />\n\t\t\t\t\t\t<Dropdown.Menu>\n\t\t\t\t\t\t\tSkip Value: <input type='number' defaultValue=\"1\" onChange={(event) => {setSkipValue(event.target.value)}}></input>\n\t\t\t\t\t\t</Dropdown.Menu>\n\t\t\t\t\t</Dropdown>{' '}\n\t\t\t\t\t\n\t\t\t\t\t<Button variant=\"primary\" disabled={props.disable_buttons} onClick={props.skip_frame_backward}>Prev</Button>{' '}\n\t\t\t\t\t{\n\t\t\t\t\t\tvideoFormat === INPUT_VIDEO && \n\t\t\t\t\t\t<Button variant=\"primary\" disabled={props.disable_buttons} onClick={handlePlaying}>{playText}</Button>\n\t\t\t\t\t}\n\t\t\t\t\t{' '}\n\t\t\t\t\t<Button variant=\"primary\" disabled={props.disable_buttons} onClick={props.skip_frame_forward}>Next</Button>{' '}\n\t\t\t\t\t<Dropdown as={ButtonGroup} drop='left'>\n\t\t\t\t\t\t<Button variant=\"success\" onClick={props.addToCanvas}>Add</Button>\n\t\t\t\t\t\t<Dropdown.Toggle split variant=\"success\" id=\"dropdown-split-basic\" />\n\t\t\t\t\t\t<Dropdown.Menu>\n\t\t\t\t\t\t\t<Dropdown.Item onClick={(event) =>{props.change_annotation_type(\"1\")}}>Behavior Annotation</Dropdown.Item>\n\t\t\t\t\t\t\t<Dropdown.Item onClick={(event) =>{props.change_annotation_type(\"2\")}}>BoundingBox</Dropdown.Item>\n\t\t\t\t\t\t\t<Dropdown.Item onClick={(event) =>{props.change_annotation_type(\"3\")}}>Segmentation</Dropdown.Item>\n\t\t\t\t\t\t</Dropdown.Menu>\n\t\t\t\t\t</Dropdown>\n\t\t\t\t\t{/*<Button variant=\"danger\" onClick={remove} disabled={disable_buttons} style={{position:\"relative\"}}>Remove</Button>{' '}*/}\n\t\t\t\t</div>\n\t\t</Navbar>\n\t\t</div>\n\t)\n}\n","let INPUT_IMAGE = \"in_image\"\nlet INPUT_VIDEO = \"in_video\"\n\nexport {INPUT_IMAGE, INPUT_VIDEO}","import store from '../store'\nimport {getFrameData, getAnnotationData} from './actions'\n\nexport async function downloadFileJSON (frame_data, VIDEO_METADATA) {\n    var fileName = \"generated_annotations\";\n   \n    const json = JSON.stringify({\"vid_metadata\": VIDEO_METADATA, \"annotations\": frame_data, \"behavior_data\": store.getState().annotation_data.data})\n    //var json = JSON.stringify(frame_data);\n    var blob = new Blob([json],{type:'application/json'});\n    var href = await URL.createObjectURL(blob);\n    var link = document.createElement('a');\n    link.href = href;\n    link.download = fileName + \".json\";\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n}\n\n\n//Legacy code below - Can be refrenced later IF need for CSV is present. Currently broken.\nfunction convert_data_csv(data, columns){\n    console.log(columns)\n    var csv = new Array(data.length + 1)\n    for(var i = 0; i < csv.length; i++){\n        csv[i] = []\n    }\n    csv[0].push(\"frame_num\")\n    for(var i = 0; i < columns.length; i++){\n        csv[0].push(columns[i]['dataField'])\n    }\n    for(var i = 0; i < data.length; i++){\n        for(var j = 0; j < data[i].length; j++){\n            csv[i+1][j]=[];\n            var obj = data[i][j]\n            var vals = Object.keys((obj)).map(function (key) { return obj[key]; });\n            csv[i+1][j] = i + \",\" + vals.join(\",\")\n        }\n        csv[i+1] = csv[i+1].join(\"\\n\")\n    }\n    csv = csv.join(\"\\n\")\n    return csv\n}\n\nexport async function downloadFileCSV (ANNOTATION_VIDEO_NAME, ANNOTATOR_NAME, annotation_data, columns) {\n    var fileName = \"generated_annotations\";\n    if(ANNOTATION_VIDEO_NAME !== \"\" && ANNOTATOR_NAME !== \"\"){\n        fileName = ANNOTATION_VIDEO_NAME.split('.').slice(0, -1).join('.') + \"_\" +  ANNOTATOR_NAME\n    }\n    var csv = convert_data_csv(annotation_data, columns(\"\"))\n    var blob = new Blob([csv],{type:'application/octet-stream'});\n    var href = await URL.createObjectURL(blob);\n    var link = document.createElement('a');\n    link.href = href;\n    link.download = fileName + \".csv\";\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n}","import React, { useEffect, useState } from \"react\"; \nimport ReactDOM from 'react-dom'\n\nimport store from '../../store' \nimport {initFrameData, updateFrameData, getFrameData, \n\t\tinitAnnotationData, updateAnnotationData, getAnnotationData, \n\t\tinitColumnData, getColumnData, \n\t\tinitCurrentFrame, getCurrentFrame, setCurrentFrame, setTotalFrames,} from '../../processing/actions'\nimport { useSelector } from \"react-redux\";\n\nimport {INPUT_IMAGE, INPUT_VIDEO} from '../../static_data/const'\nconst fabric = require(\"fabric\").fabric;\n\n\nconst canvasBackgroundUpdate = (currFrameData, inputType, image_url, scaling_factor_width, scaling_factor_height, fabricCanvas, remove_obj=true) => {\n\tif(inputType == INPUT_IMAGE){ //This is for when images are uploaded\n\t\tvar img = new Image()\n\t\timg.onload = function() {\n\t\t\tif (remove_obj){\n\t\t\t\tfabricCanvas.clear();\n\t\t\t}\n\t\t\tif(currFrameData != undefined){\n\t\t\t\tfabric.util.enlivenObjects(currFrameData, function (enlivenedObjects){\n\t\t\t\t\tenlivenedObjects.forEach(function (obj, index) {\n\t\t\t\t\t\tfabricCanvas.add(obj);\n\t\t\t\t\t});\n\t\t\t\t\tfabricCanvas.renderAll();\n\t\t\t\t})\n\t\t\t}\n\t\t\tvar f_img = new fabric.Image(img, {\n\t\t\t\tobjectCaching: false,\n\t\t\t\tscaleX: scaling_factor_width / img.width,\n\t\t\t\tscaleY: scaling_factor_height / img.height\n\t\t\t});\n\t\t\tfabricCanvas.setBackgroundImage(f_img);\n\t\t\n\t\t\tfabricCanvas.renderAll();\n\t\t};\n\t\timg.src = URL.createObjectURL(image_url)\n\t\treturn;\n\t}else{ //This is for videos\n\t\tif (remove_obj){\n\t\t\tfabricCanvas.remove(...fabricCanvas.getObjects());\n\t\t}\n\t\tif(currFrameData != undefined){\n\t\t\tfabric.util.enlivenObjects(currFrameData, function (enlivenedObjects){\n\t\t\t\tenlivenedObjects.forEach(function (obj, index) {\n\t\t\t\t\tfabricCanvas.add(obj);\n\t\t\t\t});\n\t\t\t\tfabricCanvas.renderAll();\n\t\t\t})\n\t\t}\n\t\tfabricCanvas.renderAll();\n\t}\n}\n\nexport default function FabricRender(props){\n\tconst [fabricCanvas, setFabricCanvas] = useState(null)\n\tconst [currindex, setCurrindex] = useState(0)\n\tconst [upload, setUpload] = useState(false)\n\tconst [frameToUpdate, setFrameToUpdate] = useState(0)\n\tconst metadata_redux = useSelector(state => state.metadata)\n\tconst frame_redux = useSelector(state => state.frame_data)\n\tconst image_data_store = useSelector(state => state.media_data)\n\tconst currFrame = useSelector(state => state.current_frame)\n\tconst currframe_redux = currFrame['data']\n\tconst play_redux = useSelector(state => state.play_status.play)\n\tconst image_data = image_data_store['data'][props.stream_num]\n\n\tvar save_data = (frame_number, reason) => {\n\t\tif(fabricCanvas){\n\t\t\tconsole.log('SAVING DATA FOR FRAME', frame_number, reason)\n\t\t\tupdateFrameData(frame_number, fabricCanvas.getObjects())\n\t\t}\n\t}\n\n\tuseEffect(() => {\n\t\tvar temp_fabricCanvas = (new fabric.Canvas('c', {\n\t\t\tuniScaleTransform: true,\n\t\t\tuniformScaling: false,\n\t\t\tincludeDefaultValues: false\n\t\t}));\n\n\t\tfabric.Image.prototype.toObject = (function(toObject) {\n\t\t\treturn function() {\n\t\t\t\treturn fabric.util.object.extend(toObject.call(this), {\n\t\t\t\t\tsrc: this.toDataURL()\n\t\t\t\t});\n\t\t\t};\n\t\t})(fabric.Image.prototype.toObject);\n\n\t\ttemp_fabricCanvas.on('mouse:wheel', function(opt) {\n\t\t\tvar delta = opt.e.deltaY;\n\t\t\tvar zoom = temp_fabricCanvas.getZoom();\n\t\t\tzoom *= 0.999 ** delta;\n\t\t\tif (zoom > 20) zoom = 20;\n\t\t\tif (zoom < 0.01) zoom = 0.01;\n\t\t\ttemp_fabricCanvas.zoomToPoint({ x: opt.e.offsetX, y: opt.e.offsetY }, zoom);\n\t\t\topt.e.preventDefault();\n\t\t\topt.e.stopPropagation();\n\t\t});\n\n\t\ttemp_fabricCanvas.on('object:moving', function (event) {\n\t\t\tthis.objDrag = true;\n\t\t});\n\n\t\ttemp_fabricCanvas.on('mouse:down', function(opt) {\n\t\t\tsave_data(frameToUpdate, \"mouse_down\")\n\t\t\tvar evt = opt.e;\n\t\t\tif (evt.altKey === true) {\n\t\t\t\tthis.isDragging = true;\n\t\t\t\tthis.selection = false;\n\t\t\t\tthis.lastPosX = evt.clientX;\n\t\t\t\tthis.lastPosY = evt.clientY;\n\t\t\t}\n\t\t});\n\t\ttemp_fabricCanvas.on('mouse:move', function(opt) {\n\t\t\tsave_data(frameToUpdate, \"mouse_move\")\n\t\t\tif (this.isDragging) {\n\t\t\t\tvar e = opt.e;\n\t\t\t\tvar vpt = this.viewportTransform;\n\t\t\t\tvpt[4] += e.clientX - this.lastPosX;\n\t\t\t\tvpt[5] += e.clientY - this.lastPosY;\n\t\t\t\tthis.requestRenderAll();\n\t\t\t\tthis.lastPosX = e.clientX;\n\t\t\t\tthis.lastPosY = e.clientY;\n\t\t\t}\n\t\t});\n\t\ttemp_fabricCanvas.on('mouse:up', function(opt) {\n\t\t\tsave_data(frameToUpdate, \"mouse_up\")\n\t\t\tif(this.objDrag){\n\t\t\t\tthis.objDrag = false;\n\t\t\t}\n\t\t\tthis.setViewportTransform(this.viewportTransform);\n\t\t\tthis.isDragging = false;\n\t\t\tthis.selection = true;\n\t\t});\n\n\t\tvar el = ReactDOM.findDOMNode(this);\n\t\tvar canvas_elem = document.getElementsByTagName('canvas')[props.stream_num*2]\n\t\ttemp_fabricCanvas.initialize(canvas_elem, {\n\t\t\theight: props.scaling_factor_height,\n\t\t  \twidth: props.scaling_factor_width,\n\t\t  \tbackgroundColor : null,\n\t\t});\n\n\t\tsetFabricCanvas(temp_fabricCanvas)\n\t}, []);\n\n\tuseEffect(() => {\n\t\tif(fabricCanvas){\n\t\t\tsave_data(frameToUpdate, \"frame_change\")\n\t\t\tsetFrameToUpdate(currframe_redux)\n\t\t\tvar video = document.getElementsByTagName('video')[props.stream_num]\n\t\t\tif(upload == true){\n\t\t\t\tvideo.currentTime = (video.duration * ((currframe_redux+1)/metadata_redux['total_frames']))\t\t\t\n\t\t\t}\n\t\t\tif(metadata_redux['media_type'] == INPUT_VIDEO){\n\t\t\t\tcanvasBackgroundUpdate(getFrameData(currframe_redux), INPUT_VIDEO, image_data[0], props.scaling_factor_width, props.scaling_factor_height, fabricCanvas)\n\t\t\t}else if (metadata_redux['media_type'] == INPUT_IMAGE){\n\t\t\t\tcanvasBackgroundUpdate(getFrameData(currframe_redux), INPUT_IMAGE, image_data[currframe_redux], props.scaling_factor_width, props.scaling_factor_height, fabricCanvas)\n\t\t\t}\n\t\t}\n\t}, [currFrame])\n\n\tuseEffect(() => {\n\t\tif (upload==false){\n\t\t\treturn\n\t\t}\n\t\tvar video = document.getElementsByTagName('video')[props.stream_num]\n\t\tif(play_redux){\n\t\t\tsave_data(frameToUpdate, \"play\")\n\t\t\tvideo.play()\n\t\t\tfabric.util.requestAnimFrame(function renderLoop() {\n\t\t\t\tfabricCanvas.renderAll();\n\t\t\t  \tfabric.util.requestAnimFrame(renderLoop);\n\t\t\t});\n\t\t}else{\n\t\t\tvideo.pause()\n\t\t\tlet frame_number = Math.ceil((video.currentTime  / video.duration) * metadata_redux['total_frames'])\n\t\t\tconsole.log(\"FRAME NUMBER\", frame_number)\n\t\t\tsetCurrentFrame(frame_number)\n\t\t}\n\t}, [play_redux])\n\n\n\tuseEffect(() => {\n\t\t// We want to redraw when a annotation is added or removed. Unfortunately this also causes a redraw when the current frame is changed.\n\t\t// This is not ideal, but it is a good enough solution for now. This should NOT save the data.\n\n\t\tif(fabricCanvas){\n\t\t\tcanvasBackgroundUpdate(getFrameData(currframe_redux), metadata_redux['media_type'], image_data[currframe_redux], props.scaling_factor_width, props.scaling_factor_height, fabricCanvas)\n\t\t}\n\t}, [frame_redux])\n\n\t\n\tif(fabricCanvas != null && image_data != undefined && upload===false && play_redux===false){\n\t\tif(image_data.length > 0){\n\t\t\tif(metadata_redux['media_type'] == INPUT_VIDEO){\n\t\t\t\tvar video = document.getElementsByTagName('video')[props.stream_num]\n\t\t\t\tvar source = document.createElement('source');\n\t\t\t\tsource.src = URL.createObjectURL(image_data[0])\n\t\t\t\tsource.type = \"video/mp4\"\n\t\t\t\tvideo.appendChild(source)\n\t\t\t\tvideo.onloadedmetadata = function(){\n\t\t\t\t\tinitAnnotationData(parseInt(video.duration))\n\t\t\t\t\tinitFrameData(parseInt(video.duration))\n\t\t\t\t\tsetTotalFrames(parseInt(video.duration))\n\t\t\t\t\tvideo.currentTime=0\n\t\t\t\t}\n\t\t\t\tvideo.oncanplaythrough = function(){\n\t\t\t\t\tif(upload === false){\n\t\t\t\t\t\tvar new_vid = new fabric.Image(video, {\n\t\t\t\t\t\t\tobjectCaching: false,\n\t\t\t\t\t\t\tscaleX: props.scaling_factor_width / video.videoWidth,\n\t\t\t\t\t\t\tscaleY: props.scaling_factor_height / video.videoHeight\n\t\t\t\t\t\t})\n\t\t\t\t\t\tvideo.width = video.videoWidth\n\t\t\t\t\t\tvideo.height = video.videoHeight\n\t\t\t\t\t\tfabricCanvas.setBackgroundImage(new_vid);\n\t\t\t\t\t\tfabricCanvas.renderAll();\n\t\t\t\t\t}\n\t\t\t\t\tsetUpload(true)\n\t\t\t\t}\n\t\t\t}else if(metadata_redux['media_type'] == INPUT_IMAGE){\n\t\t\t\tcanvasBackgroundUpdate(getFrameData(currframe_redux), INPUT_IMAGE, image_data[currframe_redux], props.scaling_factor_width, props.scaling_factor_height, fabricCanvas)\n\t\t\t}\n\t\t}\n\t}\n\n\treturn(\n\t\t<div style={{display: \"grid\"}}>\t\t\n\t\t\t<div style={{gridColumn: 1, gridRow:1, position: \"relative\", width: props.scaling_factor_width, height: props.scaling_factor_height, top: 0, left: 0, opacity: 0}}>\n\t\t\t\t<video></video>\n\t\t\t</div>\n\t\t\t<div style={{gridColumn: 1, gridRow:1, position: \"relative\",  top: 0, left: 0}}>\n\t\t\t\t<canvas id={props.stream_num}></canvas>\n\t\t\t</div>\n\t\t</div>\n\t)\n}\n","import React from 'react'\nimport {initFrameData, updateFrameData, getFrameData, initAnnotationData, updateAnnotationData, getAnnotationData} from '../../processing/actions'\n\nimport { useTable, usePagination } from 'react-table'\n\nexport default function AnnotTable({columns, data, select_data, current_frame, change_annot}){\n    const {\n        getTableProps,\n        getTableBodyProps,\n        headerGroups,\n        rows,\n        prepareRow,\n      } = useTable({\n        columns,\n        data,\n      })\n      if(!columns){\n        return (\n            <div>\n                {\"No column upload detected.\"}\n            </div>\n        )\n    }\n\n    return(\n        <table {...getTableProps()} style={{ border: 'solid 1px blue' }}>\n            <thead>\n                {headerGroups.map(headerGroup => (\n                <tr {...headerGroup.getHeaderGroupProps()}>\n                    {headerGroup.headers.map(column => (\n                    <th {...column.getHeaderProps()} \n                    style={{\n                      background: '#657',\n                      color: 'white',\n                      fontWeight: 'bold'\n                    }}>{column.render('Header')}</th>\n                    ))}\n                </tr>\n                ))}\n            </thead>\n            <tbody {...getTableBodyProps()}>\n                {rows.map((row, i) => {\n                    prepareRow(row)\n                    const {id, global_id, posture, behavior, confidence} = row\n                    var selection = genSelection(row.original, select_data, columns, i, current_frame)\n                    return(selection)\n                })}\n            </tbody>\n        </table>\n    )\n}\n\nconst change_row = (e) => {\n    var curr_data = getAnnotationData(e.target.dataset.curr)\n    if (curr_data.length === 0){\n        alert(\"Row changing value failed - please report this bug.\")\n        return;\n    }\n    curr_data[e.target.id][e.target.dataset.type] = e.target.value\n    updateAnnotationData(parseInt(e.target.dataset.curr), curr_data)\n}\n\nconst delete_row = (e) => {\n    var curr_data = getAnnotationData(e.target.dataset.curr)\n    if (curr_data.length === 0){\n        alert(\"Row deletion failed - please report this bug.\")\n        return;\n    }\n    var annot_delte = curr_data[e.target.id]['id']\n    console.log(annot_delte)\n    curr_data.splice(e.target.id, 1)\n    updateAnnotationData(parseInt(e.target.dataset.curr), curr_data)\n    var curr_img_data = getFrameData(e.target.dataset.curr)\n    for(var i = 0; i < curr_img_data.length; i++){\n        if(curr_img_data[i].objects[1].text == annot_delte){\n            curr_img_data.splice(i, 1)\n        }\n    }\n    updateFrameData(parseInt(e.target.dataset.curr), curr_img_data)\n}\n\nfunction genSelection(elem, select_data, columns, curr_idx, current_frame){\n    var row_vals = []\n    console.log(current_frame)\n    for(var i = 0; i < columns[0].columns.length; i++){\n        var curr_elem = columns[0].columns[i]['accessor']\n        if(!check_keys(select_data, curr_elem)){\n            continue\n        }\n        let temp = (\n            <select id={curr_idx} data-type={curr_elem} data-curr={current_frame} defaultValue={elem[curr_elem]} onChange={change_row}>\n                <option value=\"\"></option>\n                {\n                    select_data[curr_elem].map((beh, _) => {\n                        return(\n                            <option value={beh.value}>{beh.value}</option>\n                        )\n                    })\n                }\n            </select>\n        )\n        row_vals.push(temp)\n    }\n    \n    let combined_elems = (\n        <tr key={elem.id}>\n            <td>{elem.id}</td>\n            <td>\n                <input type={\"text\"} style={{width: \"50%\"}} defaultValue={elem.global_id} id={curr_idx} data-type={\"global_id\"} data-curr={current_frame} onChange={change_row}></input>\n            </td>\n            {\n                row_vals.map((i, j) => {\n                    return(<td id={j}>{i}</td>)\n                })\n            }\n            <td>\n                <input type={\"button\"} style={{backgroundColor: \"#f44336\"}} defaultValue={elem.global_id} id={curr_idx} data-type={\"global_id\"} data-curr={current_frame} onClick={delete_row}></input>\n            </td>\n        </tr>\n    )\n    return combined_elems\n}\n\nfunction check_keys(obj, key){\n    let obj_keys = Object.keys(obj)\n    for(var i = 0; i < obj_keys.length; i++){\n        if(obj_keys[i] === key){\n            return true\n        }\n    }\n    return false\n}\n","import React from \"react\"; \nimport 'bootstrap/dist/css/bootstrap.min.css';\n\nimport BootstrapTable from 'react-bootstrap-table-next';\nimport cellEditFactory, { Type } from 'react-bootstrap-table2-editor';\nimport 'react-bootstrap-table-next/dist/react-bootstrap-table2.min.css';\nimport paginationFactory from 'react-bootstrap-table2-paginator';\n\nimport Tabs from 'react-bootstrap/Tabs'\nimport Tab from 'react-bootstrap/Tab'\nimport Button from 'react-bootstrap/Button'\nimport { FormControl } from \"react-bootstrap\";\n\nimport AnnotTable from './annot_table'\nimport SwapAnnotTable from \"./cumulative_annot_table\";\n\nimport store from '../../store'\n\nfunction getAnnotationTableCount() {\n    var annotation_data = store.getState().annotation_data.data\n    var data = []\n    if (!annotation_data){\n        return data\n    }\n    for(var i = 0; i < annotation_data.length; i++){\n        if(annotation_data[i].length !== 0){\n            var txt_id = \"\"\n            var txt_global = \"\"\n            for(var j = 0; j < annotation_data[i].length; j++){\n                txt_id += (annotation_data[i][j]['id']) + ', '\n                txt_global += (annotation_data[i][j]['global_id']) + ', '\n            }\n            data.push({frame_num: i, anno_count: annotation_data[i].length, local_ids: txt_id, global_ids: txt_global})\n        }\n    }\n    return data\n}\n\n\nexport default function AnnotationTable(props){\n    var annotation_data = (props.annotation_data)\n    var columns = []\n    var col = []\n    var select_data = undefined\n    if(store.getState().column_annot.data != undefined){\n      col = store.getState().column_annot.data['columns']\n      select_data = store.getState().column_annot.data['select_data']\n      columns.push(col)//hookBypass(col)\n    }\n    const anno_col = React.useMemo(\n        () => [\n          {\n            Header: 'Name',\n            columns: [\n              {\n                Header: 'Frame',\n                accessor: 'frame_num',\n              },\n              {\n                Header: 'Count',\n                accessor: 'anno_count',\n              },\n              {\n                Header: 'Local ID',\n                accessor: 'local_id',\n              },\n              {\n                Header: 'Global ID',\n                accessor: 'global_ids',\n              },\n              /*{\n                Header: 'Swap',\n                accessor: 'swap',\n              }*/\n            ],\n          }\n        ],\n        []\n      )\n\n    //TODO Add in force option for user to upload some sort of config file to continue along to next steps.\n    return (\n        <div>\n        {\n            col.length != 0 &&\n            <Tabs defaultActiveKey=\"home\" id=\"uncontrolled-tab-example\">\n                <Tab eventKey=\"home\" title=\"Current\">\n                    <AnnotTable columns={columns} data={annotation_data} select_data={select_data} current_frame={props.currentFrame} change_annot={props.handleChangeAnnot}/>\n                </Tab>\n\n            </Tabs>\n        }   \n        </div>\n           \n    )\n}\n/*\n                <Tab eventKey=\"swap\" title=\"Swap\">\n                    <SwapAnnotTable columns={anno_col} data={getAnnotationTableCount()}></SwapAnnotTable>\n                </Tab>\n*/\n/*\n<Tab eventKey=\"profile\" title=\"Previous\">\n                <BootstrapTable\n                    keyField='frame_num'\n                    data={data} \n                    columns={anno_col((props.handleSetCurrentFrame))}\n                    table\n                    noDataIndication={ () => <div>No recorded annotations or behaviors for this video.</div> }\n                    pagination={ paginationFactory() }\n                />\n            </Tab>\n*/","//Core imports\nimport React, { useEffect, useState } from \"react\";\nimport 'bootstrap/dist/css/bootstrap.min.css';\n\n//Constants\nimport {INPUT_IMAGE, INPUT_VIDEO} from '../../static_data/const'\n\n//UI Element imports\nimport Toast from 'react-bootstrap/Toast'\n\n//Processing\nimport ExtractingAnnotation from '../../processing/annotation-processing'\n\n//Annotations\nimport { BoundingBox } from '../../annotations/bounding_box'\n\n//Column information + data structure\nimport {columns} from '../../static_data/columns'\nimport {ANNOTATION_FRAME, ANNOTATION_BBOX, ANNOTATION_KEYPOINT, ANNOTATION_SEG} from '../../static_data/constants'\n\n//Components\nimport CustomNavBar from \"../Components/nav_bar\";\nimport FabricRender from \"../Components/fabric_canvas\";\nimport AnnotationTable from \"../Components/change_table\";\n\n\n//Redux\nimport store from '../../store' \nimport {initFrameData, updateFrameData, getFrameData, \n\t\tinitAnnotationData, updateAnnotationData, getAnnotationData, \n\t\tgetColumnData,\n\t\tinitCurrentFrame, getCurrentFrame, setCurrentFrame,\n\t\tinitMedia,\n\t\tinitMetadata, setRes, setFrameRate, setTotalFrames,\n        initColumnData,\n\t\tinitPlay} from '../../processing/actions'\nimport { useSelector } from \"react-redux\";\n\n// Data imports\nimport default_column from '../../static_data/basic_column_config.json'\n\nconst fabric = require(\"fabric\").fabric;\n\n//TODO ADD DYNAMIC SOLUTION\nvar scaling_factor_width = 1920;\nvar scaling_factor_height = 1080;\n\n//var current_screen_width = window.screen.width;\nvar current_screen_height = window.screen.height;\n\nif(current_screen_height >= 1080){////Mappings are based off of https://en.wikipedia.org/wiki/List_of_common_resolutions make sure to use 1:1 and 16:9 aspect ratio\n  scaling_factor_width = 1280;\n  scaling_factor_height = 720;\n}else if(current_screen_height >= 1024){\n  scaling_factor_width = 1152;\n  scaling_factor_height = 648;\n}else if(current_screen_height >= 768){\n  scaling_factor_width = 1024;\n  scaling_factor_height = 576;\n}\n\nvar upload = false;\nvar disable_buttons = true;\nvar toast_text = \"\"\nvar ANNOTATION_VIDEO_NAME = \"\"\nvar VIDEO_METADATA = {}\nvar play_button_text = \"Play\"\nvar segmentation_flag = false;\n\n//TODO remove after fixing null exceptions\ninitAnnotationData(1)\ninitFrameData(1)\ninitCurrentFrame(0)\ninitMetadata(scaling_factor_width, scaling_factor_height, 1, INPUT_VIDEO, 1)\ninitPlay()\nconsole.log(default_column)\ninitColumnData(\n    default_column\n)\n\n//Current frame counter\nexport default function MainUpload() {\n\tconst [visualToggle, setVisualToggle] = useState(0);\n\tconst [annotationType, setAnnotationType] = useState(\"1\")\n\tconst [boxCount, setBoxCount] = useState(0)\n\tconst [oldAnnotation, setOldAnnotation] = useState(null)\n\tconst [save, changeSave] = useState(false);\n\tconst [keyCheck, changeKeyCheck] = useState(true)\n\tconst [isLoading, setIsLoading] = useState(true)\n\n\t//New state vars\n\tconst [currAnnotationData, setCurrAnnotationData] = useState([])\n\n\tconst annot_redux = useSelector(state => state.annotation_data.data)\n\tconst column_redux = useSelector(state => state.column_annot.data)\n\tconst currframe_redux = useSelector(state => state.current_frame)['data']\n\tconst imagedata_redux = useSelector(state => state.media_data.data)\n\tconst metadata_redux = useSelector(state => state.metadata)\n\tvar inputType = metadata_redux['media_type']\n\tvar skip_value = parseInt(metadata_redux['skip_value'])\n\n\tuseEffect(() => {\n\t\tif(upload == true){\n\t\t\tvar annot = getAnnotationData(currframe_redux)\n\t\t\tsetCurrAnnotationData(annot)\n\t\t}\n\t}, [currframe_redux])\n\n\tuseEffect(()=>{\n\t\tif(annot_redux.length === 1){\n\t\t\tinitAnnotationData(metadata_redux.total_frames)\n\t\t\tinitFrameData(metadata_redux.total_frames)\n\t\t}\n\t}, [metadata_redux]);\n\n\tuseEffect(() => {\n\t\tif(imagedata_redux[0].length != 0){\n\t\t\tif(metadata_redux['media_type'] == INPUT_IMAGE){\n\t\t\t\tsetTotalFrames(imagedata_redux[0].length)\n\t\t\t\tupload = true\n\t\t\t\tdisable_buttons = false\n\t\t\t\tinitAnnotationData(imagedata_redux[0].length)\n\t\t\t\tinitFrameData(imagedata_redux[0].length)\n\t\t\t\tvar url = (imagedata_redux[0][0])\n\t\t\t\tvar img = new Image;\n\t\t\t\timg.onload = function() {\n\t\t\t\t\tVIDEO_METADATA = {\"horizontal_res\": img.width, \"vertical_res\": img.height}\n\t\t\t\t\tURL.revokeObjectURL(img.src)\n\t\t\t\t}\n\t\t\t\timg.src = url\n\t\t\t\tsetVisualToggle(10)\n\t\t\t}else if(metadata_redux['media_type'] == INPUT_VIDEO){\n\t\t\t\tupload = true\n\t\t\t\tdisable_buttons = false\n\t\t\t\tinitAnnotationData(imagedata_redux[0].length)\n\t\t\t\tinitFrameData(imagedata_redux[0].length)\n\t\t\t\tsetVisualToggle(10)\n\t\t\t}\n\t\t}\n\t\tscaling_factor_width = 1920;\n\t\tscaling_factor_height = 1080;\n\t\tif(current_screen_height >= 1080){////Mappings are based off of https://en.wikipedia.org/wiki/List_of_common_resolutions make sure to use 1:1 and 16:9 aspect ratio\n\t\t\tscaling_factor_width = 1280;\n\t\t\tscaling_factor_height = 720;\n\t\t  }else if(current_screen_height >= 1024){\n\t\t\tscaling_factor_width = 1152;\n\t\t\tscaling_factor_height = 648;\n\t\t  }else if(current_screen_height >= 768){\n\t\t\tscaling_factor_width = 1024;\n\t\t\tscaling_factor_height = 576;\n\t\t}\n\t\tscaling_factor_height = scaling_factor_height * (1/imagedata_redux.length)\n\t\tscaling_factor_width = scaling_factor_width * (1/imagedata_redux.length)\n\n\n\t}, [imagedata_redux])\n\n\tconst addToCanvas = () => {\n\t\tvar color = \"#\" + ((1<<24)*Math.random() | 0).toString(16)\n\t\t\n\t\tif(currAnnotationData == null){\n\t\t\tsetCurrAnnotationData([])\n\t\t}\n\n\t\tvar annotation_type_txt = \"error\"\n\n\t\tif (annotationType === ANNOTATION_BBOX){\n\t\t\tannotation_type_txt = \"b\"\n\t\t\tvar new_bbox = new BoundingBox(50, 50, 50, 50, color, boxCount+'b', \"None\").generate_no_behavior()\n\t\t\tvar frame_dat = getFrameData(getCurrentFrame())\n\t\t\tframe_dat = Object.assign([], frame_dat)\n\t\t\tframe_dat.push(new_bbox)\n\t\t\tupdateFrameData(currframe_redux, frame_dat)\n\t\t\t//updateFrameData(currframe_redux, [new_bbox])\n\t\t}else if(annotationType === ANNOTATION_FRAME){\n\t\t\t//TODO Add annotation frame datapoint\n\t\t\tannotation_type_txt = \"f\"\n\t\t}\n\t\t\n\t\tvar saved_annot = getAnnotationData(getCurrentFrame())\n\t\tvar generated_annotation;\n\t\tif(inputType === INPUT_IMAGE){\n\t\t\tgenerated_annotation = create_annotation(boxCount+annotation_type_txt)\n\t\t}else{\n\t\t\tgenerated_annotation = create_annotation(boxCount+annotation_type_txt)\n\t\t}\n\t\tsaved_annot = Object.assign([], saved_annot)\n\t\tsaved_annot.push(generated_annotation)\n\t\tupdateAnnotationData(currframe_redux, saved_annot)\n\n\t\tsetBoxCount(boxCount + 1);\n\t}\n\n\n\tuseEffect(() =>{\n\t\tif(upload == true){\n\t\t\tsetCurrAnnotationData(getAnnotationData(currframe_redux))\n\t\t}\n\t}, [annot_redux])\n\n\tconst create_annotation = (id) => {\n\t\tvar columns = getColumnData()\n\t\tvar new_data = {}\n\t\tcolumns = columns['data']['columns']['columns']\n\t\tfor(var i = 0; i < columns.length; i++){\n\t\t\tvar curr_val = columns[i]\n\t\t\tnew_data[curr_val.accessor] = \"\"\n\t\t}\n\t\tif(inputType === INPUT_IMAGE){\n\t\t\tnew_data['dataType'] = \"image\"\n\t\t\tnew_data['fileName'] = \"temp\"//image_frames[currframe_redux]['name']\n\t\t}else{\n\t\t\tnew_data['dataType'] = \"video\"\n\t\t\tnew_data['fileName'] = \"frame_\" + currframe_redux\n\t\t}\n\t\tnew_data['id'] = id\n\t\treturn new_data\n\t}\n\n\tconst toggle_segmentation = (event) => {\n\t\tsegmentation_flag = !segmentation_flag\n\t}\n\n\tconst handleOldAnnotation = (event) => {\n\t\tvar promise = downloadOldAnnotation(event)\n\t\tpromise.then(function (result) {\n\t\t\tif(result != null){\n\t\t\t\tsetOldAnnotation(new ExtractingAnnotation(result, scaling_factor_width, scaling_factor_height));\n\t\t\t\tsetRes(result.vid_metadata.horizontal_res, result.vid_metadata.vertical_res)\n\t\t\t}else{\n\t\t\t\talert(\"Error in processing Annotation. Please check the file and try again.\")\n\t\t\t}\n\t\t})\n\t}\n\n\tuseEffect(() => {\n\t\t//TODO Find a more elegant solution. This is a temporay patch work.\n\t\tif(oldAnnotation == null){\n\t\t\treturn;\n\t\t}\n\t\tstore.dispatch({\n\t\t\ttype: \"frame_data/initOldAnnotation\",\n\t\t\tpayload: oldAnnotation.get_frame_data()\n\t\t});\n\t\tstore.dispatch({\n\t\t\ttype: \"annotation_data/initOldAnnotation\",\n\t\t\tpayload: oldAnnotation.get_annotation_data()\n\t\t});\n\t\tsetFrameRate(oldAnnotation.get_frame_rate())\n\t\tsetCurrAnnotationData(oldAnnotation.get_annotation_data()[0])\n\t\tsetBoxCount(oldAnnotation.find_highest_localid())\n\t}, [oldAnnotation]);\n\t\t\n\n\tuseEffect(() => { //This shold update the view upon column loading\n\t\tsetIsLoading(false)\n\t}, [column_redux])\n\n\n\tconst downloadOldAnnotation = (file) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tvar reader = new FileReader();\n\t\t\treader.onload = function(e) {\n\t\t\t\tresolve((JSON.parse(e.target.result)));\n\t\t\t}\n\t\t\treader.readAsText(file.target.files[0])\n\t\t})\n\t}\n  \n\tconst skip_frame_forward = e =>{\n\t\tvar frameVal = currframe_redux + skip_value\n\n\t\tif(frameVal >= metadata_redux['total_frames']){\n\t\t\tif(inputType === INPUT_IMAGE){\n\t\t\t\tsetCurrentFrame(metadata_redux['total_frames']-1)\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsetCurrentFrame(metadata_redux['total_frames']-1)\n\t\t}else{\n\t\t\tif(inputType === INPUT_IMAGE){\n\t\t\t\tsetCurrentFrame(frameVal)\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsetCurrentFrame(frameVal)\n\t\t}\n\t}\n\n\tconst skip_frame_backward = e => {\n\t\tvar frameVal = currframe_redux - skip_value\n\t\tif(frameVal < 0){\n\t\t\tif(inputType === INPUT_IMAGE){\n\t\t\t\tsetCurrentFrame(0)\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsetCurrentFrame(0)\n\t\t}else{\n\t\t\tif(inputType === INPUT_IMAGE){\n\t\t\t\tsetCurrentFrame(frameVal)\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsetCurrentFrame(frameVal)\n\t\t}\n\t}\n\n\tconst change_annotation_type = (event) => {\n\t\tsetAnnotationType(event)\n\t}\n\n\tconst onKeyPress = (event) =>{\n\t\t//Making sure input for textbox doesnt get counted as a mode change\n\t\tif(keyCheck === false){\n\t\t\treturn;\n\t\t}\n\t\tif(segmentation_flag === true){\n\t\t\talert(\"Please finish your current action!\")\n\t\t\treturn;\n\t\t}\n\t\tif (event.key === ANNOTATION_BBOX){\n\t\t\ttoast_text = \"Mode Switch: Bounding Box\"\n\t\t\tchangeSave(true)\n\t\t\tsetAnnotationType(ANNOTATION_BBOX)\n\t\t}else if (event.key === ANNOTATION_KEYPOINT){\n\t\t\ttoast_text = \"Mode Switch: Key Point\"\n\t\t\tchangeSave(true)\n\t\t\tsetAnnotationType(ANNOTATION_KEYPOINT)\n\t\t}else if(event.key === ANNOTATION_SEG) {\n\t\t\ttoast_text = \"Mode Switch: Segmentation\"\n\t\t\tchangeSave(true)\n\t\t\tsetAnnotationType(ANNOTATION_SEG)\n\t\t}else if(event.key === ANNOTATION_FRAME){\n\t\t\ttoast_text = \"Mode Switch: Behavior Annotation\"\n\t\t\tchangeSave(true)\n\t\t\tsetAnnotationType(ANNOTATION_FRAME)\n\t\t}else if (event.key === \"a\"){\n\t\t\tvar annotext = \"\"\n\t\t\tif(annotationType === ANNOTATION_BBOX){\n\t\t\t\tannotext = \"Bounding Box\"\n\t\t\t}else if(annotationType === ANNOTATION_FRAME){\n\t\t\t\tannotext = \"Behavior Data\"\n\t\t\t}else if (annotationType === ANNOTATION_KEYPOINT){\n\t\t\t\tannotext = \"Keypoint\"\n\t\t\t}else if (annotationType === ANNOTATION_SEG){\n\t\t\t\tannotext = \"Segmentation\"\n\t\t\t}\n\t\t\ttoast_text = \"Added Annotation - \" + annotext\n\t\t\tif(annotationType !== ANNOTATION_SEG){\n\t\t\t\tchangeSave(true)\n\t\t\t}\n\t\t\taddToCanvas()\n\t\t}else if (event.key === \"q\"){\n\t\t\tskip_frame_backward()\n\t\t}else if (event.key === \"e\"){\n\t\t\tskip_frame_forward()\n\t\t}else if(event.key === \"c\"){\n\t\t\t\n\t\t}\n\t}  \n\n\tuseEffect(() => {\n\t\tdocument.addEventListener(\"keydown\", onKeyPress);\n\t\treturn () => document.removeEventListener(\"keydown\", onKeyPress);\n\t}, [onKeyPress]);\n\t\n\n\tconst handle_visual_toggle = () => {\n\t\tsetVisualToggle(Math.floor(Math.random() * 999999999999))\n\t}\n\n\tconst toggleKeyCheck = (toggle_val) => {\n\t\tconsole.log(\"Keycheck activated\")\n\t\tif(toggle_val === undefined){\n\t\t\tchangeKeyCheck(!keyCheck)\n\t\t}else{\n\t\t\tchangeKeyCheck(toggle_val)\n\t\t}\n\t}\n\n\tconst handleChangeAnnot = val => {\n\t\tsetCurrAnnotationData(val)\n\t}\n\n\tconst genFabricCanvas = () => {\n\t\tvar fcanvas = []\n\t\tfor(var i = 0; i < imagedata_redux.length; i++){\n\t\t\tlet canv = (\n\t\t\t\t<div style={{gridColumn: 1, gridRow:i+1, position: \"relative\",  top: 0, left: 0}}>\n\t\t\t\t\t<FabricRender \n\t\t\t\t\t\tcurrentFrame={currframe_redux}\n\t\t\t\t\t\tscaling_factor_height={scaling_factor_height}\n\t\t\t\t\t\tscaling_factor_width={scaling_factor_width}\n\t\t\t\t\t\tstream_num={i}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t)\n\t\t\tfcanvas.push(canv)\n\t\t}\n\t\treturn(\n\t\t\t<div>\n\t\t\t{\n\t\t\t\tfcanvas.map((can, _) => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\tcan\n\t\t\t\t\t)\n\t\t\t\t})\n\t\t\t}\n\t\t\t</div>\n\t\t)\n\t}\n\n\treturn (\n\t\t<div>\n\t\t\t<CustomNavBar \n\t\t\t\tdisable_buttons={disable_buttons} \n\t\t\t\tvideo_width={scaling_factor_width} \n\t\t\t\tvideo_height={scaling_factor_height} \n\t\t\t\tskip_value={skip_value} \n\t\t\t\thandleOldAnnotation={handleOldAnnotation}\n\t\t\t\tcurrentFrame={currframe_redux}\n\t\t\t\tdisplay_frame_num={\"Frame #\" + parseInt(currframe_redux+1)+' / '+parseInt(metadata_redux['total_frames'])}\n\t\t\t\tskip_frame_forward={skip_frame_forward}\n\t\t\t\tskip_frame_backward={skip_frame_backward}\n\t\t\t\taddToCanvas={addToCanvas}\n\t\t\t\tANNOTATION_VIDEO_NAME={ANNOTATION_VIDEO_NAME}\n\t\t\t\tchange_annotation_type={change_annotation_type}\n\t\t\t\tVIDEO_METADATA={VIDEO_METADATA}\n\t\t\t\ttoggleKeyCheck={toggleKeyCheck}\n\t\t\t\thandle_visual_toggle={handle_visual_toggle}\n\t\t\t/>\n\t\t\t<Toast \n\t\t\t\tonClose={() => changeSave(false)} \n\t\t\t\tshow={save} delay={500} autohide\n\t\t\t\tstyle={{ position: 'absolute', top: '100', left: '100', zIndex: '100'}}\n\t\t\t>\n\t\t\t\t<Toast.Header>\n\t\t\t\t\t<strong className=\"mr-auto\">{toast_text}</strong>\n\t\t\t\t</Toast.Header>\n\t\t\t</Toast>\n\t\t\t{\n\t\t\t\tupload === true && \n\t\t\t\t<div style={{display: \"grid\"}}>\n\t\t\t\t\t{genFabricCanvas()}\n\t\t\t\t\t<div style={{gridColumn: 2, gridRow:1, position: \"relative\", top: 0, left: 0}}>\n\t\t\t\t\t\t<AnnotationTable\n\t\t\t\t\t\t\tannotation_data={currAnnotationData}\n\t\t\t\t\t\t\tchange_annotation_data={handleChangeAnnot}\n\t\t\t\t\t\t\tcurrentFrame={currframe_redux}\n\t\t\t\t\t\t\ttoggleKeyCheck={toggleKeyCheck}\n\t\t\t\t\t\t\tcolumns={columns}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t}\n\t\t\t{\n\t\t\t\tupload === false &&\n\t\t\t\t<div>\n\t\t\t\t\t\"Video/Image upload not detected. Please upload.\"\n\t\t\t\t</div>\n\t\t\t}\n\t\t</div>\n\t);\n}\n","export const ANNOTATION_FRAME = \"1\"\nexport const ANNOTATION_BBOX = \"2\"\nexport const ANNOTATION_SEG = \"3\"\nexport const ANNOTATION_KEYPOINT = \"4\"\n","\nimport React, { useState } from \"react\";\nimport 'bootstrap/dist/css/bootstrap.min.css';\n\nimport Button from 'react-bootstrap/Button'\nimport Modal from 'react-bootstrap/Modal'\nimport Carousel from 'react-bootstrap/Carousel'\n\nimport MainUpload from './main_upload'\nimport { Container, Jumbotron, Card} from \"react-bootstrap\";\nimport Instructions from \"../Components/instructions\";\n\nimport selection_items from '../../static_data/selectionscreen_info.json'\n\n//<img src={process.env.PUBLIC_URL + '/favicon.ico'} alt=\"logo\" style={{width: \"30%\"}} />\nfunction SelectionScreen(){\n    const [show, setShow] = useState(false);\n    const handleClose = () => setShow(false);\n    const [upload, setUpload] = useState(false)\n    const handleUpload = (event) => {\n        setUpload(!upload)\n    }\n\n    const [multiview, setMultiview] = useState(false)\n\n    if(upload){\n        return (<MainUpload/>)\n    }else{\n        return (\n            <div>\n                <Modal show={show} onHide={handleClose} size='lg'>\n                    <Modal.Header closeButton>\n                    <Modal.Title>Instructions</Modal.Title>\n                    </Modal.Header>\n                    <Modal.Body><Instructions></Instructions></Modal.Body>\n                    <Modal.Footer>\n                    <Button variant=\"secondary\" onClick={handleClose}>Close</Button>\n                    </Modal.Footer>\n                </Modal>\n                <main>\n                    <Jumbotron className=\"text-center\">\n                        <Container>\n                            <h1 className=\"jumbotron-heading\">AVAT</h1>\n                            <p className=\"lead text-muted\"> Analysis tool to record data for livestock behavior and computer vision applications. </p>\n                            <p>\n                                <Button onClick={handleUpload} variant=\"success\" className=\"mx-1 my-2\">Video Upload</Button>\n                            </p>\n                        </Container>\n                    </Jumbotron>\n                        <Carousel controls={false} fade style={{\"width\": \"70%\", \"marginLeft\": \"auto\", \"marginRight\": \"auto\"}}>\n                            {\n                                selection_items.map((item, key) => {\n                                    return(\n                                        <Carousel.Item key={key} interval={item.slide_time}>\n                                            <Card \n                                                className=\"mb-5 box-shadow\" \n                                                top=\"true\"\n                                                width='100%'\n                                            >\n                                                <Card.Img width=\"60%\" variant=\"top\" src={process.env.PUBLIC_URL + item.src} />\n                                                <Card.Body style={{\"textAlign\": \"center\"}}>\n                                                    <Card.Title>{item.altText}</Card.Title>\n                                                    <Card.Text>{item.description}</Card.Text>\n                                                </Card.Body>\n                                            </Card>\n                                        </Carousel.Item>\n                                    )\n                                })\n                            }\n                        </Carousel>\n                </main>\n            </div>\n        )\n    }\n}\n\nexport default SelectionScreen;","/**\n * @author Pradeep Senthil (pradeepsen99@gmail.com)\n * @\n */\n\n import React, { useState } from \"react\"; \n import ReactDOM from 'react-dom'\n import './App.css';\n import ReactPlayer from 'react-player'\n import 'bootstrap/dist/css/bootstrap.min.css';\n \n import FrontEnd from './ui_elements/Pages/main_upload'\n import SelectionScreen from './ui_elements/Pages/selection_screen'\n \n //<FrontEnd></FrontEnd>\n function App() {\n   return (\n     <div>\n       <SelectionScreen></SelectionScreen>    \n     </div>\n   );\n }\n       //<ActiveObject />\n       //<input type=\"file\" onChange={handleVideoUpload1} />\n       //<div>\n         //<ReactPlayer url={videoFilePath1} width=\"50%\" height=\"50%\" controls={true} style={{position:'relative', float:'left'}}/>\n         //<Fabric/>\n       //</div>\n \n export default App;","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nimport { Provider } from 'react-redux'\nimport store from './store'\n\n/* ReactDOM.render(\n    <App/>,\n    document.getElementById('root')\n);\n */\n\n//REDUX code\nReactDOM.render(\n    <Provider store={store}>\n      <App/>\n    </Provider>,\n    document.getElementById('root')\n);\n\n\n/**\n * IF NEED TO RE-ENABLE STRICT MODE THEN UNNCOMMENT AND ADD BACK\n * \n *   <React.StrictMode>\n    <MainUpload></MainUpload>\n  </React.StrictMode>,\n */\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}