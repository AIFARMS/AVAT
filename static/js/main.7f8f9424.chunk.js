(this.webpackJsonpavat=this.webpackJsonpavat||[]).push([[0],{446:function(e){e.exports=JSON.parse('[{"src":"/assets/tensorflow.gif","altText":"Model assisted annotation","description":"Supports integration with pre-trained Tensorflow models to accelerate annotation","slide_time":10000},{"src":"/assets/add_remove.gif","altText":"Quickly add and remove annotations","description":"Add and remove annotations with ease with individual edits or whole frame edits","slide_time":8000},{"src":"/assets/segmentation.png","altText":"Segmentation","description":"Multiple dots across an object to help train AI models to identify objects in frame. This annotation can be coupled with behavior data.","slide_time":4000},{"src":"/assets/bounding_box.png","altText":"Bounding Box","description":"Rectangle that serves as a point of refrence for training object detection AI models. This annotation can be coupled with behavior data.","slide_time":4000},{"src":"/assets/annotation_count.png","altText":"Keep track of multiple annotations accross frames","description":"Full frame data summary helps keep track of multiple annotations by local and global id.","slide_time":4000},{"src":"/assets/youtube.png","altText":"Video Support","description":"Supports videos from Local Files, Youtube, Vimeo and Dailymotion","slide_time":4000}]')},454:function(e,t,a){e.exports=a(622)},459:function(e,t,a){},460:function(e,t,a){},484:function(e,t){},485:function(e,t){},486:function(e,t){},498:function(e,t){},499:function(e,t){},507:function(e,t){},517:function(e,t){},622:function(e,t,a){"use strict";a.r(t);var n=a(1),o=a.n(n),i=a(65),l=a.n(i),r=(a(459),a(460),a(220)),c=a.n(r),s=(a(135),a(22)),u=a(6),d=a(192),m=a(9),f=a(10),h=a(123).fabric,g=(h.util.createClass(h.Rect,{type:"boundingbox",initialize:function(e){e||(e={}),this.callSuper("initialize",e),this.set("label",e.label||"")},toObject:function(){return h.util.object.extend(this.callSuper("toObject"),{label:this.get("label")})},_render:function(e){this.callSuper("_render",e),e.font="10px Helvetica",e.fillStyle="#333",e.fillText(this.label,-this.width/2,-this.height/2+20),e.uniScaleTransform=!1}}),a(123).fabric),p=function(){function e(t,a,n,o,i,l,r){Object(m.a)(this,e),this.top=t,this.left=a,this.id=l,this.behavior=r,this.color=i,this.width=n,this.height=o}return Object(f.a)(e,[{key:"rectangle",value:function(){return new g.Rect({hasRotatingPoint:!1,height:this.height,width:this.width,fill:this.color,opacity:".4",top:this.top,left:this.left})}},{key:"id_text",value:function(){return new g.Text(this.id.toString(),{fontSize:20,top:this.top,left:this.left,uniScaleTransform:!1})}},{key:"generate_no_behavior",value:function(e){var t=new g.Group([this.rectangle(),this.id_text()],{borderColor:"#000000",hasBorders:!0,uniScaleTransform:!0});e.on({"object:scaling":function(e){var t=e.target.item(1),a=e.target,n=a.width/(a.width*a.scaleX),o=a.height/(a.height*a.scaleY);t.set("scaleX",n),t.set("scaleY",o)}});var a=this.id;return t.local_id=a,e.add(t),t.toJSON()}},{key:"generate_mouse_no_behavior",value:function(e){var t,a,n,o;new g.Text(this.id.toString(),{fontSize:20,top:this.top,left:this.left,uniScaleTransform:!1});e.on("mouse:down",(function(i){a=!0;var l=e.getPointer(i.e);n=l.x,o=l.y;l=e.getPointer(i.e);var r=new g.Rect({left:n,top:o,originX:"left",originY:"top",width:l.x-n,height:l.y-o,angle:0,fill:"rgba(255,0,0,0.5)",transparentCorners:!1,uniScaleTransform:!0});t=r,e.add(t)})),e.on("mouse:move",(function(i){if(a){var l=e.getPointer(i.e);n>l.x&&t.set({left:Math.abs(l.x)}),o>l.y&&t.set({top:Math.abs(l.y)}),t.set({width:Math.abs(n-l.x)}),t.set({height:Math.abs(o-l.y)}),e.renderAll()}})),e.on("mouse:up",(function(t){a=!1,e.off("mouse:down"),e.off("mouse:up")}))}}]),e}(),b=a(123).fabric,v=(a(215),function(){function e(t,a,n){Object(m.a)(this,e),this.frame_data=t.annotations,this.annotation_data=t.behavior_data,this.canvas=a,this.metadata=t.vid_metadata}return Object(f.a)(e,[{key:"get_frame_data",value:function(){return console.log(this.scale_annotations()),this.scale_annotations()}},{key:"get_annotation_data",value:function(){return this.annotation_data}},{key:"find_highest_localid",value:function(){for(var e=[],t=0;t<this.annotation_data.length;t++)for(var a=0;a<this.annotation_data[t].length;a++)console.log(this.annotation_data[t][a]),e.push(parseInt(this.annotation_data[t][a].id.replace(/\D/g,"")));return console.log(Math.max.apply(Math,e)),Math.max.apply(Math,e)+1}},{key:"scale_annotations",value:function(){var e=[];console.log(this.frame_data);for(var t=0;t<this.frame_data.length;t++){var a=[],n=this.frame_data[t];if(null!=n){for(var o=0;o<n.length;o++)if("bounding_box"===n[o].type){var i=parseInt(n[o].x)/parseInt(this.metadata.horizontal_res)*this.canvas.width,l=n[o].y/this.metadata.vertical_res*this.canvas.height,r=n[o].width/this.metadata.horizontal_res*this.canvas.width,c=n[o].height/this.metadata.vertical_res*this.canvas.height,s="#"+((1<<24)*Math.random()|0).toString(16),u=new p(l,i,r,c,s,n[o].local_id,"None").generate_no_behavior(this.canvas);u.local_id=n[o].local_id,a.push(u)}else if("segmentation"===n[o].type){for(var d=[],m=n[o].points,f=0;f<m.length;f++){var h=parseInt(m[f].x)/parseInt(this.metadata.horizontal_res)*this.canvas.width,g=m[f].y/this.metadata.vertical_res*this.canvas.height;d.push({x:h,y:g})}var v=new b.Polygon(d,{strokeWidth:1,stroke:"green",opacity:.5,scaleX:1,scaleY:1,objectCaching:!1,transparentCorners:!1,cornerColor:"blue",originX:"center",originY:"center"}),y=new b.Text(n[o].local_id,{fontSize:20,centerX:"center",top:d[0].y,left:d[0].x,uniScaleTransform:!1,fill:"white"}),_=new b.Group([v,y],{perPixelTargetFind:!0});_.lockMovementY=!0,_.lockMovementX=!0,_.selectable=!1,_.local_id=n[o].local_id,a.push(_)}e.push(a)}else e.push([])}return console.log(e),e}}]),e}()),y=a(123).fabric;a(215);function _(e,t,a){var n=a.points[this.pointIndex].x-a.pathOffset.x,o=a.points[this.pointIndex].y-a.pathOffset.y;return y.util.transformPoint({x:n,y:o},y.util.multiplyTransformMatrices(a.canvas.viewportTransform,a.calcTransformMatrix()))}function E(e,t,a,n){var o=t.target,i=o.controls[o.__corner],l=o.toLocalPoint(new y.Point(a,n),"center","center"),r=o._getNonTransformedDimensions(),c=o._getTransformedDimensions(0,0),s={x:l.x*r.x/c.x+o.pathOffset.x,y:l.y*r.y/c.y+o.pathOffset.y};return o.points[i.pointIndex]=s,!0}function O(e){var t=e.getActiveObject();if(console.log(t),void 0!=t&&null!=t){var a;if("group"===t.type){a=t._objects[0];var n=t._objects[1].text;a.local_id=n,t.destroy(),e.remove(t),e.add(a)}else"polygon"===t.type&&(a=t);if(e.setActiveObject(a),a.edit=!a.edit,a.edit){var o=a.points.length-1;a.cornerStyle="rectangle",a.cornerColor="yellow",a.controls=a.points.reduce((function(e,t,a){var n,i;return e["p"+a]=new y.Control({positionHandler:_,actionHandler:(n=a>0?a-1:o,i=E,function(e,t,a,o){var l=t.target,r=y.util.transformPoint({x:l.points[n].x-l.pathOffset.x,y:l.points[n].y-l.pathOffset.y},l.calcTransformMatrix()),c=i(e,t,a,o),s=(l._setPositionDimensions({}),l._getNonTransformedDimensions()),u=(l.points[n].x-l.pathOffset.x)/s.x,d=(l.points[n].y-l.pathOffset.y)/s.y;return l.setPositionByOrigin(r,u+.5,d+.5),c}),actionName:"modifyPolygon",pointIndex:a}),e}),{})}else{a.cornerColor="blue",a.cornerStyle="rect",a.controls=y.Object.prototype.controls,void 0==a.local_id&&alert("Error - missing poly.local_id. Please report this bug in the bug tracker and the steps taken to reproduce this.");var i=a.get("points"),l=new y.Polygon(i,{strokeWidth:1,stroke:"green",opacity:.5,scaleX:1,scaleY:1,objectCaching:!1,transparentCorners:!1,cornerColor:"blue",originX:"center",originY:"center"}),r=new y.Text(a.local_id.toString(),{fontSize:20,top:a.points[0].y,left:a.points[0].x,uniScaleTransform:!1,fill:"white"}),c=new y.Group([l,r]);c.local_id=a.local_id,c.lockMovementY=!0,c.lockMovementX=!0,c.selectable=!0,e.remove(a),e.add(c),console.log(e.getObjects())}a.hasBorders=!a.edit,e.requestRenderAll()}else alert("Please select a segmentation")}var j=a(123).fabric,w=a(215),k=function(){function e(){Object(m.a)(this,e)}return Object(f.a)(e,[{key:"generate_polygon",value:function(e,t,a){var n,o=!0,i=new Array,l=new Array,r=!1,c=!1;e.forEachObject((function(e){e.selectable=!1})),e.selection=!1;var s=new function(){e.on("mouse:down",(function(e){e.target&&e.target.id===i[0].id&&0==c&&(s.polygon.generatePolygon(i),c=!0),o&&s.polygon.addPoint(e)})),e.on("mouse:up",(function(e){})),e.on("mouse:move",(function(t){if(n&&"line"==n.class){var a=e.getPointer(t.e,!1);n.set({x2:a.x,y2:a.y});var o=r.get("points");o[i.length]={x:a.x,y:a.y},r.set({points:o}),e.renderAll()}}))};s.polygon={drawPolygon:function(){o=!0,i=new Array,l=new Array},addPoint:function(t){var a=e.getPointer(t.e,!1),o=Math.floor(999901*Math.random())+99,c=(new Date).getTime()+o,s=new j.Circle({id:c,radius:2,fill:"#ffffff",stroke:"#333333",strokeWidth:.5,left:a.x,top:a.y,selectable:!1,hasBorders:!1,hasControls:!1,originX:"center",originY:"center",objectCaching:!1});s.selectable=!1,0===i.length?s.set({fill:"red",zindex:1}):s.set({zindex:0});var u=[a.x,a.y,a.x,a.y],d=new j.Line(u,{strokeWidth:2,fill:"#999999",stroke:"#999999",class:"line",originX:"center",originY:"center",selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1});if(r){(u=r.get("points")).push({x:a.x,y:a.y});var m=new j.Polygon(u,{stroke:"#333333",strokeWidth:1,fill:"#cccccc",opacity:.3,selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1});e.remove(r),e.add(m),r=m,e.renderAll()}else{var f=[{x:a.x,y:a.y}];console.log(f);m=new j.Polygon(f,{stroke:"#333333",strokeWidth:1,fill:"#cccccc",opacity:.3,selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1});r=m,e.add(m)}n=d,i.push(s),l.push(d),e.add(s),e.selection=!1},generatePolygon:function(i){var c=new Array;w.each(i,(function(t,a){c.push({x:a.left,y:a.top}),e.remove(a)})),w.each(l,(function(t,a){e.remove(a)})),console.log(i),console.log(l);var s=new j.Polygon(c,{strokeWidth:1,stroke:"green",opacity:.5,scaleX:1,scaleY:1,objectCaching:!1,transparentCorners:!1,cornerColor:"blue",originX:"center",originY:"center"});s.local_id=t,s.lockMovementY=!0,s.lockMovementX=!0,console.log(t),console.log(s),e.remove(r),a();var u=new j.Text(t.toString(),{fontSize:20,centerX:"center",top:i[0].top,left:i[0].left,uniScaleTransform:!1,fill:"white"}),d=new j.Group([s,u],{perPixelTargetFind:!0,hasControls:!1,hasBorders:!1});d.lockMovementY=!0,d.lockMovementX=!0,d.local_id=t,console.log(d),e.add(d),console.log(d._objects[0]),console.log(d),e.remove(n),e.remove(r),n=null,r=null,o=!1,e.forEachObject((function(e){e.selectable=!0}))}}}}]),e}(),C=a(208),S=[{value:"Feeding",label:"Feeding"},{value:"Drinking",label:"Drinking"},{value:"Exploratory",label:"Exploratory"},{value:"Social",label:"Social"},{value:"Locomotion",label:"Locomotion"},{value:"Proximity",label:"Proximity"},{value:"Others",label:"Others"}],x=[{value:"Lying",label:"Lying"},{value:"Sitting",label:"Sitting"},{value:"Kneeling",label:"Kneeling"},{value:"Standing",label:"Standing"}],T=[{value:"No occlusion",label:"No occlusion"},{value:"Minor occlusion",label:"Minor occlusion"},{value:"Split occlusion",label:"Split occlusion"},{value:"End occlusion",label:"End occlusion"},{value:"Critical occlusion",label:"Critical occlusion"}],A=a(39),M=function(e){return[{dataField:"id",text:"ID",headerStyle:function(){return{width:"40px",left:0}},editable:!1},{dataField:"global_id",text:"Glo",headerStyle:function(){return{width:"70px",left:0}}},{dataField:"posture",text:"Posture",editor:{type:C.Type.SELECT,options:x}},{dataField:"behavior",text:"Behavior",editor:{type:C.Type.SELECT,options:S}},{dataField:"confidence",text:"Confidence",editor:{type:C.Type.SELECT,options:T}},{dataField:"remove",text:"Del",editable:!1,headerStyle:function(){return{width:"50px",left:0}},headerFormatter:function(){return o.a.createElement("div",null,"Del",o.a.createElement(A.a,{className:"btn btn-danger btn-xs",onClick:function(){return e()},label:"Del"}))},formatter:function(t,a){return o.a.createElement("div",null,o.a.createElement(A.a,{className:"btn btn-danger btn-xs",onClick:function(){return e(a.id)},label:"Del"}))}}]},N=a(161),I=a(206),R=a(636),P=a(293),D=a(57),F=a(51),B=a(637),V=a(48),U=a(285),L=a.n(U);a(322);function z(){return o.a.createElement("div",null,o.a.createElement("h3",null,"Keybinds:"),"There are preset keybinds setup to make it easier to use the tool without having to click around. If done properly a combination of mouse and keyboard actions speed up the annotation process.",o.a.createElement("br",null),o.a.createElement("br",null),"* ",o.a.createElement("kbd",null,"1")," : Mode Switch: Behavior",o.a.createElement("br",null),"* ",o.a.createElement("kbd",null,"2")," : Mode Switch: Bounding Box",o.a.createElement("br",null),"* ",o.a.createElement("kbd",null,"3")," : Mode Switch: Segmentation",o.a.createElement("br",null),"* ",o.a.createElement("kbd",null,"a")," : Add annotation",o.a.createElement("br",null),"* ",o.a.createElement("kbd",null,"e")," : Skip forward frame(s)",o.a.createElement("br",null),"* ",o.a.createElement("kbd",null,"q")," : Skip backward frame(s)",o.a.createElement("br",null),"* ",o.a.createElement("kbd",null,"w")," : Pause/Play",o.a.createElement("br",null),"* ",o.a.createElement("kbd",null,"c")," : Copy previous annotation",o.a.createElement("br",null),"* ",o.a.createElement("kbd",null,"f")," : Activate/Deactivate scrub mode (Activated by default)",o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("h3",null,"Uploading Video:"),'Ensure that you know the framerate of the video chosen to be annotated. These values should be entered into the settings tab into their "frame rate" fields.',o.a.createElement("br",null),o.a.createElement("br",null),"Click on the right side browse button. All other buttons on the screen shuold be disabled until the video has been uploaded. Currenntly ```.mp4``` format is the best choice and tested for. Other file types such as .avi are supported but might have unintended bugs.",o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("h3",null,"Annotations"),o.a.createElement("br",null),"There are currently three kinds of annotations.",o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("h4",null,"Behavior Annotation:"),"This is for having annotations that do not have any visual attribute attached to it. This annotation is also attached by default when the bounding box or segmentation annotation is created.",o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("h4",null,"Bounding Box:"),"This forms a square around the desired object. There should be small squares at the edges of the bounding box which can be used to resize the box. The number on the top left of the box is used to identify the placement of the box in the table to the right.",o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("h4",null,"Segmentation:"),'Upon generating this each click on the video generates a point which eventually will transform to a set of interconnected points. To complete the polygon click on the original point generated (which is the red colored point) If there is a need to edit, then click on the "Edit Seg" button to start the editing process.')}var Y=a(8),X=a.n(Y),K=a(12),H=a(148),J=Object(H.b)({name:"frame_data",initialState:{data:[]},reducers:{init:function(e,t){for(var a=[],n=0;n<t.payload;n++)a.push([]);e.data=a},initOldAnnotation:function(e,t){e.data=t.payload},modifyFrame:function(e,t){var a=e.data;a[t.payload.currentFrame]=t.payload.data,e.data=a},middleware:function(e){return e({serializableCheck:!1})}}}),W=J.actions,q=(W.init,W.modifyFrame,J.reducer),G=Object(H.b)({name:"annotation_data",initialState:{data:[]},reducers:{init:function(e,t){console.log(t.payload);for(var a=[],n=0;n<t.payload;n++)a.push([]);e.data=a},initOldAnnotation:function(e,t){e.data=t.payload},modifyFrame:function(e,t){console.log(t.payload);var a=e.data;a[t.payload.currentFrame]=t.payload.data,e.data=a},middleware:function(e){return e({serializableCheck:!1})}}}),Z=G.actions,Q=(Z.init,Z.modifyFrame,G.reducer),$={data:void 0},ee=Object(H.b)({name:"column_annot",initialState:$,reducers:{init:function(e,t){console.log(t.payload.data),e.data=t.payload.data},middleware:function(e){return e({serializableCheck:!1})}}}),te=(ee.actions.init,ee.reducer),ae=Object(H.a)({reducer:{frame_data:q,annotation_data:Q,column_annot:te}});function ne(e){ae.dispatch({type:"frame_data/init",payload:e})}function oe(e,t){ae.dispatch({type:"frame_data/modifyFrame",payload:{currentFrame:e,data:t}})}function ie(e){return ae.getState().frame_data.data[e]}function le(e){ae.dispatch({type:"annotation_data/init",payload:e})}function re(e,t){ae.dispatch({type:"annotation_data/modifyFrame",payload:{currentFrame:e,data:t}})}function ce(e){return ae.getState().annotation_data.data[e]}function se(e,t,a,n,o){return ue.apply(this,arguments)}function ue(){return(ue=Object(K.a)(X.a.mark((function e(t,a,n,o,i){var l,r,c,s,u;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l="generated_annotations",""!==t&&""!==a&&(l=t.split(".").slice(0,-1).join(".")+"_"+a),console.log(o),r=JSON.stringify({vid_metadata:i,annotations:ae.getState().frame_data.data,behavior_data:ae.getState().annotation_data.data}),c=new Blob([r],{type:"application/json"}),e.next=7,URL.createObjectURL(c);case 7:s=e.sent,(u=document.createElement("a")).href=s,u.download=l+".json",document.body.appendChild(u),u.click(),document.body.removeChild(u);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function de(e,t){console.log(t);for(var a=new Array(e.length+1),n=0;n<a.length;n++)a[n]=[];a[0].push("frame_num");for(n=0;n<t.length;n++)a[0].push(t[n].dataField);for(n=0;n<e.length;n++){for(var o=0;o<e[n].length;o++){a[n+1][o]=[];var i=e[n][o],l=Object.keys(i).map((function(e){return i[e]}));a[n+1][o]=n+","+l.join(",")}a[n+1]=a[n+1].join("\n")}return a=a.join("\n")}function me(){return(me=Object(K.a)(X.a.mark((function e(t,a,n,o){var i,l,r,c,s;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="generated_annotations",""!==t&&""!==a&&(i=t.split(".").slice(0,-1).join(".")+"_"+a),l=de(n,o("")),r=new Blob([l],{type:"application/octet-stream"}),e.next=6,URL.createObjectURL(r);case 6:c=e.sent,(s=document.createElement("a")).href=c,s.download=i+".csv",document.body.appendChild(s),s.click(),document.body.removeChild(s);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}a(621),a(620);var fe=a(316);function he(e){return ge.apply(this,arguments)}function ge(){return(ge=Object(K.a)(X.a.mark((function e(t){return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return alert("Loading model\nThis might take a second or so..."),e.next=3,fe.load();case 3:e.sent.dispose(),fe.load({base:t});case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var pe=a(527),be=(a(253),a(123).fabric),ve=a(215),ye=function(){var e=Object(K.a)(X.a.mark((function e(){return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"pascal",4,e.next=4,pe.load({base:"pascal",quantizationBytes:4});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function _e(e,t,a,n,o){return Ee.apply(this,arguments)}function Ee(){return(Ee=Object(K.a)(X.a.mark((function e(t,a,n,o,i){var l;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l=document.getElementsByTagName("video")[0],console.log(l.height),ye().then((function(e){return e.segment(l)})).then((function(e){var a=e.segmentationMap,n=e.width,o=e.height;e.legend;console.log(a),console.log(t.getHeight()),console.log(t.getWidth());var i=new ImageData(a,n,o),l=document.createElement("canvas");l.setAttribute("id","_temp_canvas"),l.width=n,l.height=o,l.getContext("2d").putImageData(i,0,0),be.Image.fromURL(l.toDataURL(),(function(e){e.left=0,e.top=0,e.opacity=.5,e.scaleX=t.getHeight()/o,e.scaleY=t.getWidth()/n,t.add(e),e.bringToFront(),l=null,ve("#_temp_canvas").remove(),t.renderAll()}))}));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Oe=function(){function e(t,a,n,o){Object(m.a)(this,e),this.frame_data=t,this.canvas=a,this.metadata=n,this.image_data=o}return Object(f.a)(e,[{key:"get_frame_json",value:function(){console.log(this.frame_data[0][0].get("type"));var e=new Array(this.frame_data.length);console.log(this.metadata);for(var t=0;t<this.frame_data.length;t++){var a=[];if(this.frame_data[t]!=[]){var n=this.frame_data[t];if(void 0!=n){for(var o=0;o<n.length;o++)if(console.log(n[o]._objects),"group"===n[o].get("type"))if("rect"===n[o]._objects[0].type){console.log(n[o]);var i=n[o].left/this.canvas.width*this.metadata.horizontal_res,l=n[o].top/this.canvas.height*this.metadata.vertical_res,r=n[o].width*n[o].scaleX/this.canvas.width*this.metadata.horizontal_res,c=n[o].height*n[o].scaleY/this.canvas.height*this.metadata.vertical_res,s=n[o]._objects[1].text;0!=this.image_data.length?a.push({type:"bounding_box",x:i,y:l,width:r,height:c,local_id:s,"fileName:":this.image_data[t].name,dataType:"image"}):a.push({type:"bounding_box",x:i,y:l,width:r,height:c,local_id:s,"fileName:":this.metadata.name,dataType:"video"})}else if("polygon"===n[o]._objects[0].type){for(var u=n[o]._objects[0].points,d=[],m=0;m<u.length;m++){i=u[m].x/this.canvas.width*this.metadata.horizontal_res,l=u[m].y/this.canvas.height*this.metadata.vertical_res;d.push({x:i,y:l})}s=n[o]._objects[1].text;0!=this.image_data.length?a.push({type:"segmentation",points:d,local_id:s,"fileName:":this.image_data[t].name,dataType:"image"}):a.push({type:"segmentation",points:d,local_id:s,"fileName:":this.metadata.name,dataType:"video"})}e[t]=a}}}return e}},{key:"get_frame_json_fullCanvas",value:function(){var e=new Array(this.frame_data.length);console.log(this.metadata);for(var t=0;t<this.frame_data.length;t++){var a=[];if(this.frame_data[t]!=[]){var n=this.frame_data[t].objects;if(void 0!=n){for(var o=0;o<n.length;o++)if(console.log(n[o]),"group"===n[o].type)if("rect"===n[o].objects[0].type){console.log(n[o]);var i=n[o].left/this.canvas.width*this.metadata.horizontal_res,l=n[o].top/this.canvas.height*this.metadata.vertical_res,r=n[o].width*n[o].scaleX/this.canvas.width*this.metadata.horizontal_res,c=n[o].height*n[o].scaleY/this.canvas.height*this.metadata.vertical_res,s=n[o].objects[1].text;0!=this.image_data.length?a.push({type:"bounding_box",x:i,y:l,width:r,height:c,local_id:s,"fileName:":this.image_data[t].name,dataType:"image"}):a.push({type:"bounding_box",x:i,y:l,width:r,height:c,local_id:s,"fileName:":this.metadata.name,dataType:"video"})}else if("polygon"===n[o].objects[0].type){for(var u=n[o].objects[0].points,d=[],m=0;m<u.length;m++){i=u[m].x/this.canvas.width*this.metadata.horizontal_res,l=u[m].y/this.canvas.height*this.metadata.vertical_res;d.push({x:i,y:l})}s=n[o].objects[1].text;0!=this.image_data.length?a.push({type:"segmentation",points:d,local_id:s,"fileName:":this.image_data[t].name,dataType:"image"}):a.push({type:"segmentation",points:d,local_id:s,"fileName:":this.metadata.name,dataType:"video"})}e[t]=a}}}return e}},{key:"get_frame_coco",value:function(){}}]),e}(),je=a(191),we=a(640);function ke(e,t,a){return Ce.apply(this,arguments)}function Ce(){return(Ce=Object(K.a)(X.a.mark((function e(t,a,n){var o,i,l,r,c,s,u,d,m,f,h,g,p;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=document.getElementById("process_vid"),i=o.duration*t,console.log(i),console.log(o.duration),l=document.createElement("canvas"),r=l.getContext("2d"),c=[o.videoWidth,o.videoHeight],s=c[0],u=c[1],l.width=s,l.height=u,d=[],r.drawImage(o,0,0,s,u),m=l.toDataURL(),d.push(m),o.addEventListener("seeked",Object(K.a)(X.a.mark((function e(){return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:f&&f();case 1:case"end":return e.stop()}}),e)})))),h=1;case 15:if(!(h<i)){e.next=28;break}return g=parseFloat(h/i*o.duration),console.log(g),o.currentTime=g,n((h/(i-1)*100).toFixed(2).toString()+"%completed    |   "+(h+1).toString()+"/"+i.toString()+" frames processed."),e.next=22,new Promise((function(e){return f=e}));case 22:r.drawImage(o,0,0,s,u),p=l.toDataURL(),d.push(p);case 25:h+=a,e.next=15;break;case 28:return e.abrupt("return",d);case 29:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Se=[];function xe(e){var t=Object(n.useState)(!0),a=Object(u.a)(t,2),i=a[0],l=a[1],r=function(){return l(!1)},c=Object(n.useState)(null),s=Object(u.a)(c,2),d=s[0],m=s[1],f=Object(n.useState)(""),h=Object(u.a)(f,2),g=h[0],p=h[1],b=function(e){p(e)};return console.log(Se),o.a.createElement(V.a,{show:i,onHide:r,size:"lg"},o.a.createElement(V.a.Header,{closeButton:!0},o.a.createElement(V.a.Title,null,"Processing Video...")),o.a.createElement(V.a.Body,null,o.a.createElement("div",null,o.a.createElement("video",{id:"process_vid",style:{objectFit:"contain",height:"100%",width:"100%"},src:e.video_link}),o.a.createElement(A.a,{onClick:function(t){if(0!==e.frame_rate){a=ke(e.frame_rate);m(a),Se=a,console.log(a)}else var a=ke(15,15,b).then((function(e){m(e),Se=e,console.log(e)}))},enable:null!=d},"Process Video"),g,null!=d&&o.a.createElement(je.a,{controls:!0,fade:!0,style:{objectFit:"contain",height:"100%",width:"100%"}},d.map((function(e){return o.a.createElement(je.a.Item,null,"eee",o.a.createElement(we.a,{className:"mb-5 box-shadow",top:!0,width:"100%"},o.a.createElement(we.a.Img,{style:{objectFit:"contain",height:"100%",width:"100%"},src:e})))}))))),o.a.createElement(V.a.Footer,null,o.a.createElement(A.a,{variant:"secondary",onClick:r},"Close")))}function Te(e){var t=Object(n.useState)(!1),a=Object(u.a)(t,2),i=a[0],l=a[1],r=Object(n.useState)(!0),c=Object(u.a)(r,2),s=c[0],d=c[1],m=Object(n.useState)(0),f=Object(u.a)(m,2),h=f[0],g=f[1],p=Object(n.useState)(0),b=Object(u.a)(p,2),v=b[0],y=b[1],_=Object(n.useState)(0),E=Object(u.a)(_,2),O=E[0],j=E[1],w=Object(n.useState)(""),k=Object(u.a)(w,2),C=k[0],S=k[1],x=Object(n.useState)(""),T=Object(u.a)(x,2),M=T[0],U=T[1],Y=Object(n.useState)(!1),X=Object(u.a)(Y,2),K=X[0],H=X[1],J=Object(n.useState)(!1),W=Object(u.a)(J,2),q=(W[0],W[1],Object(n.useState)({})),G=Object(u.a)(q,2),Z=(G[0],G[1]),Q=function(){return l(!1)},$=function(){d(!1),H(!0)},ee=function(e){"string"===typeof e?(S(e.target.value),console.log(e.target.value)):S(URL.createObjectURL(e.target.files[0]))},te=function(e){return new Promise((function(t,a){var n=new FileReader;n.onload=function(e){t(JSON.parse(e.target.result))},n.readAsText(e.target.files[0])}))};return o.a.createElement("div",null,2==K&&o.a.createElement(xe,{frame_rate:v,video_link:C}),o.a.createElement(V.a,{show:i,onHide:Q,size:"lg"},o.a.createElement(V.a.Header,{closeButton:!0},o.a.createElement(V.a.Title,null,"Instructions")),o.a.createElement(V.a.Body,null,o.a.createElement(z,null)),o.a.createElement(V.a.Footer,null,o.a.createElement(A.a,{variant:"secondary",onClick:Q},"Close"))),o.a.createElement(V.a,{show:s,onHide:$,size:"lg"},o.a.createElement(V.a.Header,{closeButton:!0},o.a.createElement(V.a.Title,null,"Upload")),o.a.createElement(V.a.Body,null,o.a.createElement("div",{style:{display:"grid"}},o.a.createElement(D.a,{style:{float:"left",gridColumn:1,gridRow:1,zIndex:99}},"Video Format:",o.a.createElement(D.a.Control,{as:"select",id:"inlineFormCustomSelect",onChange:function(t){var a;a=t.target.value,console.log(a),0===(a=parseInt(a))?j(0):1===a?j(1):2===a&&(j(2),e.handleInputType(1))},defaultValue:O},o.a.createElement("option",{value:"0"},"Upload"),o.a.createElement("option",{value:"1"},"Youtube"),o.a.createElement("option",{value:"2"},"Image")),o.a.createElement(R.a.Divider,null)),o.a.createElement("div",{style:{float:"left",gridColumn:1,gridRow:2,zIndex:99}},"Annotator Name: ",o.a.createElement("input",{type:"text",defaultValue:e.ANNOTATOR_NAME,onClick:function(t){e.toggleKeyCheck(!1)},onBlur:function(t){e.toggleKeyCheck(!0)},onChange:function(t){e.change_annotator_name(t.target.value)}}),o.a.createElement(R.a.Divider,null)),o.a.createElement("div",{style:{float:"left",gridColumn:1,gridRow:3,zIndex:99}},"Date and Time:",o.a.createElement(L.a,{selected:h,onChange:function(t){!function(t){g(t);try{e.setDateTime(Math.floor(t.getTime()/1e3))}catch(a){alert("Invalid date input!")}}(t)},timeInputLabel:"Time:",dateFormat:"yyyy/MM/dd hh:mm",showTimeInput:!0,onClick:function(t){e.toggleKeyCheck(!1)},onClickOutside:function(t){e.toggleKeyCheck(!0)},onCalendarOpen:function(t){e.toggleKeyCheck(!1)},onCalendarClose:function(t){e.toggleKeyCheck(!0)}}),o.a.createElement(R.a.Divider,null)),0===O&&o.a.createElement(D.a,{style:{float:"left",gridColumn:1,gridRow:4}},o.a.createElement(D.a.File,{multiple:!0,id:"file",label:"Video Upload",accept:".mp4",custom:!0,type:"file",onChange:function(t){e.handleVideoUpload(t),ee(t)}})),1===O&&o.a.createElement("div",null,"Youtube URL:",o.a.createElement("input",{onChange:ee}),o.a.createElement(A.a,{onClick:function(t){e.handleVideoUpload(C)}},"Upload")),2===O&&o.a.createElement(D.a,{style:{float:"left",gridColumn:1,gridRow:4}},o.a.createElement(D.a.File,{multiple:!0,id:"file",label:"Image-set Upload",accept:"image/*",custom:!0,type:"file",onChange:function(t){e.handleVideoUpload(t),ee(t)}})),o.a.createElement(D.a,{style:{float:"left",gridColumn:1,gridRow:5}},o.a.createElement(D.a.File,{disabled:e.disable_buttons,accept:".json",id:"file",label:"Annotation Upload",custom:!0,type:"file",onChange:e.handleOldAnnotation})),o.a.createElement(D.a,{style:{float:"left",gridColumn:1,gridRow:6}},o.a.createElement(D.a.File,{disabled:e.disable_buttons,accept:".json",id:"file",label:"Column Upload",custom:!0,type:"file",onChange:function(e){te(e).then((function(e){var t;null!=e?(Z(e),console.log(e),t=e,ae.dispatch({type:"column_annot/init",payload:{data:t}}),alert("Column data upload successful.")):alert("Error in processing columns")}))}})),o.a.createElement(R.a.Divider,null),"Frame Rate: ",o.a.createElement("input",{type:"number",value:e.frame_rate,onClick:function(t){e.toggleKeyCheck(!1)},onBlur:function(t){e.toggleKeyCheck(!0)},onChange:function(t){e.setFrameRate(parseInt(t.target.value)),y(parseInt(t.target.value))}}),o.a.createElement(R.a.Divider,null),"Skip Value: ",o.a.createElement("input",{type:"number",defaultValue:"1",onChange:function(t){e.change_skip_value(parseInt(t.target.value))}}),"Playback Rate: ",o.a.createElement("input",{type:"number",defaultValue:"1",onChange:function(t){e.handleSetPlaybackRate(parseInt(t.target.value))}}),o.a.createElement(R.a.Divider,null),o.a.createElement("div",null,"Enable Object Detection Model:"," ",o.a.createElement("select",{defaultValue:M,onChange:function(e){U(e.target.value)},id:"base_model"},o.a.createElement("option",{value:""},"Select"),o.a.createElement("option",{value:"lite_mobilenet_v2"},"SSD Lite Mobilenet V2"),o.a.createElement("option",{value:"mobilenet_v1"},"SSD Mobilenet v1"),o.a.createElement("option",{value:"mobilenet_v2"},"SSD Mobilenet v2"))," ",o.a.createElement(A.a,{size:"sm",variant:"outline-success",onClick:function(e){""===M&&alert("Please select a model"),he(M)}},"Enable")),o.a.createElement(R.a.Divider,null))),o.a.createElement(V.a.Footer,null,o.a.createElement(A.a,{variant:"success",onClick:$},"Upload"))),o.a.createElement(N.a,{sticky:"top",bg:"dark",variant:"dark",className:"bg-5"},o.a.createElement(N.a.Brand,{href:"#home"},"AVAT"),o.a.createElement(I.a,{className:"mr-auto"},o.a.createElement(R.a,{disabled:e.disable_buttons,title:"Export",id:"basic-nav-dropdown"},o.a.createElement(R.a.Item,{onClick:function(){var t=new Oe(ae.getState().frame_data.data,e.fabricCanvas,e.VIDEO_METADATA,e.image_frames).get_frame_json();se(e.ANNOTATION_VIDEO_NAME,e.ANNOTATOR_NAME,t,e.annotation_data,e.VIDEO_METADATA)}},"JSON"),o.a.createElement(R.a.Divider,null)),o.a.createElement(P.a,{onClick:function(){return l(!0)}},"Instructions"),o.a.createElement(P.a,{onClick:e.handle_link_open},"Report")),o.a.createElement("div",null,M.length>0&&o.a.createElement(A.a,{id:"run",variant:"outline-info",onClick:function(t){_e(e.fabricCanvas,e.annotation_data,e.currentFrame,e.save_data,e.handle_visual_toggle),e.handle_visual_toggle()}},"Run model"),o.a.createElement(A.a,{variant:"outline-success",onClick:function(){return d(!0)}},"Upload")," "," ",o.a.createElement(F.a,{as:B.a},o.a.createElement(A.a,{variant:"secondary",disabled:!0},e.display_frame_num)," ",o.a.createElement(F.a.Toggle,{split:!0,variant:"secondary",id:"dropdown-split-basic"}),o.a.createElement(F.a.Menu,null,"Skip Value: ",o.a.createElement("input",{type:"number",defaultValue:"1",onChange:function(t){e.change_skip_value(parseInt(t.target.value))}}),"Playback Rate: ",o.a.createElement("input",{type:"number",defaultValue:"1",onChange:function(t){e.handleSetPlaybackRate(parseInt(t.target.value))}})))," ",o.a.createElement(A.a,{variant:"primary",disabled:e.disable_buttons,onClick:e.skip_frame_backward},"Prev")," ",o.a.createElement(A.a,{variant:"primary",disabled:e.disable_buttons,onClick:e.handlePlaying},e.play_button_text)," ",o.a.createElement(A.a,{variant:"primary",disabled:e.disable_buttons,onClick:e.skip_frame_forward},"Next")," ",o.a.createElement(F.a,{as:B.a,drop:"left"},o.a.createElement(A.a,{variant:"success",onClick:e.addToCanvas},"Add"),o.a.createElement(F.a.Toggle,{split:!0,variant:"success",id:"dropdown-split-basic"}),o.a.createElement(F.a.Menu,null,o.a.createElement(F.a.Item,{onClick:function(t){e.change_annotation_type("1")}},"Behavior Annotation"),o.a.createElement(F.a.Item,{onClick:function(t){e.change_annotation_type("2")}},"BoundingBox"),o.a.createElement(F.a.Item,{onClick:function(t){e.change_annotation_type("3")}},"Segmentation"))))))}var Ae=a(46),Me=a(47),Ne=function(e){Object(Ae.a)(a,e);var t=Object(Me.a)(a);function a(){return Object(m.a)(this,a),t.apply(this,arguments)}return Object(f.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=l.a.findDOMNode(this);this.props.fabricCanvas.initialize(t,{height:this.props.scaling_factor_height,width:this.props.scaling_factor_width,backgroundColor:null}),this.props.fabricCanvas.on("mouse:up",(function(){e.props.save_data(e.props.currentFrame)})),this.props.fabricCanvas.on("object:added",this.props.save_data(this.props.currentFrame)),this.props.fabricCanvas.on("object:removed",this.props.save_data(this.props.currentFrame)),this.props.fabricCanvas.on("object:modified",this.props.save_data(this.props.currentFrame)),this.props.fabricCanvas.on("saveData",(function(){e.props.fabricCanvas.renderAll()}))}},{key:"render",value:function(){return o.a.createElement("canvas",{id:"canvas"})}}]),a}(o.a.Component),Ie=(a(570),a(607),a(608),a(445));function Re(e){var t=e.columns,a=e.data,n=e.select_data,i=Object(Ie.useTable)({columns:t,data:a}),l=i.getTableProps,r=i.getTableBodyProps,c=i.headerGroups,s=i.rows,u=i.prepareRow;return t?(console.log(a),o.a.createElement("table",Object.assign({},l(),{style:{border:"solid 1px blue"}}),o.a.createElement("thead",null,c.map((function(e){return o.a.createElement("tr",e.getHeaderGroupProps(),e.headers.map((function(e){return o.a.createElement("th",Object.assign({},e.getHeaderProps(),{style:{background:"#657",color:"white",fontWeight:"bold"}}),e.render("Header"))})))}))),o.a.createElement("tbody",r(),s.map((function(e,a){u(e);e.id,e.global_id,e.posture,e.behavior,e.confidence;return function(e,t,a){for(var n=[],i=0;i<a[0].columns.length;i++){var l=a[0].columns[i].accessor;if(Pe(t,l)){var r=o.a.createElement("select",{defaultValue:e[l]},o.a.createElement("option",{value:""}),t[l].map((function(e,t){return o.a.createElement("option",{value:e.value},e.value)})));n.push(r)}}return o.a.createElement("tr",{key:e.id},o.a.createElement("td",null,e.id),o.a.createElement("td",null,o.a.createElement("input",{type:"text",style:{width:"50%"}})),n.map((function(e,t){return o.a.createElement("td",null,e)})))}(e.original,n,t)}))))):o.a.createElement("div",null,"No column upload detected.")}function Pe(e,t){for(var a=Object.keys(e),n=0;n<a.length;n++)if(a[n]===t)return!0;return!1}function De(e){!function(){var e=ae.getState().annotation_data.data,t=[];if(!e)return t;for(var a=0;a<e.length;a++)if(0!==e[a].length){for(var n="",o="",i=0;i<e[a].length;i++)n+=e[a][i].id+", ",o+=e[a][i].global_id+", ";t.push({frame_num:a,anno_count:e[a].length,local_ids:n,global_ids:o})}}();var t=JSON.parse(JSON.stringify(e.annotation_data)),a=[],n=[],i=void 0;return void 0!=ae.getState().column_annot.data&&(n=ae.getState().column_annot.data.columns,i=ae.getState().column_annot.data.select_data,a.push(n)),o.a.createElement("div",null,0!=n.length&&o.a.createElement(Re,{columns:a,data:t,select_data:i}))}var Fe=a(123).fabric,Be=15,Ve=-1,Ue=1920,Le=1080,ze=1,Ye=window.screen.height;Ye>=1080?(Ue=1280,Le=720):Ye>=1024?(Ue=1152,Le=648):Ye>=768&&(Ue=1024,Le=576);var Xe,Ke,He=new Fe.Canvas("c",{uniScaleTransform:!0,uniformScaling:!1,includeDefaultValues:!1});He.on("mouse:over",(function(e){null==e.target|1==it||void 0!=e.target._objects&&(Ke=e.target._objects[0].get("fill"),e.target._objects[0].set("fill","#39FF14"),He.renderAll())})),He.on("mouse:out",(function(e){null==e.target|1==it||void 0!=e.target._objects&&(e.target._objects[0].set("fill",Ke),He.renderAll())})),Fe.Image.prototype.toObject=(Xe=Fe.Image.prototype.toObject,function(){return Fe.util.object.extend(Xe.call(this),{src:this.toDataURL()})}),He.on("mouse:wheel",(function(e){var t=e.e.deltaY,a=He.getZoom();(a*=Math.pow(.999,t))>20&&(a=20),a<.01&&(a=.01),He.zoomToPoint({x:e.e.offsetX,y:e.e.offsetY},a),e.e.preventDefault(),e.e.stopPropagation()})),He.on("mouse:down",(function(e){var t=e.e;!0===t.altKey&&(this.isDragging=!0,this.selection=!1,this.lastPosX=t.clientX,this.lastPosY=t.clientY)})),He.on("mouse:move",(function(e){if(this.isDragging){var t=e.e,a=this.viewportTransform;a[4]+=t.clientX-this.lastPosX,a[5]+=t.clientY-this.lastPosY,this.requestRenderAll(),this.lastPosX=t.clientX,this.lastPosY=t.clientY}})),He.on("mouse:up",(function(e){this.setViewportTransform(this.viewportTransform),this.isDragging=!1,this.selection=!0}));var Je,We=0,qe=0,Ge=!1,Ze=!0,Qe="",$e="",et="",tt={},at="ERROR",nt=!1,ot=0,it=!1,lt=!1,rt=[],ct=0,st=0;function ut(){var e=Object(n.useState)(0),t=Object(u.a)(e,2),a=(t[0],t[1]),i=Object(n.useState)("1"),l=Object(u.a)(i,2),r=l[0],m=l[1],f=Object(n.useState)(0),h=Object(u.a)(f,2),g=h[0],b=h[1],y=Object(n.useState)(null),_=Object(u.a)(y,2),E=_[0],O=_[1],j=Object(n.useState)(null),w=Object(u.a)(j,2),k=w[0],C=w[1],S=Object(n.useState)(null),x=Object(u.a)(S,2),T=x[0],A=x[1],N=Object(n.useState)(0),I=Object(u.a)(N,2),R=I[0],P=I[1],D=Object(n.useState)(!1),F=Object(u.a)(D,2),B=F[0],V=F[1],U=Object(n.useState)(!1),L=Object(u.a)(U,2),z=L[0],Y=L[1],X=Object(n.useState)(!0),K=Object(u.a)(X,2),H=K[0],J=K[1],W=Object(n.useState)(1),q=Object(u.a)(W,2),G=q[0],Z=q[1],Q=Object(n.useState)(0),$=Object(u.a)(Q,2),ee=$[0],te=$[1],se=Object(n.useState)(0),ue=Object(u.a)(se,2),de=ue[0],me=ue[1],fe=Object(n.useState)(0),he=Object(u.a)(fe,2),ge=he[0],pe=he[1],be=Object(n.useState)([]),ve=Object(u.a)(be,2),ye=ve[0],_e=ve[1],Ee=Object(n.useState)([]),Oe=Object(u.a)(Ee,2),je=Oe[0],we=Oe[1];it||He.forEachObject((function(e){e.selectable=!0,e.evented=!0})),1==ee&&(Je=rt.length),console.log(He.getObjects());var ke=function(e){console.log("Saved data"),0!=He.getObjects().length?oe(e,He.getObjects()):oe(e,[]),re(e,je)},Ce=function(e){if(1==ee)return st=e,gt(),void(Je=rt.length);if(Je=R*Be,ft(),"number"===typeof e){st=e,a(Math.floor(999999999999*Math.random()));var t=e/Je;t>R&&(t=R),T.seekTo(t)}else{ke(st);var n=e.played;if(n=Math.floor(e.played*Je),("Play"===at&&!0===nt)|"Pause"===at){if(n>=Je)return st=Je-1,a(Math.floor(999999999999*Math.random())),void(nt=!1);st=n,a(Math.floor(999999999999*Math.random())),nt=!1}a(Math.floor(999999999999*Math.random()))}},Se=function(e){console.log(e);for(var t=1,a=0;a<je.length;a++)if(je[a].id==e){t=a;break}if(-1===t&&alert("bug: "+e),"f"!==e.substring(e.length-1,e.length)){var n=He.getObjects();console.log(n);for(a=0;a<n.length;a++)if(console.log(n[a]),n[a]._objects[1].text===e){console.log("REMOVED"),He.remove(n[a]),He.fire("saveData"),He.renderAll();break}}console.log("CURRENT FRAME: "+st);var o=Object(s.a)(je);o.splice(t,1),we(o),_e(He.getObjects()),ke(st)},xe=function(){0!=je.length&&pe(st)},Ae=function(){var e="#"+((1<<24)*Math.random()|0).toString(16);if(null==je&&we([]),1!=it){var t="error";if("2"===r){t="b";new p(He.height/2,He.width/2,50,50,e,g+"b","None").generate_no_behavior(He)}else if("4"===r)alert("KeyPoint annotation are currently unavailable"),t="k";else{if("3"===r)return t="s",void alert("Segmentation has been disabled for this version. Please use an earlier version.");"1"===r&&(t="f")}we(1===ee?function(e){return[].concat(Object(s.a)(e),[{id:g+t,global_id:"",behavior:"",posture:"",confidence:"",dataType:"image",fileName:rt[st].name}])}:function(e){return[].concat(Object(s.a)(e),[{id:g+t,global_id:"",status:"",current:"",behavior:"",posture:"",confidence:"",dataType:"video",fileName:"frame_"+st}])}),b(g+1),He.fire("saveData")}else alert("Please finish your current segmentation!")},Me=function(e){it=!it};Object(n.useEffect)((function(){null!=k&&(ae.dispatch({type:"frame_data/initOldAnnotation",payload:k.get_frame_data()}),ae.dispatch({type:"annotation_data/initOldAnnotation",payload:k.get_annotation_data()}),_e(k.get_frame_data()[0]),we(k.get_annotation_data()[0]),b(k.find_highest_localid()))}),[k]),Object(n.useEffect)((function(){0!=ye.length&&gt(),oe(st,ye),re(st,je)}),[ye,je]);var Ie=function(e){return new Promise((function(t,a){var n=new FileReader;n.onload=function(e){t(JSON.parse(e.target.result))},n.readAsText(e.target.files[0])}))},Re=function(e){"Pause"===at&&(nt=!0),Y(!z),xe()};!0===z?(at="Pause",ct=100):(at="Play",ct=0);var Pe=Object(n.useState)(!0),Ye=Object(u.a)(Pe,2),Xe=Ye[0],Ke=Ye[1],ut=function(e){xe(),ke(st);var t=st+ze;if(t>=Je){if(1===ee)return st=Je-1,_e(ie(Je-1)),void we(ce(Je-1));_e(ie(Je-1)),we(ce(Je-1)),Ce(Je-1)}else{if(1===ee)return st=t,_e(ie(t)),void we(ce(t));_e(ie(t)),we(ce(t)),Ce(t)}},dt=function(e){xe(),ke(st);var t=st-ze;if(t<0){if(1===ee)return st=0,_e(ie(0)),void we(ce(0));_e(ie(0)),we(ce(0)),Ce(0)}else{if(1===ee)return st=t,_e(ie(t)),void we(ce(t));_e(ie(t)),we(ce(t)),Ce(t)}};Object(n.useEffect)((function(){(1===ee||0!=R)&&gt()}),[st]);var mt=function(e){if(!1!==H)if(!0!==it){if("2"===e.key)Qe="Mode Switch: Bounding Box",V(!0),m("2");else if("4"===e.key)Qe="Mode Switch: Key Point",V(!0),m("4");else if("3"===e.key)Qe="Mode Switch: Segmentation",V(!0),m("3");else if("1"===e.key)Qe="Mode Switch: Behavior Annotation",V(!0),m("1");else if("a"===e.key){var t="";"2"===r?t="Bounding Box":"1"===r?t="Behavior Data":"4"===r?t="Keypoint":"3"===r&&(t="Segmentation"),Qe="Added Annotation - "+t,"3"!==r&&V(!0),Ae()}else if("q"===e.key)dt();else if("w"===e.key)gt(),Re();else if("e"===e.key)ut();else if("f"===e.key)!1===Xe?(Qe="Scrubbing Mode Activated",Ke(!0),V(!0)):(Qe="Scrubbing Mode Deactivated",Ke(!1),V(!0));else if("c"===e.key){Qe="Copying previous frame annotation",we(JSON.parse(JSON.stringify(ce(ge))));var a=ie(ge);Fe.util.enlivenObjects(a,(function(e){for(var t=0;t<e.length;t++)e[t].local_id=a[t].local_id,He.add(e[t]);_e(e)})),V(!0)}}else alert("Please finish your current action!")};Object(n.useEffect)((function(){return document.addEventListener("keydown",mt),function(){return document.removeEventListener("keydown",mt)}}),[mt]);var ft=function(){a(Math.floor(999999999999*Math.random()))},ht=function(e){console.log("Keycheck activated"),J(void 0===e?!H:e)},gt=function(){if(console.log("updated canvas"),1==ee)return(i=new Image).onload=function(){if(He.clear(),void 0!=ye)for(var e=0;e<ye.length;e++)He.add(ye[e]);tt={name:et,duration:R,horizontal_res:i.width,vertical_res:i.height,frame_rate:Be,time:ot};var t=new Fe.Image(i,{objectCaching:!1,scaleX:Ue/i.width,scaleY:Le/i.height});console.log("CURRFRAME: "+st),He.setBackgroundImage(t),He.renderAll(),me(st)},void(i.src=URL.createObjectURL(rt[st]));if(0==ee){var e=document.getElementsByTagName("video")[0],t=document.createElement("canvas"),a=t.getContext("2d"),n=Ue,o=Le;t.width=Ue,t.height=Le,a.drawImage(e,0,0,n,o);var i,l=t.toDataURL();(i=new Image).onload=function(){if(He.clear(),void 0!=ye)for(var e=0;e<ye.length;e++)He.add(ye[e]);var a=new Fe.Image(i,{objectCaching:!1,scaleX:Ue/i.width,scaleY:Le/i.height});He.setBackgroundImage(a),He.renderAll(),t.remove(),me(st)},i.src=l}};return o.a.createElement("div",null,o.a.createElement(Te,{disable_buttons:Ze,video_width:We,video_height:qe,skip_value:ze,ANNOTATOR_NAME:$e,handleOldAnnotation:function(e){Ie(e).then((function(e){null!=e?C(new v(e,He)):alert("Error in processing Annotation")}))},handleVideoUpload:function(e){if(1===ee&&(le((rt=e.target.files).length),ne(rt.length),Ze=!1),"string"===typeof e)return O(e),et=e,void(Ge=!0);et=e.target.files[0].name,O(URL.createObjectURL(e.target.files[0])),Ge=!0},currentFrame:st,display_frame_num:"Frame #"+parseInt(st+1)+" / "+parseInt(Je),skip_frame_forward:ut,skip_frame_backward:dt,handlePlaying:Re,play_button_text:at,addToCanvas:Ae,ANNOTATION_VIDEO_NAME:et,change_skip_value:function(e){ze=e},change_annotator_name:function(e){$e=e},change_annotation_type:function(e){m(e)},VIDEO_METADATA:tt,handleSetPlaybackRate:function(e){isNaN(e)?Z(0):e>16?(alert("Max playback rate is 16!"),Z(16)):Z(e)},toggleKeyCheck:ht,setFrameRate:function(e){if((Be=parseInt(e))>120)Be=120;else if(Be<=0)Be=1;else if(0==Number.isFinite(Be))return void(Be=1);Ve=Math.round(R*Be),0==je.length?(Je=R*e,console.log("Resetting frame_data and annotation_data"),ne(Ve),le(Ve)):alert("There is data currently annotated! To change frame rate refresh the page and re-upload!")},frame_rate:Be,setDateTime:function(e){tt={name:et,duration:R,horizontal_res:We,vertical_res:qe,frame_rate:Be,time:ot=e}},fabricCanvas:He,save_data:ke,handle_visual_toggle:ft,handleInputType:function(e){0==e|1==e?te(e):alert("ERROR VALUE SET - Please report this bug!\n")},image_frames:rt,toggle_segmentation:Me}),o.a.createElement(d.a,{onClose:function(){return V(!1)},show:B,delay:500,autohide:!0,style:{position:"absolute",top:"100",left:"100",zIndex:"100"}},o.a.createElement(d.a.Header,null,o.a.createElement("strong",{className:"mr-auto"},Qe))),!0===Ge&&o.a.createElement("div",{style:{display:"grid"},show:Ge},o.a.createElement("div",{style:{gridColumn:1,gridRow:1,position:"relative",width:Ue,height:Le,top:0,left:0,opacity:ct}},0==ee&&o.a.createElement(c.a,{onReady:function(e){0==lt&&(gt(),lt=!0)},ref:function(e){if(null!=e&&null!=e.player&&null!=e.player.player&&null!=e.player.player){We=e.player.player.player.videoWidth,qe=e.player.player.player.videoHeight;var t=e.player.player.player.duration;tt={name:et,duration:t,horizontal_res:We,vertical_res:qe,frame_rate:Be,time:ot}}A(e)},onDuration:function(e){!0===Ge&&null!=T&&(Ve=Math.round(e*Be),0==je.length&&(console.log("Resetting frame_data and annotation_data"),ne(Ve),le(Ve)),Ze=!1),Je=parseInt(e)*Be,P(parseInt(e))},url:E,width:"100%",height:"100%",playing:z,controls:!1,style:{position:"absolute",float:"left",top:0,left:0},volume:0,muted:!0,pip:!1,playbackRate:G,id:"myvideo"})),o.a.createElement("div",{style:{gridColumn:1,gridRow:1,position:"relative",top:0,left:0,opacity:100-ct}},o.a.createElement(Ne,{fabricCanvas:He,currentFrame:st,save_data:ke,scaling_factor_height:Le,scaling_factor_width:Ue})),o.a.createElement("div",{style:{gridColumn:2,gridRow:1,position:"relative",width:.4*Ue,height:Le,top:0,left:0}},o.a.createElement(De,{annotation_data:je,change_annotation_data:function(e){we(e)},currentFrame:de,toggleKeyCheck:ht,columns:M,remove_table_index:function(e){if(void 0===e){for(var t=[],n=0;n<je.length;n++)t.push(je[n].id);t.map((function(e){return Se(e)}))}else Se(e);console.log(je),a(Math.floor(999999999999*Math.random()))},handleSetCurrentFrame:Ce}))))}le(1),ne(1);a(123).fabric;function dt(e){var t=Object(n.useState)(!1),a=Object(u.a)(t,2),i=a[0],l=a[1],r=Object(n.useState)(!0),c=Object(u.a)(r,2),s=c[0],d=c[1],m=Object(n.useState)(0),f=Object(u.a)(m,2),h=f[0],g=f[1],p=Object(n.useState)(0),b=Object(u.a)(p,2),v=b[0],y=b[1],_=Object(n.useState)(0),E=Object(u.a)(_,2),j=(E[0],E[1],Object(n.useState)(0)),w=Object(u.a)(j,2),k=(w[0],w[1],Object(n.useState)(0)),C=Object(u.a)(k,2),S=(C[0],C[1],Object(n.useState)(2)),x=Object(u.a)(S,2),T=x[0],M=x[1],U=Object(n.useState)(""),Y=Object(u.a)(U,2),X=Y[0],K=Y[1],H=Object(n.useState)(""),J=Object(u.a)(H,2),W=J[0],q=J[1],G=Object(n.useState)(!1),Z=Object(u.a)(G,2),Q=Z[0],$=Z[1],ee=Object(n.useState)(!1),te=Object(u.a)(ee,2),ae=te[0],ne=te[1],oe=function(){return l(!1)},ie=function(){d(!1),$(!0)},le=function(e){"string"===typeof e?(K(e.target.value),console.log(e.target.value)):K(URL.createObjectURL(e.target.files[0]))},re=function(t){ne(!ae),O(e.fabricCanvas,e.save_data),e.toggle_segmentation()};return o.a.createElement("div",null,2==Q&&o.a.createElement(xe,{frame_rate:v,video_link:X}),o.a.createElement(V.a,{show:i,onHide:oe,size:"lg"},o.a.createElement(V.a.Header,{closeButton:!0},o.a.createElement(V.a.Title,null,"Instructions")),o.a.createElement(V.a.Body,null,o.a.createElement(z,null)),o.a.createElement(V.a.Footer,null,o.a.createElement(A.a,{variant:"secondary",onClick:oe},"Close"))),o.a.createElement(V.a,{show:s,onHide:ie,size:"lg"},o.a.createElement(V.a.Header,{closeButton:!0},o.a.createElement(V.a.Title,null,"Upload")),o.a.createElement(V.a.Body,null,o.a.createElement("div",{style:{display:"grid"}},o.a.createElement(D.a,{style:{float:"left",gridColumn:1,gridRow:1,zIndex:99}},"Video Format:",o.a.createElement(D.a.Control,{as:"select",id:"inlineFormCustomSelect",onChange:function(t){var a;a=t.target.value,console.log(a),0===(a=parseInt(a))?M(0):1===a?M(1):2===a&&(M(2),e.handleInputType(1))},defaultValue:T},o.a.createElement("option",{value:"2"},"Image")),o.a.createElement(R.a.Divider,null)),o.a.createElement("div",{style:{float:"left",gridColumn:1,gridRow:2,zIndex:99}},"Annotator Name: ",o.a.createElement("input",{type:"text",defaultValue:e.ANNOTATOR_NAME,onClick:function(t){e.toggleKeyCheck(!1)},onBlur:function(t){e.toggleKeyCheck(!0)},onChange:function(t){e.change_annotator_name(t.target.value)}}),o.a.createElement(R.a.Divider,null)),o.a.createElement("div",{style:{float:"left",gridColumn:1,gridRow:3,zIndex:99}},o.a.createElement("text",null,"Date and Time: "),o.a.createElement(L.a,{selected:h,onChange:function(t){!function(t){g(t);try{e.setDateTime(Math.floor(t.getTime()/1e3))}catch(a){alert("Invalid date input!")}}(t)},timeInputLabel:"Time:",dateFormat:"yyyy/MM/dd hh:mm",showTimeInput:!0,onClick:function(t){e.toggleKeyCheck(!1)},onClickOutside:function(t){e.toggleKeyCheck(!0)},onCalendarOpen:function(t){e.toggleKeyCheck(!1)},onCalendarClose:function(t){e.toggleKeyCheck(!0)}}),o.a.createElement(R.a.Divider,null)),0===T&&o.a.createElement(D.a,{style:{float:"left",gridColumn:1,gridRow:4}},o.a.createElement(D.a.File,{multiple:!0,id:"file",label:"Video Upload",accept:".mp4",custom:!0,type:"file",onChange:function(t){e.handleVideoUpload(t),le(t)}})),1===T&&o.a.createElement("div",null,o.a.createElement("text",null,"Youtube URL: "),o.a.createElement("input",{onChange:le}),o.a.createElement(A.a,{onClick:function(t){e.handleVideoUpload(X)}},"Upload")),2===T&&o.a.createElement("div",null,o.a.createElement(D.a,{style:{float:"left",gridColumn:1,gridRow:4}},o.a.createElement(D.a.File,{multiple:!0,id:"file",label:"Image-set 1 Upload",accept:"image/*",custom:!0,type:"file",onChange:function(t){e.handleVideoUpload(t),le(t)}})),o.a.createElement(D.a,{style:{float:"left",gridColumn:1,gridRow:4}},o.a.createElement(D.a.File,{multiple:!0,id:"file",label:"Image-set 2 Upload",accept:"image/*",custom:!0,type:"file",onChange:function(t){e.handleVideoUpload(t),le(t)}})),o.a.createElement(D.a,{style:{float:"left",gridColumn:1,gridRow:4}},o.a.createElement(D.a.File,{multiple:!0,id:"file",label:"Image-set 3 Upload",accept:"image/*",custom:!0,type:"file",onChange:function(t){e.handleVideoUpload(t),le(t)}}))),o.a.createElement(D.a,{style:{float:"left",gridColumn:1,gridRow:5}},o.a.createElement(D.a.File,{disabled:e.disable_buttons,accept:".json",id:"file",label:"Annotation Upload",custom:!0,type:"file",onChange:e.handleOldAnnotation})),o.a.createElement(R.a.Divider,null),"Frame Rate: ",o.a.createElement("input",{type:"number",value:e.frame_rate,onClick:function(t){e.toggleKeyCheck(!1)},onBlur:function(t){e.toggleKeyCheck(!0)},onChange:function(t){e.setFrameRate(parseInt(t.target.value)),y(parseInt(t.target.value))}}),o.a.createElement(R.a.Divider,null),"Skip Value: ",o.a.createElement("input",{type:"number",defaultValue:"1",onChange:function(t){e.change_skip_value(parseInt(t.target.value))}}),"Playback Rate: ",o.a.createElement("input",{type:"number",defaultValue:"1",onChange:function(t){e.handleSetPlaybackRate(parseInt(t.target.value))}}),o.a.createElement(R.a.Divider,null),o.a.createElement("div",null,"Enable Object Detection Model:"," ",o.a.createElement("select",{defaultValue:W,onChange:function(e){q(e.target.value)},id:"base_model"},o.a.createElement("option",{value:""},"Select"),o.a.createElement("option",{value:"lite_mobilenet_v2"},"SSD Lite Mobilenet V2"),o.a.createElement("option",{value:"mobilenet_v1"},"SSD Mobilenet v1"),o.a.createElement("option",{value:"mobilenet_v2"},"SSD Mobilenet v2"))," ",o.a.createElement(A.a,{size:"sm",variant:"outline-success",onClick:function(e){""===W&&alert("Please select a model"),he(W)}},"Enable")),o.a.createElement(R.a.Divider,null))),o.a.createElement(V.a.Footer,null,o.a.createElement(A.a,{variant:"success",onClick:ie},"Upload"))),o.a.createElement(N.a,{sticky:"top",bg:"dark",variant:"dark",className:"bg-5"},o.a.createElement(N.a.Brand,{href:"#home"},"AVAT"),o.a.createElement(I.a,{className:"mr-auto"},o.a.createElement(R.a,{disabled:e.disable_buttons,title:"Export",id:"basic-nav-dropdown"},o.a.createElement(R.a.Item,{onClick:function(){var t=new Oe(e.frame_data,e.fabricCanvas,e.VIDEO_METADATA,e.image_frames).get_frame_json();se(e.ANNOTATION_VIDEO_NAME,e.ANNOTATOR_NAME,t,e.annotation_data,e.VIDEO_METADATA)}},"JSON"),o.a.createElement(R.a.Divider,null),o.a.createElement(R.a.Item,{onClick:function(){!function(e,t,a,n){me.apply(this,arguments)}(e.ANNOTATION_VIDEO_NAME,e.ANNOTATOR_NAME,e.annotation_data,e.columns)}},"CSV")),o.a.createElement(P.a,{onClick:function(){return l(!0)}},"Instructions"),o.a.createElement(P.a,{onClick:e.handle_link_open},"Report")),o.a.createElement("div",null,W.length>0&&o.a.createElement(A.a,{id:"run",variant:"outline-info",onClick:function(t){_e(e.fabricCanvas,e.annotation_data,e.currentFrame,e.save_data,e.handle_visual_toggle),e.handle_visual_toggle()}},"Run model"),o.a.createElement(A.a,{variant:"outline-success",onClick:function(){return d(!0)}},"Upload")," ",!1===ae&&o.a.createElement(A.a,{variant:"outline-success",onClick:re},"Edit Seg"),!0===ae&&o.a.createElement(A.a,{variant:"outline-success",onClick:re},"Confirm")," ",o.a.createElement(F.a,{as:B.a},o.a.createElement(A.a,{variant:"secondary",disabled:!0},e.display_frame_num)," ",o.a.createElement(F.a.Toggle,{split:!0,variant:"secondary",id:"dropdown-split-basic"}),o.a.createElement(F.a.Menu,null,"Skip Value: ",o.a.createElement("input",{type:"number",defaultValue:"1",onChange:function(t){e.change_skip_value(parseInt(t.target.value))}}),"Playback Rate: ",o.a.createElement("input",{type:"number",defaultValue:"1",onChange:function(t){e.handleSetPlaybackRate(parseInt(t.target.value))}})))," ",o.a.createElement(A.a,{variant:"primary",disabled:e.disable_buttons,onClick:e.skip_frame_backward},"Prev")," ",o.a.createElement(A.a,{variant:"primary",disabled:e.disable_buttons,onClick:e.handlePlaying},e.play_button_text)," ",o.a.createElement(A.a,{variant:"primary",disabled:e.disable_buttons,onClick:e.skip_frame_forward},"Next")," ",o.a.createElement(F.a,{as:B.a,drop:"left"},o.a.createElement(A.a,{variant:"success",onClick:e.addToCanvas},"Add"),o.a.createElement(F.a.Toggle,{split:!0,variant:"success",id:"dropdown-split-basic"}),o.a.createElement(F.a.Menu,null,o.a.createElement(F.a.Item,{onClick:function(t){e.change_annotation_type("1")}},"Behavior Annotation"),o.a.createElement(F.a.Item,{onClick:function(t){e.change_annotation_type("2")}},"BoundingBox"),o.a.createElement(F.a.Item,{onClick:function(t){e.change_annotation_type("3")}},"Segmentation"))))))}a(624);"undefined"===typeof Storage&&alert("Your browser does not support local storage. \nSome autosaving features of the app will not work as intended.\nPlease see the documentation to find supported browsers and their versions");var mt=a(123).fabric,ft=15,ht=-1,gt=1920,pt=1080,bt=1;console.log(window.screen.width),console.log(window.screen.height);var vt=window.screen.height;vt>=1080?(gt=1280,pt=720):vt>=1024?(gt=1152,pt=648):vt>=768&&(gt=1024,pt=576);var yt,_t=new mt.Canvas("c",{uniScaleTransform:!0,uniformScaling:!1,includeDefaultValues:!1});_t.on("mouse:over",(function(e){null==e.target|1==Dt||void 0!=e.target._objects&&(yt=e.target._objects[0].get("fill"),e.target._objects[0].set("fill","#39FF14"),_t.renderAll())})),_t.on("mouse:out",(function(e){null==e.target|1==Dt||void 0!=e.target._objects&&(e.target._objects[0].set("fill",yt),_t.renderAll())})),mt.Image.prototype.toObject=function(e){return function(){return mt.util.object.extend(e.call(this),{src:this.toDataURL()})}}(mt.Image.prototype.toObject),_t.on("mouse:wheel",(function(e){var t=e.e.deltaY,a=_t.getZoom();(a*=Math.pow(.999,t))>20&&(a=20),a<.01&&(a=.01),_t.zoomToPoint({x:e.e.offsetX,y:e.e.offsetY},a),e.e.preventDefault(),e.e.stopPropagation()})),_t.on("mouse:down",(function(e){var t=e.e;!0===t.altKey&&(this.isDragging=!0,this.selection=!1,this.lastPosX=t.clientX,this.lastPosY=t.clientY)})),_t.on("mouse:move",(function(e){if(this.isDragging){var t=e.e,a=this.viewportTransform;a[4]+=t.clientX-this.lastPosX,a[5]+=t.clientY-this.lastPosY,this.requestRenderAll(),this.lastPosX=t.clientX,this.lastPosY=t.clientY}})),_t.on("mouse:up",(function(e){this.setViewportTransform(this.viewportTransform),this.isDragging=!1,this.selection=!0}));var Et,Ot=0,jt=0,wt=[[]],kt=[[]],Ct=!1,St=!0,xt="",Tt=[],At=[],Mt="",Nt="",It={},Rt="ERROR",Pt=!1,Dt=!1,Ft=[],Bt=[],Vt=[],Ut=0;function Lt(e){0!=_t.getObjects().length?(wt[e]=_t.getObjects(),wt[e].backgroundImage=null):wt[e]=[],console.log("SAVED")}function zt(){var e=Object(n.useState)(0),t=Object(u.a)(e,2),a=(t[0],t[1]),i=Object(n.useState)("1"),l=Object(u.a)(i,2),r=l[0],c=l[1],s=Object(n.useState)(0),m=Object(u.a)(s,2),f=m[0],h=m[1],g=Object(n.useState)(null),b=Object(u.a)(g,2),y=(b[0],b[1]),_=Object(n.useState)(null),E=Object(u.a)(_,2),O=(E[0],E[1],Object(n.useState)(null)),j=Object(u.a)(O,2),w=(j[0],j[1],Object(n.useState)(null)),C=Object(u.a)(w,2),S=C[0],x=C[1],T=Object(n.useState)(null),A=Object(u.a)(T,2),N=A[0],I=(A[1],Object(n.useState)(0)),R=Object(u.a)(I,2),P=R[0],D=(R[1],Object(n.useState)(!1)),F=Object(u.a)(D,2),B=(F[0],F[1],Object(n.useState)(!1)),V=Object(u.a)(B,2),U=V[0],L=V[1],z=Object(n.useState)(!1),Y=Object(u.a)(z,2),X=(Y[0],Y[1],Object(n.useState)(!1)),K=Object(u.a)(X,2),H=K[0],J=K[1],W=Object(n.useState)(!0),q=Object(u.a)(W,2),G=q[0],Z=q[1],Q=Object(n.useState)(1),$=Object(u.a)(Q,2),ee=($[0],$[1]),te=Object(n.useState)(1),ae=Object(u.a)(te,2),ne=ae[0],oe=(ae[1],Object(n.useState)(0)),ie=Object(u.a)(oe,2),le=ie[0],re=ie[1],ce=Object(n.useState)(0),se=Object(u.a)(ce,2),ue=se[0];se[1];Dt||_t.forEachObject((function(e){e.selectable=!0,e.evented=!0}));var de=function(e){if(Et=P*ft,ke(),"number"===typeof e){re(e),a(Math.floor(999999999999*Math.random()));var t=e/Et;t>P&&(t=P),N.seekTo(t)}else{Lt(le);var n=e.played;if(n=Math.floor(e.played*Et),("Play"===Rt&&!0===Pt)|"Pause"===Rt){if(n>=Et)return re(Et-1),a(Math.floor(999999999999*Math.random())),void(Pt=!1);re(n),a(Math.floor(999999999999*Math.random())),Pt=!1}a(Math.floor(999999999999*Math.random()))}},me=function(e){for(var t=0,a=0;a<kt[le].length;a++)if(kt[le][a].id==e){t=a;break}if("f"!==e.substring(e.length-1,e.length)){var n=_t.getObjects();for(a=0;a<n.length;a++)if(console.log(n[a]),n[a]._objects[1].text===e){console.log("REMOVED"),console.log(n[a]),_t.remove(n[a]),_t.fire("saveData"),_t.renderAll();break}}kt[le].splice(t,1),Lt(le)},fe=function(){0!=kt[le].length&&(Tt=kt[le],At=wt[le])},he=function(){var e="#"+((1<<24)*Math.random()|0).toString(16);if(null==kt[le]&&(kt[le]=[]),1!=Dt){var t="error";if("2"===r){t="b";new p(_t.height/2,_t.width/2,50,50,e,f+"b","None").generate_no_behavior(_t)}else if("4"===r)alert("KeyPoint annotation are currently unavailable"),t="k";else if("3"===r){t="s";(new k).generate_polygon(_t,f+"s",ge);ge()}else"1"===r&&(t="f");1===ne?kt[le].push({id:f+t,global_id:"",status:"",current:"",behavior:"",posture:"",notes:"",confidence:"",dataType:"image",fileName:Ft[le].name}):kt[le].push({id:f+t,global_id:"",status:"",current:"",behavior:"",posture:"",notes:"",confidence:"",dataType:"video",fileName:"frame_"+le}),Lt(le),h(f+1),_t.fire("saveData")}else alert("Please finish your current segmentation!")},ge=function(e){Dt=!Dt};Object(n.useEffect)((function(){null!=S&&(wt=S.get_frame_data(),kt=S.get_annotation_data(),ke(),Se(),console.log(S.get_frame_data()))}),[S]);var pe=function(e){return new Promise((function(t,a){var n=new FileReader;n.onload=function(e){t(JSON.parse(e.target.result))},n.readAsText(e.target.files[0])}))},be=function(e){"Pause"===Rt&&(Pt=!0),J(!H),fe()};!0===H?(Rt="Pause",Ut=100):(Rt="Play",Ut=0);var ve=Object(n.useState)(!0),ye=Object(u.a)(ve,2),_e=ye[0],Ee=ye[1],Oe=function(e){fe();var t=le+bt;if(t>=Et){if(1===ne)return void re(Et-1);de(Et-1)}else{if(1===ne)return void re(t);de(t)}},je=function(e){fe();var t=le-bt;if(t<0){if(1===ne)return void re(0);de(0)}else{if(1===ne)return void re(t);de(t)}};Object(n.useEffect)((function(){1===ne&&Se()}),[le]);var we=function(e){if(!1!==G)if(!0!==Dt)if("2"===e.key)xt="Mode Switch: Bounding Box",L(!0),c("2");else if("4"===e.key)xt="Mode Switch: Key Point",L(!0),c("4");else if("3"===e.key)xt="Mode Switch: Segmentation",L(!0),c("3");else if("1"===e.key)xt="Mode Switch: Behavior Annotation",L(!0),c("1");else if("a"===e.key){var t="";"2"===r?t="Bounding Box":"1"===r?t="Behavior Data":"4"===r?t="Keypoint":"3"===r&&(t="Segmentation"),xt="Added Annotation - "+t,"3"!==r&&L(!0),he()}else"q"===e.key?je():"w"===e.key?(Se(),be()):"e"===e.key?(console.log(_t.toJSON()),Oe()):"s"===e.key?(xt="Annotation Saved",L(!0),wt[le]=_t.toJSON()):"f"===e.key?!1===_e?(xt="Scrubbing Mode Activated",Ee(!0),L(!0)):(xt="Scrubbing Mode Deactivated",Ee(!1),L(!0)):"c"===e.key&&(xt="Copying previous frame annotation",kt[le]=JSON.parse(JSON.stringify(Tt)),wt[le]=JSON.parse(JSON.stringify(At)),mt.util.enlivenObjects(wt[le],(function(e){console.log(e),wt[le]=e;for(var t=0;t<e.length;t++)wt[le][t].local_id=At[t].local_id;Se(),L(!0)})));else alert("Please finish your current action!")};Object(n.useEffect)((function(){return document.addEventListener("keydown",we),function(){return document.removeEventListener("keydown",we)}}),[we]);var ke=function(){a(Math.floor(999999999999*Math.random()))},Ce=function(e){console.log("Keycheck activated"),Z(void 0===e?!G:e)};console.log(document.getElementsByTagName("img")[0]);var Se=function(){console.log("hi"),0!=Ft.length&&0!=Bt.length&&0!=Vt.length&&1==ne&&(document.getElementsByTagName("img")[0].src=URL.createObjectURL(Ft[le]),document.getElementsByTagName("img")[1].src=URL.createObjectURL(Bt[le]),document.getElementsByTagName("img")[2].src=URL.createObjectURL(Vt[le]))};return Se(),o.a.createElement("div",null,o.a.createElement(dt,{disable_buttons:St,video_width:Ot,video_height:jt,skip_value:bt,ANNOTATOR_NAME:Mt,handle_link_open:function(){window.open("https://forms.gle/CrJuYEoT39uFgnR17","_blank")},handleOldAnnotation:function(e){pe(e).then((function(e){null!=e?x(new v(e,_t)):alert("Error in processing Annotation")}))},handleVideoUpload:function(e){if(1===ne){Ft=e.target.files,Et=Ft.length;for(var t=0;t<Et;t++)kt.push([]);Se(),St=!1}Nt=e.target.files[0].name,y(URL.createObjectURL(e.target.files[0])),Ct=!0},currentFrame:le,display_frame_num:"Frame #"+parseInt(le+1)+" / "+parseInt(Et),skip_frame_forward:Oe,skip_frame_backward:je,handlePlaying:be,play_button_text:Rt,addToCanvas:he,ANNOTATION_VIDEO_NAME:Nt,frame_data:wt,change_skip_value:function(e){bt=e},change_annotator_name:function(e){Mt=e},change_annotation_type:function(e){c(e)},annotation_data:kt,VIDEO_METADATA:It,scaling_factor_height:pt,scaling_factor_width:gt,columns:M,handleSetPlaybackRate:function(e){isNaN(e)?ee(0):e>16?(alert("Max playback rate is 16!"),ee(16)):ee(e)},toggleKeyCheck:Ce,setFrameRate:function(e){if((ft=parseInt(e))>120)ft=120;else if(ft<=0)ft=1;else if(0==Number.isFinite(ft))return void(ft=1);if(console.log(Number.isFinite(ft)),console.log(ft),ht=Math.round(P*ft),0==kt[0].length){Et=P*e,console.log("Resetting frame_data and annotation_data"),wt=new Array(ht),kt=new Array(ht);for(var t=0;t<ht;t++)wt[t]=[],kt[t]=[];a(Math.floor(999999999999*Math.random()))}else alert("There is data currently annotated! To change frame rate refresh the page and re-upload!")},frame_rate:ft,setDateTime:function(e){It={name:Nt,duration:P,horizontal_res:Ot,vertical_res:jt,frame_rate:ft,time:e},console.log(e)},fabricCanvas:_t,save_data:Lt,handle_visual_toggle:ke,image_frames:Ft,toggle_segmentation:ge}),o.a.createElement(d.a,{onClose:function(){return L(!1)},show:U,delay:500,autohide:!0,style:{position:"absolute",top:"100",left:"100",zIndex:"100"}},o.a.createElement(d.a.Header,null,o.a.createElement("strong",{className:"mr-auto"},xt))),!0===Ct&&o.a.createElement("div",{style:{display:"grid"},show:Ct},o.a.createElement("div",{style:{gridColumn:1,gridRow:1,position:"relative",width:gt,height:pt,top:0,left:0,opacity:Ut}},o.a.createElement("img",null),o.a.createElement("img",null),o.a.createElement("img",null)),o.a.createElement("div",{style:{gridColumn:1,gridRow:2,position:"relative",width:gt,top:0,left:0}}),o.a.createElement("div",{style:{gridColumn:2,gridRow:1,position:"relative",width:.4*gt,height:pt,top:0,left:0}},o.a.createElement(De,{annotation_data:kt,currentFrame:ue,toggleKeyCheck:Ce,columns:M,remove_table_index:function(e){if(void 0===e){for(var t=[],n=0;n<kt[le].length;n++)t.push(kt[le][n].id);t.map((function(e){return me(e)}))}else me(e);a(Math.floor(999999999999*Math.random()))},handleSetCurrentFrame:de}))))}var Yt=a(638),Xt=a(639),Kt=a(446);var Ht=function(){var e=Object(n.useState)(!1),t=Object(u.a)(e,2),a=t[0],i=t[1],l=function(){return i(!1)},r=Object(n.useState)(!1),c=Object(u.a)(r,2),s=c[0],d=c[1],m=Object(n.useState)(!1),f=Object(u.a)(m,2),h=f[0],g=f[1];return s?o.a.createElement(ut,null):h?o.a.createElement(zt,null):o.a.createElement("div",null,o.a.createElement(V.a,{show:a,onHide:l,size:"lg"},o.a.createElement(V.a.Header,{closeButton:!0},o.a.createElement(V.a.Title,null,"Instructions")),o.a.createElement(V.a.Body,null,o.a.createElement(z,null)),o.a.createElement(V.a.Footer,null,o.a.createElement(A.a,{variant:"secondary",onClick:l},"Close"))),o.a.createElement("main",null,o.a.createElement(Yt.a,{className:"text-center"},o.a.createElement(Xt.a,null,o.a.createElement("h1",{className:"jumbotron-heading"},"AVAT"),o.a.createElement("p",{className:"lead text-muted"}," Analysis tool to record data for livestock behavior and computer vision applications. "),o.a.createElement("p",null,o.a.createElement(A.a,{onClick:function(e){d(!s)},variant:"success",className:"mx-1 my-2"},"Video Upload"),o.a.createElement(A.a,{onClick:function(e){g(!h)},variant:"success"},"Multiview")))),o.a.createElement(je.a,{controls:!1,fade:!0,style:{width:"70%","margin-left":"auto","margin-right":"auto"}},Kt.map((function(e,t){return o.a.createElement(je.a.Item,{interval:e.slide_time},o.a.createElement(we.a,{className:"mb-5 box-shadow",top:!0,width:"100%"},o.a.createElement(we.a.Img,{width:"60%",variant:"top",src:"."+e.src}),o.a.createElement(we.a.Body,{style:{"text-align":"center"}},o.a.createElement(we.a.Title,null,e.altText),o.a.createElement(we.a.Text,null,e.description))))})))))};var Jt=function(){return o.a.createElement("div",null,o.a.createElement(Ht,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Wt=a(448);l.a.render(o.a.createElement(Wt.a,{store:ae},o.a.createElement(Jt,null),","),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[454,1,2]]]);
//# sourceMappingURL=main.7f8f9424.chunk.js.map