{"version":3,"sources":["fabric_types/fabric_boundingbox.js","annotations/bounding_box.js","processing/annotation-processing.js","static_data/behaviors.js","static_data/posture.js","static_data/confidence.js","static_data/columns.js","ui_elements/Components/instructions.js","reducer/frame_data.js","reducer/annotation_data.js","reducer/column_annot.js","reducer/current_frame.js","reducer/media_data.js","store.js","processing/actions.js","processing/download.js","processing/exporting_annotation.js","processing/video_to_frame.js","ui_elements/Components/process_video.js","ui_elements/Components/nav_bar.js","static_data/const.js","ui_elements/Components/fabric_canvas.js","ui_elements/Components/annot_table.js","ui_elements/Components/change_table.js","ui_elements/Pages/main_upload.js","static_data/constants.js","ui_elements/Pages/selection_screen.js","App.js","serviceWorker.js","index.js"],"names":["fabric","require","util","createClass","Rect","type","initialize","options","this","callSuper","set","label","toObject","object","extend","get","_render","ctx","font","fillStyle","fillText","width","height","uniScaleTransform","BoundingBox","top","left","color","id","behavior","hasRotatingPoint","fill","opacity","Text","toString","fontSize","group","Group","rectangle","id_text","borderColor","hasBorders","temp","local_id","toJSON","canvas","isDown","origX","origY","on","o","pointer","getPointer","e","x","y","rect_temp","originX","originY","angle","transparentCorners","add","Math","abs","renderAll","off","behaviors","value","posture","confidence","columns","remove_table_index","dataField","text","headerStyle","editable","editor","Type","SELECT","headerFormatter","Button","className","onClick","formatter","cellContent","row","Instructions","frameDataSlice","createSlice","name","initialState","data","reducers","init","state","payload","i","push","initOldAnnotation","modifyFrame","currentFrame","middleware","getDefaultMiddleware","serializableCheck","actions","annotationDataSlice","console","log","undefined","columnDataSlice","currFrameDataSlice","changeFrame","mediaDataSlice","addMedia","media","stream_num","configureStore","reducer","frame_data","annotation_data","column_annot","current_frame","media_data","initFrameData","frame_count","store","dispatch","initAnnotationData","updateAnnotationData","frame_number","getAnnotationData","JSON","parse","stringify","getState","setCurrentFrame","frame_num","initMedia","num_streams","ANNOTATION_VIDEO_NAME","ANNOTATOR_NAME","VIDEO_METADATA","a","fileName","split","slice","join","json","blob","Blob","URL","createObjectURL","href","link","document","createElement","download","body","appendChild","click","removeChild","ExportingAnnotation","image_data","metadata","standard_annot","Array","length","curr","frame_objects","j","_objects","raw_points","points","k","videoFrameExtract","frame_rate","skip_val","handleText","video","getElementById","total_frames","duration","context","getContext","videoWidth","videoHeight","w","h","frames","drawImage","base64ImageData","toDataURL","addEventListener","seekResolve","new_time","parseFloat","currentTime","toFixed","Promise","r","test_frame","ProcessVideo","props","useState","show","setShow","handleClose","setFrames","setText","event","Modal","onHide","size","Header","closeButton","Title","Body","style","objectFit","src","video_link","then","ret","enable","Carousel","controls","fade","map","Item","Card","Img","Footer","variant","CustomNavBar","uploadShow","setUploadShow","frameRate","setFrameRate","videoFormat","setVideoFormat","videoLink","process","setProcess","columnLoad","setColumnLoad","numStrems","setNumStreams","handleUploadClose","handleMediaUpload","alert","parseInt","target","files","downloadColumn","file","resolve","reject","reader","FileReader","onload","result","readAsText","display","Form","Control","as","onChange","handleInputType","defaultValue","NavDropdown","Divider","toggleKeyCheck","onBlur","File","multiple","accept","custom","uploadButtons","button_image","float","gridColumn","gridRow","key","button_video","but","_","generateUploadButtons","disabled","disable_buttons","column_dat","handleOldAnnotation","change_skip_value","handleSetPlaybackRate","Navbar","sticky","bg","Brand","Nav","title","converted_annot","fabricCanvas","image_frames","get_frame_json","downloadFileJSON","NavLink","handle_link_open","Dropdown","ButtonGroup","display_frame_num","Toggle","Menu","skip_frame_backward","handlePlaying","play_button_text","skip_frame_forward","drop","addToCanvas","change_annotation_type","FabricRender","setFabricCanvas","useEffect","temp_fabricCanvas","Canvas","uniformScaling","includeDefaultValues","Image","prototype","call","opt","delta","deltaY","zoom","getZoom","zoomToPoint","offsetX","offsetY","preventDefault","stopPropagation","evt","altKey","isDragging","selection","lastPosX","clientX","lastPosY","clientY","vpt","viewportTransform","requestRenderAll","setViewportTransform","el","ReactDOM","findDOMNode","canvas_elem","getElementsByTagName","scaling_factor_height","scaling_factor_width","backgroundColor","useSelector","currframe_redux","currFrameData","inputType","image_url","img","clear","enlivenObjects","enlivenedObjects","forEach","obj","index","f_img","objectCaching","scaleX","scaleY","setBackgroundImage","canvasBackgroundUpdate","AnnotTable","select_data","change_annot","useTable","getTableProps","getTableBodyProps","headerGroups","rows","prepareRow","border","headerGroup","getHeaderGroupProps","headers","column","getHeaderProps","background","fontWeight","render","global_id","elem","curr_idx","row_vals","curr_elem","check_keys","data-type","data-curr","change_row","beh","delete_row","genSelection","original","curr_data","dataset","splice","obj_keys","Object","keys","AnnotationTable","col","React","useMemo","accessor","Tabs","defaultActiveKey","Tab","eventKey","handleChangeAnnot","current_screen_height","window","screen","upload","toast_text","segmentation_flag","MainUpload","setVisualToggle","annotationType","setAnnotationType","boxCount","setBoxCount","oldAnnotation","save","changeSave","keyCheck","changeKeyCheck","setInputType","setIsLoading","setCurrFrameData","currAnnotationData","setCurrAnnotationData","annot_redux","column_redux","imagedata_redux","annot","random","annotation_type_txt","generate_no_behavior","generated_annotation","saved_annot","create_annotation","assign","new_data","get_frame_data","get_annotation_data","find_highest_localid","downloadOldAnnotation","frameVal","onKeyPress","annotext","removeEventListener","toggle_val","video_width","video_height","skip_value","handle_visual_toggle","floor","val","Toast","onClose","delay","autohide","position","zIndex","fcanvas","canv","can","genFabricCanvas","change_annotation_data","SelectionScreen","setUpload","Jumbotron","Container","selection_items","item","interval","slide_time","altText","description","App","Boolean","location","hostname","match","navigator","serviceWorker","ready","registration","unregister","catch","error","message"],"mappings":"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","file":"static/js/main.301989a3.chunk.js","sourcesContent":["const fabric = require(\"fabric\").fabric;\n\nvar boundingbox = fabric.util.createClass(fabric.Rect, {\n    type: 'boundingbox',\n    initialize: function(options) {\n        options || (options = { });\n\n        this.callSuper('initialize', options);\n        this.set('label', options.label || '');\n    },\n\n    toObject: function() {\n        return fabric.util.object.extend(this.callSuper('toObject'), {\n            label: this.get('label')\n        });\n    },\n\n    _render: function(ctx) {\n        this.callSuper('_render', ctx);\n\n        ctx.font = '10px Helvetica';\n        ctx.fillStyle = '#333';\n        /* scaleX = this.width / (this.width * this.scaleX),\n        scaleY = this.height / (this.height * this.scaleY); */\n        ctx.fillText(this.label, (-this.width/2), (-this.height/2 + 20));\n        ctx.uniScaleTransform = false;\n    }\n});\n  \nexport {boundingbox};","import { boundingbox } from '../fabric_types/fabric_boundingbox'\nconst fabric = require(\"fabric\").fabric;\n\nclass BoundingBox {\n    constructor(top, left, width, height, color, id, behavior) {\n        this.top = top;\n        this.left = left;\n        this.id = id;\n        this.behavior = behavior;\n        this.color = color;\n        this.width = width;\n        this.height = height;\n    }\n\n    rectangle(){\n        return new fabric.Rect({\n            hasRotatingPoint: false,\n            height: this.height,\n            width: this.width,\n            fill: this.color,\n            opacity: '.4',\n            top: this.top,\n            left: this.left,\n        });\n    } \n\n    //TODO Add text scaling\n    id_text(){\n        return new fabric.Text(this.id.toString(), {\n            fontSize: 20,\n            top: this.top,\n            left: this.left,\n            uniScaleTransform: false,\n          });\n    }\n\n    generate_no_behavior(){\n        var group = new fabric.Group([this.rectangle(), this.id_text()],{\n            borderColor: '#000000',\n            hasBorders: true,\n            uniScaleTransform: true\n        });\n        /* var box = new boundingbox({\n            hasRotatingPoint: false,\n            height: this.height,\n            width: this.width,\n            fill: this.color,\n            opacity: '.4',\n            top: this.top,\n            left: this.left,\n            label: this.id.toString()\n        }) */\n\n        function onChange(obj) {\n            var text_box = obj.target.item(1),\n                group = obj.target,\n                scaleX = group.width / (group.width * group.scaleX),\n                scaleY = group.height / (group.height * group.scaleY);\n            text_box.set('scaleX', scaleX);\n            text_box.set('scaleY', scaleY);\n        }\n        /* canvas.on({\n            'object:scaling': onChange\n        }) */\n\n        var temp = this.id \n        group.local_id = temp\n        //canvas.add(group)\n        //console.log(group.toJSON())\n        return group.toJSON()\n    }\n\n    generate_mouse_no_behavior(canvas){\n        var group, isDown, origX, origY;\n\n        var temp_id = new fabric.Text(this.id.toString(), {\n            fontSize: 20,\n            top: this.top,\n            left: this.left,\n            uniScaleTransform: false,\n          });\n\n        canvas.on('mouse:down', function(o){\n            isDown = true;\n            var pointer = canvas.getPointer(o.e);\n            origX = pointer.x;\n            origY = pointer.y;\n            var pointer = canvas.getPointer(o.e);\n            var rect_temp = new fabric.Rect({\n                left: origX,\n                top: origY,\n                originX: 'left',\n                originY: 'top',\n                width: pointer.x-origX,\n                height: pointer.y-origY,\n                angle: 0,\n                fill: 'rgba(255,0,0,0.5)',\n                transparentCorners: false,\n                uniScaleTransform: true\n            });\n            group = rect_temp\n\n\n            canvas.add(group)\n        });\n        \n        canvas.on('mouse:move', function(o){\n            if (!isDown) return;\n            var pointer = canvas.getPointer(o.e);\n            \n            if(origX>pointer.x){\n                group.set({ left: Math.abs(pointer.x) });\n            }\n            if(origY>pointer.y){\n                group.set({ top: Math.abs(pointer.y) });\n            }\n            \n            group.set({ width: Math.abs(origX - pointer.x) });\n            group.set({ height: Math.abs(origY - pointer.y) });\n            \n            \n            canvas.renderAll();\n        });\n        \n        canvas.on('mouse:up', function(o){\n          isDown = false;\n          canvas.off('mouse:down')\n          canvas.off('mouse:up')\n        });\n    }\n\n}\n\nexport {BoundingBox}","import {BoundingBox} from '../annotations/bounding_box'\nconst fabric = require(\"fabric\").fabric;\nconst $ = require(\"jquery\")\n\nexport default class ExtractingAnnotation{\n    constructor(annotation_json, canvas, image_data){\n        this.frame_data = annotation_json['annotations']\n        this.annotation_data = annotation_json['behavior_data']\n        this.canvas = canvas\n        this.metadata = annotation_json['vid_metadata']\n    }\n\n    get_frame_data(){\n        console.log(this.scale_annotations())\n        return this.scale_annotations()\n    }\n    \n    get_annotation_data(){\n        return this.annotation_data;\n    }\n\n    find_highest_localid(){\n        var localid = []\n        for(var i = 0; i < this.annotation_data.length; i++){\n            for(var j = 0; j < this.annotation_data[i].length; j++){\n                console.log(this.annotation_data[i][j])\n                localid.push(parseInt(this.annotation_data[i][j]['id'].replace(/\\D/g, \"\")))\n            }\n        }\n        console.log(Math.max(...localid))\n        return Math.max(...localid)+1\n    }\n\n    scale_annotations(){\n        var new_annotations = []\n        console.log(this.frame_data)\n        for(var i = 0; i < this.frame_data.length; i++){\n            var temp_data = []\n            var curr_frame = this.frame_data[i]\n            if(curr_frame == null){\n                new_annotations.push([])\n                continue;\n            }\n            for(var j = 0; j < curr_frame.length; j++){\n                if(curr_frame[j]['type'] === \"bounding_box\"){\n                    var x = (parseInt(curr_frame[j]['x']) / parseInt(this.metadata['horizontal_res']) * this.canvas.width) \n                    var y = (curr_frame[j]['y'] / this.metadata['vertical_res'] * this.canvas.height)\n                    var width = ((curr_frame[j]['width']) / this.metadata['horizontal_res'] * this.canvas.width)\n                    var height = ((curr_frame[j]['height']) / this.metadata['vertical_res'] * this.canvas.height)\n\n                    var color = \"#\" + ((1<<24)*Math.random() | 0).toString(16)\n                    var new_bbox = new BoundingBox(y, x, width, height, color, curr_frame[j]['local_id'], \"None\").generate_no_behavior(this.canvas)\n                    //this.canvas.add(new_bbox)\n                    new_bbox.local_id = curr_frame[j]['local_id']\n                    temp_data.push(new_bbox)\n                }else if(curr_frame[j]['type'] === \"segmentation\"){\n                    var points = []\n                    var curr_points = curr_frame[j]['points']\n                    for(var k = 0; k < curr_points.length; k++){\n                        var x_scaled = (parseInt(curr_points[k]['x']) / parseInt(this.metadata['horizontal_res']) * this.canvas.width)\n                        var y_scaled = (curr_points[k]['y'] / this.metadata['vertical_res'] * this.canvas.height)\n                        points.push({x: x_scaled, y: y_scaled})\n                    }\n                    var po = new fabric.Polygon(points, {\n                        strokeWidth: 1,\n                        stroke: 'green',\n                        opacity: .5,\n                        scaleX: 1,\n                        scaleY: 1,\n                        objectCaching: false,\n                        transparentCorners: false,\n                        cornerColor: 'blue',\n                        originX: 'center',\n                        originY: 'center'\n                    });\n                    var display_text = new fabric.Text(curr_frame[j]['local_id'], {\n                        fontSize: 20,\n                        centerX: \"center\",\n                        top: points[0].y,\n                        left: points[0].x, \n                        uniScaleTransform: false,\n                        fill: \"white\",\n                    })\n                    var grouppo = new fabric.Group([po, display_text], {perPixelTargetFind: true})\n                    grouppo.lockMovementY = true;\n                    grouppo.lockMovementX = true;\n                    grouppo.selectable = false;\n                    grouppo.local_id = curr_frame[j]['local_id']\n                    //this.canvas.add(grouppo)\n                    temp_data.push(grouppo)\n                }\n            }\n            new_annotations.push(temp_data)\n        }\n        console.log(new_annotations)\n        return new_annotations\n    }\n}\n\n//This is the parser for the Multi-Camera pig tracking output JSON code. \n/*\nclass MCPT_Processing {\n    constructor(annotation_json){\n        this.objects = annotation_json['objects']\n        console.log(this.objects)\n    }\n\n    getObjects_MCPT() {\n        return this.objects\n    }\n\n    getObjectById_MCPT(id) {\n        return this.objects[id]\n    }\n    \n    getObjectByIdFrame(id, frame_num){\n        return this.objects[id][frame_num]\n    }\n\n    getAllObjectByFrame_MCPT(frame_num){\n        var i;\n        var objects_frame = []\n        for (i = 0; i < this.objects.length; i++){\n            var curr_obj = this.objects[i]\n            if(curr_obj['frames'][curr_obj['frames'].length-1]['frameNumber'] < frame_num){\n                continue;\n            }\n            var curr_obj_frames = curr_obj['frames'];\n            for (var j = 0; j < curr_obj_frames.length; j++){\n                if(curr_obj_frames[j]['frameNumber'] === frame_num){\n                    objects_frame.push(curr_obj_frames[j]);\n                    break;\n                }\n            }\n        }\n        console.log(objects_frame)\n        return objects_frame;\n    }\n}*/","const behaviors = [{\n  value: 'Feeding',\n  label: 'Feeding'\n},{\n  value: 'Drinking',\n  label: 'Drinking'\n},{\n  value: 'Exploratory',\n  label: 'Exploratory'\n},{\n  value: 'Social',\n  label: 'Social'\n},{\n  value: 'Locomotion',\n  label: 'Locomotion'\n},{\n  value: 'Proximity',\n  label: 'Proximity'\n},{\n  value: 'Others',\n  label: 'Others'\n}]\n\nexport {behaviors};\n","const posture = [{\n  value: 'Lying',\n  label: 'Lying'\n},{\n  value: 'Sitting',\n  label: 'Sitting'\n},{\n  value: 'Kneeling',\n  label: 'Kneeling'\n},{\n  value: 'Standing',\n  label: 'Standing'\n}]\n\n  export {posture}","const confidence = [{\n    value: 'No occlusion',\n    label: 'No occlusion'\n  },{\n    value: 'Minor occlusion',\n    label: 'Minor occlusion'\n  },{\n    value: 'Split occlusion',\n    label: 'Split occlusion'\n  },{\n    value: 'End occlusion',\n    label: 'End occlusion'\n  },{\n    value: 'Critical occlusion',\n    label: 'Critical occlusion'\n  }\n]\nexport {confidence};\n","import React from \"react\"; \nimport { Type } from 'react-bootstrap-table2-editor';\nimport {behaviors} from './behaviors'\nimport {posture} from './posture'\nimport {status} from './status'\nimport {confidence} from './confidence'\nimport Button from 'react-bootstrap/Button'\n\nconst columns = (remove_table_index) => [{\n  dataField: \"id\",\n  text: \"ID\",\n  headerStyle: () => { return { width: \"40px\", left: 0 }; },\n  editable: false,\n},{\n  dataField: \"global_id\",\n  text: \"Glo\",\n  headerStyle: () => { return { width: \"70px\", left: 0}; }\n},{\n  dataField: \"posture\",\n  text: \"Posture\",\n  editor: {\n      type: Type.SELECT,\n      options: posture,\n  }\n},\n{\n  dataField: \"behavior\",\n  text: \"Behavior\",\n  editor: {\n      type: Type.SELECT,\n      options: behaviors,\n  }\n},{\n  dataField: \"confidence\",\n  text: \"Confidence\",\n  editor: {\n      type: Type.SELECT,\n      options: confidence,\n  }\n},{\n  dataField: \"remove\",\n  text: \"Del\",\n  editable: false,\n  headerStyle: () => { return { width: \"50px\", left: 0}; },\n  headerFormatter: () => {return (\n    <div>\n      Del\n      <Button\n        className=\"btn btn-danger btn-xs\"\n        onClick={() => remove_table_index()}\n        label=\"Del\"\n      >\n      </Button>\n    </div>\n  );},\n  formatter: (cellContent, row) => {\n    return (\n      <div>        \n        <Button\n          className=\"btn btn-danger btn-xs\"\n            onClick={() => remove_table_index(row.id)}\n            label=\"Del\"\n          >\n        </Button>\n      </div>\n    );\n  },\n}\n]\nexport {columns}\n \n","import React from \"react\"; \n\nexport default function Instructions(){\n    return (\n        <div>\n        <h3>Keybinds:</h3>\n\n        There are preset keybinds setup to make it easier to use the tool without having to click around. If done properly a combination of mouse and keyboard actions speed up the annotation process. \n        <br></br><br></br>\n        * <kbd>1</kbd> : Mode Switch: Behavior<br></br>\n        * <kbd>2</kbd> : Mode Switch: Bounding Box<br></br>\n        * <kbd>3</kbd> : Mode Switch: Segmentation (Currently Disabled)<br></br>\n        * <kbd>a</kbd> : Add annotation<br></br>\n        * <kbd>e</kbd> : Skip forward frame(s)<br></br>\n        * <kbd>q</kbd> : Skip backward frame(s)<br></br>\n        * <kbd>w</kbd> : Pause/Play<br></br>\n\n        <br></br><br></br>\n        <h3>Uploading Video:</h3>\n\n        Ensure that you know the framerate of the video chosen to be annotated. These values should be entered into the settings tab into their \"frame rate\" fields. \n        <br></br><br></br>\n        Click on the right side browse button. All other buttons on the screen shuold be disabled until the video has been uploaded. Currenntly ```.mp4``` format is the best choice and tested for. Other file types such as .avi are supported but might have unintended bugs.\n        <br></br>\n        Please note that videos SHOULD be in 16:9 aspect ratio for best results. Extraneous behavior may occur if resolution is different.\n        <br></br><br></br>\n\n        <h3>Uploading Image:</h3>\n        Select all of the image files needed for the various inputs. To select a group of images, they should be in the same folder.\n        <br></br>\n        Please note that images SHOULD be in 16:9 aspect ratio for best results. Extraneous behavior may occur if resolution is different.\n        <br></br><br></br>\n        <h3>Annotations</h3>\n        <br></br>\n        There are currently two kinds of annotations. \n        <br></br><br></br>\n        <h4>Behavior Annotation:</h4>\n\n        This is for having annotations that do not have any visual attribute attached to it. This annotation is also attached by default when the bounding box or segmentation annotation is created. \n\n        <br></br><br></br>\n        <h4>Bounding Box:</h4>\n\n        This forms a square around the desired object. There should be small squares at the edges of the bounding box which can be used to resize the box. The number on the top left of the box is used to identify the placement of the box in the table to the right.\n        <br></br><br></br>\n        </div>\n    )\n}","import {createSlice} from '@reduxjs/toolkit'\n\nconst initialState = {data: []}\n\nconst frameDataSlice = createSlice({\n    name: 'frame_data',\n    initialState,\n    reducers:{\n        init(state, payload){\n            var data = [];\n            for(var i = 0; i < payload.payload; i++){\n                data.push([]);\n            }\n            state.data = data;\n        },\n        initOldAnnotation(state, payload){\n            state.data = payload.payload\n        },\n        modifyFrame(state, payload){\n            var temp = state.data\n            temp[payload.payload.currentFrame] = payload.payload.data\n            state.data = temp\n        },\n        middleware: (getDefaultMiddleware) => getDefaultMiddleware({\n            serializableCheck: false\n        })\n    }\n})\n\nexport const {init, modifyFrame} = frameDataSlice.actions\nexport default frameDataSlice.reducer","import {createSlice} from '@reduxjs/toolkit'\n\nconst initialState = {data: []}\n\nconst annotationDataSlice = createSlice({\n    name: 'annotation_data',\n    initialState,\n    reducers:{\n        init(state, payload){\n            console.log(payload.payload)\n            var data = [];\n            for(var i = 0; i < payload.payload; i++){\n                data.push([]);\n            }\n            state.data = data;\n        },\n        initOldAnnotation(state, payload){\n            state.data = payload.payload\n        },\n        modifyFrame(state, payload){\n            console.log(payload.payload)\n            var temp = state.data\n            temp[payload.payload.currentFrame] = payload.payload.data\n            state.data = temp\n        },\n        middleware: (getDefaultMiddleware) => getDefaultMiddleware({\n            serializableCheck: false\n        })\n    }\n})\n\nexport const {init, modifyFrame} = annotationDataSlice.actions\nexport default annotationDataSlice.reducer","import {createSlice} from '@reduxjs/toolkit'\n\nconst initialState = {data: undefined}\n\nconst columnDataSlice = createSlice({\n    name: 'column_annot',\n    initialState,\n    reducers:{\n        init(state, payload){\n            console.log(payload.payload.data)\n            state.data = payload.payload.data\n        },\n        middleware: (getDefaultMiddleware) => getDefaultMiddleware({\n            serializableCheck: false\n        })\n    }\n})\n\nexport const {init} = columnDataSlice.actions\nexport default columnDataSlice.reducer","import {createSlice} from '@reduxjs/toolkit'\n\nconst initialState = {data: undefined}\n\nconst currFrameDataSlice = createSlice({\n    name: 'current_frame',\n    initialState,\n    reducers:{\n        init(state, payload){\n            console.log(payload.payload.data)\n            state.data = payload.payload.data\n        },\n        changeFrame(state, payload){\n            state.data = payload.payload.data\n        },\n        middleware: (getDefaultMiddleware) => getDefaultMiddleware({\n            serializableCheck: false\n        })\n    }\n})\n\nexport const {init} = currFrameDataSlice.actions\nexport default currFrameDataSlice.reducer","import {createSlice} from '@reduxjs/toolkit'\n\nconst initialState = {data: []}\n\nconst mediaDataSlice = createSlice({\n    name: 'media_data',\n    initialState,\n    reducers:{\n        init(state, payload){\n            var data = [];\n            for(var i = 0; i < payload.payload; i++){\n                data.push([]);\n            }\n            state.data = data;\n        },\n        addMedia(state, payload){\n            var temp = state.data\n            var media = payload.payload.media\n            temp[payload.payload.stream_num] = media\n            state.data = temp\n        },\n        middleware: (getDefaultMiddleware) => getDefaultMiddleware({\n            serializableCheck: false\n        })\n    }\n})\n\nexport const {init, modifyFrame} = mediaDataSlice.actions\nexport default mediaDataSlice.reducer","import { configureStore } from '@reduxjs/toolkit'\nimport frameDataSlice from './reducer/frame_data'\nimport annotationDataSlice from './reducer/annotation_data'\nimport columnDataSlice from './reducer/column_annot'\nimport currFrameDataSlice from './reducer/current_frame'\nimport mediaDataSlice from './reducer/media_data'\n\nexport default configureStore({\n  reducer: {\n    frame_data: frameDataSlice,\n    annotation_data: annotationDataSlice,\n    column_annot: columnDataSlice,\n    current_frame: currFrameDataSlice,\n    media_data: mediaDataSlice\n  },\n})","import store from '../store'\n\n/*\nAction functions for frame_data\n*/\nfunction initFrameData(frame_count){\n\tstore.dispatch({\n\t\ttype: \"frame_data/init\",\n\t\tpayload: frame_count\n\t})\n}\nfunction updateFrameData(frame_number, data){\n\tstore.dispatch({\n\t\ttype: \"frame_data/modifyFrame\",\n\t\tpayload: {currentFrame: frame_number, data: data}\n\t})\n}\nfunction getFrameData(frame_number){\n\treturn JSON.parse(JSON.stringify(store.getState().frame_data.data[frame_number]))\n} \n\n/*\nAction functions for annotation_data\n*/\nfunction initAnnotationData(frame_count){\n    store.dispatch({\n\t\ttype: \"annotation_data/init\",\n\t\tpayload: frame_count\n\t})\n}\nfunction updateAnnotationData(frame_number, data){\n    store.dispatch({\n\t\ttype: \"annotation_data/modifyFrame\",\n\t\tpayload: {currentFrame: frame_number, data: data}\n\t})\n}\nfunction getAnnotationData(frame_number){\n    return JSON.parse(JSON.stringify(store.getState().annotation_data.data[frame_number]))\n}\n\n/*\nAction functions for column uploading\n*/\nfunction initColumnData(column_dat){\n\tstore.dispatch({\n\t\ttype: \"column_annot/init\",\n\t\tpayload: {data: column_dat}\n\t})\n}\n\nfunction getColumnData(){\n\treturn JSON.parse(JSON.stringify(store.getState().column_annot))\n}\n\nfunction initCurrentFrame(frame_num){\n\tstore.dispatch({\n\t\ttype: \"current_frame/init\",\n\t\tpayload: {data: frame_num}\n\t})\n}\n\nfunction getCurrentFrame(){\n\treturn JSON.parse(JSON.stringify(store.getState().current_frame))['data']\n}\n\nfunction setCurrentFrame(frame_num){\n\tstore.dispatch({\n\t\ttype: \"current_frame/changeFrame\",\n\t\tpayload: {data: frame_num}\n\t})\n}\n\nfunction initMedia(num_streams){\n\tstore.dispatch({\n\t\ttype: \"media_data/init\",\n\t\tpayload: num_streams\n\t})\n}\n\nfunction setMedia(stream_num, media){\n\tstore.dispatch({\n\t\ttype: \"media_data/addMedia\",\n\t\tpayload: {stream_num: stream_num, media: media}\n\t})\n}\n\nexport {initFrameData, \n\t\tupdateFrameData, \n\t\tgetFrameData, \n\t\tinitAnnotationData, \n\t\tupdateAnnotationData, \n\t\tgetAnnotationData, \n\t\tinitColumnData, \n\t\tgetColumnData,\n\t\tinitCurrentFrame,\n\t\tgetCurrentFrame,\n\t\tsetCurrentFrame,\n\t\tinitMedia,\n\t\tsetMedia}","import store from '../store'\nimport {getFrameData, getAnnotationData} from './actions'\n\nexport async function downloadFileJSON (ANNOTATION_VIDEO_NAME, ANNOTATOR_NAME, frame_data, annotation_data, VIDEO_METADATA) {\n    var fileName = \"generated_annotations\";\n    if(ANNOTATION_VIDEO_NAME !== \"\" && ANNOTATOR_NAME !== \"\"){\n        fileName = ANNOTATION_VIDEO_NAME.split('.').slice(0, -1).join('.') + \"_\" +  ANNOTATOR_NAME\n    }\n    //const json = JSON.stringify(fabricCanvas.getObjects());\n    const json = JSON.stringify({\"vid_metadata\": VIDEO_METADATA, \"annotations\": frame_data, \"behavior_data\": store.getState().annotation_data.data})\n    //var json = JSON.stringify(frame_data);\n    var blob = new Blob([json],{type:'application/json'});\n    var href = await URL.createObjectURL(blob);\n    var link = document.createElement('a');\n    link.href = href;\n    link.download = fileName + \".json\";\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n}\n\n\n//Legacy code below - Can be refrenced later IF need for CSV is present. Currently broken.\nfunction convert_data_csv(data, columns){\n    console.log(columns)\n    var csv = new Array(data.length + 1)\n    for(var i = 0; i < csv.length; i++){\n        csv[i] = []\n    }\n    csv[0].push(\"frame_num\")\n    for(var i = 0; i < columns.length; i++){\n        csv[0].push(columns[i]['dataField'])\n    }\n    for(var i = 0; i < data.length; i++){\n        for(var j = 0; j < data[i].length; j++){\n            csv[i+1][j]=[];\n            var obj = data[i][j]\n            var vals = Object.keys((obj)).map(function (key) { return obj[key]; });\n            csv[i+1][j] = i + \",\" + vals.join(\",\")\n        }\n        csv[i+1] = csv[i+1].join(\"\\n\")\n    }\n    csv = csv.join(\"\\n\")\n    return csv\n}\n\nexport async function downloadFileCSV (ANNOTATION_VIDEO_NAME, ANNOTATOR_NAME, annotation_data, columns) {\n    var fileName = \"generated_annotations\";\n    if(ANNOTATION_VIDEO_NAME !== \"\" && ANNOTATOR_NAME !== \"\"){\n        fileName = ANNOTATION_VIDEO_NAME.split('.').slice(0, -1).join('.') + \"_\" +  ANNOTATOR_NAME\n    }\n    var csv = convert_data_csv(annotation_data, columns(\"\"))\n    var blob = new Blob([csv],{type:'application/octet-stream'});\n    var href = await URL.createObjectURL(blob);\n    var link = document.createElement('a');\n    link.href = href;\n    link.download = fileName + \".csv\";\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n}","export default class ExportingAnnotation{\n    constructor(annotation_data, canvas, VIDEO_METADATA, image_data){\n        this.frame_data = annotation_data\n        this.canvas = canvas\n        this.metadata = VIDEO_METADATA\n        this.image_data = image_data\n    }\n\n    get_frame_json(){\n        var standard_annot = new Array(this.frame_data.length)\n        console.log(this.metadata)\n        console.log(this.frame_data)\n        for(var i = 0; i < this.frame_data.length; i++){\n            var curr = []\n\n            if(this.frame_data[i] == []){\n                continue;\n            }\n            var frame_objects = this.frame_data[i]\n            if(frame_objects == undefined){\n                continue;\n            }\n            \n            for(var j = 0; j < frame_objects.length; j++){\n                console.log(frame_objects[j]._objects)\n                if(frame_objects[j].get('type') !== \"group\"){\n                    continue;\n                }\n                if(frame_objects[j]._objects[0]['type'] === \"rect\"){\n                    console.log(frame_objects[j])\n                    var x = (frame_objects[j]['left'] / this.canvas.width) * this.metadata['horizontal_res']\n                    var y = (frame_objects[j]['top'] / this.canvas.height) * this.metadata['vertical_res']\n                    var width = ((frame_objects[j]['width'] * frame_objects[j]['scaleX']) / this.canvas.width) * this.metadata['horizontal_res']\n                    var height = ((frame_objects[j]['height'] * frame_objects[j]['scaleY']) / this.canvas.height )* this.metadata['vertical_res']\n                    var local_id = frame_objects[j]._objects[1]['text']\n                    if(this.image_data.length != 0){\n                        curr.push({\"type\": \"bounding_box\",\"x\": x, \"y\": y, \"width\": width, \"height\": height, \"local_id\": local_id,\"fileName:\": this.image_data[i]['name'], \"dataType\": \"image\"})\n                    }else{\n                        curr.push({\"type\": \"bounding_box\",\"x\": x, \"y\": y, \"width\": width, \"height\": height, \"local_id\": local_id, \"fileName:\": this.metadata['name'], \"dataType\": \"video\"})\n                    }\n                    //curr.push({\"type\": \"bounding_box\",\"x\": x, \"y\": y, \"width\": width, \"height\": height, \"local_id\": local_id})\n                }else if (frame_objects[j]._objects[0]['type'] === \"polygon\"){\n                    var raw_points = frame_objects[j]._objects[0]['points']\n                    var points = []\n                    for(var k = 0; k < raw_points.length; k++){\n                        var x = (raw_points[k]['x'] / this.canvas.width) * this.metadata['horizontal_res']\n                        var y = (raw_points[k]['y'] / this.canvas.height) * this.metadata['vertical_res']\n                        points.push({\"x\": x, \"y\": y})\n                    }\n                    var local_id = frame_objects[j]._objects[1]['text']\n\n                    if(this.image_data.length != 0){\n                        curr.push({\"type\": \"segmentation\", \"points\": points, \"local_id\": local_id, \"fileName:\": this.image_data[i]['name'], \"dataType\": \"image\"})\n                    }else{\n                        curr.push({\"type\": \"segmentation\", \"points\": points, \"local_id\": local_id, \"fileName:\": this.metadata['name'], \"dataType\": \"video\"})\n                    }\n                    //curr.push({\"type\": \"segmentation\", \"points\": points, \"local_id\": local_id})\n                }\n\n            }\n\n            standard_annot[i] = curr\n        }\n        return standard_annot\n    }\n\n    get_frame_json_fullCanvas(){\n        var standard_annot = new Array(this.frame_data.length)\n        console.log(this.metadata)\n        for(var i = 0; i < this.frame_data.length; i++){\n            var curr = []\n\n            if(this.frame_data[i] == []){\n                continue;\n            }\n            var frame_objects = this.frame_data[i]['objects']\n            if(frame_objects == undefined){\n                continue;\n            }\n            \n            for(var j = 0; j < frame_objects.length; j++){\n                console.log(frame_objects[j])\n                if(frame_objects[j]['type'] !== \"group\"){\n                    continue;\n                }\n                if(frame_objects[j]['objects'][0]['type'] === \"rect\"){\n                    console.log(frame_objects[j])\n                    var x = (frame_objects[j]['left'] / this.canvas.width) * this.metadata['horizontal_res']\n                    var y = (frame_objects[j]['top'] / this.canvas.height) * this.metadata['vertical_res']\n                    var width = ((frame_objects[j]['width'] * frame_objects[j]['scaleX']) / this.canvas.width) * this.metadata['horizontal_res']\n                    var height = ((frame_objects[j]['height'] * frame_objects[j]['scaleY']) / this.canvas.height )* this.metadata['vertical_res']\n                    var local_id = frame_objects[j]['objects'][1]['text']\n                    if(this.image_data.length != 0){\n                        curr.push({\"type\": \"bounding_box\",\"x\": x, \"y\": y, \"width\": width, \"height\": height, \"local_id\": local_id,\"fileName:\": this.image_data[i]['name'], \"dataType\": \"image\"})\n                    }else{\n                        curr.push({\"type\": \"bounding_box\",\"x\": x, \"y\": y, \"width\": width, \"height\": height, \"local_id\": local_id, \"fileName:\": this.metadata['name'], \"dataType\": \"video\"})\n                    }\n                    //curr.push({\"type\": \"bounding_box\",\"x\": x, \"y\": y, \"width\": width, \"height\": height, \"local_id\": local_id})\n                }else if (frame_objects[j]['objects'][0]['type'] === \"polygon\"){\n                    var raw_points = frame_objects[j]['objects'][0]['points']\n                    var points = []\n                    for(var k = 0; k < raw_points.length; k++){\n                        var x = (raw_points[k]['x'] / this.canvas.width) * this.metadata['horizontal_res']\n                        var y = (raw_points[k]['y'] / this.canvas.height) * this.metadata['vertical_res']\n                        points.push({\"x\": x, \"y\": y})\n                    }\n                    var local_id = frame_objects[j]['objects'][1]['text']\n\n                    if(this.image_data.length != 0){\n                        curr.push({\"type\": \"segmentation\", \"points\": points, \"local_id\": local_id, \"fileName:\": this.image_data[i]['name'], \"dataType\": \"image\"})\n                    }else{\n                        curr.push({\"type\": \"segmentation\", \"points\": points, \"local_id\": local_id, \"fileName:\": this.metadata['name'], \"dataType\": \"video\"})\n                    }\n                    //curr.push({\"type\": \"segmentation\", \"points\": points, \"local_id\": local_id})\n                }\n\n            }\n\n            standard_annot[i] = curr\n        }\n        return standard_annot\n    }\n\n    get_frame_coco(){\n\n    }\n}","export default async function videoFrameExtract(frame_rate, skip_val, handleText){\n    \n    //alert(\"Video will be extracted into frames - This might take a bit!\")\n    const video = document.getElementById(\"process_vid\")\n    var total_frames = video.duration * frame_rate\n    console.log(total_frames)\n    console.log(video.duration)\n\n    let canvas = document.createElement('canvas');\n    let context = canvas.getContext('2d');\n    let [w, h] = [video.videoWidth, video.videoHeight]\n    canvas.width =  w;\n    canvas.height = h;\n\n    let frames = [];\n    context.drawImage(video, 0, 0, w, h);\n    let base64ImageData = canvas.toDataURL();\n    frames.push(base64ImageData);\n\n    let seekResolve;\n    video.addEventListener('seeked', async function() {\n      if(seekResolve) seekResolve();\n    });\n\n    for(var i = 1; i < total_frames; i=i+skip_val){\n        var new_time = parseFloat((i/total_frames)*video.duration)\n        console.log(new_time)\n        video.currentTime = new_time\n        handleText(((i/(total_frames-1))*100).toFixed(2).toString() + \"%\" + \"completed\" + \"    |   \" + (i+1).toString() + \"/\" + total_frames.toString() + \" frames processed.\")\n\n        await new Promise(r => seekResolve=r);\n\n        context.drawImage(video, 0, 0, w, h);\n        let base64ImageData = canvas.toDataURL();\n        frames.push(base64ImageData);\n    }\n    //console.log(frames)\n    return frames\n}","import React from 'react';\nimport { useState } from 'react';\nimport \"bootstrap/dist/css/bootstrap.min.css\";\n\nimport Navbar from 'react-bootstrap/Navbar'\nimport Nav from 'react-bootstrap/Nav'\nimport Button from 'react-bootstrap/Button'\nimport { NavDropdown, NavLink } from 'react-bootstrap';\nimport Form from 'react-bootstrap/Form'\nimport Dropdown from 'react-bootstrap/Dropdown'\nimport { ButtonGroup } from 'react-bootstrap';\nimport Modal from 'react-bootstrap/Modal'\nimport Carousel from 'react-bootstrap/Carousel'\n\nimport { Container, Jumbotron, Col, Row, Card} from \"react-bootstrap\";\n\n\nimport videoFrameExtract from '../../processing/video_to_frame';\n\nvar test_frame = []\nexport default function ProcessVideo(props){\n    const [show, setShow] = useState(true);\n    const handleShow = () => setShow(true);\n    const handleClose = () => setShow(false);\n    const [frames, setFrames] = useState(null);\n    const [text, setText] = useState(\"\");\n\n    const handleText = (event) => {\n        setText(event)\n    }\n\n    const handleProcess = (e) => {\n        if(props.frame_rate === 0){\n            var temp = videoFrameExtract(15, 15, handleText).then(function(ret) {\n                setFrames(ret)\n                test_frame = ret\n                console.log(ret)\n            })\n            return;\n        }\n        var temp = videoFrameExtract(props.frame_rate)\n        setFrames(temp)\n        test_frame = temp\n        console.log(temp)\n    }\n    console.log(test_frame)\n    return(\n        <Modal show={show} onHide={handleClose} size='lg'>\n            <Modal.Header closeButton>\n            <Modal.Title>Processing Video...</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                <div>\n                    <video id='process_vid' style={{objectFit: 'contain', height: '100%', width: '100%'}} src={props.video_link}></video>\n                    <Button onClick={handleProcess} enable={frames!=null} >Process Video</Button>\n                    {text}\n                    {\n                        frames != null &&\n                        <Carousel controls={true} fade style={{objectFit: 'contain', height: '100%', width: '100%'}}>\n                        {\n                            frames.map((x) => {\n                                return(\n                                        <Carousel.Item >eee\n                                            <Card className=\"mb-5 box-shadow\" top\n                                                width='100%'\n                                            >\n                                                <Card.Img style={{objectFit: 'contain', height: '100%', width: '100%'}} src={x} />\n                                            </Card>\n                                        </Carousel.Item>\n                                    )\n                            })\n                        }\n                            \n                        </Carousel>\n                    }\n                </div>\n            </Modal.Body>\n            <Modal.Footer>\n            <Button variant=\"secondary\" onClick={handleClose}>Close</Button>\n            </Modal.Footer>\n        </Modal>\n    )\n}","import React from 'react';\nimport { useState } from 'react';\nimport \"bootstrap/dist/css/bootstrap.min.css\";\n\nimport Navbar from 'react-bootstrap/Navbar'\nimport Nav from 'react-bootstrap/Nav'\nimport Button from 'react-bootstrap/Button'\nimport { NavDropdown, NavLink } from 'react-bootstrap';\nimport Form from 'react-bootstrap/Form'\nimport Dropdown from 'react-bootstrap/Dropdown'\nimport { ButtonGroup } from 'react-bootstrap';\nimport Modal from 'react-bootstrap/Modal'\n\nimport \"react-datepicker/dist/react-datepicker.css\";\n\nimport Instructions from './instructions';\nimport { downloadFileJSON} from '../../processing/download';\n\nimport ExportingAnnotation from '../../processing/exporting_annotation';\nimport ProcessVideo from './process_video';\nimport store from '../../store' \nimport {INPUT_IMAGE, INPUT_VIDEO} from '../../static_data/const'\n\nimport {initFrameData, updateFrameData, getFrameData, initAnnotationData, updateAnnotationData, getAnnotationData, initColumnData, setMedia, initMedia} from '../../processing/actions'\n\ninitMedia(1)\nexport default function CustomNavBar(props){\n\tconst [show, setShow] = useState(false);\n\tconst [uploadShow, setUploadShow] = useState(true);\n\tconst [frameRate, setFrameRate] = useState(0)\n\tconst [videoFormat, setVideoFormat] = useState(INPUT_VIDEO)\n\tconst [videoLink, setVideoLink] = useState(\"\")\n\tconst [model, setModel] = useState(\"\")\n\tconst [process, setProcess] = useState(false)\n\tconst [editSeg, setEditSeg] = useState(false)\n\tconst [columnLoad, setColumnLoad] = useState(false)\n\tconst [numStrems, setNumStreams] = useState(1)\n\n\tconst handleClose = () => setShow(false);\n\tconst handleShow = () => setShow(true);\n\tconst handleUploadClose = () => {setUploadShow(false); setProcess(true)}\n\tconst handleUploadShow = () => {\n\t\tsetUploadShow(true)\n\t}\n\n\tconst handleDownloadJSON = () => {\n\t\tvar converted_annot = new ExportingAnnotation(store.getState().frame_data.data, props.fabricCanvas, props.VIDEO_METADATA, props.image_frames).get_frame_json()\n\t\tdownloadFileJSON(props.ANNOTATION_VIDEO_NAME, props.ANNOTATOR_NAME, converted_annot, props.annotation_data, props.VIDEO_METADATA)\n\t}\n\tconst handleVideoFormat = (type) => {\n\t\tconsole.log(type)\n\t\t//TODO Make sure bug is resolved and simply have video format equal type\n\t\t//type = parseInt(type)\n\t\tif(type === INPUT_VIDEO){\n\t\t\tsetVideoFormat(INPUT_VIDEO)\n\t\t\talert(\"Video is currently under development, some features might not work as expected.\")\n\t\t}else if (type === INPUT_IMAGE){\n\t\t\tsetVideoFormat(INPUT_IMAGE)\n\t\t\tprops.handleInputType(INPUT_IMAGE)\n\t\t}else {\n\t\t\talert(\"Wrong input detected - please report this bug.\")\n\t\t}\n\t}\n\n\tconst handleMediaUpload = (event) => {\n\t\tif(videoFormat == INPUT_VIDEO){\n\t\t\talert(\"Video is currently being redone. Some features might not work as expected.\")\n\t\t}else{\n\t\t\t//console.log(event.target.id)\n\t\t\tsetMedia(parseInt(event.target.id), event.target.files)\n\t\t\t//setMedia(1, event.target.files)\n\t\t}\n\t}\n\n\tconst handleColumnUpload = (event) => {\n\t\tvar promise = downloadColumn(event)\n\t\tpromise.then(function (result) {\n\t\t\tif(result != null){\n\t\t\t\tsetColumnLoad(true);\n\t\t\t\tconsole.log(result)\n\t\t\t\tinitColumnData(result)\n\t\t\t}else{\n\t\t\t\talert(\"Error in processing columns\")\n\t\t\t}\n\t\t})\n\t}\n\n\tconst downloadColumn = (file) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tvar reader = new FileReader();\n\t\t\treader.onload = function(e) {\n\t\t\t\tresolve((JSON.parse(e.target.result)));\n\t\t\t}\n\t\t\treader.readAsText(file.target.files[0])\n\t\t})\n\t}\n\n\tconst handleStreamNumChange = (event) => {\n\t\tsetNumStreams(event.target.value)\n\t\tinitMedia(event.target.value)\n\t}\n\n\tconst generateUploadButtons = () => {\n\t\tvar uploadButtons = []\n\t\tfor(var i = 0; i < numStrems; i++){\n\t\t\tlet button_image = (\n\t\t\t\t<Form style={{float: \"left\",gridColumn: 1, gridRow:4}}>\n\t\t\t\t\t<Form.File multiple id={i+\"\"} key={i} label={\"Image Upload \" + i} accept=\"image/*\" custom type=\"file\" onChange={(event) => {handleMediaUpload(event)}} />\n\t\t\t\t</Form>\n\t\t\t)\n\t\t\tlet button_video = (\n\t\t\t\t<Form style={{float: \"left\",gridColumn: 1, gridRow:4}}>\n\t\t\t\t\t<Form.File multiple id=\"file\" label={\"Video Upload \" + i} accept=\".mp4\" custom type=\"file\" onChange={(event) => {handleMediaUpload(event)}} />\n\t\t\t\t</Form>\n\t\t\t)\n\t\t\tif (videoFormat === INPUT_IMAGE){\n\t\t\t\tuploadButtons.push(button_image)\n\t\t\t}else if (videoFormat === INPUT_VIDEO){\n\t\t\t\tuploadButtons.push(button_video)\n\t\t\t}\n\t\t}\n\t\treturn (\n\t\t\t<div>\n\t\t\t{\n\t\t\t\tuploadButtons.map((but, _) => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\tbut\n\t\t\t\t\t)\n\t\t\t\t})\n\t\t\t}\n\t\t\t</div>\n\t\t)\n\t\t\n\t}\n\n\n\treturn (\n\t\t<div>\n\t\t{\n\t\t\t//TODO Re-enable this for video processing. \n\t\t\tprocess == 2 && \n\t\t\t<ProcessVideo\n\t\t\t\tframe_rate={frameRate}\n\t\t\t\tvideo_link={videoLink}\n\t\t\t/>\n\t\t}\n\t\t<Modal show={show} onHide={handleClose} size='lg'>\n\t\t\t<Modal.Header closeButton>\n\t\t\t<Modal.Title>Instructions</Modal.Title>\n\t\t\t</Modal.Header>\n\t\t\t<Modal.Body><Instructions></Instructions></Modal.Body>\n\t\t\t<Modal.Footer>\n\t\t\t<Button variant=\"secondary\" onClick={handleClose}>Close</Button>\n\t\t\t</Modal.Footer>\n\t\t</Modal>\n\t\t<Modal show={uploadShow} onHide={handleUploadClose} size='lg'>\n\t\t\t<Modal.Header closeButton>\n\t\t\t\t<Modal.Title>Upload</Modal.Title>\n\t\t\t</Modal.Header>\n\t\t\t<Modal.Body>\n\t\t\t\t<div style={{display: \"grid\"}}>\n\t\t\t\t\t{/*onClick and onBlur events are for the sole purpose to stop the eventKeys from firing off*/}\n\t\t\t\t\t<Form >\n\t\t\t\t\t\tMedia Format: \n\t\t\t\t\t\t<Form.Control\n\t\t\t\t\t\t\tas=\"select\"\n\t\t\t\t\t\t\tid=\"inlineFormCustomSelect\"\n\t\t\t\t\t\t\tonChange={(event)=>{handleVideoFormat(event.target.value)}}\n\t\t\t\t\t\t\tdefaultValue={videoFormat}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<option value={INPUT_VIDEO}>Video</option>\n\t\t\t\t\t\t\t<option value={INPUT_IMAGE}>Image</option>\n\t\t\t\t\t\t</Form.Control>\n\t\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\t</Form>\n\t\t\t\t\t<div>\n\t\t\t\t\t\tStream Num: <input type=\"number\" defaultValue={1} onClick={(event) => {props.toggleKeyCheck(false)}} onBlur={(event) => {props.toggleKeyCheck(true)}} onChange={handleStreamNumChange}></input>\n\t\t\t\t\t</div>\n\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\t{videoFormat === INPUT_VIDEO && \n\t\t\t\t\t\t<Form >\n\t\t\t\t\t\t\t<Form.File multiple id=\"file\" label=\"Video Upload\" accept=\".mp4\" custom type=\"file\" onChange={(event) => {handleMediaUpload(event)}} />\n\t\t\t\t\t\t</Form>\n\t\t\t\t\t}{videoFormat === INPUT_IMAGE &&\n\t\t\t\t\t\t<Form >\n\t\t\t\t\t\t\t<Form.File multiple id=\"file\" label=\"Image-set Upload\" accept=\"image/*\" custom type=\"file\" onChange={(event) => {handleMediaUpload(event)}} />\n\t\t\t\t\t\t</Form>\n\t\t\t\t\t}\n\t\t\t\t\t{\n\t\t\t\t\t\tgenerateUploadButtons()\n\t\t\t\t\t}\n\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\t<Form >\n\t\t\t\t\t\t<Form.File disabled={props.disable_buttons} accept=\".json\" id=\"file\" label=\"Column Upload\" custom type=\"file\" onChange={handleColumnUpload}/>\n\t\t\t\t\t</Form>\n\t\t\t\t\t<Form >\n\t\t\t\t\t\t<Form.File disabled={!columnLoad} accept=\".json\" id=\"file\" label=\"Annotation Upload\" custom type=\"file\" onChange={props.handleOldAnnotation}/>\n\t\t\t\t\t</Form>\n\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\tFrame Rate: <input type=\"number\" value={props.frame_rate} onClick={(event) => {props.toggleKeyCheck(false)}} onBlur={(event) => {props.toggleKeyCheck(true)}} onChange={(event) => {props.setFrameRate(parseInt(event.target.value)); setFrameRate(parseInt(event.target.value))}}></input>\n\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\tSkip Value: <input type='number' defaultValue=\"1\" onChange={(event) => {props.change_skip_value(parseInt(event.target.value))}}></input>\n\t\t\t\t\tPlayback Rate: <input type='number' defaultValue=\"1\" onChange={(event) => {props.handleSetPlaybackRate(parseInt(event.target.value))}}></input>\n\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t</div>\n\t\t\t</Modal.Body>\n\t\t\t<Modal.Footer>\n\t\t\t<Button variant=\"success\" onClick={handleUploadClose}>Upload</Button>\n\t\t\t</Modal.Footer>\n\t\t</Modal>\n\t\t<Navbar sticky=\"top\" bg=\"dark\" variant=\"dark\" className=\"bg-5\">\n\t\t\t\t<Navbar.Brand href=\"#home\">AVAT</Navbar.Brand>\n\t\t\t\t<Nav className=\"mr-auto\">\n\t\t\t\t\t\t<NavDropdown disabled={props.disable_buttons} title=\"Export\" id=\"basic-nav-dropdown\">\n\t\t\t\t\t\t\t<NavDropdown.Item onClick={handleDownloadJSON}>JSON</NavDropdown.Item>\n\t\t\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\t\t</NavDropdown>\n\t\t\t\t\t\t<NavLink onClick={handleShow}>Instructions</NavLink>\n\t\t\t\t\t\t<NavLink onClick={props.handle_link_open}>Report</NavLink>\n\t\t\t\t</Nav>\n\t\t\t\t<div>\n\t\t\t\t\t<Button variant=\"outline-success\" onClick={handleUploadShow}>Upload</Button>{' '}\n\t\t\t\t\t{' '}\n\t\t\t\t\t<Dropdown as={ButtonGroup}>\n\t\t\t\t\t\t<Button variant=\"secondary\" disabled={true}>{props.display_frame_num}</Button>{' '}\n\t\t\t\t\t\t<Dropdown.Toggle split variant=\"secondary\" id=\"dropdown-split-basic\" />\n\t\t\t\t\t\t<Dropdown.Menu>\n\t\t\t\t\t\t\tSkip Value: <input type='number' defaultValue=\"1\" onChange={(event) => {props.change_skip_value(parseInt(event.target.value))}}></input>\n\t\t\t\t\t\t\tPlayback Rate: <input type='number' defaultValue=\"1\" onChange={(event) => {props.handleSetPlaybackRate(parseInt(event.target.value))}}></input>\n\t\t\t\t\t\t</Dropdown.Menu>\n\t\t\t\t\t</Dropdown>{' '}\n\t\t\t\t\t\n\t\t\t\t\t<Button variant=\"primary\" disabled={props.disable_buttons} onClick={props.skip_frame_backward}>Prev</Button>{' '}\n\t\t\t\t\t{\n\t\t\t\t\t\tvideoFormat === INPUT_VIDEO && \n\t\t\t\t\t\t<Button variant=\"primary\" disabled={props.disable_buttons} onClick={props.handlePlaying}>{props.play_button_text}</Button>\n\t\t\t\t\t}\n\t\t\t\t\t{' '}\n\t\t\t\t\t<Button variant=\"primary\" disabled={props.disable_buttons} onClick={props.skip_frame_forward}>Next</Button>{' '}\n\t\t\t\t\t<Dropdown as={ButtonGroup} drop='left'>\n\t\t\t\t\t\t<Button variant=\"success\" onClick={props.addToCanvas}>Add</Button>\n\t\t\t\t\t\t<Dropdown.Toggle split variant=\"success\" id=\"dropdown-split-basic\" />\n\t\t\t\t\t\t<Dropdown.Menu>\n\t\t\t\t\t\t\t<Dropdown.Item onClick={(event) =>{props.change_annotation_type(\"1\")}}>Behavior Annotation</Dropdown.Item>\n\t\t\t\t\t\t\t<Dropdown.Item onClick={(event) =>{props.change_annotation_type(\"2\")}}>BoundingBox</Dropdown.Item>\n\t\t\t\t\t\t\t<Dropdown.Item onClick={(event) =>{props.change_annotation_type(\"3\")}}>Segmentation</Dropdown.Item>\n\t\t\t\t\t\t</Dropdown.Menu>\n\t\t\t\t\t</Dropdown>\n\t\t\t\t\t{/*<Button variant=\"danger\" onClick={remove} disabled={disable_buttons} style={{position:\"relative\"}}>Remove</Button>{' '}*/}\n\t\t\t\t</div>\n\t\t</Navbar>\n\t\t</div>\n\t)\n}","let INPUT_IMAGE = \"in_image\"\nlet INPUT_VIDEO = \"in_video\"\n\nexport {INPUT_IMAGE, INPUT_VIDEO}","import React, { useEffect, useState } from \"react\"; \nimport ReactDOM from 'react-dom'\n\nimport store from '../../store' \nimport {initFrameData, updateFrameData, getFrameData, \n\t\tinitAnnotationData, updateAnnotationData, getAnnotationData, \n\t\tinitColumnData, getColumnData, \n\t\tinitCurrentFrame, getCurrentFrame, setCurrentFrame,} from '../../processing/actions'\nimport { useSelector } from \"react-redux\";\n\nimport {INPUT_IMAGE, INPUT_VIDEO} from '../../static_data/const'\nconst fabric = require(\"fabric\").fabric;\n\n\nvar temp_color;\n\nconst canvasBackgroundUpdate = (currFrameData, inputType, image_url, scaling_factor_width, scaling_factor_height, fabricCanvas) => {\n\t\n\t  if(inputType == INPUT_IMAGE){ //This is for when images are uploaded\n\t\t  var img = new Image()\n\t\t  img.onload = function() {\n\t\t\t  fabricCanvas.clear()\n\t\t\t  if(currFrameData != undefined){\n\t\t\t\t  fabric.util.enlivenObjects(currFrameData, function (enlivenedObjects){\n\t\t\t\t\t  enlivenedObjects.forEach(function (obj, index) {\n\t\t\t\t\t\t  fabricCanvas.add(obj);\n\t\t\t\t\t  });\n\t\t\t\t\t  fabricCanvas.renderAll();\n\t\t\t\t  })\n\t\t\t  }\n\t\t\t  var f_img = new fabric.Image(img, {\n\t\t\t\t  objectCaching: false,\n\t\t\t\t  scaleX: scaling_factor_width / img.width,\n\t\t\t\t  scaleY: scaling_factor_height / img.height\n\t\t\t  });\n\t\t\t  fabricCanvas.setBackgroundImage(f_img);\n\t\t\t\n\t\t\t  fabricCanvas.renderAll();\n\t\t\t  console.log(\"updated canvas\")\n\t\t  };\n\t\t  img.src = URL.createObjectURL(image_url)\n\t\t  return;\n\t}\n}\n\nexport default function FabricRender(props){\n\tconst [fabricCanvas, setFabricCanvas] = useState(null)\n\n\tuseEffect(() => {\n\n\t\tvar temp_fabricCanvas = (new fabric.Canvas('c', {\n\t\t\tuniScaleTransform: true,\n\t\t\tuniformScaling: false,\n\t\t\tincludeDefaultValues: false\n\t\t}));\n\n\t\tfabric.Image.prototype.toObject = (function(toObject) {\n\t\t\treturn function() {\n\t\t\t\treturn fabric.util.object.extend(toObject.call(this), {\n\t\t\t\t\tsrc: this.toDataURL()\n\t\t\t\t});\n\t\t\t};\n\t\t})(fabric.Image.prototype.toObject);\n\n\t\ttemp_fabricCanvas.on('mouse:wheel', function(opt) {\n\t\t\tvar delta = opt.e.deltaY;\n\t\t\tvar zoom = temp_fabricCanvas.getZoom();\n\t\t\tzoom *= 0.999 ** delta;\n\t\t\tif (zoom > 20) zoom = 20;\n\t\t\tif (zoom < 0.01) zoom = 0.01;\n\t\t\ttemp_fabricCanvas.zoomToPoint({ x: opt.e.offsetX, y: opt.e.offsetY }, zoom);\n\t\t\topt.e.preventDefault();\n\t\t\topt.e.stopPropagation();\n\t\t});\n\n\t\ttemp_fabricCanvas.on('mouse:down', function(opt) {\n\t\t\tvar evt = opt.e;\n\t\t\tif (evt.altKey === true) {\n\t\t\t\tthis.isDragging = true;\n\t\t\t\tthis.selection = false;\n\t\t\t\tthis.lastPosX = evt.clientX;\n\t\t\t\tthis.lastPosY = evt.clientY;\n\t\t\t}\n\t\t});\n\t\ttemp_fabricCanvas.on('mouse:move', function(opt) {\n\t\t\tif (this.isDragging) {\n\t\t\t\tvar e = opt.e;\n\t\t\t\tvar vpt = this.viewportTransform;\n\t\t\t\tvpt[4] += e.clientX - this.lastPosX;\n\t\t\t\tvpt[5] += e.clientY - this.lastPosY;\n\t\t\t\tthis.requestRenderAll();\n\t\t\t\tthis.lastPosX = e.clientX;\n\t\t\t\tthis.lastPosY = e.clientY;\n\t\t\t}\n\t\t});\n\t\ttemp_fabricCanvas.on('mouse:up', function(opt) {\n\t\t\tthis.setViewportTransform(this.viewportTransform);\n\t\t\tthis.isDragging = false;\n\t\t\tthis.selection = true;\n\t\t});\n\n\t\tvar el = ReactDOM.findDOMNode(this);\n\t\tconsole.log(el)\n\t\tvar canvas_elem = document.getElementsByTagName('canvas')[props.stream_num*2]\n\t\tconsole.log(canvas_elem)\n\t\ttemp_fabricCanvas.initialize(canvas_elem, {\n\t\t\theight: props.scaling_factor_height,\n\t\t  \twidth: props.scaling_factor_width,\n\t\t  \tbackgroundColor : null,\n\t\t});\n\n\t\tsetFabricCanvas(temp_fabricCanvas)\n\t}, []);\n\n\t\n\tvar image_data = useSelector(state => state.media_data)\n\tconsole.log(image_data)\n\timage_data = image_data['data'][props.stream_num]\n\n\tvar currframe_redux = useSelector(state => state.current_frame)['data']\n\tif(fabricCanvas != null && image_data != undefined){\n\t\tconsole.log(image_data)\n\t\tif(image_data.length !== 0){\n\t\t\tcanvasBackgroundUpdate([], INPUT_IMAGE, image_data[currframe_redux], props.scaling_factor_width, props.scaling_factor_height, fabricCanvas)\n\t\t}\n\t}\n\n\treturn(\n\t\t<div>\n\t\t\t<canvas id={props.stream_num}></canvas>\n\t\t</div>\n\t)\n}","import React from 'react'\nimport {initFrameData, updateFrameData, getFrameData, initAnnotationData, updateAnnotationData, getAnnotationData} from '../../processing/actions'\n\nimport { useTable, usePagination } from 'react-table'\n\nexport default function AnnotTable({columns, data, select_data, current_frame, change_annot}){\n    const {\n        getTableProps,\n        getTableBodyProps,\n        headerGroups,\n        rows,\n        prepareRow,\n      } = useTable({\n        columns,\n        data,\n      })\n      if(!columns){\n        return (\n            <div>\n                {\"No column upload detected.\"}\n            </div>\n        )\n    }\n\n    return(\n        <table {...getTableProps()} style={{ border: 'solid 1px blue' }}>\n            <thead>\n                {headerGroups.map(headerGroup => (\n                <tr {...headerGroup.getHeaderGroupProps()}>\n                    {headerGroup.headers.map(column => (\n                    <th {...column.getHeaderProps()} \n                    style={{\n                      background: '#657',\n                      color: 'white',\n                      fontWeight: 'bold'\n                    }}>{column.render('Header')}</th>\n                    ))}\n                </tr>\n                ))}\n            </thead>\n            <tbody {...getTableBodyProps()}>\n                {rows.map((row, i) => {\n                    prepareRow(row)\n                    const {id, global_id, posture, behavior, confidence} = row\n                    var selection = genSelection(row.original, select_data, columns, i, current_frame)\n                    return(selection)\n                })}\n            </tbody>\n        </table>\n    )\n}\n\nconst change_row = (e) => {\n    var curr_data = getAnnotationData(e.target.dataset.curr)\n    if (curr_data.length === 0){\n        alert(\"Row changing value failed - please report this bug.\")\n        return;\n    }\n    curr_data[e.target.id][e.target.dataset.type] = e.target.value\n    updateAnnotationData(parseInt(e.target.dataset.curr), curr_data)\n}\n\nconst delete_row = (e) => {\n    var curr_data = getAnnotationData(e.target.dataset.curr)\n    if (curr_data.length === 0){\n        alert(\"Row deletion failed - please report this bug.\")\n        return;\n    }\n    curr_data.splice(e.target.id, 1)\n    updateAnnotationData(parseInt(e.target.dataset.curr), curr_data)\n}\n\nfunction genSelection(elem, select_data, columns, curr_idx, current_frame){\n    var row_vals = []\n    console.log(current_frame)\n    for(var i = 0; i < columns[0].columns.length; i++){\n        var curr_elem = columns[0].columns[i]['accessor']\n        if(!check_keys(select_data, curr_elem)){\n            continue\n        }\n        let temp = (\n            <select id={curr_idx} data-type={curr_elem} data-curr={current_frame} defaultValue={elem[curr_elem]} onChange={change_row}>\n                <option value=\"\"></option>\n                {\n                    select_data[curr_elem].map((beh, _) => {\n                        return(\n                            <option value={beh.value}>{beh.value}</option>\n                        )\n                    })\n                }\n            </select>\n        )\n        row_vals.push(temp)\n    }\n    \n    let combined_elems = (\n        <tr key={elem.id}>\n            <td>{elem.id}</td>\n            <td>\n                <input type={\"text\"} style={{width: \"50%\"}} defaultValue={elem.global_id} id={curr_idx} data-type={\"global_id\"} data-curr={current_frame} onChange={change_row}></input>\n            </td>\n            {\n                row_vals.map((i, j) => {\n                    return(<td id={j}>{i}</td>)\n                })\n            }\n            <td>\n                <input type={\"button\"} style={{backgroundColor: \"#f44336\"}} defaultValue={elem.global_id} id={curr_idx} data-type={\"global_id\"} data-curr={current_frame} onClick={delete_row}></input>\n            </td>\n        </tr>\n    )\n    return combined_elems\n}\n\nfunction check_keys(obj, key){\n    let obj_keys = Object.keys(obj)\n    for(var i = 0; i < obj_keys.length; i++){\n        if(obj_keys[i] === key){\n            return true\n        }\n    }\n    return false\n}\n\n\nconst EditableCell = ({\n    value: initialValue,\n    row: { index },\n    column: { id },\n    updateMyData,\n}) => {\n    const [value, setValue] = React.useState(initialValue)\n    const onChange = e => {\n        setValue(e.target.value)\n    }\n\n    const onBlur = () => {\n        updateMyData(index, id, value)\n    }\n\n    React.useEffect(() => {\n        setValue(initialValue)\n      }, [initialValue])\n    \n      return <input value={value} onChange={onChange} onBlur={onBlur} />\n}\n\nconst defaultColumn = {\n    Cell: EditableCell,\n}","import React from \"react\"; \nimport 'bootstrap/dist/css/bootstrap.min.css';\n\nimport BootstrapTable from 'react-bootstrap-table-next';\nimport cellEditFactory, { Type } from 'react-bootstrap-table2-editor';\nimport 'react-bootstrap-table-next/dist/react-bootstrap-table2.min.css';\nimport paginationFactory from 'react-bootstrap-table2-paginator';\n\nimport Tabs from 'react-bootstrap/Tabs'\nimport Tab from 'react-bootstrap/Tab'\nimport Button from 'react-bootstrap/Button'\nimport { FormControl } from \"react-bootstrap\";\n\nimport AnnotTable from './annot_table'\nimport SwapAnnotTable from \"./cumulative_annot_table\";\n\nimport store from '../../store'\n\nfunction getAnnotationTableCount() {\n    var annotation_data = store.getState().annotation_data.data\n    var data = []\n    if (!annotation_data){\n        return data\n    }\n    for(var i = 0; i < annotation_data.length; i++){\n        if(annotation_data[i].length !== 0){\n            var txt_id = \"\"\n            var txt_global = \"\"\n            for(var j = 0; j < annotation_data[i].length; j++){\n                txt_id += (annotation_data[i][j]['id']) + ', '\n                txt_global += (annotation_data[i][j]['global_id']) + ', '\n            }\n            data.push({frame_num: i, anno_count: annotation_data[i].length, local_ids: txt_id, global_ids: txt_global})\n        }\n    }\n    return data\n}\n\n\nexport default function AnnotationTable(props){\n    var annotation_data = (props.annotation_data)\n    console.log(annotation_data)\n    var columns = []\n    var col = []\n    var select_data = undefined\n    if(store.getState().column_annot.data != undefined){\n      col = store.getState().column_annot.data['columns']\n      select_data = store.getState().column_annot.data['select_data']\n      columns.push(col)//hookBypass(col)\n    }\n    const anno_col = React.useMemo(\n        () => [\n          {\n            Header: 'Name',\n            columns: [\n              {\n                Header: 'Frame',\n                accessor: 'frame_num',\n              },\n              {\n                Header: 'Count',\n                accessor: 'anno_count',\n              },\n              {\n                Header: 'Local ID',\n                accessor: 'local_id',\n              },\n              {\n                Header: 'Global ID',\n                accessor: 'global_ids',\n              },\n              /*{\n                Header: 'Swap',\n                accessor: 'swap',\n              }*/\n            ],\n          }\n        ],\n        []\n      )\n\n    //TODO Add in force option for user to upload some sort of config file to continue along to next steps.\n    return (\n        <div>\n        {\n            col.length != 0 &&\n            <Tabs defaultActiveKey=\"home\" id=\"uncontrolled-tab-example\">\n                <Tab eventKey=\"home\" title=\"Current\">\n                    <AnnotTable columns={columns} data={annotation_data} select_data={select_data} current_frame={props.currentFrame} change_annot={props.handleChangeAnnot}/>\n                </Tab>\n\n            </Tabs>\n        }   \n        </div>\n           \n    )\n}\n/*\n                <Tab eventKey=\"swap\" title=\"Swap\">\n                    <SwapAnnotTable columns={anno_col} data={getAnnotationTableCount()}></SwapAnnotTable>\n                </Tab>\n*/\n/*\n<Tab eventKey=\"profile\" title=\"Previous\">\n                <BootstrapTable\n                    keyField='frame_num'\n                    data={data} \n                    columns={anno_col((props.handleSetCurrentFrame))}\n                    table\n                    noDataIndication={ () => <div>No recorded annotations or behaviors for this video.</div> }\n                    pagination={ paginationFactory() }\n                />\n            </Tab>\n*/","//Core imports\nimport React, { useEffect, useState } from \"react\"; \nimport ReactPlayer from 'react-player'\nimport 'bootstrap/dist/css/bootstrap.min.css';\n\n//Constants\nimport {INPUT_IMAGE, INPUT_VIDEO} from '../../static_data/const'\n\n//UI Element imports\nimport Toast from 'react-bootstrap/Toast'\n\n//Processing\nimport ExtractingAnnotation from '../../processing/annotation-processing'\n\n//Annotations\nimport { BoundingBox } from '../../annotations/bounding_box'\n\n//Column information + data structure\nimport {columns} from '../../static_data/columns'\nimport {ANNOTATION_FRAME, ANNOTATION_BBOX, ANNOTATION_KEYPOINT, ANNOTATION_SEG} from '../../static_data/constants'\n\n//Components\nimport CustomNavBar from \"../Components/nav_bar\";\nimport FabricRender from \"../Components/fabric_canvas\";\nimport AnnotationTable from \"../Components/change_table\";\n\n\n//Redux\nimport store from '../../store' \nimport {initFrameData, updateFrameData, getFrameData, \n\t\tinitAnnotationData, updateAnnotationData, getAnnotationData, \n\t\tinitColumnData, getColumnData, \n\t\tinitCurrentFrame, getCurrentFrame, setCurrentFrame,\n\t\tinitMedia, setMedia} from '../../processing/actions'\nimport { useSelector } from \"react-redux\";\n\nconst fabric = require(\"fabric\").fabric;\n\n//TODO ADD DYNAMIC SOLUTION \nvar frame_rate = 15;\nvar num_frames = -1;\nvar scaling_factor_width = 1920;\nvar scaling_factor_height = 1080;\nvar skip_value = 1;\n\n//var current_screen_width = window.screen.width;\nvar current_screen_height = window.screen.height;\n\nif(current_screen_height >= 1080){////Mappings are based off of https://en.wikipedia.org/wiki/List_of_common_resolutions make sure to use 1:1 and 16:9 aspect ratio\n  scaling_factor_width = 1280;\n  scaling_factor_height = 720;\n}else if(current_screen_height >= 1024){\n  scaling_factor_width = 1152;\n  scaling_factor_height = 648;\n}else if(current_screen_height >= 768){\n  scaling_factor_width = 1024;\n  scaling_factor_height = 576;\n}\n\nvar video_width = 0;\nvar video_height = 0;\nvar upload = false;\nvar disable_buttons = true;\nvar toast_text = \"\"\nvar ANNOTATION_VIDEO_NAME = \"\"\nvar VIDEO_METADATA = {}\nvar play_button_text = \"ERROR\"\nvar segmentation_flag = false;\nvar total_frames\nvar player_opacity = 0\n\n//TODO remove after fixing null exceptions\ninitAnnotationData(1)\ninitFrameData(1)\ninitCurrentFrame(0)\n\n\n//Current frame counter\nexport default function MainUpload() {\n\tconst [visualToggle, setVisualToggle] = useState(0);\n\tconst [annotationType, setAnnotationType] = useState(\"1\")\n\tconst [boxCount, setBoxCount] = useState(0)\n\tconst [videoFilePath, setVideoFileURL] = useState(null);\n\tconst [oldAnnotation, setOldAnnotation] = useState(null)\n\tconst [save, changeSave] = useState(false);\n\tconst [keyCheck, changeKeyCheck] = useState(true)\n\tconst [inputType, setInputType] = useState(INPUT_VIDEO)\n\tconst [isLoading, setIsLoading] = useState(true)\n\n\t//New state vars\n\tconst [currFrameData, setCurrFrameData] = useState([])\n\tconst [currAnnotationData, setCurrAnnotationData] = useState([])\n\n\tconst annot_redux = useSelector(state => state.annotation_data.data)\n\tconst column_redux = useSelector(state => state.column_annot.data)\n\tconst currframe_redux = useSelector(state => state.current_frame)['data']\n\tconst imagedata_redux = useSelector(state => state.media_data.data)\n\n\tuseEffect(() => {\n\t\tif(upload == true){\n\t\t\tvar annot = getAnnotationData(currframe_redux)\n\t\t\tsetCurrAnnotationData(annot)\n\t\t}\n\t}, [currframe_redux])\n\n\tuseEffect(() => {\n\t\tif(imagedata_redux[0].length != 0){\n\t\t\tconsole.log(imagedata_redux)\n\t\t\ttotal_frames = imagedata_redux[0].length\n\t\t\tupload = true\n\t\t\tdisable_buttons = false\n\t\t\tinitAnnotationData(total_frames)\n\t\t\tinitFrameData(total_frames)\n\t\t\tsetVisualToggle(10)\n\t\t}\n\t\tscaling_factor_width = 1920;\n\t\tscaling_factor_height = 1080;\n\t\tif(current_screen_height >= 1080){////Mappings are based off of https://en.wikipedia.org/wiki/List_of_common_resolutions make sure to use 1:1 and 16:9 aspect ratio\n\t\t\tscaling_factor_width = 1280;\n\t\t\tscaling_factor_height = 720;\n\t\t  }else if(current_screen_height >= 1024){\n\t\t\tscaling_factor_width = 1152;\n\t\t\tscaling_factor_height = 648;\n\t\t  }else if(current_screen_height >= 768){\n\t\t\tscaling_factor_width = 1024;\n\t\t\tscaling_factor_height = 576;\n\t\t}\n\t\tscaling_factor_height = scaling_factor_height * (1/imagedata_redux.length)\n\t\tscaling_factor_width = scaling_factor_width * (1/imagedata_redux.length)\n\t}, [imagedata_redux])\n\n\tconst handleInputType = (val) => {\n\t\tif(val == INPUT_VIDEO | val == INPUT_IMAGE){\n\t\t\tsetInputType(val)\n\t\t}else{\n\t\t\talert(\"ERROR VALUE SET - Please report this bug!\\n\")\n\t\t}\n\t}\n\n\tconst addToCanvas = () => {\n\t\tvar color = \"#\" + ((1<<24)*Math.random() | 0).toString(16)\n\t\t\n\t\tif(currAnnotationData == null){\n\t\t\tsetCurrAnnotationData([])\n\t\t}\n\t\tif (segmentation_flag == true){\n\t\t\talert(\"Please finish your current segmentation!\")\n\t\t\treturn\n\t\t}\n\t\t\n\t\tvar annotation_type_txt = \"error\"\n\n\t\tif (annotationType === ANNOTATION_BBOX){\n\t\t\tannotation_type_txt = \"b\"\n\t\t\tvar new_bbox = new BoundingBox(50, 50, 50, 50, color, boxCount+'b', \"None\").generate_no_behavior()\n\t\t}else if(annotationType === ANNOTATION_FRAME){\n\t\t\t//TODO Add annotation frame datapoint\n\t\t\tannotation_type_txt = \"f\"\n\t\t}\n\t\t\n\t\tvar saved_annot = getAnnotationData(getCurrentFrame())\n\t\tvar generated_annotation;\n\t\tif(inputType === INPUT_IMAGE){\n\t\t\tgenerated_annotation = create_annotation(boxCount+annotation_type_txt)\n\t\t}else{\n\t\t\tgenerated_annotation = create_annotation(boxCount+annotation_type_txt)\n\t\t}\n\t\tsaved_annot = Object.assign([], saved_annot)\n\t\tsaved_annot.push(generated_annotation)\n\t\tupdateAnnotationData(currframe_redux, saved_annot)\n\n\t\tsetBoxCount(boxCount + 1);\n\t}\n\n\tuseEffect(() =>{\n\t\tif(upload == true){\n\t\t\tsetCurrAnnotationData(getAnnotationData(currframe_redux))\n\t\t}\n\t}, [annot_redux])\n\n\tconst create_annotation = (id) => {\n\t\tvar columns = getColumnData()\n\t\tvar new_data = {}\n\t\tcolumns = columns['data']['columns']['columns']\n\t\tfor(var i = 0; i < columns.length; i++){\n\t\t\tvar curr_val = columns[i]\n\t\t\tnew_data[curr_val.accessor] = \"\"\n\t\t}\n\t\tif(inputType === INPUT_IMAGE){\n\t\t\tnew_data['dataType'] = \"image\"\n\t\t\tnew_data['fileName'] = \"temp\"//image_frames[currframe_redux]['name']\n\t\t}else{\n\t\t\tnew_data['dataType'] = \"video\"\n\t\t\tnew_data['fileName'] = \"frame_\" + currframe_redux\n\t\t}\n\t\tnew_data['id'] = id\n\t\treturn new_data\n\t}\n\n\tconst toggle_segmentation = (event) => {\n\t\tsegmentation_flag = !segmentation_flag\n\t}\n\n\t//ASYNC Function  - To note that the data that comes out of this will be a bit delayed and this could cause some issues.\n\tconst handleOldAnnotation = (event) => {\n\t\tvar promise = downloadOldAnnotation(event)\n\t\tpromise.then(function (result) {\n\t\t\tif(result != null){\n\t\t\t\t//alert(\"WIP on oldUpload- please report this bug\")\n\t\t\t\t//setOldAnnotation(new ExtractingAnnotation(result, fabricCanvas));\n\t\t\t}else{\n\t\t\t\talert(\"Error in processing Annotation\")\n\t\t\t}\n\t\t})\n\t}\n\n\tuseEffect(() => {\n\t\t//TODO Find a more elegant solution. This is a temporay patch work.\n\t\tif(oldAnnotation == null){\n\t\t\treturn;\n\t\t}\n\t\tstore.dispatch({\n\t\t\ttype: \"frame_data/initOldAnnotation\",\n\t\t\tpayload: oldAnnotation.get_frame_data()\n\t\t});\n\t\tstore.dispatch({\n\t\t\ttype: \"annotation_data/initOldAnnotation\",\n\t\t\tpayload: oldAnnotation.get_annotation_data()\n\t\t});\n\n\t\tsetCurrFrameData(oldAnnotation.get_frame_data()[0])\n\t\tsetCurrAnnotationData(oldAnnotation.get_annotation_data()[0])\n\t\tsetBoxCount(oldAnnotation.find_highest_localid())\n\t}, [oldAnnotation]);\n\t\t\n\n\tuseEffect(() => { //This shold update the view upon column loading\n\t\tsetIsLoading(false)\n\t}, [column_redux])\n\n\n\tconst downloadOldAnnotation = (file) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\tvar reader = new FileReader();\n\t\treader.onload = function(e) {\n\t\t\tresolve((JSON.parse(e.target.result)));\n\t\t}\n\t\treader.readAsText(file.target.files[0])\n\t\t})\n\t}\n  \n\tconst skip_frame_forward = e =>{\n\t\tvar frameVal = currframe_redux + skip_value\n\n\t\tif(frameVal >= total_frames){\n\t\t\tif(inputType === INPUT_IMAGE){\n\t\t\t\tsetCurrentFrame(total_frames-1)\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsetCurrentFrame(total_frames-1)\n\t\t}else{\n\t\t\tif(inputType === INPUT_IMAGE){\n\t\t\t\tsetCurrentFrame(frameVal)\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsetCurrentFrame(frameVal)\n\t\t}\n\t}\n\n\tconst skip_frame_backward = e => {\n\t\tvar frameVal = currframe_redux - skip_value\n\t\tif(frameVal < 0){\n\t\t\tif(inputType === INPUT_IMAGE){\n\t\t\t\tsetCurrentFrame(0)\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsetCurrentFrame(0)\n\t\t}else{\n\t\t\tif(inputType === INPUT_IMAGE){\n\t\t\t\tsetCurrentFrame(frameVal)\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsetCurrentFrame(frameVal)\n\t\t}\n\t}\n\n\tconst change_annotation_type = (event) => {\n\t\tsetAnnotationType(event)\n\t}\n\n\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\tconst onKeyPress = (event) =>{\n\t\t//Making sure input for textbox doesnt get counted as a mode change\n\t\tif(keyCheck === false){\n\t\t\treturn;\n\t\t}\n\t\tif(segmentation_flag === true){\n\t\t\talert(\"Please finish your current action!\")\n\t\t\treturn;\n\t\t}\n\t\tif (event.key === ANNOTATION_BBOX){\n\t\t\ttoast_text = \"Mode Switch: Bounding Box\"\n\t\t\tchangeSave(true)\n\t\t\tsetAnnotationType(ANNOTATION_BBOX)\n\t\t}else if (event.key === ANNOTATION_KEYPOINT){\n\t\t\ttoast_text = \"Mode Switch: Key Point\"\n\t\t\tchangeSave(true)\n\t\t\tsetAnnotationType(ANNOTATION_KEYPOINT)\n\t\t}else if(event.key === ANNOTATION_SEG) {\n\t\t\ttoast_text = \"Mode Switch: Segmentation\"\n\t\t\tchangeSave(true)\n\t\t\tsetAnnotationType(ANNOTATION_SEG)\n\t\t}else if(event.key === ANNOTATION_FRAME){\n\t\t\ttoast_text = \"Mode Switch: Behavior Annotation\"\n\t\t\tchangeSave(true)\n\t\t\tsetAnnotationType(ANNOTATION_FRAME)\n\t\t}else if (event.key === \"a\"){\n\t\t\tvar annotext = \"\"\n\t\t\tif(annotationType === ANNOTATION_BBOX){\n\t\t\t\tannotext = \"Bounding Box\"\n\t\t\t}else if(annotationType === ANNOTATION_FRAME){\n\t\t\t\tannotext = \"Behavior Data\"\n\t\t\t}else if (annotationType === ANNOTATION_KEYPOINT){\n\t\t\t\tannotext = \"Keypoint\"\n\t\t\t}else if (annotationType === ANNOTATION_SEG){\n\t\t\t\tannotext = \"Segmentation\"\n\t\t\t}\n\t\t\ttoast_text = \"Added Annotation - \" + annotext\n\t\t\tif(annotationType !== ANNOTATION_SEG){\n\t\t\t\tchangeSave(true)\n\t\t\t}\n\t\t\taddToCanvas()\n\t\t}else if (event.key === \"q\"){\n\t\t\tskip_frame_backward()\n\t\t}else if (event.key === \"w\"){\n\t\t\talert(\"Video is currently under development, please use images for now!\")\n\t\t}else if (event.key === \"e\"){\n\t\t\tskip_frame_forward()\n\t\t}else if(event.key === \"c\"){\n\t\t\t\n\t\t}\n\t}  \n\n\tuseEffect(() => {\n\t\tdocument.addEventListener(\"keydown\", onKeyPress);\n\t\treturn () => document.removeEventListener(\"keydown\", onKeyPress);\n\t}, [onKeyPress]);\n\t\n\n\tconst handle_visual_toggle = () => {\n\t\tsetVisualToggle(Math.floor(Math.random() * 999999999999))\n\t}\n\n\tconst toggleKeyCheck = (toggle_val) => {\n\t\tconsole.log(\"Keycheck activated\")\n\t\tif(toggle_val === undefined){\n\t\t\tchangeKeyCheck(!keyCheck)\n\t\t}else{\n\t\t\tchangeKeyCheck(toggle_val)\n\t\t}\n\t}\n\n\tconst handleChangeAnnot = val => {\n\t\tsetCurrAnnotationData(val)\n\t}\n\n\tconst genFabricCanvas = () => {\n\t\tvar fcanvas = []\n\t\tfor(var i = 0; i < imagedata_redux.length; i++){\n\t\t\tlet canv = (\n\t\t\t\t<div style={{gridColumn: 1, gridRow:i+1, position: \"relative\",  top: 0, left: 0}}>\n\t\t\t\t\t<FabricRender \n\t\t\t\t\t\tcurrentFrame={currframe_redux}\n\t\t\t\t\t\tscaling_factor_height={scaling_factor_height}\n\t\t\t\t\t\tscaling_factor_width={scaling_factor_width}\n\t\t\t\t\t\tstream_num={i}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t)\n\t\t\tfcanvas.push(canv)\n\t\t}\n\t\tconsole.log(fcanvas)\n\t\treturn(\n\t\t\t<div>\n\t\t\t{\n\t\t\t\tfcanvas.map((can, _) => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\tcan\n\t\t\t\t\t)\n\t\t\t\t})\n\t\t\t}\n\t\t\t</div>\n\t\t)\n\t}\n\n\treturn (\n\t\t<div>\n\t\t\t<CustomNavBar \n\t\t\t\tdisable_buttons={disable_buttons} \n\t\t\t\tvideo_width={video_width} \n\t\t\t\tvideo_height={video_height} \n\t\t\t\tskip_value={skip_value} \n\t\t\t\thandleOldAnnotation={handleOldAnnotation}\n\t\t\t\tcurrentFrame={currframe_redux}\n\t\t\t\tdisplay_frame_num={\"Frame #\" + parseInt(currframe_redux+1)+' / '+parseInt(total_frames)}\n\t\t\t\tskip_frame_forward={skip_frame_forward}\n\t\t\t\tskip_frame_backward={skip_frame_backward}\n\t\t\t\tplay_button_text={play_button_text}\n\t\t\t\taddToCanvas={addToCanvas}\n\t\t\t\tANNOTATION_VIDEO_NAME={ANNOTATION_VIDEO_NAME}\n\t\t\t\tchange_annotation_type={change_annotation_type}\n\t\t\t\tVIDEO_METADATA={VIDEO_METADATA}\n\t\t\t\ttoggleKeyCheck={toggleKeyCheck}\n\t\t\t\thandle_visual_toggle={handle_visual_toggle}\n\t\t\t\thandleInputType={handleInputType}\n\t\t\t/>\n\t\t\t<Toast \n\t\t\t\tonClose={() => changeSave(false)} \n\t\t\t\tshow={save} delay={500} autohide\n\t\t\t\tstyle={{ position: 'absolute', top: '100', left: '100', zIndex: '100'}}\n\t\t\t>\n\t\t\t\t<Toast.Header>\n\t\t\t\t\t<strong className=\"mr-auto\">{toast_text}</strong>\n\t\t\t\t</Toast.Header>\n\t\t\t</Toast>\n\t\t\t{\n\t\t\t\tupload === true && \n\t\t\t\t<div style={{display: \"grid\"}}>\n\t\t\t\t\t{genFabricCanvas()}\n\t\t\t\t\t<div style={{gridColumn: 2, gridRow:1, position: \"relative\", top: 0, left: 0}}>\n\t\t\t\t\t\t<AnnotationTable\n\t\t\t\t\t\t\tannotation_data={currAnnotationData}\n\t\t\t\t\t\t\tchange_annotation_data={handleChangeAnnot}\n\t\t\t\t\t\t\tcurrentFrame={currframe_redux}\n\t\t\t\t\t\t\ttoggleKeyCheck={toggleKeyCheck}\n\t\t\t\t\t\t\tcolumns={columns}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t}\n\t\t\t{\n\t\t\t\tupload === false &&\n\t\t\t\t<div>\n\t\t\t\t\t\"Video/Image upload not detected. Please upload.\"\n\t\t\t\t</div>\n\t\t\t}\n\t\t</div>\n\t);\n}","export const ANNOTATION_FRAME = \"1\"\nexport const ANNOTATION_BBOX = \"2\"\nexport const ANNOTATION_SEG = \"3\"\nexport const ANNOTATION_KEYPOINT = \"4\"\n","\nimport React, { useState } from \"react\";\nimport 'bootstrap/dist/css/bootstrap.min.css';\n\nimport Button from 'react-bootstrap/Button'\nimport Modal from 'react-bootstrap/Modal'\nimport Carousel from 'react-bootstrap/Carousel'\n\nimport MainUpload from './main_upload'\nimport { Container, Jumbotron, Col, Row, Card} from \"react-bootstrap\";\nimport Instructions from \"../Components/instructions\";\n\nimport selection_items from '../../static_data/selectionscreen_info.json'\n\n//<img src={process.env.PUBLIC_URL + '/favicon.ico'} alt=\"logo\" style={{width: \"30%\"}} />\nfunction SelectionScreen(){\n    const [show, setShow] = useState(false);\n    const handleClose = () => setShow(false);\n\tconst handleShow = () => setShow(true);\n    const [upload, setUpload] = useState(false)\n    const handleUpload = (event) => {\n        setUpload(!upload)\n    }\n\n    const [multiview, setMultiview] = useState(false)\n    const handleMultiview = (event) => {\n        setMultiview(!multiview)\n    }\n\n    if(upload){\n        return (<MainUpload/>)\n    }else{\n        return (\n            <div>\n                <Modal show={show} onHide={handleClose} size='lg'>\n                    <Modal.Header closeButton>\n                    <Modal.Title>Instructions</Modal.Title>\n                    </Modal.Header>\n                    <Modal.Body><Instructions></Instructions></Modal.Body>\n                    <Modal.Footer>\n                    <Button variant=\"secondary\" onClick={handleClose}>Close</Button>\n                    </Modal.Footer>\n                </Modal>\n                <main>\n                    <Jumbotron className=\"text-center\">\n                        <Container>\n                            <h1 className=\"jumbotron-heading\">AVAT</h1>\n                            <p className=\"lead text-muted\"> Analysis tool to record data for livestock behavior and computer vision applications. </p>\n                            <p>\n                                <Button onClick={handleUpload} variant=\"success\" className=\"mx-1 my-2\">Video Upload</Button>\n                            </p>\n                        </Container>\n                    </Jumbotron>\n                        <Carousel controls={false} fade style={{\"width\": \"70%\", \"margin-left\": \"auto\", \"margin-right\": \"auto\"}}>\n                            {\n                                selection_items.map((item, key) => {\n                                    return(\n                                        <Carousel.Item interval={item.slide_time}>\n                                            <Card \n                                                className=\"mb-5 box-shadow\" \n                                                top\n                                                width='100%'\n                                            >\n                                                <Card.Img width=\"60%\" variant=\"top\" src={process.env.PUBLIC_URL + item.src} />\n                                                <Card.Body style={{\"text-align\": \"center\"}}>\n                                                    <Card.Title>{item.altText}</Card.Title>\n                                                    <Card.Text>{item.description}</Card.Text>\n                                                </Card.Body>\n                                            </Card>\n                                        </Carousel.Item>\n                                    )\n                                })\n                            }\n                        </Carousel>\n                </main>\n            </div>\n        )\n    }\n}\n\nexport default SelectionScreen;","/**\n * @author Pradeep Senthil (pradeepsen99@gmail.com)\n * @\n */\n\n import React, { useState } from \"react\"; \n import ReactDOM from 'react-dom'\n import './App.css';\n import ReactPlayer from 'react-player'\n import 'bootstrap/dist/css/bootstrap.min.css';\n \n import FrontEnd from './ui_elements/Pages/main_upload'\n import SelectionScreen from './ui_elements/Pages/selection_screen'\n \n //<FrontEnd></FrontEnd>\n function App() {\n   return (\n     <div>\n       <SelectionScreen></SelectionScreen>    \n     </div>\n   );\n }\n       //<ActiveObject />\n       //<input type=\"file\" onChange={handleVideoUpload1} />\n       //<div>\n         //<ReactPlayer url={videoFilePath1} width=\"50%\" height=\"50%\" controls={true} style={{position:'relative', float:'left'}}/>\n         //<Fabric/>\n       //</div>\n \n export default App;","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nimport { Provider } from 'react-redux'\nimport store from './store'\n\n/* ReactDOM.render(\n    <App/>,\n    document.getElementById('root')\n);\n */\n\n//REDUX code\nReactDOM.render(\n    <Provider store={store}>\n      <App/>,\n    </Provider>,\n    document.getElementById('root')\n);\n\n\n/**\n * IF NEED TO RE-ENABLE STRICT MODE THEN UNNCOMMENT AND ADD BACK\n * \n *   <React.StrictMode>\n    <MainUpload></MainUpload>\n  </React.StrictMode>,\n */\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}