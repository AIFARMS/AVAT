(this.webpackJsonpannotation_tool=this.webpackJsonpannotation_tool||[]).push([[0],{104:function(e,t,a){},105:function(e,t,a){},178:function(e,t){},179:function(e,t){},180:function(e,t){},186:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),r=a(13),l=a.n(r),o=(a(104),a(105),a(37)),c=a.n(o),s=(a(45),a(32)),u=a(12),d=a(43),m=a.n(d),h=a(55),f=a(10),b=a(11),v=a(35),g=a(36),p=a(22),E=a(26),y=a(38),O=a(39),j=function(){function e(t){Object(y.a)(this,e),this.objects=t.objects,console.log(this.objects)}return Object(O.a)(e,[{key:"getObjects",value:function(){return this.objects}},{key:"getObjectById",value:function(e){return this.objects[e]}},{key:"getObjectByIdFrame",value:function(e,t){return this.objects[e][t]}},{key:"getAllObjectByFrame",value:function(e){var t,a=[];for(t=0;t<this.objects.length;t++){var n=this.objects[t];if(!(n.frames[n.frames.length-1].frameNumber<e))for(var i=n.frames,r=0;r<i.length;r++)if(i[r].frameNumber===e){a.push(i[r]);break}}return console.log(a),a}}]),e}(),w=a(94),S=a.n(w),k=a(70),C=a.n(k),D=(a(173),[{dataField:"id",text:"ID"},{dataField:"behavior",text:"Beh",editor:{type:k.Type.SELECT,options:[{value:"Lying",label:"lying"},{value:"Sitting",label:"sitting"},{value:"Standing",label:"standing"},{value:"Locomotion",label:"locomotion"},{value:"Consumption",label:"consumption"}]}},{dataField:"is_hidden",text:"Hid"},{dataField:"posture",text:"Pos",editor:{type:k.Type.SELECT,options:{posture:[{value:"Lying sternally",label:"lying_sternally"},{value:"Sitting",label:"sitting"},{value:"Standing",label:"standing"},{value:"Walking ",label:"walking"},{value:"Consumption",label:"consumption"}]}}}]);var T=function(e){var t=function(e){var t=[];if(null==e)return[];for(var a=0;a<e.objects.length;a++){var n=a+1,i=e.objects[a];console.log(i.left),t.push({id:n.toString(),behavior:"None",is_hidden:"False",posture:"None"})}return t}(e.data);return i.a.createElement("div",{style:{width:"15%"}},i.a.createElement(S.a,{condensed:!0,keyField:"id",data:t,columns:D,cellEdit:C()({mode:"click",blurToSave:!0})}))},A=a(193),x=a(78).fabric,F=function(){function e(t,a,n,i,r,l,o){Object(y.a)(this,e),this.top=t,this.left=a,this.id=l,this.behavior=o,this.color=r,this.width=n,this.height=i}return Object(O.a)(e,[{key:"rectangle",value:function(){return new x.Rect({hasRotatingPoint:!1,uniScaleTransform:!0,height:this.height,width:this.width,fill:this.color,borderColor:"#000",opacity:".4",top:this.top,left:this.left})}},{key:"id_text",value:function(){return new x.Text(this.id.toString(),{fontSize:20,top:this.top,left:this.left,uniScaleTransform:!1})}},{key:"behavior",value:function(){}},{key:"generate_no_behavior",value:function(){return new x.Group([this.rectangle(),this.id_text()],{left:this.left,top:this.top,uniScaleTransform:!0})}},{key:"generate_with_behavior",value:function(){}}]),e}();var I=function(){function e(t,a,n){Object(y.a)(this,e),this.frame_data=t,this.canvas_width=a,this.canvas_height=n,this.windowWidth=3840,this.windowHeight=2160}return Object(O.a)(e,[{key:"generate_frame",value:function(){for(var e=[],t=0;t<this.frame_data.length;t++){var a="#"+((1<<24)*Math.random()|0).toString(16);console.log(this.frame_data[t]);var n=new F(this.getTop(this.frame_data[t]),this.getLeft(this.frame_data[t]),this.getWidth(this.frame_data[t]),this.getHeight(this.frame_data[t]),a,t,"TEST").generate_no_behavior();e.push(n)}return e}},{key:"getID",value:function(e){return e.id}},{key:"getWidth",value:function(e){return Math.floor(e.bbox.width/this.windowWidth*this.canvas_width)}},{key:"getHeight",value:function(e){return Math.floor(e.bbox.height/this.windowHeight*this.canvas_height)}},{key:"getTop",value:function(e){return Math.floor(e.bbox.y/this.windowHeight*this.canvas_height)}},{key:"getLeft",value:function(e){return Math.floor(e.bbox.x/this.windowWidth*this.canvas_width)}}]),e}(),_=a(78).fabric,R=(a(91),a(92)),N=new _.Canvas("c",{uniScaleTransform:!0}),M=R({displayName:"Fabric",componentDidMount:function(){var e=l.a.findDOMNode(this);N.initialize(e,{height:.7*window.innerHeight,width:.7*window.innerWidth,backgroundColor:null}),N.on("mouse:up",(function(){L[U]=N.toJSON()})),N.on("saveData",(function(){N.renderAll()}))},render:function(){return i.a.createElement("canvas",null)}}),B=R({displayName:"NewObjects",render:function(){return i.a.createElement("div",{style:{float:"right"}},i.a.createElement(b.a,{onClick:this.addGroup,style:{position:"relative"}},"Add")," ",i.a.createElement(b.a,{onClick:this.remove,style:{position:"relative"}},"Remove")," ")},addGroup:function(){var e="#"+((1<<24)*Math.random()|0).toString(16),t=new F(N.height/2,N.width/2,50,50,e,1,"id: 1").generate_no_behavior();N.add(t),N.setActiveObject(t),N.fire("saveData")},remove:function(){N.remove(N.getActiveObject()),N.fire("saveData")}});var L=[],P=!1,U=0;var H=function(){var e=Object(n.useState)(null),t=Object(f.a)(e,2),a=t[0],r=t[1],l=Object(n.useState)(null),o=Object(f.a)(l,2),s=(o[0],o[1],Object(n.useState)(null)),u=Object(f.a)(s,2),d=u[0],y=u[1];Object(n.useEffect)((function(){null!=d&&(console.log(d),console.log(d.getAllObjectByFrame(2)))}),d);var O=function(e){return new Promise((function(t,a){var n=new FileReader;n.onload=function(e){t(JSON.parse(e.target.result))},n.readAsText(e.target.files[0])}))},w=Object(n.useState)(!1),S=Object(f.a)(w,2),k=S[0],C=S[1],D="ERROR";D=!0===k?"Pause":"Play";var x=Object(n.useState)(!1),F=Object(f.a)(x,2),_=(F[0],F[1]),R=Object(n.useState)(0),H=Object(f.a)(R,2),W=H[0],J=H[1],z=Object(n.useState)(null),V=Object(f.a)(z,2),q=V[0],Y=V[1],G=Object(n.useState)(0),X=Object(f.a)(G,2),K=X[0],$=X[1],Q=Object(n.useState)(0),Z=Object(f.a)(Q,2),ee=Z[0],te=Z[1],ae=Object(n.useState)(0),ne=Object(f.a)(ae,2);ne[0],ne[1],L[ee]=N.toJSON();var ie=function(){var e=Object(h.a)(m.a.mark((function e(){var t,a,n,i,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="generated_annotations",a=JSON.stringify(L),n=new Blob([a],{type:"application/json"}),e.next=5,URL.createObjectURL(n);case 5:i=e.sent,(r=document.createElement("a")).href=i,r.download=t+".json",document.body.appendChild(r),r.click(),document.body.removeChild(r);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),re=Object(n.useState)(!1),le=Object(f.a)(re,2),oe=le[0],ce=le[1],se=function(){return ce(!1)};return i.a.createElement("div",null,i.a.createElement(v.a,{bg:"dark",variant:"dark",className:"bg-5"},i.a.createElement(v.a.Brand,{href:"#home"},"Annotation Tool"),i.a.createElement(g.a,{className:"mr-auto"},i.a.createElement(g.a.Link,{onClick:function(){return ce(!0)}},"Instructions"),i.a.createElement(A.a,{title:"Annotation Type",id:"basic-nav-dropdown"},i.a.createElement(A.a.Item,null,"Square Box"),i.a.createElement(A.a.Divider,null),i.a.createElement(A.a.Item,null,"Key Point"),i.a.createElement(A.a.Divider,null),i.a.createElement(A.a.Item,null,"Wire Frame")),i.a.createElement(A.a,{title:"Export",id:"basic-nav-dropdown"},i.a.createElement(A.a.Item,{onClick:ie},"JSON"),i.a.createElement(A.a.Divider,null),i.a.createElement(A.a.Item,null,"CSV")),i.a.createElement(A.a,{title:"Settings",id:"basic-nav-dropdown"},i.a.createElement(A.a.Divider,null),i.a.createElement(A.a.Item,{disabled:!0},"Input Frame-Rate: ",i.a.createElement("input",{type:"text"})))),i.a.createElement("div",null,i.a.createElement(b.a,{variant:"secondary",disabled:"true"},"Frame # ",parseInt(ee)+" / "+parseInt(15*K)),i.a.createElement(E.a,{style:{float:"left",width:80}},i.a.createElement(E.a.File,{id:"file",label:"Annotation Upload",custom:!0,type:"file",onChange:function(e){O(e).then((function(e){null!=e?y(new j(e)):console.log("ERROR in upload old_annotation")}))}})),i.a.createElement(E.a,{style:{float:"left",width:80}},i.a.createElement(E.a.File,{id:"file",label:"Video Upload",custom:!0,type:"file",onChange:function(e){r(URL.createObjectURL(e.target.files[0])),P=!0}})),i.a.createElement(b.a,{variant:"primary",onClick:function(e){var t=15*K;q.seekTo((q.getCurrentTime()/K*t-1)/t)}},"Prev")," ",i.a.createElement(b.a,{variant:"primary",onClick:function(e){C(!k)}},D)," ",i.a.createElement(b.a,{variant:"primary",onClick:function(e){var t=15*K;L[ee]=N.toJSON(),console.log(ee),console.log(L),q.seekTo((q.getCurrentTime()/K*t+1)/t)}},"Next")," ",i.a.createElement(B,null))),i.a.createElement(p.a,{show:oe,onHide:se},i.a.createElement(p.a.Header,{closeButton:!0},i.a.createElement(p.a.Title,null,"Instructions")),i.a.createElement(p.a.Body,null,"TODO: Add instructions"),i.a.createElement(p.a.Footer,null,i.a.createElement(b.a,{variant:"secondary",onClick:se},"Close"))),i.a.createElement("div",{style:{display:"flex"}},i.a.createElement("div",{style:{position:"relative",width:.7*window.innerWidth,height:.7*window.innerHeight}},i.a.createElement(c.a,{onProgress:function(e){console.log(e);var t=15*K;if(t,J(ee/t),te(Math.round(e.played*t)),U=ee,null!=d){N.clear();for(var a=new I(d.getAllObjectByFrame(ee),N.width,N.height).generate_frame(),n=0;n<a.length;n++){var i=a[n];console.log(i),N.add(i),N.setActiveObject(i),N.fire("saveData")}}},ref:function(e){Y(e),!0===P&&null!=q&&(console.log("RESET VALUES"),L=new Array(7200),P=!1)},onDuration:function(e){$(parseInt(e)),console.log(e)},url:a,width:"100%",height:"99.999%",playing:k,controls:!1,style:{position:"realtive",float:"left"},volume:0,muted:!0,pip:!1}),i.a.createElement(M,null),i.a.createElement("input",{style:{width:.7*window.innerWidth},type:"range",min:0,max:.999999,step:"any",value:W,onMouseDown:function(e){_(!0)},onChange:function(e){J(parseFloat(e.target.value))},onMouseUp:function(e){_(!1),q.seekTo(parseFloat(e.target.value))}})),i.a.createElement(T,{data:L[ee],style:{float:"right"}})))},W=a(96),J=a(78).fabric,z=a(91),V=a(92),q=new z.Reactor({debug:!0}),Y=function(e){var t,a={};if(!(e instanceof Object)||Array.isArray(e))throw new Error("keyMirror(...): Argument must be an object.");for(t in e)e.hasOwnProperty(t)&&(a[t]=t);return a}({fabricData:null,activeObject:null}),G=new J.Canvas,X=z.Store({getInitialState:function(){return z.toImmutable({fabricData:{objects:[]},activeObject:!1})},initialize:function(){this.on(Y.fabricData,this.saveFabricData),this.on(Y.activeObject,this.saveActiveObject)},saveFabricData:function(e,t){return e.set("fabricData",z.toImmutable(t))},saveActiveObject:function(e,t){return e.set("activeObject",t)}});q.registerStores({fabricStore:X});var K=V({displayName:"Fabric",componentDidMount:function(){var e=l.a.findDOMNode(this);alert("Please use the upload functionality. This is a Alpha version and some features may be missing or broken. The video upload option should have the latest features and bug fixes. This sign will be updated when the youtube option is functional. "),G.initialize(e,{height:.8*window.innerHeight,width:.8*window.innerWidth,backgroundColor:null}),G.on("mouse:up",(function(){q.dispatch(Y.fabricData,G.toObject()),q.dispatch(Y.activeObject,!!G.getActiveObject())})),G.on("saveData",(function(){q.dispatch(Y.fabricData,G.toObject()),q.dispatch(Y.activeObject,!!G.getActiveObject()),G.renderAll()}))},render:function(){return i.a.createElement("canvas",null)}}),$=V({displayName:"NewObjects",mixins:[q.ReactMixin],getDataBindings:function(){return{fabricData:["fabricStore","fabricData"],activeObject:["fabricStore","activeObject"]}},render:function(){return this.state.fabricData.get("objects").size,i.a.createElement("div",{style:{float:"right"}},i.a.createElement(b.a,{onClick:this.addSquare,style:{position:"relative"}},"Add Square")," ",i.a.createElement(b.a,{onClick:this.remove,style:{position:"relative"}},"Remove")," ")},addSquare:function(){var e="#"+((1<<24)*Math.random()|0).toString(16),t=new J.Rect({hasRotatingPoint:!1,uniScaleTransform:!0,height:50,width:50,originX:"center",originY:"center",fill:e,borderColor:"#000",opacity:".4",top:G.height/2,left:G.width/2},(function(e){console.log(e)}));G.add(t),G.setActiveObject(t),G.fire("saveData")},remove:function(){G.remove(G.getActiveObject()),G.fire("saveData")}});V({displayName:"ActiveObject",mixins:[q.ReactMixin],getDataBindings:function(){return{fabricObject:["fabricStore","fabricData","objects",0],activeObject:["fabricStore","activeObject"]}},render:function(){if(console.log(this.state.activeObject),this.state.fabricObject){var e=this.state.fabricObject.get("fill");return console.log(G.getActiveObject()),i.a.createElement("div",null,i.a.createElement("div",null,i.a.createElement("b",null,"Active Object")),i.a.createElement("div",null,"fill: ",i.a.createElement("span",{style:{color:e}},this.state.fabricObject.get("fill"))),i.a.createElement("div",null,"top: ",this.state.fabricObject.get("top")),i.a.createElement("div",null,"left: ",this.state.fabricObject.get("left")),i.a.createElement("div",null,"angle: ",this.state.fabricObject.get("angle")),i.a.createElement("div",null,"scaleX: ",this.state.fabricObject.get("scaleX")),i.a.createElement("div",null,"scaleY: ",this.state.fabricObject.get("scaleY")))}return console.log(G.getActiveObject()),null}});var Q=[],Z=!1;var ee=function(){var e=Object(n.useState)(null),t=Object(f.a)(e,2),a=(t[0],t[1]),r=Object(n.useState)(null),l=Object(f.a)(r,2),o=(l[0],l[1],Object(n.useState)(null)),s=Object(f.a)(o,2),u=(s[0],s[1]),d=Object(n.useState)(!1),y=Object(f.a)(d,2),O=y[0],j=y[1],w="ERROR";w=!0===O?"Pause":"Play";var S=Object(n.useState)(!1),k=Object(f.a)(S,2),C=(k[0],k[1]),D=Object(n.useState)(0),x=Object(f.a)(D,2),F=x[0],I=x[1],_=Object(n.useState)(null),R=Object(f.a)(_,2),N=R[0],M=R[1],B=Object(n.useState)(0),L=Object(f.a)(B,2),P=L[0],U=L[1],H=Object(n.useState)(0),W=Object(f.a)(H,2),J=W[0],z=W[1],V=function(){var e=Object(h.a)(m.a.mark((function e(){var t,a,n,i,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="generated_annotations",a=JSON.stringify(Q),n=new Blob([a],{type:"application/json"}),e.next=5,URL.createObjectURL(n);case 5:i=e.sent,(r=document.createElement("a")).href=i,r.download=t+".json",document.body.appendChild(r),r.click(),document.body.removeChild(r);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),q=Object(n.useState)(!1),Y=Object(f.a)(q,2),X=Y[0],ee=Y[1],te=function(){return ee(!1)};return i.a.createElement("div",null,i.a.createElement(v.a,{bg:"dark",variant:"dark",class:"bg-5"},i.a.createElement(v.a.Brand,{href:"#home"},"Annotation Tool"),i.a.createElement(g.a,{className:"mr-auto"},i.a.createElement(g.a.Link,{onClick:function(){return ee(!0)}},"Instructions"),i.a.createElement(A.a,{title:"Annotation Type",id:"basic-nav-dropdown"},i.a.createElement(A.a.Item,null,"Square Box"),i.a.createElement(A.a.Divider,null),i.a.createElement(A.a.Item,null,"Key Point"),i.a.createElement(A.a.Divider,null),i.a.createElement(A.a.Item,null,"Wire Frame")),i.a.createElement(A.a,{title:"Export",id:"basic-nav-dropdown"},i.a.createElement(A.a.Item,{onClick:V},"JSON"),i.a.createElement(A.a.Divider,null),i.a.createElement(A.a.Item,null,"CSV")),i.a.createElement(A.a,{title:"Settings",id:"basic-nav-dropdown"},i.a.createElement(A.a.Divider,null),i.a.createElement(A.a.Item,{disabled:!0},"Input Frame-Rate: ",i.a.createElement("input",{type:"text"})))),i.a.createElement("div",null,i.a.createElement(b.a,{variant:"secondary",disabled:"true"},"Frame # ",parseInt(J)+" / "+parseInt(15*P)),i.a.createElement(E.a,{style:{float:"left",width:80}},i.a.createElement(E.a.File,{id:"file",label:"Annotation Upload",custom:!0,type:"file",onChange:function(e){return new Promise((function(t,a){var n=new FileReader;n.onload=function(e){t(u(JSON.parse(e.target.result)))},n.readAsText(e.target.files[0])}))}})),i.a.createElement(E.a,{style:{float:"left",width:80}},i.a.createElement(E.a.File,{id:"file",label:"Video Upload",custom:!0,type:"file",onChange:function(e){a(URL.createObjectURL(e.target.files[0])),Z=!0}})),i.a.createElement(b.a,{variant:"primary",onClick:function(e){var t=15*P;N.seekTo((N.getCurrentTime()/P*t-1)/t)}},"Prev Frame")," ",i.a.createElement(b.a,{variant:"primary",onClick:function(e){j(!O)}},w)," ",i.a.createElement(b.a,{variant:"primary",onClick:function(e){var t=15*P;Q[J]=G.toJSON(),console.log(J),console.log(Q),N.seekTo((N.getCurrentTime()/P*t+1)/t)}},"Next Frame")," ",i.a.createElement($,null))),i.a.createElement(p.a,{show:X,onHide:te},i.a.createElement(p.a.Header,{closeButton:!0},i.a.createElement(p.a.Title,null,"Instructions")),i.a.createElement(p.a.Body,null,"TODO: Add instructions"),i.a.createElement(p.a.Footer,null,i.a.createElement(b.a,{variant:"secondary",onClick:te},"Close"))),i.a.createElement("div",{style:{display:"flex"}},i.a.createElement("div",{style:{position:"relative"}},i.a.createElement(c.a,{onProgress:function(e){console.log(e);var t=15*P;t,I(J/t),z(Math.round(e.played*t))},ref:function(e){M(e),!0===Z&&null!=N&&(console.log("RESET VALUES"),Q=new Array(7200),Z=!1)},onDuration:function(e){U(parseInt(e)),console.log(e)},url:"https://www.youtube.com/watch?v=MF6J2H983HY",width:.8*window.innerWidth,height:.8*window.innerHeight,playing:O,controls:!1,style:{position:"realtive",float:"left"},volume:0,muted:!0,pip:!1}),i.a.createElement(K,null),i.a.createElement("input",{style:{width:.8*window.innerWidth},type:"range",min:0,max:.999999,step:"any",value:F,onMouseDown:function(e){C(!0)},onChange:function(e){I(parseFloat(e.target.value))},onMouseUp:function(e){C(!1),N.seekTo(parseFloat(e.target.value))}})),i.a.createElement(T,{data:Q[J],style:{float:"right"}})))},te=a(191),ae=a(192);var ne=function(){var e=Object(n.useState)(!1),t=(Object(W.a)(e),Object(n.useState)(!1)),a=Object(f.a)(t,2),r=a[0],l=(a[1],Object(n.useState)(!1)),o=Object(f.a)(l,2),c=o[0];return o[1],r?i.a.createElement(ee,null):c?i.a.createElement(H,null):i.a.createElement(s.a,null,i.a.createElement("div",null,i.a.createElement(te.a,{fluid:!0},i.a.createElement(ae.a,null,i.a.createElement("div",{class:"row align-items-center"},i.a.createElement("div",{class:"pb-4 col-md-6 col-lg-7"},i.a.createElement("h0",{style:{fontSize:"50px"}},"Annotation Tool ","  ",i.a.createElement("img",{class:"",src:"./favicon.ico",alt:"logo",style:{width:"9%"}})),i.a.createElement("h5",null," Online tool to mass annotate videos for AI/ML "),i.a.createElement(b.a,{size:"lg"},"Instructions")),i.a.createElement("div",{class:"col-md-6 col-lg-5"},i.a.createElement("div",{class:"row"},i.a.createElement("div",{class:"col"},i.a.createElement("div",{class:"card my-2"},i.a.createElement(s.c,{to:"/upload",variant:"btn-primary outline-success"},"Video Upload"))),i.a.createElement("div",{class:"col-12"},i.a.createElement("div",{class:"card my-2"},i.a.createElement(s.c,{to:"/youtube",variant:"btn-primary outline-success"},"Youtube"))))))),i.a.createElement("div",{class:"container"},i.a.createElement("div",{class:"row align-items-center"}))),i.a.createElement(u.c,null,i.a.createElement(u.a,{path:"/youtube",component:ee}),i.a.createElement(u.a,{path:"/upload",component:H}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(s.b,null,i.a.createElement("div",null,i.a.createElement(u.c,null,i.a.createElement(u.a,{exact:!0,path:"/",component:ne}),i.a.createElement(u.a,{path:"/youtube",component:ee}),i.a.createElement(u.a,{path:"/upload",component:H}))))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},99:function(e,t,a){e.exports=a(186)}},[[99,1,2]]]);
//# sourceMappingURL=main.f19836cc.chunk.js.map