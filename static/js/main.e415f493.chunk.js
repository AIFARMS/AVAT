(this.webpackJsonpavat=this.webpackJsonpavat||[]).push([[0],{116:function(e){e.exports=JSON.parse('[{"src":"/assets/tensorflow.gif","altText":"Model assisted annotation","description":"Supports integration with pre-trained Tensorflow models to accelerate annotation","slide_time":10000},{"src":"/assets/add_remove.gif","altText":"Quickly add and remove annotations","description":"Add and remove annotations with ease with individual edits or whole frame edits","slide_time":8000},{"src":"/assets/bounding_box.png","altText":"Bounding Box","description":"Rectangle that serves as a point of refrence for training object detection AI models. This annotation can be coupled with behavior data.","slide_time":4000},{"src":"/assets/annotation_count.png","altText":"Keep track of multiple annotations accross frames","description":"Full frame data summary helps keep track of multiple annotations by local and global id.","slide_time":4000},{"src":"/assets/youtube.png","altText":"Video Support","description":"Supports videos from Local Files, Youtube, Vimeo and Dailymotion","slide_time":4000}]')},118:function(e,t,a){e.exports=a(216)},123:function(e,t,a){},124:function(e,t,a){},149:function(e,t){},150:function(e,t){},151:function(e,t){},216:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),o=a(15),r=a.n(o),l=(a(123),a(124),a(95),a(40),a(7)),c=a(93),s=a(41),d=a(42),u=a(53).fabric,m=(u.util.createClass(u.Rect,{type:"boundingbox",initialize:function(e){e||(e={}),this.callSuper("initialize",e),this.set("label",e.label||"")},toObject:function(){return u.util.object.extend(this.callSuper("toObject"),{label:this.get("label")})},_render:function(e){this.callSuper("_render",e),e.font="10px Helvetica",e.fillStyle="#333",e.fillText(this.label,-this.width/2,-this.height/2+20),e.uniScaleTransform=!1}}),a(53).fabric),h=function(){function e(t,a,n,i,o,r,l){Object(s.a)(this,e),this.top=t,this.left=a,this.id=r,this.behavior=l,this.color=o,this.width=n,this.height=i}return Object(d.a)(e,[{key:"rectangle",value:function(){return new m.Rect({hasRotatingPoint:!1,height:this.height,width:this.width,fill:this.color,opacity:".4",top:this.top,left:this.left})}},{key:"id_text",value:function(){return new m.Text(this.id.toString(),{fontSize:20,top:this.top,left:this.left,uniScaleTransform:!1})}},{key:"generate_no_behavior",value:function(){var e=new m.Group([this.rectangle(),this.id_text()],{borderColor:"#000000",hasBorders:!0,uniScaleTransform:!0});var t=this.id;return e.local_id=t,e.toJSON()}},{key:"generate_mouse_no_behavior",value:function(e){var t,a,n,i;new m.Text(this.id.toString(),{fontSize:20,top:this.top,left:this.left,uniScaleTransform:!1});e.on("mouse:down",(function(o){a=!0;var r=e.getPointer(o.e);n=r.x,i=r.y;r=e.getPointer(o.e);var l=new m.Rect({left:n,top:i,originX:"left",originY:"top",width:r.x-n,height:r.y-i,angle:0,fill:"rgba(255,0,0,0.5)",transparentCorners:!1,uniScaleTransform:!0});t=l,e.add(t)})),e.on("mouse:move",(function(o){if(a){var r=e.getPointer(o.e);n>r.x&&t.set({left:Math.abs(r.x)}),i>r.y&&t.set({top:Math.abs(r.y)}),t.set({width:Math.abs(n-r.x)}),t.set({height:Math.abs(i-r.y)}),e.renderAll()}})),e.on("mouse:up",(function(t){a=!1,e.off("mouse:down"),e.off("mouse:up")}))}}]),e}(),f=a(53).fabric,p=(a(152),function(){function e(t,a,n){Object(s.a)(this,e),this.frame_data=t.annotations,this.annotation_data=t.behavior_data,this.width=a,this.height=n,this.metadata=t.vid_metadata}return Object(d.a)(e,[{key:"get_frame_data",value:function(){return console.log(this.scale_annotations()),this.scale_annotations()}},{key:"get_annotation_data",value:function(){return this.annotation_data}},{key:"find_highest_localid",value:function(){for(var e=[],t=0;t<this.annotation_data.length;t++)for(var a=0;a<this.annotation_data[t].length;a++)console.log(this.annotation_data[t][a]),e.push(parseInt(this.annotation_data[t][a].id.replace(/\D/g,"")));return console.log(Math.max.apply(Math,e)),Math.max.apply(Math,e)+1}},{key:"scale_annotations",value:function(){var e=[];console.log(this.frame_data);for(var t=0;t<this.frame_data.length;t++){var a=[],n=this.frame_data[t];if(null!=n){for(var i=0;i<n.length;i++)if("bounding_box"===n[i].type){var o=parseInt(n[i].x)/parseInt(this.metadata.horizontal_res)*this.width,r=n[i].y/this.metadata.vertical_res*this.height,l=n[i].width/this.metadata.horizontal_res*this.width,c=n[i].height/this.metadata.vertical_res*this.height,s="#"+((1<<24)*Math.random()|0).toString(16),d=new h(r,o,l,c,s,n[i].local_id,"None").generate_no_behavior(this);d.local_id=n[i].local_id,a.push(d)}else if("segmentation"===n[i].type){for(var u=[],m=n[i].points,p=0;p<m.length;p++){var g=parseInt(m[p].x)/parseInt(this.metadata.horizontal_res)*this.width,b=m[p].y/this.metadata.vertical_res*this.height;u.push({x:g,y:b})}var _=new f.Polygon(u,{strokeWidth:1,stroke:"green",opacity:.5,scaleX:1,scaleY:1,objectCaching:!1,transparentCorners:!1,cornerColor:"blue",originX:"center",originY:"center"}),v=new f.Text(n[i].local_id,{fontSize:20,centerX:"center",top:u[0].y,left:u[0].x,uniScaleTransform:!1,fill:"white"}),y=new f.Group([_,v],{perPixelTargetFind:!0});y.lockMovementY=!0,y.lockMovementX=!0,y.selectable=!1,y.local_id=n[i].local_id,a.push(y)}e.push(a)}else e.push([])}return console.log(e),e}}]),e}()),g=a(60),b=[{value:"Feeding",label:"Feeding"},{value:"Drinking",label:"Drinking"},{value:"Exploratory",label:"Exploratory"},{value:"Social",label:"Social"},{value:"Locomotion",label:"Locomotion"},{value:"Proximity",label:"Proximity"},{value:"Others",label:"Others"}],_=[{value:"Lying",label:"Lying"},{value:"Sitting",label:"Sitting"},{value:"Kneeling",label:"Kneeling"},{value:"Standing",label:"Standing"}],v=[{value:"No occlusion",label:"No occlusion"},{value:"Minor occlusion",label:"Minor occlusion"},{value:"Split occlusion",label:"Split occlusion"},{value:"End occlusion",label:"End occlusion"},{value:"Critical occlusion",label:"Critical occlusion"}],y=a(13),E=function(e){return[{dataField:"id",text:"ID",headerStyle:function(){return{width:"40px",left:0}},editable:!1},{dataField:"global_id",text:"Glo",headerStyle:function(){return{width:"70px",left:0}}},{dataField:"posture",text:"Posture",editor:{type:g.Type.SELECT,options:_}},{dataField:"behavior",text:"Behavior",editor:{type:g.Type.SELECT,options:b}},{dataField:"confidence",text:"Confidence",editor:{type:g.Type.SELECT,options:v}},{dataField:"remove",text:"Del",editable:!1,headerStyle:function(){return{width:"50px",left:0}},headerFormatter:function(){return i.a.createElement("div",null,"Del",i.a.createElement(y.a,{className:"btn btn-danger btn-xs",onClick:function(){return e()},label:"Del"}))},formatter:function(t,a){return i.a.createElement("div",null,i.a.createElement(y.a,{className:"btn btn-danger btn-xs",onClick:function(){return e(a.id)},label:"Del"}))}}]},w=a(81),O=a(59),j=a(221),k=a(49),S=a(26),x=a(14),T=a(222),C=a(11);a(162);function N(){return i.a.createElement("div",null,i.a.createElement("h3",null,"Keybinds:"),"There are preset keybinds setup to make it easier to use the tool without having to click around. If done properly a combination of mouse and keyboard actions speed up the annotation process.",i.a.createElement("br",null),i.a.createElement("br",null),"* ",i.a.createElement("kbd",null,"1")," : Mode Switch: Behavior",i.a.createElement("br",null),"* ",i.a.createElement("kbd",null,"2")," : Mode Switch: Bounding Box",i.a.createElement("br",null),"* ",i.a.createElement("kbd",null,"3")," : Mode Switch: Segmentation (Currently Disabled)",i.a.createElement("br",null),"* ",i.a.createElement("kbd",null,"a")," : Add annotation",i.a.createElement("br",null),"* ",i.a.createElement("kbd",null,"e")," : Skip forward frame(s)",i.a.createElement("br",null),"* ",i.a.createElement("kbd",null,"q")," : Skip backward frame(s)",i.a.createElement("br",null),"* ",i.a.createElement("kbd",null,"w")," : Pause/Play",i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement("h3",null,"Uploading Video:"),'Ensure that you know the framerate of the video chosen to be annotated. These values should be entered into the settings tab into their "frame rate" fields.',i.a.createElement("br",null),i.a.createElement("br",null),"Click on the right side browse button. All other buttons on the screen shuold be disabled until the video has been uploaded. Currenntly ```.mp4``` format is the best choice and tested for. Other file types such as .avi are supported but might have unintended bugs.",i.a.createElement("br",null),"Please note that videos SHOULD be in 16:9 aspect ratio for best results. Extraneous behavior may occur if resolution is different.",i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement("h3",null,"Uploading Image:"),"Select all of the image files needed for the various inputs. To select a group of images, they should be in the same folder.",i.a.createElement("br",null),"Please note that images SHOULD be in 16:9 aspect ratio for best results. Extraneous behavior may occur if resolution is different.",i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement("h3",null,"Annotations"),i.a.createElement("br",null),"There are currently two kinds of annotations.",i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement("h4",null,"Behavior Annotation:"),"This is for having annotations that do not have any visual attribute attached to it. This annotation is also attached by default when the bounding box or segmentation annotation is created.",i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement("h4",null,"Bounding Box:"),"This forms a square around the desired object. There should be small squares at the edges of the bounding box which can be used to resize the box. The number on the top left of the box is used to identify the placement of the box in the table to the right.",i.a.createElement("br",null),i.a.createElement("br",null))}var A=a(27),I=a.n(A),F=a(50),R=a(19),M=Object(R.b)({name:"frame_data",initialState:{data:[]},reducers:{init:function(e,t){for(var a=[],n=0;n<t.payload;n++)a.push([]);e.data=a},initOldAnnotation:function(e,t){e.data=t.payload},modifyFrame:function(e,t){var a=e.data;a[t.payload.currentFrame]=t.payload.data,e.data=a},middleware:function(e){return e({serializableCheck:!1})}}}),B=M.actions,D=(B.init,B.modifyFrame,M.reducer),z=Object(R.b)({name:"annotation_data",initialState:{data:[]},reducers:{init:function(e,t){console.log(t.payload);for(var a=[],n=0;n<t.payload;n++)a.push([]);e.data=a},initOldAnnotation:function(e,t){e.data=t.payload},modifyFrame:function(e,t){console.log(t.payload);var a=e.data;a[t.payload.currentFrame]=t.payload.data,e.data=a},middleware:function(e){return e({serializableCheck:!1})}}}),P=z.actions,V=(P.init,P.modifyFrame,z.reducer),L={data:void 0},U=Object(R.b)({name:"column_annot",initialState:L,reducers:{init:function(e,t){console.log(t.payload.data),e.data=t.payload.data},middleware:function(e){return e({serializableCheck:!1})}}}),H=(U.actions.init,U.reducer),J={data:void 0},Y=Object(R.b)({name:"current_frame",initialState:J,reducers:{init:function(e,t){console.log(t.payload.data),e.data=t.payload.data},changeFrame:function(e,t){e.data=t.payload.data},middleware:function(e){return e({serializableCheck:!1})}}}),K=(Y.actions.init,Y.reducer),X=Object(R.b)({name:"media_data",initialState:{data:[]},reducers:{init:function(e,t){for(var a=[],n=0;n<t.payload;n++)a.push([]);e.data=a},addMedia:function(e,t){var a=e.data,n=t.payload.media;console.log(t),console.log(a),a[t.payload.stream_num]=n,e.data=a},middleware:function(e){return e({serializableCheck:!1})}}}),G=X.actions,q=(G.init,G.modifyFrame,X.reducer);function W(e){ue.dispatch({type:"frame_data/init",payload:e})}function Q(e,t){ue.dispatch({type:"frame_data/modifyFrame",payload:{currentFrame:e,data:t}})}function Z(e){return JSON.parse(JSON.stringify(ue.getState().frame_data.data[e]))}function $(e){ue.dispatch({type:"annotation_data/init",payload:e})}function ee(e,t){ue.dispatch({type:"annotation_data/modifyFrame",payload:{currentFrame:e,data:t}})}function te(e){return JSON.parse(JSON.stringify(ue.getState().annotation_data.data[e]))}function ae(e){ue.dispatch({type:"current_frame/changeFrame",payload:{data:e}})}function ne(e){ue.dispatch({type:"media_data/init",payload:e})}function ie(e,t){ue.dispatch({type:"media_data/addMedia",payload:{stream_num:e,media:t}})}function oe(e){ue.dispatch({type:"metadata/setMediaType",payload:{media_type:e}})}function re(e){ue.dispatch({type:"metadata/setTotalFrames",payload:{total_frames:e}})}function le(e){ue.dispatch({type:"metadata/setSkipValue",payload:{skip_value:e}})}var ce=Object(R.b)({name:"metadata",initialState:{horizontal_res:0,vertical_res:0,frame_rate:1,media_type:"in_video",total_frames:0,skip_value:1},reducers:{init:function(e,t){e.horizontal_res=t.payload.horizontal_res,e.vertical_res=t.payload.vertical_res,e.frame_rate=t.payload.frame_rate,e.media_type=t.payload.media_type,e.total_frames=t.payload.total_frames},setRes:function(e,t){e.horizontal_res=t.payload.horizontal_res,e.vertical_res=t.payload.vertical_res},setFrameRate:function(e,t){var a=JSON.parse(JSON.stringify(e)).frame_rate;e.total_frames=e.total_frames/a,e.total_frames=e.total_frames*t.payload.frame_rate,e.frame_rate=t.payload.frame_rate},setMediaType:function(e,t){e.media_type=t.payload.media_type},setTotalFrames:function(e,t){e.total_frames=t.payload.total_frames},setSkipValue:function(e,t){e.skip_value=t.payload.skip_value},middleware:function(e){return e({serializableCheck:!1})}}}),se=ce.actions,de=(se.init,se.setRes,se.setFrameRate,se.setMediaType,se.setTotalFrames,se.setSkipValue,ce.reducer),ue=Object(R.a)({reducer:{frame_data:D,annotation_data:V,column_annot:H,current_frame:K,media_data:q,metadata:de}});function me(){return(me=Object(F.a)(I.a.mark((function e(t,a,n,i,o){var r,l,c,s,d;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="generated_annotations",""!==t&&""!==a&&(r=t.split(".").slice(0,-1).join(".")+"_"+a),l=JSON.stringify({vid_metadata:o,annotations:n,behavior_data:ue.getState().annotation_data.data}),c=new Blob([l],{type:"application/json"}),e.next=6,URL.createObjectURL(c);case 6:s=e.sent,(d=document.createElement("a")).href=s,d.download=r+".json",document.body.appendChild(d),d.click(),document.body.removeChild(d);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var he=function(){function e(t,a,n,i,o){Object(s.a)(this,e),console.log(a),console.log(n),this.frame_data=t,this.width=a,this.height=n,this.metadata=i,this.image_data=o}return Object(d.a)(e,[{key:"get_frame_json",value:function(){var e=new Array(this.frame_data.length);console.log(this.metadata),console.log(this.frame_data);for(var t=0;t<this.frame_data.length;t++){var a=[];if(this.frame_data[t]!=[]){var n=this.frame_data[t];if(void 0!=n){for(var i=0;i<n.length;i++)try{if(console.log(n[i]),void 0==n[i])continue;if("group"!==n[i].type)continue;if("rect"===n[i]._objects[0]){console.log(n[i]);var o=n[i].left/this.width*this.metadata.horizontal_res,r=n[i].top/this.height*this.metadata.vertical_res,l=n[i].width*n[i].scaleX/this.width*this.metadata.horizontal_res,c=n[i].height*n[i].scaleY/this.height*this.metadata.vertical_res,s=n[i]._objects[1].text;0!=this.image_data.length?a.push({type:"bounding_box",x:o,y:r,width:l,height:c,local_id:s,"fileName:":this.image_data[t].name,dataType:"image"}):a.push({type:"bounding_box",x:o,y:r,width:l,height:c,local_id:s,"fileName:":this.metadata.name,dataType:"video"})}else if("polygon"===n[i]._objects[0].type){for(var d=n[i]._objects[0].points,u=[],m=0;m<d.length;m++){o=d[m].x/this.width*this.metadata.horizontal_res,r=d[m].y/this.height*this.metadata.vertical_res;u.push({x:o,y:r})}s=n[i]._objects[1].text;0!=this.image_data.length?a.push({type:"segmentation",points:u,local_id:s,"fileName:":this.image_data[t].name,dataType:"image"}):a.push({type:"segmentation",points:u,local_id:s,"fileName:":this.metadata.name,dataType:"video"})}}catch(h){console.log(h)}e[t]=a}}}return e}},{key:"get_frame_json_fullCanvas",value:function(){var e=new Array(this.frame_data.length);console.log(this.metadata);for(var t=0;t<this.frame_data.length;t++){var a=[];if(this.frame_data[t]!=[]){var n=this.frame_data[t].objects;if(void 0!=n){for(var i=0;i<n.length;i++)if(console.log(n[i]),"group"===n[i].type)if("rect"===n[i].objects[0].type){console.log(n[i]);var o=n[i].left/this.width*this.metadata.horizontal_res,r=n[i].top/this.height*this.metadata.vertical_res,l=n[i].width*n[i].scaleX/this.width*this.metadata.horizontal_res,c=n[i].height*n[i].scaleY/this.height*this.metadata.vertical_res,s=n[i].objects[1].text;0!=this.image_data.length?a.push({type:"bounding_box",x:o,y:r,width:l,height:c,local_id:s,"fileName:":this.image_data[t].name,dataType:"image"}):a.push({type:"bounding_box",x:o,y:r,width:l,height:c,local_id:s,"fileName:":this.metadata.name,dataType:"video"})}else if("polygon"===n[i].objects[0].type){for(var d=n[i].objects[0].points,u=[],m=0;m<d.length;m++){o=d[m].x/this.width*this.metadata.horizontal_res,r=d[m].y/this.height*this.metadata.vertical_res;u.push({x:o,y:r})}s=n[i].objects[1].text;0!=this.image_data.length?a.push({type:"segmentation",points:u,local_id:s,"fileName:":this.image_data[t].name,dataType:"image"}):a.push({type:"segmentation",points:u,local_id:s,"fileName:":this.metadata.name,dataType:"video"})}e[t]=a}}}return e}},{key:"get_frame_coco",value:function(){}}]),e}(),fe=a(52),pe=a(225);function ge(e){var t=Object(n.useState)(!1),a=Object(l.a)(t,2),o=a[0],r=a[1],c=Object(n.useState)(!0),s=Object(l.a)(c,2),d=s[0],u=s[1],m=Object(n.useState)("in_video"),h=Object(l.a)(m,2),f=h[0],p=h[1],g=Object(n.useState)(!1),b=Object(l.a)(g,2),_=(b[0],b[1]),v=Object(n.useState)(!1),E=Object(l.a)(v,2),A=E[0],I=E[1],F=Object(n.useState)(1),R=Object(l.a)(F,2),M=R[0],B=R[1],D=function(){return r(!1)},z=function(){u(!1),_(!0)},P=function(e){console.log(e.target.files),ie(parseInt(e.target.id),e.target.files)},V=function(e){return new Promise((function(t,a){var n=new FileReader;n.onload=function(e){t(JSON.parse(e.target.result))},n.readAsText(e.target.files[0])}))};return i.a.createElement("div",null,i.a.createElement(C.a,{show:o,onHide:D,size:"lg"},i.a.createElement(C.a.Header,{closeButton:!0},i.a.createElement(C.a.Title,null,"Instructions")),i.a.createElement(C.a.Body,null,i.a.createElement(N,null)),i.a.createElement(C.a.Footer,null,i.a.createElement(y.a,{variant:"secondary",onClick:D},"Close"))),i.a.createElement(C.a,{show:d,onHide:z,size:"lg"},i.a.createElement(C.a.Header,{closeButton:!0},i.a.createElement(C.a.Title,null,"Upload")),i.a.createElement(C.a.Body,null,i.a.createElement("div",{style:{display:"grid"}},i.a.createElement(S.a,null,"Media Format:",i.a.createElement(S.a.Control,{as:"select",id:"inlineFormCustomSelect",onChange:function(e){var t;t=e.target.value,console.log(t),"in_video"===t?(p("in_video"),oe("in_video")):"in_image"===t?(p("in_image"),oe("in_image")):alert("Wrong input detected - please report this bug.")},defaultValue:f},i.a.createElement("option",{value:"in_video"},"Video"),i.a.createElement("option",{value:"in_image"},"Image")),i.a.createElement(j.a.Divider,null)),i.a.createElement("div",null,"Stream Num: ",i.a.createElement("input",{type:"number",defaultValue:1,onClick:function(t){e.toggleKeyCheck(!1)},onBlur:function(t){e.toggleKeyCheck(!0)},onChange:function(e){B(e.target.value),ne(e.target.value)}})),i.a.createElement(j.a.Divider,null),function(){for(var e=[],t=0;t<M;t++){var a=i.a.createElement(S.a,{style:{float:"left",gridColumn:1,gridRow:4}},i.a.createElement(S.a.File,{multiple:!0,id:t+"",key:t,label:"Image Upload "+t,accept:"image/*",custom:!0,type:"file",onChange:function(e){P(e)}})),n=i.a.createElement(S.a,{style:{float:"left",gridColumn:1,gridRow:4}},i.a.createElement(S.a.File,{id:t+"",key:t,label:"Video Upload "+t,accept:".mp4",custom:!0,type:"file",onChange:function(e){P(e)}}));"in_image"===f?e.push(a):"in_video"===f&&e.push(n)}return i.a.createElement("div",null,e.map((function(e,t){return e})))}(),i.a.createElement(j.a.Divider,null),i.a.createElement(S.a,null,i.a.createElement(S.a.File,{disabled:e.disable_buttons,accept:".json",id:"file",label:"Column Upload",custom:!0,type:"file",onChange:function(e){V(e).then((function(e){var t;null!=e?(I(!0),console.log(e),t=e,ue.dispatch({type:"column_annot/init",payload:{data:t}})):alert("Error in processing columns")}))}})),i.a.createElement(S.a,null,i.a.createElement(S.a.File,{disabled:!A,accept:".json",id:"file",label:"Annotation Upload",custom:!0,type:"file",onChange:e.handleOldAnnotation})),i.a.createElement(j.a.Divider,null),"Frame Rate: ",i.a.createElement("input",{type:"number",onClick:function(t){e.toggleKeyCheck(!1)},onBlur:function(t){e.toggleKeyCheck(!0)},onChange:function(e){var t;t=e.target.value,ue.dispatch({type:"metadata/setFrameRate",payload:{frame_rate:t}})}}),i.a.createElement(j.a.Divider,null),"Skip Value: ",i.a.createElement("input",{type:"number",defaultValue:"1",onChange:function(e){le(e.target.value)}}),i.a.createElement(j.a.Divider,null))),i.a.createElement(C.a.Footer,null,i.a.createElement(y.a,{variant:"success",onClick:z},"Upload"))),i.a.createElement(w.a,{sticky:"top",bg:"dark",variant:"dark",className:"bg-5"},i.a.createElement(w.a.Brand,{href:"#home"},"AVAT"),i.a.createElement(O.a,{className:"mr-auto"},i.a.createElement(j.a,{disabled:e.disable_buttons,title:"Export",id:"basic-nav-dropdown"},i.a.createElement(j.a.Item,{onClick:function(){var t=new he(ue.getState().frame_data.data,e.video_width,e.video_height,e.VIDEO_METADATA,ue.getState().media_data.data[0]).get_frame_json();!function(e,t,a,n,i){me.apply(this,arguments)}(e.ANNOTATION_VIDEO_NAME,e.ANNOTATOR_NAME,t,e.annotation_data,e.VIDEO_METADATA)}},"JSON"),i.a.createElement(j.a.Divider,null)),i.a.createElement(k.a,{onClick:function(){return r(!0)}},"Instructions"),i.a.createElement(k.a,{onClick:e.handle_link_open},"Report")),i.a.createElement("div",null,i.a.createElement(y.a,{variant:"outline-success",onClick:function(){u(!0)}},"Upload")," "," ",i.a.createElement(x.a,{as:T.a},i.a.createElement(y.a,{variant:"secondary",disabled:!0},e.display_frame_num)," ",i.a.createElement(x.a.Toggle,{split:!0,variant:"secondary",id:"dropdown-split-basic"}),i.a.createElement(x.a.Menu,null,"Skip Value: ",i.a.createElement("input",{type:"number",defaultValue:"1",onChange:function(e){le(e.target.value)}})))," ",i.a.createElement(y.a,{variant:"primary",disabled:e.disable_buttons,onClick:e.skip_frame_backward},"Prev")," ","in_video"===f&&i.a.createElement(y.a,{variant:"primary",disabled:e.disable_buttons,onClick:e.handlePlaying},e.play_button_text)," ",i.a.createElement(y.a,{variant:"primary",disabled:e.disable_buttons,onClick:e.skip_frame_forward},"Next")," ",i.a.createElement(x.a,{as:T.a,drop:"left"},i.a.createElement(y.a,{variant:"success",onClick:e.addToCanvas},"Add"),i.a.createElement(x.a.Toggle,{split:!0,variant:"success",id:"dropdown-split-basic"}),i.a.createElement(x.a.Menu,null,i.a.createElement(x.a.Item,{onClick:function(t){e.change_annotation_type("1")}},"Behavior Annotation"),i.a.createElement(x.a.Item,{onClick:function(t){e.change_annotation_type("2")}},"BoundingBox"),i.a.createElement(x.a.Item,{onClick:function(t){e.change_annotation_type("3")}},"Segmentation"))))))}ne(1);var be=a(24),_e=a(53).fabric,ve=function(e,t,a,n,i,o,r,l){if("in_image"==t)return console.log("Redraw of canvas -- image"),(m=new Image).onload=function(){o.clear(),console.log(e),void 0!=e&&_e.util.enlivenObjects(e,(function(e){e.forEach((function(e,t){o.add(e)})),o.renderAll()})),console.log(o.getObjects());var t=new _e.Image(m,{objectCaching:!1,scaleX:n/m.width,scaleY:i/m.height});o.setBackgroundImage(t),o.renderAll(),console.log("updated canvas")},void(m.src=URL.createObjectURL(a));console.log("Redraw of canvas -- video");var c=document.createElement("canvas"),s=c.getContext("2d"),d=n,u=i;c.width=n,c.height=i,s.drawImage(l,0,0,d,u);var m,h=c.toDataURL();return(m=new Image).onload=function(){o.clear(),console.log(e),void 0!=e&&_e.util.enlivenObjects(e,(function(e){e.forEach((function(e,t){o.add(e)})),o.renderAll()})),console.log(o.getObjects());var t=new _e.Image(m,{objectCaching:!1,scaleX:n/m.width,scaleY:i/m.height});o.setBackgroundImage(t),o.renderAll(),c.remove(),console.log("updated canvas")},void(m.src=h)};function ye(e){var t=this,a=Object(n.useState)(null),o=Object(l.a)(a,2),c=o[0],s=o[1],d=Object(n.useState)(0),u=Object(l.a)(d,2),m=u[0],h=u[1],f=Object(n.useState)(!1),p=Object(l.a)(f,2),g=p[0],b=p[1],_=Object(be.b)((function(e){return e.metadata}));Object(be.b)((function(e){return e.frame_data}));Object(n.useEffect)((function(){var a,n=new _e.Canvas("c",{uniScaleTransform:!0,uniformScaling:!1,includeDefaultValues:!1});_e.Image.prototype.toObject=(a=_e.Image.prototype.toObject,function(){return _e.util.object.extend(a.call(this),{src:this.toDataURL()})}),n.on("mouse:wheel",(function(e){var t=e.e.deltaY,a=n.getZoom();(a*=Math.pow(.999,t))>20&&(a=20),a<.01&&(a=.01),n.zoomToPoint({x:e.e.offsetX,y:e.e.offsetY},a),e.e.preventDefault(),e.e.stopPropagation()})),n.on("mouse:down",(function(e){var t=e.e;!0===t.altKey&&(this.isDragging=!0,this.selection=!1,this.lastPosX=t.clientX,this.lastPosY=t.clientY)})),n.on("mouse:move",(function(e){if(this.isDragging){var t=e.e,a=this.viewportTransform;a[4]+=t.clientX-this.lastPosX,a[5]+=t.clientY-this.lastPosY,this.requestRenderAll(),this.lastPosX=t.clientX,this.lastPosY=t.clientY}})),n.on("mouse:up",(function(e){this.setViewportTransform(this.viewportTransform),this.isDragging=!1,this.selection=!0}));var i=r.a.findDOMNode(t);console.log(i);var o=document.getElementsByTagName("canvas")[2*e.stream_num];console.log(o),n.initialize(o,{height:e.scaling_factor_height,width:e.scaling_factor_width,backgroundColor:null}),s(n)}),[]);var v=Object(be.b)((function(e){return e.media_data}));console.log(v),v=v.data[e.stream_num];var y=Object(be.b)((function(e){return e.current_frame})).data;if(Object(n.useEffect)((function(){null!=c&&Q(m,c.getObjects()),h(y);var t=document.getElementsByTagName("video")[e.stream_num];1==g&&(t.currentTime=t.duration*((y+1)/_.total_frames))}),[y]),null!=c&&void 0!=v&&(console.log(v),v.length>0))if("in_video"==_.media_type){var E=document.getElementsByTagName("video")[e.stream_num];if(!1===g){var w=document.createElement("source");w.src=URL.createObjectURL(v[0]),w.type="video/mp4",E.appendChild(w),E.onloadedmetadata=function(){$(parseInt(E.duration)),W(parseInt(E.duration)),re(parseInt(E.duration)),E.currentTime=0},E.oncanplay=function(){ve(Z(y),"in_video",v[0],e.scaling_factor_width,e.scaling_factor_height,c,0,E)},b(!0)}else!0===g&&(E.currentTime=E.duration*((y+1)/_.total_frames))}else"in_image"==_.media_type&&ve(Z(y),"in_image",v[y],e.scaling_factor_width,e.scaling_factor_height,c);return i.a.createElement("div",{style:{display:"grid"}},i.a.createElement("div",{style:{gridColumn:1,gridRow:1,position:"relative",width:e.scaling_factor_width,height:e.scaling_factor_height,top:0,left:0,opacity:0}},i.a.createElement("video",null)),i.a.createElement("div",{style:{gridColumn:1,gridRow:1,position:"relative",top:0,left:0}},i.a.createElement("canvas",{id:e.stream_num})))}a(168),a(206),a(207);var Ee=a(114),we=a(115),Oe=a(77);function je(e){var t=e.columns,a=e.data,n=e.select_data,o=e.current_frame,r=(e.change_annot,Object(Oe.useTable)({columns:t,data:a})),l=r.getTableProps,c=r.getTableBodyProps,s=r.headerGroups,d=r.rows,u=r.prepareRow;return t?i.a.createElement("table",Object.assign({},l(),{style:{border:"solid 1px blue"}}),i.a.createElement("thead",null,s.map((function(e){return i.a.createElement("tr",e.getHeaderGroupProps(),e.headers.map((function(e){return i.a.createElement("th",Object.assign({},e.getHeaderProps(),{style:{background:"#657",color:"white",fontWeight:"bold"}}),e.render("Header"))})))}))),i.a.createElement("tbody",c(),d.map((function(e,a){u(e);e.id,e.global_id,e.posture,e.behavior,e.confidence;return function(e,t,a,n,o){var r=[];console.log(o);for(var l=0;l<a[0].columns.length;l++){var c=a[0].columns[l].accessor;if(xe(t,c)){var s=i.a.createElement("select",{id:n,"data-type":c,"data-curr":o,defaultValue:e[c],onChange:ke},i.a.createElement("option",{value:""}),t[c].map((function(e,t){return i.a.createElement("option",{value:e.value},e.value)})));r.push(s)}}return i.a.createElement("tr",{key:e.id},i.a.createElement("td",null,e.id),i.a.createElement("td",null,i.a.createElement("input",{type:"text",style:{width:"50%"},defaultValue:e.global_id,id:n,"data-type":"global_id","data-curr":o,onChange:ke})),r.map((function(e,t){return i.a.createElement("td",{id:t},e)})),i.a.createElement("td",null,i.a.createElement("input",{type:"button",style:{backgroundColor:"#f44336"},defaultValue:e.global_id,id:n,"data-type":"global_id","data-curr":o,onClick:Se})))}(e.original,n,t,a,o)})))):i.a.createElement("div",null,"No column upload detected.")}var ke=function(e){var t=te(e.target.dataset.curr);0!==t.length?(t[e.target.id][e.target.dataset.type]=e.target.value,ee(parseInt(e.target.dataset.curr),t)):alert("Row changing value failed - please report this bug.")},Se=function(e){var t=te(e.target.dataset.curr);if(0!==t.length){var a=t[e.target.id].id;console.log(a),t.splice(e.target.id,1),ee(parseInt(e.target.dataset.curr),t);for(var n=Z(e.target.dataset.curr),i=0;i<n.length;i++)n[i].objects[1].text==a&&n.splice(i,1);Q(parseInt(e.target.dataset.curr),n)}else alert("Row deletion failed - please report this bug.")};function xe(e,t){for(var a=Object.keys(e),n=0;n<a.length;n++)if(a[n]===t)return!0;return!1}function Te(e){var t=e.annotation_data;console.log(t);var a=[],n=[],o=void 0;void 0!=ue.getState().column_annot.data&&(n=ue.getState().column_annot.data.columns,o=ue.getState().column_annot.data.select_data,a.push(n));i.a.useMemo((function(){return[{Header:"Name",columns:[{Header:"Frame",accessor:"frame_num"},{Header:"Count",accessor:"anno_count"},{Header:"Local ID",accessor:"local_id"},{Header:"Global ID",accessor:"global_ids"}]}]}),[]);return i.a.createElement("div",null,0!=n.length&&i.a.createElement(Ee.a,{defaultActiveKey:"home",id:"uncontrolled-tab-example"},i.a.createElement(we.a,{eventKey:"home",title:"Current"},i.a.createElement(je,{columns:a,data:t,select_data:o,current_frame:e.currentFrame,change_annot:e.handleChangeAnnot}))))}a(53).fabric;var Ce=1920,Ne=1080,Ae=window.screen.height;Ae>=1080?(Ce=1280,Ne=720):Ae>=1024?(Ce=1152,Ne=648):Ae>=768&&(Ce=1024,Ne=576);var Ie,Fe,Re,Me,Be,De,ze=!1,Pe=!0,Ve="",Le={},Ue=!1;function He(){var e=Object(n.useState)(0),t=Object(l.a)(e,2),a=(t[0],t[1]),o=Object(n.useState)("1"),r=Object(l.a)(o,2),s=r[0],d=r[1],u=Object(n.useState)(0),m=Object(l.a)(u,2),f=m[0],g=m[1],b=Object(n.useState)(null),_=Object(l.a)(b,2),v=(_[0],_[1],Object(n.useState)(null)),y=Object(l.a)(v,2),w=y[0],O=y[1],j=Object(n.useState)(!1),k=Object(l.a)(j,2),S=k[0],x=k[1],T=Object(n.useState)(!0),C=Object(l.a)(T,2),N=C[0],A=C[1],I=Object(n.useState)(!0),F=Object(l.a)(I,2),R=(F[0],F[1]),M=Object(n.useState)([]),B=Object(l.a)(M,2),D=(B[0],B[1]),z=Object(n.useState)([]),P=Object(l.a)(z,2),V=P[0],L=P[1],U=Object(be.b)((function(e){return e.annotation_data.data})),H=Object(be.b)((function(e){return e.column_annot.data})),J=Object(be.b)((function(e){return e.current_frame})).data,Y=Object(be.b)((function(e){return e.media_data.data})),K=Object(be.b)((function(e){return e.metadata}));console.log("in_video"==K.media_type);var X=K.media_type,G=parseInt(K.skip_value);Object(n.useEffect)((function(){if(1==ze){var e=te(J);L(e)}}),[J]),Object(n.useEffect)((function(){$(K.total_frames),W(K.total_frames)}),[K]),Object(n.useEffect)((function(){if(0!=Y[0].length)if("in_image"==K.media_type){re(Y[0].length),ze=!0,Pe=!1,$(Y[0].length),W(Y[0].length);var e=URL.createObjectURL(Y[0][0]),t=new Image;t.onload=function(){Le={horizontal_res:t.width,vertical_res:t.height},URL.revokeObjectURL(t.src)},t.src=e,a(10)}else"in_video"==K.media_type&&(ze=!0,Pe=!1,$(Y[0].length),W(Y[0].length),a(10));Ce=1920,Ne=1080,Ae>=1080?(Ce=1280,Ne=720):Ae>=1024?(Ce=1152,Ne=648):Ae>=768&&(Ce=1024,Ne=576),Ne*=1/Y.length,Ce*=1/Y.length}),[Y]);var q=function(){var e="#"+((1<<24)*Math.random()|0).toString(16);null==V&&L([]);var t="error";if("2"===s){t="b";var a=new h(50,50,50,50,e,f+"b","None").generate_no_behavior();D([a]),Q(J,[a])}else"1"===s&&(t="f");var n,i=te(JSON.parse(JSON.stringify(ue.getState().current_frame)).data);n=Z(f+t),(i=Object.assign([],i)).push(n),ee(J,i),g(f+1)};Object(n.useEffect)((function(){1==ze&&L(te(J))}),[U]);var Z=function(e){var t=JSON.parse(JSON.stringify(ue.getState().column_annot)),a={};t=t.data.columns.columns;for(var n=0;n<t.length;n++){a[t[n].accessor]=""}return"in_image"===X?(a.dataType="image",a.fileName="temp"):(a.dataType="video",a.fileName="frame_"+J),a.id=e,a};Object(n.useEffect)((function(){null!=w&&(ue.dispatch({type:"frame_data/initOldAnnotation",payload:w.get_frame_data()}),ue.dispatch({type:"annotation_data/initOldAnnotation",payload:w.get_annotation_data()}),D(w.get_frame_data()[0]),L(w.get_annotation_data()[0]),g(w.find_highest_localid()))}),[w]),Object(n.useEffect)((function(){R(!1)}),[H]);var ne=function(e){return new Promise((function(t,a){var n=new FileReader;n.onload=function(e){t(JSON.parse(e.target.result))},n.readAsText(e.target.files[0])}))},ie=function(e){var t=J+G;if(t>=K.total_frames){if("in_image"===X)return void ae(K.total_frames-1);ae(K.total_frames-1)}else{if("in_image"===X)return void ae(t);ae(t)}},oe=function(e){var t=J-G;if(t<0){if("in_image"===X)return void ae(0);ae(0)}else{if("in_image"===X)return void ae(t);ae(t)}},le=function(e){if(!1!==N)if(!0!==Ue)if("2"===e.key)Ve="Mode Switch: Bounding Box",x(!0),d("2");else if("4"===e.key)Ve="Mode Switch: Key Point",x(!0),d("4");else if("3"===e.key)Ve="Mode Switch: Segmentation",x(!0),d("3");else if("1"===e.key)Ve="Mode Switch: Behavior Annotation",x(!0),d("1");else if("a"===e.key){var t="";"2"===s?t="Bounding Box":"1"===s?t="Behavior Data":"4"===s?t="Keypoint":"3"===s&&(t="Segmentation"),Ve="Added Annotation - "+t,"3"!==s&&x(!0),q()}else"q"===e.key?oe():"w"===e.key?alert("Video is currently under development, please use images for now!"):"e"===e.key?ie():e.key;else alert("Please finish your current action!")};Object(n.useEffect)((function(){return document.addEventListener("keydown",le),function(){return document.removeEventListener("keydown",le)}}),[le]);var ce=function(e){console.log("Keycheck activated"),A(void 0===e?!N:e)};return i.a.createElement("div",null,i.a.createElement(ge,{disable_buttons:Pe,video_width:Ce,video_height:Ne,skip_value:G,handleOldAnnotation:function(e){ne(e).then((function(e){null!=e?O(new p(e,Ce,Ne)):alert("Error in processing Annotation")}))},currentFrame:J,display_frame_num:"Frame #"+parseInt(J+1)+" / "+parseInt(K.total_frames),skip_frame_forward:ie,skip_frame_backward:oe,play_button_text:"ERROR",addToCanvas:q,ANNOTATION_VIDEO_NAME:"",change_annotation_type:function(e){d(e)},VIDEO_METADATA:Le,toggleKeyCheck:ce,handle_visual_toggle:function(){a(Math.floor(999999999999*Math.random()))}}),i.a.createElement(c.a,{onClose:function(){return x(!1)},show:S,delay:500,autohide:!0,style:{position:"absolute",top:"100",left:"100",zIndex:"100"}},i.a.createElement(c.a.Header,null,i.a.createElement("strong",{className:"mr-auto"},Ve))),!0===ze&&i.a.createElement("div",{style:{display:"grid"}},function(){for(var e=[],t=0;t<Y.length;t++){var a=i.a.createElement("div",{style:{gridColumn:1,gridRow:t+1,position:"relative",top:0,left:0}},i.a.createElement(ye,{currentFrame:J,scaling_factor_height:Ne,scaling_factor_width:Ce,stream_num:t}));e.push(a)}return console.log(e),i.a.createElement("div",null,e.map((function(e,t){return e})))}(),i.a.createElement("div",{style:{gridColumn:2,gridRow:1,position:"relative",top:0,left:0}},i.a.createElement(Te,{annotation_data:V,change_annotation_data:function(e){L(e)},currentFrame:J,toggleKeyCheck:ce,columns:E}))),!1===ze&&i.a.createElement("div",null,'"Video/Image upload not detected. Please upload."'))}$(1),W(1),Ie=0,ue.dispatch({type:"current_frame/init",payload:{data:Ie}}),Fe=Ce,Re=Ne,Me=1,Be="in_video",De=1,ue.dispatch({type:"metadata/init",payload:{horizontal_res:Fe,vertical_res:Re,frame_rate:Me,media_type:Be,total_frames:De}});var Je=a(223),Ye=a(224),Ke=a(116);var Xe=function(){var e=Object(n.useState)(!1),t=Object(l.a)(e,2),a=t[0],o=t[1],r=function(){return o(!1)},c=Object(n.useState)(!1),s=Object(l.a)(c,2),d=s[0],u=s[1],m=Object(n.useState)(!1),h=Object(l.a)(m,2);return h[0],h[1],d?i.a.createElement(He,null):i.a.createElement("div",null,i.a.createElement(C.a,{show:a,onHide:r,size:"lg"},i.a.createElement(C.a.Header,{closeButton:!0},i.a.createElement(C.a.Title,null,"Instructions")),i.a.createElement(C.a.Body,null,i.a.createElement(N,null)),i.a.createElement(C.a.Footer,null,i.a.createElement(y.a,{variant:"secondary",onClick:r},"Close"))),i.a.createElement("main",null,i.a.createElement(Je.a,{className:"text-center"},i.a.createElement(Ye.a,null,i.a.createElement("h1",{className:"jumbotron-heading"},"AVAT"),i.a.createElement("p",{className:"lead text-muted"}," Analysis tool to record data for livestock behavior and computer vision applications. "),i.a.createElement("p",null,i.a.createElement(y.a,{onClick:function(e){u(!d)},variant:"success",className:"mx-1 my-2"},"Video Upload")))),i.a.createElement(fe.a,{controls:!1,fade:!0,style:{width:"70%","margin-left":"auto","margin-right":"auto"}},Ke.map((function(e,t){return i.a.createElement(fe.a.Item,{interval:e.slide_time},i.a.createElement(pe.a,{className:"mb-5 box-shadow",top:!0,width:"100%"},i.a.createElement(pe.a.Img,{width:"60%",variant:"top",src:"."+e.src}),i.a.createElement(pe.a.Body,{style:{"text-align":"center"}},i.a.createElement(pe.a.Title,null,e.altText),i.a.createElement(pe.a.Text,null,e.description))))})))))};var Ge=function(){return i.a.createElement("div",null,i.a.createElement(Xe,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(i.a.createElement(be.a,{store:ue},i.a.createElement(Ge,null),","),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[118,1,2]]]);
//# sourceMappingURL=main.e415f493.chunk.js.map