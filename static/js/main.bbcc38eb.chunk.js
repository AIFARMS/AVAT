(this.webpackJsonpannotation_tool=this.webpackJsonpannotation_tool||[]).push([[0],{103:function(e,t,n){},104:function(e,t,n){},176:function(e,t){},177:function(e,t){},178:function(e,t){},186:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),o=n(13),r=n.n(o),l=(n(103),n(104),n(39)),c=n.n(l),s=(n(46),n(45),n(11),n(43)),u=n.n(s),d=n(57),h=n(6),f=n(12),g=n(38),v=n(37),m=n(22),b=n(28),y=n(23),p=n(24),w=function(){function e(t){Object(y.a)(this,e),this.objects=t.objects,console.log(this.objects)}return Object(p.a)(e,[{key:"getObjects",value:function(){return this.objects}},{key:"getObjectById",value:function(e){return this.objects[e]}},{key:"getObjectByIdFrame",value:function(e,t){return this.objects[e][t]}},{key:"getAllObjectByFrame",value:function(e){var t,n=[];for(t=0;t<this.objects.length;t++){var a=this.objects[t];if(!(a.frames[a.frames.length-1].frameNumber<e))for(var i=a.frames,o=0;o<i.length;o++)if(i[o].frameNumber===e){n.push(i[o]);break}}return console.log(n),n}}]),e}(),k=n(60),E=n.n(k),j=n(34),O=n.n(j),_=(n(92),[{value:"inactive",label:"Inactive"},{value:"walking",label:"Walking"},{value:"running",label:"Running"},{value:"play_solo",label:"Play Solo"},{value:"play_social",label:"Play Social"},{value:"head_tossing",label:"Head Tossing"},{value:"interacting",label:"Interacting with pen features"},{value:"drinking",label:"Drinking"},{value:"eating",label:"Eating"},{value:"fighting",label:"Fighting"},{value:"defacating",label:"Defacating"},{value:"other_active",label:"Other"},{value:"unknown",label:"Unknown"}]),C=[{value:"Lying sternally",label:"lying_sternally"},{value:"Sitting",label:"sitting"},{value:"Standing",label:"standing"},{value:"Walking ",label:"walking"},{value:"Consumption",label:"consumption"}];j.Type.SELECT,j.Type.SELECT;var S=n(194),x=n(48).fabric,T=function(){function e(t,n,a,i,o,r,l){Object(y.a)(this,e),this.top=t,this.left=n,this.id=r,this.behavior=l,this.color=o,this.width=a,this.height=i}return Object(p.a)(e,[{key:"rectangle",value:function(){return new x.Rect({hasRotatingPoint:!1,uniScaleTransform:!0,height:this.height,width:this.width,fill:this.color,borderColor:"#000",opacity:".4",top:this.top,left:this.left})}},{key:"id_text",value:function(){return new x.Text(this.id.toString(),{fontSize:20,top:this.top,left:this.left,uniScaleTransform:!1})}},{key:"behavior",value:function(){}},{key:"generate_no_behavior",value:function(){return new x.Group([this.rectangle(),this.id_text()],{left:this.left,top:this.top,uniScaleTransform:!0})}},{key:"generate_with_behavior",value:function(){}}]),e}();var A=function(){function e(t,n,a,i,o){Object(y.a)(this,e),this.frame_data=t,this.canvas_width=n,this.canvas_height=a,this.windowWidth=o,this.windowHeight=i}return Object(p.a)(e,[{key:"generate_frame",value:function(){for(var e=[],t=0;t<this.frame_data.length;t++){var n="#"+((1<<24)*Math.random()|0).toString(16);console.log(this.frame_data[t]);var a=new T(this.getTop(this.frame_data[t]),this.getLeft(this.frame_data[t]),this.getWidth(this.frame_data[t]),this.getHeight(this.frame_data[t]),n,t,"TEST").generate_no_behavior();e.push(a)}return e}},{key:"getID",value:function(e){return e.id}},{key:"getWidth",value:function(e){return Math.floor(e.bbox.width/this.windowWidth*this.canvas_width)}},{key:"getHeight",value:function(e){return Math.floor(e.bbox.height/this.windowHeight*this.canvas_height)}},{key:"getTop",value:function(e){return Math.floor(e.bbox.y/this.windowHeight*this.canvas_height)}},{key:"getLeft",value:function(e){return Math.floor(e.bbox.x/this.windowWidth*this.canvas_width)}}]),e}(),D=n(48).fabric,N=function(){function e(){Object(y.a)(this,e)}return Object(p.a)(e,[{key:"generate_stick",value:function(e){function t(e,t,n,a,i,o){var r=new D.Circle({left:e,top:t,strokeWidth:5,radius:12,fill:"#fff",stroke:"#666"});return r.hasControls=r.hasBorders=!1,r.line1=n,r.line2=a,r.line3=i,r.line4=o,r}function n(e){return new D.Line(e,{fill:"red",stroke:"red",strokeWidth:5,selectable:!1,evented:!1})}D.Object.prototype.originX=D.Object.prototype.originY="center";var a=n([250,125,250,175]),i=n([250,175,250,250]),o=n([250,250,300,350]),r=n([250,250,200,350]),l=n([250,175,175,225]),c=n([250,175,325,225]);e.add(a,i,o,r,l,c),e.add(t(a.get("x1"),a.get("y1"),null,a),t(a.get("x2"),a.get("y2"),a,i,l,c),t(i.get("x2"),i.get("y2"),i,o,r),t(o.get("x2"),o.get("y2"),o),t(r.get("x2"),r.get("y2"),r),t(l.get("x2"),l.get("y2"),l),t(c.get("x2"),c.get("y2"),c)),e.on("object:moving",(function(t){var n=t.target;n.line1&&n.line1.set({x2:n.left,y2:n.top}),n.line2&&n.line2.set({x1:n.left,y1:n.top}),n.line3&&n.line3.set({x1:n.left,y1:n.top}),n.line4&&n.line4.set({x1:n.left,y1:n.top}),e.renderAll()}))}},{key:"generate_poly",value:function(e){}}]),e}(),R=n(48).fabric,F=n(179),P=function(){function e(){Object(y.a)(this,e)}return Object(p.a)(e,[{key:"generate_polygon",value:function(e,t){var n,a=!0,i=new Array,o=new Array,r=!1,l=new function(){e.selection=!1,e.on("mouse:down",(function(e){e.target&&e.target.id===i[0].id&&l.polygon.generatePolygon(i),a&&l.polygon.addPoint(e)})),e.on("mouse:up",(function(e){})),e.on("mouse:move",(function(t){if(n&&"line"==n.class){var a=e.getPointer(t.e);n.set({x2:a.x,y2:a.y});var o=r.get("points");o[i.length]={x:a.x,y:a.y},r.set({points:o}),e.renderAll()}e.renderAll()}))};l.polygon={drawPolygon:function(){a=!0,i=new Array,o=new Array},addPoint:function(t){var a=Math.floor(999901*Math.random())+99,l=(new Date).getTime()+a,c=new R.Circle({radius:5,fill:"#ffffff",stroke:"#333333",strokeWidth:.5,left:t.e.layerX/e.getZoom(),top:t.e.layerY/e.getZoom(),selectable:!1,hasBorders:!1,hasControls:!1,originX:"center",originY:"center",id:l,objectCaching:!1});0===i.length&&c.set({fill:"red"});var s=[t.e.layerX/e.getZoom(),t.e.layerY/e.getZoom(),t.e.layerX/e.getZoom(),t.e.layerY/e.getZoom()],u=new R.Line(s,{strokeWidth:2,fill:"#999999",stroke:"#999999",class:"line",originX:"center",originY:"center",selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1});if(r){var d=e.getPointer(t.e);(s=r.get("points")).push({x:d.x,y:d.y});var h=new R.Polygon(s,{stroke:"#333333",strokeWidth:1,fill:"#cccccc",opacity:.3,selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1});e.remove(r),e.add(h),r=h,e.renderAll()}else{var f=[{x:t.e.layerX/e.getZoom(),y:t.e.layerY/e.getZoom()}];h=new R.Polygon(f,{stroke:"#333333",strokeWidth:1,fill:"#cccccc",opacity:.3,selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1});r=h,e.add(h)}n=u,i.push(c),o.push(u),e.add(u),e.add(c),e.selection=!1},generatePolygon:function(t){var i=new Array;F.each(t,(function(t,n){i.push({x:n.left,y:n.top}),e.remove(n)})),F.each(o,(function(t,n){e.remove(n)})),console.log(t),console.log(o);for(var l=new R.Group,c=0;c<t.length;c++)l.addWithUpdate(t[c]),l.addWithUpdate(o[c]);return e.add(l),e.remove(n),e.remove(r),n=null,r=null,a=!1,e.selection=!0,l}}}}]),e}(),B=function(){function e(t,n,a,i,o,r){Object(y.a)(this,e),this.id=t,this.behavior=n,this.posture=a,this.hidden=i,this.type=o,this.Annotation=r}return Object(p.a)(e,[{key:"get_id",value:function(){return this.id}},{key:"set_id",value:function(e){this.id=e}},{key:"get_behavior",value:function(){return this.behavior}},{key:"set_behavior",value:function(e){this.behavior=e}},{key:"get_posture",value:function(){return this.behavior}},{key:"set_posture",value:function(e){this.posture=e}},{key:"get_hidden",value:function(){return this.hidden}},{key:"set_hidden",value:function(e){this.hidden=e}},{key:"get_type",value:function(){return this.type}},{key:"generate_row",value:function(){return{id:this.id,behavior:this.behavior,is_hidden:this.hidden,posture:this.posture}}}]),e}(),I=[{dataField:"id",text:"ID"},{dataField:"behavior",text:"Beh",editor:{type:j.Type.SELECT,options:_}},{dataField:"is_hidden",text:"Hid"},{dataField:"posture",text:"Pos",editor:{type:j.Type.SELECT,options:C}}],L=n(48).fabric,W=n(93),M=new L.Canvas("c",{uniScaleTransform:!0}),U=W({displayName:"Fabric",componentDidMount:function(){var e=r.a.findDOMNode(this);M.initialize(e,{height:1080,width:1920,backgroundColor:null}),M.on("mouse:up",(function(){H[Y]=M.toJSON()})),M.on("saveData",(function(){M.renderAll()}))},render:function(){return i.a.createElement("canvas",null)}}),H=[[]],J=[[]],Z=!1,X=!0,Y=0;var z=function(){var e=Object(a.useState)(0),t=Object(h.a)(e,2),n=t[0],o=t[1],r=Object(a.useState)(0),l=Object(h.a)(r,2),s=l[0],y=l[1],p=function(){var e="#"+((1<<24)*Math.random()|0).toString(16);if(null==J[me]&&(J[me]=[]),0===n){var t=new T(M.height/2,M.width/2,50,50,e,s,"None").generate_no_behavior();J[me].push({id:s,behavior:"None",is_hidden:0,posture:"None"}),M.add(t),M.setActiveObject(t)}else if(1===n){var a=(new N).generate_stick(M);J[me].push(new B(s,"None","None",0,1,a))}else if(2===n){var i=(new P).generate_polygon(M,s);J[me].push(new B(s,"None","None",0,2,i))}y(s+1),M.fire("saveData")},k=Object(a.useState)(null),j=Object(h.a)(k,2),_=j[0],C=j[1],x=Object(a.useState)(null),D=Object(h.a)(x,2),R=(D[0],D[1],Object(a.useState)(null)),F=Object(h.a)(R,2),L=F[0],W=F[1];Object(a.useEffect)((function(){null!=L&&(console.log(L),console.log(L.getAllObjectByFrame(2)))}),L);var z=function(e){return new Promise((function(t,n){var a=new FileReader;a.onload=function(e){t(JSON.parse(e.target.result))},a.readAsText(e.target.files[0])}))},V=Object(a.useState)(!1),G=Object(h.a)(V,2),q=G[0],K=G[1],$="ERROR";$=!0===q?"Pause":"Play";var Q=Object(a.useState)(!1),ee=Object(h.a)(Q,2),te=(ee[0],ee[1]),ne=Object(a.useState)(0),ae=Object(h.a)(ne,2),ie=ae[0],oe=ae[1],re=Object(a.useState)(null),le=Object(h.a)(re,2),ce=le[0],se=le[1],ue=Object(a.useState)(0),de=Object(h.a)(ue,2),he=de[0],fe=de[1],ge=Object(a.useState)(0),ve=Object(h.a)(ge,2),me=ve[0],be=ve[1],ye=function(){var e=Object(d.a)(u.a.mark((function e(){var t,n,a,i,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="generated_annotations",n=JSON.stringify(H),a=new Blob([n],{type:"application/json"}),e.next=5,URL.createObjectURL(a);case 5:i=e.sent,(o=document.createElement("a")).href=i,o.download=t+".json",document.body.appendChild(o),o.click(),document.body.removeChild(o);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),pe=Object(a.useState)(!1),we=Object(h.a)(pe,2),ke=we[0],Ee=we[1],je=function(){return Ee(!1)},Oe=function(){o(0)},_e=function(){o(1)},Ce=function(){o(2)},Se=function(e){"s"===e.key?Ce():"b"===e.key?Oe():"k"===e.key?_e():"a"===e.key&&p()};return Object(a.useEffect)((function(){return document.addEventListener("keydown",Se),function(){return document.removeEventListener("keydown",Se)}}),[Se]),i.a.createElement("div",null,i.a.createElement(g.a,{bg:"dark",variant:"dark",className:"bg-5"},i.a.createElement(g.a.Brand,{href:"#home"},"Annotation Tool"),i.a.createElement(v.a,{className:"mr-auto"},i.a.createElement(v.a.Link,{onClick:function(){return Ee(!0)}},"Instructions"),i.a.createElement(S.a,{disabled:X,title:"Annotation Type",id:"basic-nav-dropdown"},i.a.createElement(S.a.Item,{onClick:Oe},"Square Box"),i.a.createElement(S.a.Divider,null),i.a.createElement(S.a.Item,{onClick:_e},"Key Point"),i.a.createElement(S.a.Divider,null),i.a.createElement(S.a.Item,{onClick:Ce},"Segmentation")),i.a.createElement(S.a,{disabled:X,title:"Export",id:"basic-nav-dropdown"},i.a.createElement(S.a.Item,{onClick:ye},"JSON"),i.a.createElement(S.a.Divider,null),i.a.createElement(S.a.Item,null,"CSV")),i.a.createElement(S.a,{disabled:X,title:"Settings",id:"basic-nav-dropdown"},i.a.createElement(S.a.Divider,null),"Frame Rate: ",i.a.createElement("input",{type:"text",value:"15"}),i.a.createElement(S.a.Divider,null),"Horizontal Res: ",i.a.createElement("input",{type:"text>",value:"3840"}),i.a.createElement(S.a.Divider,null),"Vertical Res: ",i.a.createElement("input",{type:"text>",value:"2178"}))),i.a.createElement("div",null,i.a.createElement(b.a,{style:{float:"left",width:80}},i.a.createElement(b.a.File,{disabled:X,id:"file",label:"Annotation Upload",custom:!0,type:"file",onChange:function(e){z(e).then((function(e){null!=e?W(new w(e)):console.log("ERROR in upload old_annotation")}))}})),i.a.createElement(b.a,{style:{float:"left",width:80}},i.a.createElement(b.a.File,{id:"file",label:"Video Upload",accept:".mp4",custom:!0,type:"file",onChange:function(e){C(URL.createObjectURL(e.target.files[0])),Z=!0}})),i.a.createElement(f.a,{variant:"secondary",disabled:!0},"Frame # ",parseInt(me)+" / "+parseInt(15*he))," ",i.a.createElement(f.a,{variant:"primary",disabled:X,onClick:function(e){var t=15*he;ce.seekTo((ce.getCurrentTime()/he*t-1)/t)}},"Prev")," ",i.a.createElement(f.a,{variant:"primary",disabled:X,onClick:function(e){K(!q)}},$)," ",i.a.createElement(f.a,{variant:"primary",disabled:X,onClick:function(e){var t=15*he;M.clear(),console.log(me),M.loadFromJSON(H[me],(function(){console.log(H[me]),M.renderAll()})),ce.seekTo((ce.getCurrentTime()/he*t+1)/t)}},"Next")," ",i.a.createElement(f.a,{variant:"success",disabled:X,onClick:p,style:{position:"relative"}},"Add")," ",i.a.createElement(f.a,{variant:"success",onClick:function(){y(s+1),M.remove(M.getActiveObject()),M.fire("saveData")},disabled:X,style:{position:"relative"}},"Remove")," ")),i.a.createElement(m.a,{show:ke,onHide:je},i.a.createElement(m.a.Header,{closeButton:!0},i.a.createElement(m.a.Title,null,"Instructions")),i.a.createElement(m.a.Body,null,"TODO: Add instructions"),i.a.createElement(m.a.Footer,null,i.a.createElement(f.a,{variant:"secondary",onClick:je},"Close"))),i.a.createElement("div",{style:{display:"grid"}},i.a.createElement("div",{style:{gridColumn:1,gridRow:1,position:"relative",width:1920,height:1080,top:0,left:0}},i.a.createElement(c.a,{onProgress:function(e){H[me]=M.toJSON(),console.log(me);var t=15*he;if(oe(me/t),be(Math.round(e.played*t)),Y=me,null!=L){M.clear();for(var n=new A(L.getAllObjectByFrame(me),1920,1080).generate_frame(),a=0;a<n.length;a++){var i=n[a];console.log(i),M.add(i),M.setActiveObject(i),M.fire("saveData")}}},ref:function(e){if(se(e),!0===Z&&null!=ce){console.log("RESET VALUES"),H=new Array(7200),J=new Array(7200);for(var t=0;t<7200;t++)H[t]=[],J[t]=[];Z=!1,X=!1}},onDuration:function(e){fe(parseInt(e)),console.log(e)},url:_,width:"100%",height:"99.999%",playing:q,controls:!1,style:{position:"absolute",float:"left",top:0,left:0},volume:0,muted:!0,pip:!1})),i.a.createElement("div",{style:{gridColumn:1,gridRow:1,position:"relative",width:1920,height:1080,top:0,left:0}},i.a.createElement(U,null)),i.a.createElement("div",{style:{gridColumn:1,gridRow:2,position:"relative",width:1920,top:0,left:0}},i.a.createElement("input",{style:{width:1920},type:"range",min:0,max:.999999,step:"any",value:ie,onMouseDown:function(e){te(!0)},onChange:function(e){oe(parseFloat(e.target.value))},onMouseUp:function(e){te(!1),ce.seekTo(parseFloat(e.target.value))}})),i.a.createElement("div",{style:{gridColumn:2,gridRow:1,position:"relative",width:1920,height:1080,top:0,left:0}},i.a.createElement("div",{style:{width:"15%"}},i.a.createElement(E.a,{keyField:"id",data:J[me],columns:I,cellEdit:O()({mode:"click",blurToSave:!0,afterSaveCell:function(e,t,n,a){J[me][n.id]=n}})})))))},V=(n(96),n(48).fabric),G=(n(183),n(93)),q=new V.Canvas("c",{uniScaleTransform:!0}),K=(G({displayName:"Fabric",componentDidMount:function(){var e=r.a.findDOMNode(this);q.initialize(e,{height:1080,width:1920,backgroundColor:null}),q.on("mouse:up",(function(){K[$]=q.toJSON()})),q.on("saveData",(function(){q.renderAll()}))},render:function(){return i.a.createElement("canvas",null)}}),[]),$=0;n(192),n(193);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(z,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},98:function(e,t,n){e.exports=n(186)}},[[98,1,2]]]);
//# sourceMappingURL=main.bbcc38eb.chunk.js.map