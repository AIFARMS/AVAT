{"version":3,"sources":["fabric_types/fabric_boundingbox.js","annotations/bounding_box.js","processing/annotation-processing.js","annotations/segmentation_edit.js","annotations/segmentation.js","static_data/behaviors.js","static_data/posture.js","static_data/confidence.js","static_data/columns.js","ui_elements/Components/instructions.js","reducer/frame_data.js","reducer/annotation_data.js","reducer/column_annot.js","store.js","processing/actions.js","processing/download.js","tensorflow/ObjectDetection.js","tensorflow/SemanticSegmentation.js","processing/exporting_annotation.js","processing/video_to_frame.js","ui_elements/Components/process_video.js","ui_elements/Components/nav_bar.js","ui_elements/Components/fabric_canvas.js","static_data/combined_dat.js","ui_elements/Components/annot_table.js","ui_elements/Components/change_table.js","ui_elements/Pages/main_upload.js","static_data/constants.js","annotations/key_point.js","ui_elements/Components/nav_bar_multiview.js","ui_elements/Pages/main_muiltiview.js","ui_elements/Pages/selection_screen.js","App.js","serviceWorker.js","index.js"],"names":["fabric","require","util","createClass","Rect","type","initialize","options","this","callSuper","set","label","toObject","object","extend","get","_render","ctx","font","fillStyle","fillText","width","height","uniScaleTransform","BoundingBox","top","left","color","id","behavior","hasRotatingPoint","fill","opacity","Text","toString","fontSize","canvas","group","Group","rectangle","id_text","borderColor","hasBorders","on","obj","text_box","target","item","scaleX","scaleY","temp","local_id","add","toJSON","isDown","origX","origY","o","pointer","getPointer","e","x","y","rect_temp","originX","originY","angle","transparentCorners","Math","abs","renderAll","off","ExtractingAnnotation","annotation_json","image_data","frame_data","annotation_data","metadata","console","log","scale_annotations","localid","i","length","j","push","parseInt","replace","max","new_annotations","temp_data","curr_frame","random","new_bbox","generate_no_behavior","points","curr_points","k","x_scaled","y_scaled","po","Polygon","strokeWidth","stroke","objectCaching","cornerColor","display_text","centerX","grouppo","perPixelTargetFind","lockMovementY","lockMovementX","selectable","polygonPositionHandler","dim","finalMatrix","fabricObject","pointIndex","pathOffset","transformPoint","multiplyTransformMatrices","viewportTransform","calcTransformMatrix","actionHandler","eventData","transform","polygon","currentControl","controls","__corner","mouseLocalPosition","toLocalPoint","Point","polygonBaseSize","_getNonTransformedDimensions","size","_getTransformedDimensions","finalPointPosition","Edit","curr_obj","getActiveObject","undefined","poly","_objects","text","destroy","remove","setActiveObject","edit","lastControl","cornerStyle","reduce","acc","point","index","anchorIndex","fn","Control","positionHandler","absolutePoint","actionPerformed","_setPositionDimensions","newX","newY","setPositionByOrigin","actionName","Object","prototype","alert","new_polygon","getObjects","requestRenderAll","$","Segmentation","segmentation_flag","activeLine","polygonMode","pointArray","Array","lineArray","activeShape","generate_flag","forEachObject","selection","prototypefabric","generatePolygon","addPoint","class","x2","y2","drawPolygon","floor","temp_id","Date","getTime","circle","Circle","radius","hasControls","zindex","line","Line","evented","polyPoint","each","behaviors","value","posture","confidence","columns","remove_table_index","dataField","headerStyle","editable","editor","Type","SELECT","headerFormatter","Button","className","onClick","formatter","cellContent","row","Instructions","frameDataSlice","createSlice","name","initialState","data","reducers","init","state","payload","initOldAnnotation","modifyFrame","currentFrame","middleware","getDefaultMiddleware","serializableCheck","actions","annotationDataSlice","columnDataSlice","configureStore","reducer","column_annot","initFrameData","frame_count","store","dispatch","updateFrameData","frame_number","getFrameData","getState","initAnnotationData","updateAnnotationData","getAnnotationData","downloadFileJSON","ANNOTATION_VIDEO_NAME","ANNOTATOR_NAME","VIDEO_METADATA","a","fileName","split","slice","join","json","JSON","stringify","blob","Blob","URL","createObjectURL","href","link","document","createElement","download","body","appendChild","click","removeChild","convert_data_csv","csv","vals","keys","map","key","load","model_type","cocoSsd","dispose","base","deeplab","loadModel","quantizationBytes","run_model_segment","fabricCanvas","save_data","refresh","image","getElementsByTagName","then","model","segment","segmentationMap","legend","getHeight","getWidth","seg_image","ImageData","c","setAttribute","getContext","putImageData","Image","fromURL","toDataURL","img","bringToFront","ExportingAnnotation","standard_annot","curr","frame_objects","raw_points","videoFrameExtract","frame_rate","skip_val","handleText","video","getElementById","total_frames","duration","context","videoWidth","videoHeight","w","h","frames","drawImage","base64ImageData","addEventListener","seekResolve","new_time","parseFloat","currentTime","toFixed","Promise","r","test_frame","ProcessVideo","props","useState","show","setShow","handleClose","setFrames","setText","event","Modal","onHide","Header","closeButton","Title","Body","style","objectFit","src","video_link","ret","enable","Carousel","fade","Item","Card","Img","Footer","variant","CustomNavBar","uploadShow","setUploadShow","startDate","setStartDate","frameRate","setFrameRate","videoFormat","setVideoFormat","videoLink","setVideoLink","setModel","process","setProcess","editSeg","setEditSeg","setColumnData","handleUploadClose","handleVideoLink","files","downloadColumn","file","resolve","reject","reader","FileReader","onload","parse","result","readAsText","display","Form","float","gridColumn","gridRow","zIndex","as","onChange","handleInputType","defaultValue","NavDropdown","Divider","toggleKeyCheck","onBlur","change_annotator_name","selected","date","setDateTime","error","handleSetStartDate","timeInputLabel","dateFormat","showTimeInput","onClickOutside","onCalendarOpen","onCalendarClose","File","multiple","accept","custom","handleVideoUpload","disabled","disable_buttons","handleOldAnnotation","column_dat","change_skip_value","handleSetPlaybackRate","Navbar","sticky","bg","Brand","Nav","title","converted_annot","image_frames","get_frame_json","NavLink","handle_link_open","handle_visual_toggle","toggle_segmentation","Dropdown","ButtonGroup","display_frame_num","Toggle","Menu","skip_frame_backward","handlePlaying","play_button_text","skip_frame_forward","drop","addToCanvas","change_annotation_type","FabricRender","el","ReactDOM","findDOMNode","scaling_factor_height","scaling_factor_width","backgroundColor","React","Component","AnnotTable","useTable","getTableProps","getTableBodyProps","headerGroups","rows","prepareRow","border","headerGroup","getHeaderGroupProps","headers","column","getHeaderProps","background","fontWeight","render","global_id","elem","behaviors_temp","beh","confidence_temp","posture_temp","genSelection","original","AnnotationTable","txt_id","txt_global","frame_num","anno_count","local_ids","global_ids","getAnnotationTableCount","handler","col","Tabs","defaultActiveKey","Tab","eventKey","keyField","handleSetCurrentFrame","table","noDataIndication","pagination","paginationFactory","num_frames","skip_value","current_screen_height","window","screen","temp_color","Canvas","uniformScaling","includeDefaultValues","call","opt","delta","deltaY","zoom","getZoom","zoomToPoint","offsetX","offsetY","preventDefault","stopPropagation","evt","altKey","isDragging","lastPosX","clientX","lastPosY","clientY","vpt","setViewportTransform","video_width","video_height","upload","toast_text","temp_flag","time_unix","on_ready_flag","player_opacity","MainUpload","setVisualToggle","annotationType","setAnnotationType","boxCount","setBoxCount","videoFilePath","setVideoFileURL","oldAnnotation","setOldAnnotation","player","setPlayer","setDuration","save","changeSave","playing","setPlaying","keyCheck","changeKeyCheck","playbackRate","setPlaybackRate","inputType","setInputType","tableFrameNum","setTableFrameNum","previousFrameNumber","setPreviousFrameNumber","currFrameData","setCurrFrameData","currAnnotationData","setCurrAnnotationData","val","canvasBackgroundUpdate","new_skip","seekTo","frame_calc","removeRow","index_num","substring","current_objects","fire","temp_array","splice","save_previous_data","annotation_type_txt","generate_polygon","oldArray","status","current","notes","dataType","useEffect","get_frame_data","get_annotation_data","find_highest_localid","downloadOldAnnotation","scrubbing","setScrubbing","frameVal","onKeyPress","annotext","previous_frame_data","enlivenObjects","objects","removeEventListener","toggle_val","clear","horizontal_res","vertical_res","time","f_img","setBackgroundImage","htmlvideo","isNaN","framerate","Number","isFinite","round","Toast","onClose","delay","autohide","position","onReady","ref","onDuration","url","volume","muted","pip","change_annotation_data","indiciesToDelete","MultiviewCustomNavBar","edit_click","downloadFileCSV","Storage","previous_annotation","previous_canvas_annotation","image_frames1","image_frames2","MainMultiview","setCurrentFrame","open","SelectionScreen","setUpload","multiview","setMultiview","Jumbotron","Container","selection_items","interval","slide_time","altText","description","App","Boolean","location","hostname","match","navigator","serviceWorker","ready","registration","unregister","catch","message"],"mappings":"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","file":"static/js/main.b8fda707.chunk.js","sourcesContent":["const fabric = require(\"fabric\").fabric;\n\nvar boundingbox = fabric.util.createClass(fabric.Rect, {\n    type: 'boundingbox',\n    initialize: function(options) {\n        options || (options = { });\n\n        this.callSuper('initialize', options);\n        this.set('label', options.label || '');\n    },\n\n    toObject: function() {\n        return fabric.util.object.extend(this.callSuper('toObject'), {\n            label: this.get('label')\n        });\n    },\n\n    _render: function(ctx) {\n        this.callSuper('_render', ctx);\n\n        ctx.font = '10px Helvetica';\n        ctx.fillStyle = '#333';\n        /* scaleX = this.width / (this.width * this.scaleX),\n        scaleY = this.height / (this.height * this.scaleY); */\n        ctx.fillText(this.label, (-this.width/2), (-this.height/2 + 20));\n        ctx.uniScaleTransform = false;\n    }\n});\n  \nexport {boundingbox};","import { boundingbox } from '../fabric_types/fabric_boundingbox'\nconst fabric = require(\"fabric\").fabric;\n\nclass BoundingBox {\n    constructor(top, left, width, height, color, id, behavior) {\n        this.top = top;\n        this.left = left;\n        this.id = id;\n        this.behavior = behavior;\n        this.color = color;\n        this.width = width;\n        this.height = height;\n    }\n\n    rectangle(){\n        return new fabric.Rect({\n            hasRotatingPoint: false,\n            height: this.height,\n            width: this.width,\n            fill: this.color,\n            opacity: '.4',\n            top: this.top,\n            left: this.left,\n        });\n    } \n\n    //TODO Add text scaling\n    id_text(){\n        return new fabric.Text(this.id.toString(), {\n            fontSize: 20,\n            top: this.top,\n            left: this.left,\n            uniScaleTransform: false,\n          });\n    }\n\n    generate_no_behavior(canvas){\n        var group = new fabric.Group([this.rectangle(), this.id_text()],{\n            borderColor: '#000000',\n            hasBorders: true,\n            uniScaleTransform: true\n        });\n        /* var box = new boundingbox({\n            hasRotatingPoint: false,\n            height: this.height,\n            width: this.width,\n            fill: this.color,\n            opacity: '.4',\n            top: this.top,\n            left: this.left,\n            label: this.id.toString()\n        }) */\n\n        function onChange(obj) {\n            var text_box = obj.target.item(1),\n                group = obj.target,\n                scaleX = group.width / (group.width * group.scaleX),\n                scaleY = group.height / (group.height * group.scaleY);\n            text_box.set('scaleX', scaleX);\n            text_box.set('scaleY', scaleY);\n        }\n        canvas.on({\n            'object:scaling': onChange\n        })\n\n        var temp = this.id \n        group.local_id = temp\n        canvas.add(group)\n        //console.log(group.toJSON())\n        return group.toJSON()\n    }\n\n    generate_mouse_no_behavior(canvas){\n        var group, isDown, origX, origY;\n\n        var temp_id = new fabric.Text(this.id.toString(), {\n            fontSize: 20,\n            top: this.top,\n            left: this.left,\n            uniScaleTransform: false,\n          });\n\n        canvas.on('mouse:down', function(o){\n            isDown = true;\n            var pointer = canvas.getPointer(o.e);\n            origX = pointer.x;\n            origY = pointer.y;\n            var pointer = canvas.getPointer(o.e);\n            var rect_temp = new fabric.Rect({\n                left: origX,\n                top: origY,\n                originX: 'left',\n                originY: 'top',\n                width: pointer.x-origX,\n                height: pointer.y-origY,\n                angle: 0,\n                fill: 'rgba(255,0,0,0.5)',\n                transparentCorners: false,\n                uniScaleTransform: true\n            });\n            group = rect_temp\n\n\n            canvas.add(group)\n        });\n        \n        canvas.on('mouse:move', function(o){\n            if (!isDown) return;\n            var pointer = canvas.getPointer(o.e);\n            \n            if(origX>pointer.x){\n                group.set({ left: Math.abs(pointer.x) });\n            }\n            if(origY>pointer.y){\n                group.set({ top: Math.abs(pointer.y) });\n            }\n            \n            group.set({ width: Math.abs(origX - pointer.x) });\n            group.set({ height: Math.abs(origY - pointer.y) });\n            \n            \n            canvas.renderAll();\n        });\n        \n        canvas.on('mouse:up', function(o){\n          isDown = false;\n          canvas.off('mouse:down')\n          canvas.off('mouse:up')\n        });\n    }\n\n}\n\nexport {BoundingBox}","import {BoundingBox} from '../annotations/bounding_box'\nconst fabric = require(\"fabric\").fabric;\nconst $ = require(\"jquery\")\n\nexport default class ExtractingAnnotation{\n    constructor(annotation_json, canvas, image_data){\n        this.frame_data = annotation_json['annotations']\n        this.annotation_data = annotation_json['behavior_data']\n        this.canvas = canvas\n        this.metadata = annotation_json['vid_metadata']\n    }\n\n    get_frame_data(){\n        console.log(this.scale_annotations())\n        return this.scale_annotations()\n    }\n    \n    get_annotation_data(){\n        return this.annotation_data;\n    }\n\n    find_highest_localid(){\n        var localid = []\n        for(var i = 0; i < this.annotation_data.length; i++){\n            for(var j = 0; j < this.annotation_data[i].length; j++){\n                console.log(this.annotation_data[i][j])\n                localid.push(parseInt(this.annotation_data[i][j]['id'].replace(/\\D/g, \"\")))\n            }\n        }\n        console.log(Math.max(...localid))\n        return Math.max(...localid)+1\n    }\n\n    scale_annotations(){\n        var new_annotations = []\n        console.log(this.frame_data)\n        for(var i = 0; i < this.frame_data.length; i++){\n            var temp_data = []\n            var curr_frame = this.frame_data[i]\n            if(curr_frame == null){\n                new_annotations.push([])\n                continue;\n            }\n            for(var j = 0; j < curr_frame.length; j++){\n                if(curr_frame[j]['type'] === \"bounding_box\"){\n                    var x = (parseInt(curr_frame[j]['x']) / parseInt(this.metadata['horizontal_res']) * this.canvas.width) \n                    var y = (curr_frame[j]['y'] / this.metadata['vertical_res'] * this.canvas.height)\n                    var width = ((curr_frame[j]['width']) / this.metadata['horizontal_res'] * this.canvas.width)\n                    var height = ((curr_frame[j]['height']) / this.metadata['vertical_res'] * this.canvas.height)\n\n                    var color = \"#\" + ((1<<24)*Math.random() | 0).toString(16)\n                    var new_bbox = new BoundingBox(y, x, width, height, color, curr_frame[j]['local_id'], \"None\").generate_no_behavior(this.canvas)\n                    //this.canvas.add(new_bbox)\n                    new_bbox.local_id = curr_frame[j]['local_id']\n                    temp_data.push(new_bbox)\n                }else if(curr_frame[j]['type'] === \"segmentation\"){\n                    var points = []\n                    var curr_points = curr_frame[j]['points']\n                    for(var k = 0; k < curr_points.length; k++){\n                        var x_scaled = (parseInt(curr_points[k]['x']) / parseInt(this.metadata['horizontal_res']) * this.canvas.width)\n                        var y_scaled = (curr_points[k]['y'] / this.metadata['vertical_res'] * this.canvas.height)\n                        points.push({x: x_scaled, y: y_scaled})\n                    }\n                    var po = new fabric.Polygon(points, {\n                        strokeWidth: 1,\n                        stroke: 'green',\n                        opacity: .5,\n                        scaleX: 1,\n                        scaleY: 1,\n                        objectCaching: false,\n                        transparentCorners: false,\n                        cornerColor: 'blue',\n                        originX: 'center',\n                        originY: 'center'\n                    });\n                    var display_text = new fabric.Text(curr_frame[j]['local_id'], {\n                        fontSize: 20,\n                        centerX: \"center\",\n                        top: points[0].y,\n                        left: points[0].x, \n                        uniScaleTransform: false,\n                        fill: \"white\",\n                    })\n                    var grouppo = new fabric.Group([po, display_text], {perPixelTargetFind: true})\n                    grouppo.lockMovementY = true;\n                    grouppo.lockMovementX = true;\n                    grouppo.selectable = false;\n                    grouppo.local_id = curr_frame[j]['local_id']\n                    //this.canvas.add(grouppo)\n                    temp_data.push(grouppo)\n                }\n            }\n            new_annotations.push(temp_data)\n        }\n        console.log(new_annotations)\n        return new_annotations\n    }\n}\n\n//This is the parser for the Multi-Camera pig tracking output JSON code. \n/*\nclass MCPT_Processing {\n    constructor(annotation_json){\n        this.objects = annotation_json['objects']\n        console.log(this.objects)\n    }\n\n    getObjects_MCPT() {\n        return this.objects\n    }\n\n    getObjectById_MCPT(id) {\n        return this.objects[id]\n    }\n    \n    getObjectByIdFrame(id, frame_num){\n        return this.objects[id][frame_num]\n    }\n\n    getAllObjectByFrame_MCPT(frame_num){\n        var i;\n        var objects_frame = []\n        for (i = 0; i < this.objects.length; i++){\n            var curr_obj = this.objects[i]\n            if(curr_obj['frames'][curr_obj['frames'].length-1]['frameNumber'] < frame_num){\n                continue;\n            }\n            var curr_obj_frames = curr_obj['frames'];\n            for (var j = 0; j < curr_obj_frames.length; j++){\n                if(curr_obj_frames[j]['frameNumber'] === frame_num){\n                    objects_frame.push(curr_obj_frames[j]);\n                    break;\n                }\n            }\n        }\n        console.log(objects_frame)\n        return objects_frame;\n    }\n}*/","const fabric = require(\"fabric\").fabric;\nconst $ = require(\"jquery\")\n\nfunction polygonPositionHandler(dim, finalMatrix, fabricObject) {\n    var x = (fabricObject.points[this.pointIndex].x - fabricObject.pathOffset.x),\n        y = (fabricObject.points[this.pointIndex].y - fabricObject.pathOffset.y);\n\n    return fabric.util.transformPoint(\n        { x: x, y: y },\n        fabric.util.multiplyTransformMatrices(\n            fabricObject.canvas.viewportTransform,\n            fabricObject.calcTransformMatrix()\n        )\n    );\n}\n\nfunction actionHandler(eventData, transform, x, y) {\n    var polygon = transform.target,\n        currentControl = polygon.controls[polygon.__corner],\n        mouseLocalPosition = polygon.toLocalPoint(new fabric.Point(x, y), 'center', 'center'),\n    polygonBaseSize = polygon._getNonTransformedDimensions(),\n            size = polygon._getTransformedDimensions(0, 0),\n            finalPointPosition = {\n                x: mouseLocalPosition.x * polygonBaseSize.x / size.x + polygon.pathOffset.x,\n                y: mouseLocalPosition.y * polygonBaseSize.y / size.y + polygon.pathOffset.y\n            };\n    polygon.points[currentControl.pointIndex] = finalPointPosition;\n    return true;\n}\n\nfunction anchorWrapper(anchorIndex, fn) {\n    return function(eventData, transform, x, y) {\n        var fabricObject = transform.target,\n            absolutePoint = fabric.util.transformPoint({\n                x: (fabricObject.points[anchorIndex].x - fabricObject.pathOffset.x),\n                y: (fabricObject.points[anchorIndex].y - fabricObject.pathOffset.y),\n            }, fabricObject.calcTransformMatrix()),\n            actionPerformed = fn(eventData, transform, x, y),\n            newDim = fabricObject._setPositionDimensions({}),\n            polygonBaseSize = fabricObject._getNonTransformedDimensions(),\n            newX = (fabricObject.points[anchorIndex].x - fabricObject.pathOffset.x) / polygonBaseSize.x,\n                newY = (fabricObject.points[anchorIndex].y - fabricObject.pathOffset.y) / polygonBaseSize.y;\n        fabricObject.setPositionByOrigin(absolutePoint, newX + 0.5, newY + 0.5);\n        return actionPerformed;\n    }\n}\n\nfunction Edit(canvas) {\n    // clone what are you copying since you\n    // may want copy and paste on different moment.\n    // and you do not want the changes happened\n    // later to reflect on the copy.\n    var curr_obj = canvas.getActiveObject();\n    console.log(curr_obj)\n    if(curr_obj == undefined || curr_obj == null){\n        alert(\"Please select a segmentation\")\n        return\n    }/* else if(curr_obj._objects == undefined && curr_obj.points == undefined){\n        alert(\"Please select a segmentation\")\n        return\n    } */\n    var poly;\n    if(curr_obj.type === \"group\"){\n        poly = curr_obj._objects[0]\n        var text = curr_obj._objects[1]['text']\n        poly['local_id'] = text\n        curr_obj.destroy()\n        canvas.remove(curr_obj)\n        canvas.add(poly)\n    }else if(curr_obj.type === \"polygon\"){\n        poly = curr_obj\n    }\n    \n\n    canvas.setActiveObject(poly);\n    poly.edit = !poly.edit;\n    if (poly.edit) {\n        var lastControl = poly.points.length - 1;\n        poly.cornerStyle = 'rectangle';\n        poly.cornerColor = 'yellow';\n        poly.controls = poly.points.reduce(function(acc, point, index) {\n                acc['p' + index] = new fabric.Control({\n                    positionHandler: polygonPositionHandler,\n                    actionHandler: anchorWrapper(index > 0 ? index - 1 : lastControl, actionHandler),\n                    actionName: 'modifyPolygon',\n                    pointIndex: index\n                });\n                return acc;\n            }, { });\n    } else {\n        poly.cornerColor = 'blue';\n        poly.cornerStyle = 'rect';\n        poly.controls = fabric.Object.prototype.controls;\n        if(poly.local_id == undefined){\n            alert(\"Error - missing poly.local_id. Please report this bug in the bug tracker and the steps taken to reproduce this.\")\n        }\n        var points = poly.get('points')\n        var new_polygon = new fabric.Polygon(points, {\n            strokeWidth: 1,\n            stroke: 'green',\n            opacity: .5,\n            scaleX: 1,\n            scaleY: 1,\n            objectCaching: false,\n            transparentCorners: false,\n            cornerColor: 'blue',\n            originX: 'center',\n            originY: 'center'\n        });\n        var display_text = new fabric.Text(poly.local_id.toString(), {\n            fontSize: 20,\n            top: poly.points[0].y,\n            left: poly.points[0].x, \n            uniScaleTransform: false,\n            fill: \"white\",\n        })\n\n        var grouppo = new fabric.Group([new_polygon, display_text]);\n        grouppo['local_id'] = poly.local_id;\n        grouppo.lockMovementY = true;\n        grouppo.lockMovementX = true;\n        grouppo.selectable = true;\n        canvas.remove(poly);\n        canvas.add(grouppo);\n        console.log(canvas.getObjects())\n    }\n    poly.hasBorders = !poly.edit;\n    canvas.requestRenderAll();\n}\n\nexport {Edit}","import { Edit } from \"./segmentation_edit\";\nconst fabric = require(\"fabric\").fabric;\nconst $ = require(\"jquery\")\n\nclass Segmentation {\n    generate_polygon(canvas, id, segmentation_flag){\n        var min = 99;\n        var max = 999999;\n        var polygonMode = true;\n        var pointArray = new Array();\n        var lineArray = new Array();\n\n        var activeLine;\n        var activeShape = false;\n\n        var generate_flag = false;\n\n        canvas.forEachObject(function(object){ \n            object.selectable = false; \n            //object.evented = false;\n        });\n        canvas.selection = false;\n\n        var prototypefabric = new function () {\n                //canvas = window._canvas = new fabric.Canvas('c');\n                //canvas.setWidth($(window).width());\n                //canvas.setHeight($(window).height()-$('#nav-bar').height());\n                //canvas.selection = false;\n        \n                canvas.on('mouse:down', function (options) {\n                    if(options.target && options.target.id === pointArray[0].id){\n                        if(generate_flag == false){\n                            prototypefabric.polygon.generatePolygon(pointArray);\n                            generate_flag = true;\n                        }\n                    }\n                    if(polygonMode){\n                        prototypefabric.polygon.addPoint(options);\n                    }\n                });\n                canvas.on('mouse:up', function (options) {\n        \n                });\n                canvas.on('mouse:move', function (options) {\n                    if(activeLine && activeLine.class == \"line\"){\n                        var pointer = canvas.getPointer(options.e, false);\n                        activeLine.set({ x2: pointer.x, y2: pointer.y });\n        \n                        var points = activeShape.get(\"points\");\n                        points[pointArray.length] = {\n                            x:pointer.x,\n                            y:pointer.y\n                        }\n                        activeShape.set({\n                            points: points\n                        });\n                        canvas.renderAll();\n                    }\n                    //canvas.renderAll();\n                });\n        }();\n        \n        \n        \n        prototypefabric.polygon = {\n            drawPolygon : function() {\n                polygonMode = true;\n                pointArray = new Array();\n                lineArray = new Array();\n            },\n            addPoint : function(options) {\n                var pointer = canvas.getPointer(options.e, false);\n                var CIRCLE_RADIUS = 2;\n                var random = Math.floor(Math.random() * (max - min + 1)) + min;\n                var temp_id = new Date().getTime() + random;\n                var circle = new fabric.Circle({\n                    id: temp_id,\n                    radius: 2,\n                    fill: '#ffffff',\n                    stroke: '#333333',\n                    strokeWidth: 0.5,\n                    left: (pointer.x),\n                    top: (pointer.y),\n                    selectable: false,\n                    hasBorders: false,\n                    hasControls: false,\n                    originX:'center',\n                    originY:'center',\n                    objectCaching:false\n                });\n                circle.selectable = false;\n                if(pointArray.length === 0){\n                    circle.set({\n                        fill:'red',\n                        zindex: 1\n                    })\n                }else{\n                    circle.set({\n                        zindex: 0\n                    })\n                }\n                \n\n                var points = [(pointer.x),(pointer.y),(pointer.x),(pointer.y)];\n                var line = new fabric.Line(points, {\n                    strokeWidth: 2,\n                    fill: '#999999',\n                    stroke: '#999999',\n                    class:'line',\n                    originX:'center',\n                    originY:'center',\n                    selectable: false,\n                    hasBorders: false,\n                    hasControls: false,\n                    evented: false,\n                        objectCaching:false\n                });\n                if(activeShape){\n                    var points = activeShape.get(\"points\");\n                    points.push({\n                        x: pointer.x,\n                        y: pointer.y\n                    });\n                    var polygon = new fabric.Polygon(points,{\n                        stroke:'#333333',\n                        strokeWidth:1,\n                        fill: '#cccccc',\n                        opacity: 0.3,\n                        selectable: false,\n                        hasBorders: false,\n                        hasControls: false,\n                        evented: false,\n                        objectCaching:false\n                    });\n                    canvas.remove(activeShape);\n                    canvas.add(polygon);\n                    activeShape = polygon;\n                    canvas.renderAll();\n                }\n                else{\n                    var polyPoint = [{x:(pointer.x),y:(pointer.y)}];\n                    console.log(polyPoint)\n                    var polygon = new fabric.Polygon(polyPoint,{\n                        stroke:'#333333',\n                        strokeWidth:1,\n                        fill: '#cccccc',\n                        opacity: 0.3,\n                        selectable: false,\n                        hasBorders: false,\n                        hasControls: false,\n                        evented: false,\n                        objectCaching:false\n                    });\n                    activeShape = polygon;\n                    canvas.add(polygon);\n                }\n                activeLine = line;\n        \n                pointArray.push(circle);\n                lineArray.push(line);\n        \n                //canvas.add(line);\n                canvas.add(circle);\n                canvas.selection = false;\n            },\n            generatePolygon : function(pointArray){\n                var points = new Array();\n                $.each(pointArray,function(index,point){\n                    points.push({\n                        x:point.left,\n                        y:point.top\n                    });\n                    canvas.remove(point);\n                });\n                $.each(lineArray,function(index,line){\n                    canvas.remove(line);\n                });\n\n                console.log(pointArray)\n                console.log(lineArray)\n\n                var po = new fabric.Polygon(points, {\n                    strokeWidth: 1,\n                    stroke: 'green',\n                    opacity: .5,\n                    scaleX: 1,\n                    scaleY: 1,\n                    objectCaching: false,\n                    transparentCorners: false,\n                    cornerColor: 'blue',\n                    originX: 'center',\n                    originY: 'center'\n                });\n\n                /*po.toObject = (function(toObject) {\n                    return function(propertiesToInclude) {\n                        return fabric.util.object.extend(toObject.call(this, propertiesToInclude), {\n                            local_id: id\n                        });\n                    };\n                })(po.toObject)*/\n                po['local_id'] = id\n                po.lockMovementY = true;\n                po.lockMovementX = true;\n                console.log(id)\n                console.log(po)\n\n                canvas.remove(activeShape);\n                //canvas.add(po);\n\n                segmentation_flag();\n                /*\n                REMEMBER TO CHANGE THE ANNOTATION UPLOAD CODE TO REFLECT ANY CODE CHANGES DONE HERE ASWELL!\n                */\n                var display_text = new fabric.Text(id.toString(), {\n                    fontSize: 20,\n                    centerX: \"center\",\n                    top: pointArray[0].top,\n                    left: pointArray[0].left, \n                    uniScaleTransform: false,\n                    fill: \"white\",\n                })\n\n                var grouppo = new fabric.Group([po, display_text], {\n                    perPixelTargetFind: true,\n                    hasControls: false,\n                    hasBorders: false\n                })\n                grouppo.lockMovementY = true;\n                grouppo.lockMovementX = true;\n                grouppo['local_id'] = id\n                console.log(grouppo)\n\n                canvas.add(grouppo)\n                //canvas.setActiveObject(grouppo)\n                //Edit(canvas)\n                console.log(grouppo._objects[0])\n                console.log(grouppo)\n                  \n                canvas.remove(activeLine);\n                canvas.remove(activeShape)\n                //canvas.add(polygon);\n        \n                activeLine = null;\n                activeShape = null;\n                polygonMode = false;\n                //canvas.selection = true;\n\n                canvas.forEachObject(function(object){ \n                    object.selectable = true; \n                });\n\n                //return group\n            }\n        };\n        \n        \n        //return prototypefabric.polygon.drawPolygon();\n    }\n}\n\nexport {Segmentation}","const behaviors = [{\n  value: 'Feeding',\n  label: 'Feeding'\n},{\n  value: 'Drinking',\n  label: 'Drinking'\n},{\n  value: 'Exploratory',\n  label: 'Exploratory'\n},{\n  value: 'Social',\n  label: 'Social'\n},{\n  value: 'Locomotion',\n  label: 'Locomotion'\n},{\n  value: 'Proximity',\n  label: 'Proximity'\n},{\n  value: 'Others',\n  label: 'Others'\n}]\n\nexport {behaviors};\n","const posture = [{\n  value: 'Lying',\n  label: 'Lying'\n},{\n  value: 'Sitting',\n  label: 'Sitting'\n},{\n  value: 'Kneeling',\n  label: 'Kneeling'\n},{\n  value: 'Standing',\n  label: 'Standing'\n}]\n\n  export {posture}","const confidence = [{\n    value: 'No occlusion',\n    label: 'No occlusion'\n  },{\n    value: 'Minor occlusion',\n    label: 'Minor occlusion'\n  },{\n    value: 'Split occlusion',\n    label: 'Split occlusion'\n  },{\n    value: 'End occlusion',\n    label: 'End occlusion'\n  },{\n    value: 'Critical occlusion',\n    label: 'Critical occlusion'\n  }\n]\nexport {confidence};\n","import React from \"react\"; \nimport { Type } from 'react-bootstrap-table2-editor';\nimport {behaviors} from './behaviors'\nimport {posture} from './posture'\nimport {status} from './status'\nimport {confidence} from './confidence'\nimport Button from 'react-bootstrap/Button'\n\nconst columns = (remove_table_index) => [{\n  dataField: \"id\",\n  text: \"ID\",\n  headerStyle: () => { return { width: \"40px\", left: 0 }; },\n  editable: false,\n},{\n  dataField: \"global_id\",\n  text: \"Glo\",\n  headerStyle: () => { return { width: \"70px\", left: 0}; }\n},{\n  dataField: \"posture\",\n  text: \"Posture\",\n  editor: {\n      type: Type.SELECT,\n      options: posture,\n  }\n},\n{\n  dataField: \"behavior\",\n  text: \"Behavior\",\n  editor: {\n      type: Type.SELECT,\n      options: behaviors,\n  }\n},{\n  dataField: \"confidence\",\n  text: \"Confidence\",\n  editor: {\n      type: Type.SELECT,\n      options: confidence,\n  }\n},{\n  dataField: \"remove\",\n  text: \"Del\",\n  editable: false,\n  headerStyle: () => { return { width: \"50px\", left: 0}; },\n  headerFormatter: () => {return (\n    <div>\n      Del\n      <Button\n        className=\"btn btn-danger btn-xs\"\n        onClick={() => remove_table_index()}\n        label=\"Del\"\n      >\n      </Button>\n    </div>\n  );},\n  formatter: (cellContent, row) => {\n    return (\n      <div>        \n        <Button\n          className=\"btn btn-danger btn-xs\"\n            onClick={() => remove_table_index(row.id)}\n            label=\"Del\"\n          >\n        </Button>\n      </div>\n    );\n  },\n}\n]\nexport {columns}\n \n","import React from \"react\"; \n\nexport default function Instructions(){\n    return (\n        <div>\n        <h3>Keybinds:</h3>\n\n        There are preset keybinds setup to make it easier to use the tool without having to click around. If done properly a combination of mouse and keyboard actions speed up the annotation process. \n        <br></br><br></br>\n        * <kbd>1</kbd> : Mode Switch: Behavior<br></br>\n        * <kbd>2</kbd> : Mode Switch: Bounding Box<br></br>\n        * <kbd>3</kbd> : Mode Switch: Segmentation<br></br>\n        * <kbd>a</kbd> : Add annotation<br></br>\n        * <kbd>e</kbd> : Skip forward frame(s)<br></br>\n        * <kbd>q</kbd> : Skip backward frame(s)<br></br>\n        * <kbd>w</kbd> : Pause/Play<br></br>\n        * <kbd>c</kbd> : Copy previous annotation<br></br>\n        * <kbd>f</kbd> : Activate/Deactivate scrub mode (Activated by default)<br></br>\n\n        <br></br><br></br>\n        <h3>Uploading Video:</h3>\n\n        Ensure that you know the framerate of the video chosen to be annotated. These values should be entered into the settings tab into their \"frame rate\" fields. \n        <br></br><br></br>\n        Click on the right side browse button. All other buttons on the screen shuold be disabled until the video has been uploaded. Currenntly ```.mp4``` format is the best choice and tested for. Other file types such as .avi are supported but might have unintended bugs.\n        <br></br><br></br>\n        <h3>Annotations</h3>\n        <br></br>\n        There are currently three kinds of annotations. \n        <br></br><br></br>\n        <h4>Behavior Annotation:</h4>\n\n        This is for having annotations that do not have any visual attribute attached to it. This annotation is also attached by default when the bounding box or segmentation annotation is created. \n\n        <br></br><br></br>\n        <h4>Bounding Box:</h4>\n\n        This forms a square around the desired object. There should be small squares at the edges of the bounding box which can be used to resize the box. The number on the top left of the box is used to identify the placement of the box in the table to the right.\n        <br></br><br></br>\n        <h4>Segmentation:</h4>\n\n        Upon generating this each click on the video generates a point which eventually will transform to a set of interconnected points. To complete the polygon click on the original point generated (which is the red colored point)\n        If there is a need to edit, then click on the \"Edit Seg\" button to start the editing process.\n\n        </div>\n    )\n}","import {createSlice} from '@reduxjs/toolkit'\n\nconst initialState = {data: []}\n\nconst frameDataSlice = createSlice({\n    name: 'frame_data',\n    initialState,\n    reducers:{\n        init(state, payload){\n            var data = [];\n            for(var i = 0; i < payload.payload; i++){\n                data.push([]);\n            }\n            state.data = data;\n        },\n        initOldAnnotation(state, payload){\n            state.data = payload.payload\n        },\n        modifyFrame(state, payload){\n            var temp = state.data\n            temp[payload.payload.currentFrame] = payload.payload.data\n            state.data = temp\n        },\n        middleware: (getDefaultMiddleware) => getDefaultMiddleware({\n            serializableCheck: false\n        })\n    }\n})\n\nexport const {init, modifyFrame} = frameDataSlice.actions\nexport default frameDataSlice.reducer","import {createSlice} from '@reduxjs/toolkit'\n\nconst initialState = {data: []}\n\nconst annotationDataSlice = createSlice({\n    name: 'annotation_data',\n    initialState,\n    reducers:{\n        init(state, payload){\n            console.log(payload.payload)\n            var data = [];\n            for(var i = 0; i < payload.payload; i++){\n                data.push([]);\n            }\n            state.data = data;\n        },\n        initOldAnnotation(state, payload){\n            state.data = payload.payload\n        },\n        modifyFrame(state, payload){\n            console.log(payload.payload)\n            var temp = state.data\n            temp[payload.payload.currentFrame] = payload.payload.data\n            state.data = temp\n        },\n        middleware: (getDefaultMiddleware) => getDefaultMiddleware({\n            serializableCheck: false\n        })\n    }\n})\n\nexport const {init, modifyFrame} = annotationDataSlice.actions\nexport default annotationDataSlice.reducer","import {createSlice} from '@reduxjs/toolkit'\n\nconst initialState = {data: undefined}\n\nconst columnDataSlice = createSlice({\n    name: 'column_annot',\n    initialState,\n    reducers:{\n        init(state, payload){\n            console.log(payload.payload.data)\n            state.data = payload.payload.data\n        },\n        middleware: (getDefaultMiddleware) => getDefaultMiddleware({\n            serializableCheck: false\n        })\n    }\n})\n\nexport const {init} = columnDataSlice.actions\nexport default columnDataSlice.reducer","import { configureStore } from '@reduxjs/toolkit'\nimport frameDataSlice from './reducer/frame_data'\nimport annotationDataSlice from './reducer/annotation_data'\nimport columnDataSlice from './reducer/column_annot'\n\nexport default configureStore({\n  reducer: {\n    frame_data: frameDataSlice,\n    annotation_data: annotationDataSlice,\n    column_annot: columnDataSlice\n  },\n})","import store from '../store'\n\n/*\nAction functions for frame_data\n*/\nfunction initFrameData(frame_count){\n\tstore.dispatch({\n\t\ttype: \"frame_data/init\",\n\t\tpayload: frame_count\n\t})\n}\nfunction updateFrameData(frame_number, data){\n\tstore.dispatch({\n\t\ttype: \"frame_data/modifyFrame\",\n\t\tpayload: {currentFrame: frame_number, data: data}\n\t})\n}\nfunction getFrameData(frame_number){\n\treturn store.getState().frame_data.data[frame_number]\n} \n\n/*\nAction functions for annotation_data\n*/\nfunction initAnnotationData(frame_count){\n    store.dispatch({\n\t\ttype: \"annotation_data/init\",\n\t\tpayload: frame_count\n\t})\n}\nfunction updateAnnotationData(frame_number, data){\n    store.dispatch({\n\t\ttype: \"annotation_data/modifyFrame\",\n\t\tpayload: {currentFrame: frame_number, data: data}\n\t})\n}\nfunction getAnnotationData(frame_number){\n    return store.getState().annotation_data.data[frame_number]\n}\n\n/*\nAction functions for column uploading\n*/\nfunction initColumnData(column_dat){\n\tstore.dispatch({\n\t\ttype: \"column_annot/init\",\n\t\tpayload: {data: column_dat}\n\t})\n}\n\nfunction getColumnData(){\n\treturn store.getState().column_annot\n}\n\nexport {initFrameData, updateFrameData, getFrameData, initAnnotationData, updateAnnotationData, getAnnotationData, initColumnData, getColumnData}","import store from '../store'\nimport {getFrameData, getAnnotationData} from './actions'\n\nexport async function downloadFileJSON (ANNOTATION_VIDEO_NAME, ANNOTATOR_NAME, frame_data, annotation_data, VIDEO_METADATA) {\n    var fileName = \"generated_annotations\";\n    if(ANNOTATION_VIDEO_NAME !== \"\" && ANNOTATOR_NAME !== \"\"){\n        fileName = ANNOTATION_VIDEO_NAME.split('.').slice(0, -1).join('.') + \"_\" +  ANNOTATOR_NAME\n    }\n    console.log(annotation_data)\n    //const json = JSON.stringify(fabricCanvas.getObjects());\n    const json = JSON.stringify({\"vid_metadata\": VIDEO_METADATA, \"annotations\": store.getState().frame_data.data, \"behavior_data\": store.getState().annotation_data.data})\n    //var json = JSON.stringify(frame_data);\n    var blob = new Blob([json],{type:'application/json'});\n    var href = await URL.createObjectURL(blob);\n    var link = document.createElement('a');\n    link.href = href;\n    link.download = fileName + \".json\";\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n}\n\n\n//Legacy code below - Can be refrenced later IF need for CSV is present. Currently broken.\nfunction convert_data_csv(data, columns){\n    console.log(columns)\n    var csv = new Array(data.length + 1)\n    for(var i = 0; i < csv.length; i++){\n        csv[i] = []\n    }\n    csv[0].push(\"frame_num\")\n    for(var i = 0; i < columns.length; i++){\n        csv[0].push(columns[i]['dataField'])\n    }\n    for(var i = 0; i < data.length; i++){\n        for(var j = 0; j < data[i].length; j++){\n            csv[i+1][j]=[];\n            var obj = data[i][j]\n            var vals = Object.keys((obj)).map(function (key) { return obj[key]; });\n            csv[i+1][j] = i + \",\" + vals.join(\",\")\n        }\n        csv[i+1] = csv[i+1].join(\"\\n\")\n    }\n    csv = csv.join(\"\\n\")\n    return csv\n}\n\nexport async function downloadFileCSV (ANNOTATION_VIDEO_NAME, ANNOTATOR_NAME, annotation_data, columns) {\n    var fileName = \"generated_annotations\";\n    if(ANNOTATION_VIDEO_NAME !== \"\" && ANNOTATOR_NAME !== \"\"){\n        fileName = ANNOTATION_VIDEO_NAME.split('.').slice(0, -1).join('.') + \"_\" +  ANNOTATOR_NAME\n    }\n    var csv = convert_data_csv(annotation_data, columns(\"\"))\n    var blob = new Blob([csv],{type:'application/octet-stream'});\n    var href = await URL.createObjectURL(blob);\n    var link = document.createElement('a');\n    link.href = href;\n    link.download = fileName + \".csv\";\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n}","import '@tensorflow/tfjs-backend-cpu';\nimport '@tensorflow/tfjs-backend-webgl';\nimport * as cocoSsd from '@tensorflow-models/coco-ssd';\n\nimport {BoundingBox} from '../annotations/bounding_box'\n\nlet modelPromise;\n\nexport async function load(model_type) {\n    alert(\"Loading model\\nThis might take a second or so...\")\n    const model = await cocoSsd.load();\n    model.dispose();\n    modelPromise = cocoSsd.load({base: model_type});\n}\n\nexport async function run_model(fabricCanvas, annotation_data, currentFrame, save_data, refresh) {\n    const image = document.getElementsByTagName(\"video\")[0]\n    console.log(image.height)\n\n    console.log(\"IMAGE CLASSIFICATION\")\n    const model = await modelPromise;\n    console.log('model loaded');\n    console.time('predict1');\n    const result = await model.detect(image);\n    console.timeEnd('predict1');\n\n    for (let i = 0; i < result.length; i++) {\n        var box = result[i].bbox\n        var color = \"#\" + ((1<<24)*Math.random() | 0).toString(16)\n        var new_bbox = new BoundingBox(box[1], box[0], box[2], box[3], color, i+'b', \"None\").generate_no_behavior(fabricCanvas)\n        fabricCanvas.add(new_bbox)\n        annotation_data[currentFrame].push({id: i+'b', global_id: i,status: \"\", current: \"\", behavior: \"\", posture: \"\", notes: \"\"})\n    } \n    save_data(currentFrame)\n    refresh()\n    /*\n    const c = document.getElementById('canvas');\n    const context = c.getContext('2d');\n    //context.drawImage(image, 0, 0);\n    context.font = '10px Arial';\n\n    console.log('number of detections: ', result.length);\n    for (let i = 0; i < result.length; i++) {\n        context.beginPath();\n        context.rect(...result[i].bbox);\n        context.lineWidth = 3;\n        context.strokeStyle = 'red';\n        context.fillStyle = 'red';\n        context.stroke();\n        context.fillText(\n            result[i].score.toFixed(3) + ' ' + result[i].class, result[i].bbox[0],\n            result[i].bbox[1] > 10 ? result[i].bbox[1] - 5 : 10);\n    }\n    console.log(result)\n    //alert(JSON.stringify(result))*/\n};\n","//const tf = require('@tensorflow-models/tfjs-node');\nconst deeplab = require('@tensorflow-models/deeplab');\nconst tfconv = require('@tensorflow/tfjs-converter');\n\nconst fabric = require(\"fabric\").fabric;\nconst $ = require(\"jquery\")\n\nconst loadModel = async () => {\n    const modelName = 'pascal';   // set to your preferred model, either `pascal`, `cityscapes` or `ade20k`\n    const quantizationBytes = 4;  // either 1, 2 or 4\n    return await deeplab.load({base: modelName, quantizationBytes});\n  };\n\n\nexport async function load(){\n\n}\n\nexport async function run_model_segment(fabricCanvas, annotation_data, currentFrame, save_data, refresh) {\n    const image = document.getElementsByTagName(\"video\")[0]\n    console.log(image.height)\n\n    loadModel()\n    .then((model) => model.segment(image))\n    .then(\n        ({segmentationMap, width, height, legend}) =>{\n\n            console.log(segmentationMap);\n            console.log(fabricCanvas.getHeight())\n            console.log(fabricCanvas.getWidth())\n            //let width = fabricCanvas.getWidth();\n            //let height = fabricCanvas.getHeight();\n            var seg_image = new ImageData(segmentationMap, width, height)\n            //fabricCanvas.Image(seg_image)\n\n            var c = document.createElement('canvas');\n\n            c.setAttribute('id', '_temp_canvas');\n            c.width = width;\n            c.height = height;\n\n            c.getContext('2d').putImageData(seg_image, 0, 0);\n\n            fabric.Image.fromURL(c.toDataURL(), function(img) {\n                img.left = 0;\n                img.top = 0;\n                img.opacity = .5;\n                img.scaleX = fabricCanvas.getHeight() / height;\n                img.scaleY = fabricCanvas.getWidth() / width;\n                fabricCanvas.add(img);\n                img.bringToFront();\n                c = null;\n                $('#_temp_canvas').remove();\n                fabricCanvas.renderAll();\n            });\n\n        });\n}\n","export default class ExportingAnnotation{\n    constructor(annotation_data, canvas, VIDEO_METADATA, image_data){\n        this.frame_data = annotation_data\n        this.canvas = canvas\n        this.metadata = VIDEO_METADATA\n        this.image_data = image_data\n    }\n\n    get_frame_json(){\n        console.log(this.frame_data[0][0].get('type'))\n        var standard_annot = new Array(this.frame_data.length)\n        console.log(this.metadata)\n        for(var i = 0; i < this.frame_data.length; i++){\n            var curr = []\n\n            if(this.frame_data[i] == []){\n                continue;\n            }\n            var frame_objects = this.frame_data[i]\n            if(frame_objects == undefined){\n                continue;\n            }\n            \n            for(var j = 0; j < frame_objects.length; j++){\n                console.log(frame_objects[j]._objects)\n                if(frame_objects[j].get('type') !== \"group\"){\n                    continue;\n                }\n                if(frame_objects[j]._objects[0]['type'] === \"rect\"){\n                    console.log(frame_objects[j])\n                    var x = (frame_objects[j]['left'] / this.canvas.width) * this.metadata['horizontal_res']\n                    var y = (frame_objects[j]['top'] / this.canvas.height) * this.metadata['vertical_res']\n                    var width = ((frame_objects[j]['width'] * frame_objects[j]['scaleX']) / this.canvas.width) * this.metadata['horizontal_res']\n                    var height = ((frame_objects[j]['height'] * frame_objects[j]['scaleY']) / this.canvas.height )* this.metadata['vertical_res']\n                    var local_id = frame_objects[j]._objects[1]['text']\n                    if(this.image_data.length != 0){\n                        curr.push({\"type\": \"bounding_box\",\"x\": x, \"y\": y, \"width\": width, \"height\": height, \"local_id\": local_id,\"fileName:\": this.image_data[i]['name'], \"dataType\": \"image\"})\n                    }else{\n                        curr.push({\"type\": \"bounding_box\",\"x\": x, \"y\": y, \"width\": width, \"height\": height, \"local_id\": local_id, \"fileName:\": this.metadata['name'], \"dataType\": \"video\"})\n                    }\n                    //curr.push({\"type\": \"bounding_box\",\"x\": x, \"y\": y, \"width\": width, \"height\": height, \"local_id\": local_id})\n                }else if (frame_objects[j]._objects[0]['type'] === \"polygon\"){\n                    var raw_points = frame_objects[j]._objects[0]['points']\n                    var points = []\n                    for(var k = 0; k < raw_points.length; k++){\n                        var x = (raw_points[k]['x'] / this.canvas.width) * this.metadata['horizontal_res']\n                        var y = (raw_points[k]['y'] / this.canvas.height) * this.metadata['vertical_res']\n                        points.push({\"x\": x, \"y\": y})\n                    }\n                    var local_id = frame_objects[j]._objects[1]['text']\n\n                    if(this.image_data.length != 0){\n                        curr.push({\"type\": \"segmentation\", \"points\": points, \"local_id\": local_id, \"fileName:\": this.image_data[i]['name'], \"dataType\": \"image\"})\n                    }else{\n                        curr.push({\"type\": \"segmentation\", \"points\": points, \"local_id\": local_id, \"fileName:\": this.metadata['name'], \"dataType\": \"video\"})\n                    }\n                    //curr.push({\"type\": \"segmentation\", \"points\": points, \"local_id\": local_id})\n                }\n\n            }\n\n            standard_annot[i] = curr\n        }\n        return standard_annot\n    }\n\n    get_frame_json_fullCanvas(){\n        var standard_annot = new Array(this.frame_data.length)\n        console.log(this.metadata)\n        for(var i = 0; i < this.frame_data.length; i++){\n            var curr = []\n\n            if(this.frame_data[i] == []){\n                continue;\n            }\n            var frame_objects = this.frame_data[i]['objects']\n            if(frame_objects == undefined){\n                continue;\n            }\n            \n            for(var j = 0; j < frame_objects.length; j++){\n                console.log(frame_objects[j])\n                if(frame_objects[j]['type'] !== \"group\"){\n                    continue;\n                }\n                if(frame_objects[j]['objects'][0]['type'] === \"rect\"){\n                    console.log(frame_objects[j])\n                    var x = (frame_objects[j]['left'] / this.canvas.width) * this.metadata['horizontal_res']\n                    var y = (frame_objects[j]['top'] / this.canvas.height) * this.metadata['vertical_res']\n                    var width = ((frame_objects[j]['width'] * frame_objects[j]['scaleX']) / this.canvas.width) * this.metadata['horizontal_res']\n                    var height = ((frame_objects[j]['height'] * frame_objects[j]['scaleY']) / this.canvas.height )* this.metadata['vertical_res']\n                    var local_id = frame_objects[j]['objects'][1]['text']\n                    if(this.image_data.length != 0){\n                        curr.push({\"type\": \"bounding_box\",\"x\": x, \"y\": y, \"width\": width, \"height\": height, \"local_id\": local_id,\"fileName:\": this.image_data[i]['name'], \"dataType\": \"image\"})\n                    }else{\n                        curr.push({\"type\": \"bounding_box\",\"x\": x, \"y\": y, \"width\": width, \"height\": height, \"local_id\": local_id, \"fileName:\": this.metadata['name'], \"dataType\": \"video\"})\n                    }\n                    //curr.push({\"type\": \"bounding_box\",\"x\": x, \"y\": y, \"width\": width, \"height\": height, \"local_id\": local_id})\n                }else if (frame_objects[j]['objects'][0]['type'] === \"polygon\"){\n                    var raw_points = frame_objects[j]['objects'][0]['points']\n                    var points = []\n                    for(var k = 0; k < raw_points.length; k++){\n                        var x = (raw_points[k]['x'] / this.canvas.width) * this.metadata['horizontal_res']\n                        var y = (raw_points[k]['y'] / this.canvas.height) * this.metadata['vertical_res']\n                        points.push({\"x\": x, \"y\": y})\n                    }\n                    var local_id = frame_objects[j]['objects'][1]['text']\n\n                    if(this.image_data.length != 0){\n                        curr.push({\"type\": \"segmentation\", \"points\": points, \"local_id\": local_id, \"fileName:\": this.image_data[i]['name'], \"dataType\": \"image\"})\n                    }else{\n                        curr.push({\"type\": \"segmentation\", \"points\": points, \"local_id\": local_id, \"fileName:\": this.metadata['name'], \"dataType\": \"video\"})\n                    }\n                    //curr.push({\"type\": \"segmentation\", \"points\": points, \"local_id\": local_id})\n                }\n\n            }\n\n            standard_annot[i] = curr\n        }\n        return standard_annot\n    }\n\n    get_frame_coco(){\n\n    }\n}","export default async function videoFrameExtract(frame_rate, skip_val, handleText){\n    \n    //alert(\"Video will be extracted into frames - This might take a bit!\")\n    const video = document.getElementById(\"process_vid\")\n    var total_frames = video.duration * frame_rate\n    console.log(total_frames)\n    console.log(video.duration)\n\n    let canvas = document.createElement('canvas');\n    let context = canvas.getContext('2d');\n    let [w, h] = [video.videoWidth, video.videoHeight]\n    canvas.width =  w;\n    canvas.height = h;\n\n    let frames = [];\n    context.drawImage(video, 0, 0, w, h);\n    let base64ImageData = canvas.toDataURL();\n    frames.push(base64ImageData);\n\n    let seekResolve;\n    video.addEventListener('seeked', async function() {\n      if(seekResolve) seekResolve();\n    });\n\n    for(var i = 1; i < total_frames; i=i+skip_val){\n        var new_time = parseFloat((i/total_frames)*video.duration)\n        console.log(new_time)\n        video.currentTime = new_time\n        handleText(((i/(total_frames-1))*100).toFixed(2).toString() + \"%\" + \"completed\" + \"    |   \" + (i+1).toString() + \"/\" + total_frames.toString() + \" frames processed.\")\n\n        await new Promise(r => seekResolve=r);\n\n        context.drawImage(video, 0, 0, w, h);\n        let base64ImageData = canvas.toDataURL();\n        frames.push(base64ImageData);\n    }\n    //console.log(frames)\n    return frames\n}","import React from 'react';\nimport { useState } from 'react';\nimport \"bootstrap/dist/css/bootstrap.min.css\";\n\nimport Navbar from 'react-bootstrap/Navbar'\nimport Nav from 'react-bootstrap/Nav'\nimport Button from 'react-bootstrap/Button'\nimport { NavDropdown, NavLink } from 'react-bootstrap';\nimport Form from 'react-bootstrap/Form'\nimport Dropdown from 'react-bootstrap/Dropdown'\nimport { ButtonGroup } from 'react-bootstrap';\nimport Modal from 'react-bootstrap/Modal'\nimport Carousel from 'react-bootstrap/Carousel'\n\nimport { Container, Jumbotron, Col, Row, Card} from \"react-bootstrap\";\n\n\nimport videoFrameExtract from '../../processing/video_to_frame';\n\nvar test_frame = []\nexport default function ProcessVideo(props){\n    const [show, setShow] = useState(true);\n    const handleShow = () => setShow(true);\n    const handleClose = () => setShow(false);\n    const [frames, setFrames] = useState(null);\n    const [text, setText] = useState(\"\");\n\n    const handleText = (event) => {\n        setText(event)\n    }\n\n    const handleProcess = (e) => {\n        if(props.frame_rate === 0){\n            var temp = videoFrameExtract(15, 15, handleText).then(function(ret) {\n                setFrames(ret)\n                test_frame = ret\n                console.log(ret)\n            })\n            return;\n        }\n        var temp = videoFrameExtract(props.frame_rate)\n        setFrames(temp)\n        test_frame = temp\n        console.log(temp)\n    }\n    console.log(test_frame)\n    return(\n        <Modal show={show} onHide={handleClose} size='lg'>\n            <Modal.Header closeButton>\n            <Modal.Title>Processing Video...</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                <div>\n                    <video id='process_vid' style={{objectFit: 'contain', height: '100%', width: '100%'}} src={props.video_link}></video>\n                    <Button onClick={handleProcess} enable={frames!=null} >Process Video</Button>\n                    {text}\n                    {\n                        frames != null &&\n                        <Carousel controls={true} fade style={{objectFit: 'contain', height: '100%', width: '100%'}}>\n                        {\n                            frames.map((x) => {\n                                return(\n                                        <Carousel.Item >eee\n                                            <Card className=\"mb-5 box-shadow\" top\n                                                width='100%'\n                                            >\n                                                <Card.Img style={{objectFit: 'contain', height: '100%', width: '100%'}} src={x} />\n                                            </Card>\n                                        </Carousel.Item>\n                                    )\n                            })\n                        }\n                            \n                        </Carousel>\n                    }\n                </div>\n            </Modal.Body>\n            <Modal.Footer>\n            <Button variant=\"secondary\" onClick={handleClose}>Close</Button>\n            </Modal.Footer>\n        </Modal>\n    )\n}","import React from 'react';\nimport { useState } from 'react';\nimport \"bootstrap/dist/css/bootstrap.min.css\";\n\nimport Navbar from 'react-bootstrap/Navbar'\nimport Nav from 'react-bootstrap/Nav'\nimport Button from 'react-bootstrap/Button'\nimport { NavDropdown, NavLink } from 'react-bootstrap';\nimport Form from 'react-bootstrap/Form'\nimport Dropdown from 'react-bootstrap/Dropdown'\nimport { ButtonGroup } from 'react-bootstrap';\nimport Modal from 'react-bootstrap/Modal'\n\nimport DatePicker from 'react-datepicker'\nimport \"react-datepicker/dist/react-datepicker.css\";\n\nimport Instructions from './instructions';\nimport { downloadFileJSON , downloadFileCSV} from '../../processing/download';\nimport { Edit } from '../../annotations/segmentation_edit';\n\nimport {run_model, load} from '../../tensorflow/ObjectDetection';\nimport { run_model_segment } from '../../tensorflow/SemanticSegmentation'; \n\nimport ExportingAnnotation from '../../processing/exporting_annotation';\nimport ProcessVideo from './process_video';\nimport store from '../../store' \n\nimport {initFrameData, updateFrameData, getFrameData, initAnnotationData, updateAnnotationData, getAnnotationData, initColumnData} from '../../processing/actions'\n\nexport default function CustomNavBar(props){\n\tconst [show, setShow] = useState(false);\n\tconst [uploadShow, setUploadShow] = useState(true);\n\tconst [startDate, setStartDate] = useState(0);\n\tconst [frameRate, setFrameRate] = useState(0)\n\tconst [videoFormat, setVideoFormat] = useState(0)\n\tconst [videoLink, setVideoLink] = useState(\"\")\n\tconst [model, setModel] = useState(\"\")\n\tconst [process, setProcess] = useState(false)\n\tconst [editSeg, setEditSeg] = useState(false)\n\tconst [columnData, setColumnData] = useState({})\n\n\tconst handleClose = () => setShow(false);\n\tconst handleShow = () => setShow(true);\n\tconst handleUploadClose = () => {setUploadShow(false); setProcess(true)}\n\tconst handleUploadShow = () => setUploadShow(true)\n\n\tconst handleDownloadJSON = () => {\n\t\tvar converted_annot = new ExportingAnnotation(store.getState().frame_data.data, props.fabricCanvas, props.VIDEO_METADATA, props.image_frames).get_frame_json()\n\t\tdownloadFileJSON(props.ANNOTATION_VIDEO_NAME, props.ANNOTATOR_NAME, converted_annot, props.annotation_data, props.VIDEO_METADATA)\n\t}\n\n\tconst handleSetStartDate = (date) => {\n\t\tsetStartDate(date)\n\t\ttry { //Making sure that any garbage input taken care of\n\t\t\tprops.setDateTime(Math.floor((date.getTime() / 1000)))\n\t\t} catch (error) {\n\t\t\talert(\"Invalid date input!\")\n\t\t}\n\t}\n\n\tconst handleVideoFormat = (type) => {\n\t\tconsole.log(type)\n\t\t//TODO Make sure bug is resolved and simply have video format equal type\n\t\ttype = parseInt(type)\n\t\tif(type === 0){\n\t\t\tsetVideoFormat(0)\n\t\t}else if (type === 1){\n\t\t\tsetVideoFormat(1)\n\t\t}else if (type === 2){\n\t\t\tsetVideoFormat(2)\n\t\t\tprops.handleInputType(1)\n\t\t}\n\t}\n\n\tconst handleEnableModel = (event) => {\n\t\t//Defualt value is true which is disbaled. False turns it on!\n\t\tif(model === \"\"){\n\t\t\talert(\"Please select a model\")\n\t\t}\n\t\tload(model)\n\t}\n\n\tconst handleVideoLink = (event) => {\n\t\tif(typeof(event) === \"string\"){\n\t\t\tsetVideoLink(event.target.value)\n\t\t\tconsole.log(event.target.value)\n\t\t}else{\n\t\t\tsetVideoLink(URL.createObjectURL(event.target.files[0]))\n\t\t}\n\t}\n\n\tconst edit_click = (event) => {\n\t\tsetEditSeg(!editSeg);\n\t\tEdit(props.fabricCanvas, props.save_data);\n\t\tprops.toggle_segmentation();\n\t\tprops.save_data()\n\t}\n\n\tconst handleColumnUpload = (event) => {\n\t\tvar promise = downloadColumn(event)\n\t\tpromise.then(function (result) {\n\t\t\tif(result != null){\n\t\t\t\tsetColumnData(result);\n\t\t\t\tconsole.log(result)\n\t\t\t\tinitColumnData(result)\n\t\t\t\talert(\"Column data upload successful.\")\n\t\t\t}else{\n\t\t\t\talert(\"Error in processing columns\")\n\t\t\t}\n\t\t})\n\t}\n\n\tconst downloadColumn = (file) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\tvar reader = new FileReader();\n\t\treader.onload = function(e) {\n\t\t\tresolve((JSON.parse(e.target.result)));\n\t\t}\n\t\treader.readAsText(file.target.files[0])\n\t\t})\n\t}\n\n\n\treturn (\n\t\t<div>\n\t\t{\n\t\t\t//TODO Re-enable this for video processing. \n\t\t\tprocess == 2 && \n\t\t\t<ProcessVideo\n\t\t\t\tframe_rate={frameRate}\n\t\t\t\tvideo_link={videoLink}\n\t\t\t/>\n\t\t}\n\t\t<Modal show={show} onHide={handleClose} size='lg'>\n\t\t\t<Modal.Header closeButton>\n\t\t\t<Modal.Title>Instructions</Modal.Title>\n\t\t\t</Modal.Header>\n\t\t\t<Modal.Body><Instructions></Instructions></Modal.Body>\n\t\t\t<Modal.Footer>\n\t\t\t<Button variant=\"secondary\" onClick={handleClose}>Close</Button>\n\t\t\t</Modal.Footer>\n\t\t</Modal>\n\t\t<Modal show={uploadShow} onHide={handleUploadClose} size='lg'>\n\t\t\t<Modal.Header closeButton>\n\t\t\t\t<Modal.Title>Upload</Modal.Title>\n\t\t\t</Modal.Header>\n\t\t\t<Modal.Body>\n\t\t\t\t<div style={{display: \"grid\"}}>\n\t\t\t\t\t{/*onClick and onBlur events are for the sole purpose to stop the eventKeys from firing off*/}\n\t\t\t\t\t<Form style={{float: \"left\",gridColumn: 1, gridRow:1, zIndex:99}}>\n\t\t\t\t\t\tVideo Format: \n\t\t\t\t\t\t<Form.Control\n\t\t\t\t\t\t\tas=\"select\"\n\t\t\t\t\t\t\tid=\"inlineFormCustomSelect\"\n\t\t\t\t\t\t\tonChange={(event)=>{handleVideoFormat(event.target.value)}}\n\t\t\t\t\t\t\tdefaultValue={videoFormat}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<option value=\"0\">Upload</option>\n\t\t\t\t\t\t\t<option value=\"1\">Youtube</option>\n\t\t\t\t\t\t\t<option value=\"2\">Image</option>\n\t\t\t\t\t\t</Form.Control>\n\t\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\t</Form>\n\t\t\t\t\t<div style={{float: \"left\",gridColumn: 1, gridRow:2, zIndex:99}}>\n\t\t\t\t\t\tAnnotator Name: <input type='text' defaultValue={props.ANNOTATOR_NAME} onClick={(event) => {props.toggleKeyCheck(false)}} onBlur={(event) => {props.toggleKeyCheck(true)}} onChange={(event) => {props.change_annotator_name(event.target.value)}}></input>\n\t\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style={{float: \"left\",gridColumn: 1, gridRow:3, zIndex:99}}>\n\t\t\t\t\t\t{\"Date and Time:\"}\n\t\t\t\t\t\t<DatePicker\n\t\t\t\t\t\t\tselected={startDate}\n\t\t\t\t\t\t\tonChange={(date) => {handleSetStartDate(date)}}\n\t\t\t\t\t\t\ttimeInputLabel=\"Time:\"\n\t\t\t\t\t\t\tdateFormat=\"yyyy/MM/dd hh:mm\"\n\t\t\t\t\t\t\tshowTimeInput\n\t\t\t\t\t\t\tonClick={(event) => {props.toggleKeyCheck(false)}}\n\t\t\t\t\t\t\tonClickOutside={(event) => {props.toggleKeyCheck(true)}}\n\t\t\t\t\t\t\tonCalendarOpen={(event) => {props.toggleKeyCheck(false)}}\n\t\t\t\t\t\t\tonCalendarClose={(event) => {props.toggleKeyCheck(true)}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\t</div>\n\t\t\t\t\t{videoFormat === 0 && \n\t\t\t\t\t\t<Form style={{float: \"left\",gridColumn: 1, gridRow:4}}>\n\t\t\t\t\t\t\t<Form.File multiple id=\"file\" label=\"Video Upload\" accept=\".mp4\" custom type=\"file\" onChange={(event) => {props.handleVideoUpload(event); handleVideoLink(event)}} />\n\t\t\t\t\t\t</Form>\n\t\t\t\t\t}\n\t\t\t\t\t{videoFormat === 1 &&\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t{'Youtube URL:'}\n\t\t\t\t\t\t\t<input onChange={handleVideoLink}></input>\n\t\t\t\t\t\t\t<Button onClick={(event) => {props.handleVideoUpload(videoLink)}}>Upload</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t}{videoFormat === 2 &&\n\t\t\t\t\t\t<Form style={{float: \"left\",gridColumn: 1, gridRow:4}}>\n\t\t\t\t\t\t\t<Form.File multiple id=\"file\" label=\"Image-set Upload\" accept=\"image/*\" custom type=\"file\" onChange={(event) => {props.handleVideoUpload(event); handleVideoLink(event)}} />\n\t\t\t\t\t\t</Form>\n\t\t\t\t\t}\n\t\t\t\t\t<Form style={{float: \"left\",gridColumn: 1, gridRow:5}}>\n\t\t\t\t\t\t<Form.File disabled={props.disable_buttons} accept=\".json\" id=\"file\" label=\"Annotation Upload\" custom type=\"file\" onChange={props.handleOldAnnotation}/>\n\t\t\t\t\t</Form>\n\t\t\t\t\t<Form style={{float: \"left\",gridColumn: 1, gridRow:6}}>\n\t\t\t\t\t\t<Form.File disabled={props.disable_buttons} accept=\".json\" id=\"file\" label=\"Column Upload\" custom type=\"file\" onChange={handleColumnUpload}/>\n\t\t\t\t\t</Form>\n\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\tFrame Rate: <input type=\"number\" value={props.frame_rate} onClick={(event) => {props.toggleKeyCheck(false)}} onBlur={(event) => {props.toggleKeyCheck(true)}} onChange={(event) => {props.setFrameRate(parseInt(event.target.value)); setFrameRate(parseInt(event.target.value))}}></input>\n\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\tSkip Value: <input type='number' defaultValue=\"1\" onChange={(event) => {props.change_skip_value(parseInt(event.target.value))}}></input>\n\t\t\t\t\tPlayback Rate: <input type='number' defaultValue=\"1\" onChange={(event) => {props.handleSetPlaybackRate(parseInt(event.target.value))}}></input>\n\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\t<div>\n\t\t\t\t\t\tEnable Object Detection Model:{' '}\n\t\t\t\t\t\t<select defaultValue={model} onChange={(event) => {setModel(event.target.value)}} id='base_model'>\n\t\t\t\t\t\t\t<option value=\"\">Select</option>\n\t\t\t\t\t\t\t<option value=\"lite_mobilenet_v2\">SSD Lite Mobilenet V2</option>\n\t\t\t\t\t\t\t<option value=\"mobilenet_v1\">SSD Mobilenet v1</option>\n\t\t\t\t\t\t\t<option value=\"mobilenet_v2\">SSD Mobilenet v2</option>\n\t\t\t\t\t\t</select>{' '}\n\t\t\t\t\t\t<Button size='sm' variant='outline-success' onClick={handleEnableModel}>Enable</Button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t</div>\n\t\t\t</Modal.Body>\n\t\t\t<Modal.Footer>\n\t\t\t<Button variant=\"success\" onClick={handleUploadClose}>Upload</Button>\n\t\t\t</Modal.Footer>\n\t\t</Modal>\n\t\t<Navbar sticky=\"top\" bg=\"dark\" variant=\"dark\" className=\"bg-5\">\n\t\t\t\t<Navbar.Brand href=\"#home\">AVAT</Navbar.Brand>\n\t\t\t\t<Nav className=\"mr-auto\">\n\t\t\t\t\t\t<NavDropdown disabled={props.disable_buttons} title=\"Export\" id=\"basic-nav-dropdown\">\n\t\t\t\t\t\t\t<NavDropdown.Item onClick={handleDownloadJSON}>JSON</NavDropdown.Item>\n\t\t\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\t\t</NavDropdown>\n\t\t\t\t\t\t<NavLink onClick={handleShow}>Instructions</NavLink>\n\t\t\t\t\t\t<NavLink onClick={props.handle_link_open}>Report</NavLink>\n\t\t\t\t</Nav>\n\t\t\t\t<div>\n\t\t\t\t\t{\n\t\t\t\t\t\tmodel.length > 0 &&\n\t\t\t\t\t\t<Button id=\"run\" variant=\"outline-info\" onClick={(event) => {run_model_segment(props.fabricCanvas, props.annotation_data, props.currentFrame, props.save_data, props.handle_visual_toggle); props.handle_visual_toggle();}}>Run model</Button>\n\t\t\t\t\t}\n\t\t\t\t\t<Button variant=\"outline-success\" onClick={handleUploadShow}>Upload</Button>{' '}\n\t\t\t\t\t{\n\t\t\t\t\t\t//props.fabricCanvas != undefined &&props.fabricCanvas.getActiveObject !== undefined && props.fabricCanvas.getActiveObject()._objects[0].type == \"polygon\" && <Button variant=\"outline-success\" onClick={edit_click}>Edit Seg</Button>\n\t\t\t\t\t\t<Button variant=\"outline-success\" onClick={edit_click}>Edit Seg</Button>\n\t\t\t\t\t}\n\t\t\t\t\t{' '}\n\t\t\t\t\t<Dropdown as={ButtonGroup}>\n\t\t\t\t\t\t<Button variant=\"secondary\" disabled={true}>{props.display_frame_num}</Button>{' '}\n\t\t\t\t\t\t<Dropdown.Toggle split variant=\"secondary\" id=\"dropdown-split-basic\" />\n\t\t\t\t\t\t<Dropdown.Menu>\n\t\t\t\t\t\t\tSkip Value: <input type='number' defaultValue=\"1\" onChange={(event) => {props.change_skip_value(parseInt(event.target.value))}}></input>\n\t\t\t\t\t\t\tPlayback Rate: <input type='number' defaultValue=\"1\" onChange={(event) => {props.handleSetPlaybackRate(parseInt(event.target.value))}}></input>\n\t\t\t\t\t\t</Dropdown.Menu>\n\t\t\t\t\t</Dropdown>{' '}\n\t\t\t\t\t\n\t\t\t\t\t<Button variant=\"primary\" disabled={props.disable_buttons} onClick={props.skip_frame_backward}>Prev</Button>{' '}\n\t\t\t\t\t<Button variant=\"primary\" disabled={props.disable_buttons} onClick={props.handlePlaying}>{props.play_button_text}</Button>{' '}\n\t\t\t\t\t<Button variant=\"primary\" disabled={props.disable_buttons} onClick={props.skip_frame_forward}>Next</Button>{' '}\n\t\t\t\t\t<Dropdown as={ButtonGroup} drop='left'>\n\t\t\t\t\t\t<Button variant=\"success\" onClick={props.addToCanvas}>Add</Button>\n\t\t\t\t\t\t<Dropdown.Toggle split variant=\"success\" id=\"dropdown-split-basic\" />\n\t\t\t\t\t\t<Dropdown.Menu>\n\t\t\t\t\t\t\t<Dropdown.Item onClick={(event) =>{props.change_annotation_type(\"1\")}}>Behavior Annotation</Dropdown.Item>\n\t\t\t\t\t\t\t<Dropdown.Item onClick={(event) =>{props.change_annotation_type(\"2\")}}>BoundingBox</Dropdown.Item>\n\t\t\t\t\t\t\t<Dropdown.Item onClick={(event) =>{props.change_annotation_type(\"3\")}}>Segmentation</Dropdown.Item>\n\t\t\t\t\t\t</Dropdown.Menu>\n\t\t\t\t\t</Dropdown>\n\t\t\t\t\t{/*<Button variant=\"danger\" onClick={remove} disabled={disable_buttons} style={{position:\"relative\"}}>Remove</Button>{' '}*/}\n\t\t\t\t</div>\n\t\t</Navbar>\n\t\t</div>\n\t)\n}","import React from 'react';\nimport ReactDOM from 'react-dom'\n\nexport default class FabricRender extends React.Component{\n    componentDidMount() {\n        var el = ReactDOM.findDOMNode(this);\n  \n      //alert(\"Loaded player: \\nHorizontal Resolution = \" + scaling_factor_width + \"\\nVertical Resolution = \" + scaling_factor_height)\n      // Here we have the canvas so we can initialize fabric\n      this.props.fabricCanvas.initialize(el, {\n          height: this.props.scaling_factor_height,\n        width: this.props.scaling_factor_width,\n        backgroundColor : null,\n      });\n      \n      // on mouse up lets save some state\n      this.props.fabricCanvas.on('mouse:up', () => {\n        this.props.save_data(this.props.currentFrame)\n      });\n  \n      this.props.fabricCanvas.on('object:added', this.props.save_data(this.props.currentFrame));\n      this.props.fabricCanvas.on('object:removed', this.props.save_data(this.props.currentFrame));\n      this.props.fabricCanvas.on('object:modified', this.props.save_data(this.props.currentFrame));\n      \n      // an event we will fire when we want to save state\n      this.props.fabricCanvas.on('saveData', () => {\n        this.props.fabricCanvas.renderAll(); // programatic changes we make will not trigger a render in fabric\n      });\n    }\n\n    render() {\n      return <canvas id=\"canvas\"></canvas>\n    }\n}","const confidence = [{\n    value: 'No occlusion',\n    label: 'No occlusion'\n  },{\n    value: 'Minor occlusion',\n    label: 'Minor occlusion'\n  },{\n    value: 'Split occlusion',\n    label: 'Split occlusion'\n  },{\n    value: 'End occlusion',\n    label: 'End occlusion'\n  },{\n    value: 'Critical occlusion',\n    label: 'Critical occlusion'\n  }\n]\nexport {confidence};\n\nconst behaviors = [{\n    value: 'Feeding',\n    label: 'Feeding'\n  },{\n    value: 'Drinking',\n    label: 'Drinking'\n  },{\n    value: 'Exploratory',\n    label: 'Exploratory'\n  },{\n    value: 'Social',\n    label: 'Social'\n  },{\n    value: 'Locomotion',\n    label: 'Locomotion'\n  },{\n    value: 'Proximity',\n    label: 'Proximity'\n  },{\n    value: 'Others',\n    label: 'Others'\n  }\n]\nexport {behaviors};\n  \nconst posture = [{\n    value: 'Lying',\n    label: 'Lying'\n  },{\n    value: 'Sitting',\n    label: 'Sitting'\n  },{\n    value: 'Kneeling',\n    label: 'Kneeling'\n  },{\n    value: 'Standing',\n    label: 'Standing'\n  }\n]\n  \nexport {posture}","import React from 'react'\n\nimport { useTable, usePagination } from 'react-table'\nimport {confidence, behaviors, posture} from '../../static_data/combined_dat'\n\nexport default function AnnotTable({columns, data}){\n    console.log(columns)\n\n    const {\n        getTableProps,\n        getTableBodyProps,\n        headerGroups,\n        rows,\n        prepareRow,\n      } = useTable({\n        columns,\n        data,\n      })\n      if(!columns){\n        return (\n            <div>\n                {\"No column upload detected.\"}\n            </div>\n        )\n    }\n    return(\n        <table {...getTableProps()} style={{ border: 'solid 1px blue' }}>\n            <thead>\n                {headerGroups.map(headerGroup => (\n                <tr {...headerGroup.getHeaderGroupProps()}>\n                    {headerGroup.headers.map(column => (\n                    <th {...column.getHeaderProps()} \n                    style={{\n                      background: '#657',\n                      color: 'white',\n                      fontWeight: 'bold'\n                    }}>{column.render('Header')}</th>\n                    ))}\n                </tr>\n                ))}\n            </thead>\n            <tbody {...getTableBodyProps()}>\n                {rows.map((row, i) => {\n                    prepareRow(row)\n                    const {id, global_id, posture, behavior, confidence} = row\n                    var selection = genSelection(row.original)\n                    console.log(selection)\n                    return(selection)\n                })}\n            </tbody>\n        </table>\n    )\n}\n\nfunction genSelection(elem){\n    let behaviors_temp = (\n        <select defaultValue={elem.behavior}>\n            <option value=\"\"></option>\n            {\n                behaviors.map((beh, i) => {\n                    return(\n                        <option value={beh.value}>{beh.value}</option>\n                    )\n                })\n            }\n        </select>\n    )\n\n    let confidence_temp = (\n        <select defaultValue={elem.confidence}>\n            <option value=\"\"></option>\n            {\n                confidence.map((beh, i) => {\n                    return(\n                        <option value={beh.value}>{beh.value}</option>\n                    )\n                })\n            }\n        </select>\n    )\n\n    let posture_temp = (\n        <select defaultValue={elem.posture}>\n            <option value=\"\"></option>\n            {\n                posture.map((beh, i) => {\n                    return(\n                        <option value={beh.value}>{beh.value}</option>\n                    )\n                })\n            }\n        </select>\n    )\n\n    let coombined = (\n        <tr key={elem.id}>\n            <td>{elem.id}</td>\n            <td>{elem.global_id}</td>\n            <td>{posture_temp}</td>\n            <td>{behaviors_temp}</td>\n            <td>{confidence_temp}</td>\n        </tr>\n    )\n    return coombined\n}","import React from \"react\"; \nimport 'bootstrap/dist/css/bootstrap.min.css';\n\nimport BootstrapTable from 'react-bootstrap-table-next';\nimport cellEditFactory, { Type } from 'react-bootstrap-table2-editor';\nimport 'react-bootstrap-table-next/dist/react-bootstrap-table2.min.css';\nimport paginationFactory from 'react-bootstrap-table2-paginator';\n\nimport Tabs from 'react-bootstrap/Tabs'\nimport Tab from 'react-bootstrap/Tab'\nimport Button from 'react-bootstrap/Button'\nimport { FormControl } from \"react-bootstrap\";\n\nimport AnnotTable from './annot_table'\n\nimport store from '../../store'\n\nconst anno_col = (handler) => [\n    {\n        dataField: \"frame_num\",\n        text: \"Frame\",\n        headerStyle: () => { return { width: \"40px\", left: 0 }; }\n    },{\n        dataField: \"anno_count\",\n        text: \"Count\",\n        headerStyle: () => { return { width: \"40px\", left: 0 }; }\n    },{\n        dataField: \"local_ids\",\n        text: \"Local ID\",\n        headerStyle: () => { return { width: \"40px\", left: 0 }; }\n    },{\n        dataField: \"global_ids\",\n        text: \"Global ID\",\n        headerStyle: () => { return { width: \"40px\", left: 0 }; }\n    },{\n        dataField: \"swap\",\n        text: \"Swap\",\n        editable: false,\n        headerStyle: () => { return { width: \"50px\", left: 0}; },\n        formatter: (cellContent, row) => {\n          return (\n            <Button\n                className=\"btn btn-confirm btn-xs\"\n                label=\"Del\"\n                onClick={() => {handler(row.frame_num)}}\n            >\n                Skip\n            </Button>\n          );\n        },\n      }\n]\n\n\nfunction getAnnotationTableCount() {\n    var annotation_data = store.getState().annotation_data.data\n    var data = []\n    if (!annotation_data){\n        return data\n    }\n    for(var i = 0; i < annotation_data.length; i++){\n        if(annotation_data[i].length !== 0){\n            var txt_id = \"\"\n            var txt_global = \"\"\n            for(var j = 0; j < annotation_data[i].length; j++){\n                txt_id += (annotation_data[i][j]['id']) + ', '\n                txt_global += (annotation_data[i][j]['global_id']) + ', '\n            }\n            data.push({frame_num: i, anno_count: annotation_data[i].length, local_ids: txt_id, global_ids: txt_global})\n        }\n    }\n    return data\n}\n\n\nexport default function AnnotationTable(props){\n    const expandRow = {\n        onlyOneExpanding: true,\n        renderer: (row, rowIndex) => (\n          <div>\n            <FormControl \n                as=\"textarea\" aria-label=\"With textarea\" \n                defaultValue={props.annotation_data[rowIndex]['notes']} \n                onChange={(event)=> {handleOnChange(event, rowIndex)}}\n                onClick={(event) => {props.toggleKeyCheck(false)}} \n                onBlur={(event) => {props.toggleKeyCheck(true)}}\n            />\n          </div>\n        ),\n        showExpandColumn: true,\n        expandByColumnOnly: true\n    };\n\n    const handleOnChange = (event, rowIndex) => {\n        console.log(props.annotation_data);\n        props.annotation_data[rowIndex]['notes'] = (event.target.value);\n        console.log(props.annotation_data) \n    }\n\n    var data = getAnnotationTableCount()\n    console.log(props.annotation_data)\n    var annotation_data = JSON.parse(JSON.stringify(props.annotation_data))\n    var columns = []\n    var col = []\n    if(store.getState().column_annot.data != undefined){\n      col = store.getState().column_annot.data['columns']\n      columns.push(col)//hookBypass(col)\n      console.log(columns)\n    }\n\n    console.log(store.getState().column_annot)\n    console.log(col)\n    console.log(columns)\n    \n  console.log(columns)\n\n    //TODO Add in force option for user to upload some sort of config file to continue along to next steps.\n    return (\n        <Tabs defaultActiveKey=\"home\" id=\"uncontrolled-tab-example\">\n            {\n              col.length != 0 &&\n              <Tab eventKey=\"home\" title=\"Current\">\n                <AnnotTable columns={columns} data={annotation_data} />\n              </Tab>\n            }\n            <Tab eventKey=\"profile\" title=\"Previous\">\n                <BootstrapTable\n                    keyField='frame_num'\n                    data={data} \n                    columns={anno_col((props.handleSetCurrentFrame))}\n                    table\n                    noDataIndication={ () => <div>No recorded annotations or behaviors for this video.</div> }\n                    pagination={ paginationFactory() }\n                />\n            </Tab>\n        </Tabs>\n    )\n}","//Core imports\nimport React, { useEffect, useState } from \"react\"; \nimport ReactPlayer from 'react-player'\nimport 'bootstrap/dist/css/bootstrap.min.css';\n//import fileMetadata from '../../processing/extract_framerate'\n\n//UI Element imports\nimport Toast from 'react-bootstrap/Toast'\n\n//Processing\nimport ExtractingAnnotation from '../../processing/annotation-processing'\n\n//Annotations\nimport { BoundingBox } from '../../annotations/bounding_box'\nimport { Segmentation } from '../../annotations/segmentation'\n\n//Column information + data structure\nimport {columns} from '../../static_data/columns'\nimport {ANNOTATION_FRAME, ANNOTATION_BBOX, ANNOTATION_KEYPOINT, ANNOTATION_SEG} from '../../static_data/constants'\n\n//Components\nimport CustomNavBar from \"../Components/nav_bar\";\nimport FabricRender from \"../Components/fabric_canvas\";\nimport AnnotationTable from \"../Components/change_table\";\n\n//\nimport store from '../../store' \nimport {initFrameData, updateFrameData, getFrameData, initAnnotationData, updateAnnotationData, getAnnotationData} from '../../processing/actions'\n\nconst fabric = require(\"fabric\").fabric;\n\n//TODO ADD DYNAMIC SOLUTION \nvar frame_rate = 15;\nvar num_frames = -1;\nvar scaling_factor_width = 1920;\nvar scaling_factor_height = 1080;\nvar skip_value = 1;\n\n//var current_screen_width = window.screen.width;\nvar current_screen_height = window.screen.height;\n\n//Mappings are based off of https://en.wikipedia.org/wiki/List_of_common_resolutions make sure to use 1:1 and 16:9 aspect ratio\n/*if (current_screen_height >= 1440){\n  scaling_factor_width = 1920;\n  scaling_factor_height = 1080;\n}else */if(current_screen_height >= 1080){\n  scaling_factor_width = 1280;\n  scaling_factor_height = 720;\n}else if(current_screen_height >= 1024){\n  scaling_factor_width = 1152;\n  scaling_factor_height = 648;\n}else if(current_screen_height >= 768){\n  scaling_factor_width = 1024;\n  scaling_factor_height = 576;\n}\n\n// globally accessable fabricCanvas instance\nvar fabricCanvas = new fabric.Canvas('c', {\n\tuniScaleTransform: true,\n\tuniformScaling: false,\n\tincludeDefaultValues: false\n});\n\nfabricCanvas.on('mouse:over', function(e) {\n\tif(e.target == null | segmentation_flag == true){\n\t\treturn;\n\t}else if(e.target['_objects'] == undefined){\n\t\treturn;\n\t}\t\n    temp_color = e.target['_objects'][0].get('fill')\n\te.target['_objects'][0].set('fill', \"#39FF14\");\n    fabricCanvas.renderAll();\n});\n\nfabricCanvas.on('mouse:out', function(e) {\n\tif(e.target == null | segmentation_flag == true){\n\t\treturn;\n\t}else if(e.target['_objects'] == undefined){\n\t\treturn;\n\t}\n\te.target['_objects'][0].set('fill', temp_color);\n    fabricCanvas.renderAll();\n});\n\nfabric.Image.prototype.toObject = (function(toObject) {\n\treturn function() {\n\t  return fabric.util.object.extend(toObject.call(this), {\n\t\tsrc: this.toDataURL()\n\t  });\n\t};\n  })(fabric.Image.prototype.toObject);\n\nfabricCanvas.on('mouse:wheel', function(opt) {\n\tvar delta = opt.e.deltaY;\n\tvar zoom = fabricCanvas.getZoom();\n\t\n\tzoom *= 0.999 ** delta;\n\tif (zoom > 20) zoom = 20;\n\tif (zoom < 0.01) zoom = 0.01;\n\tfabricCanvas.zoomToPoint({ x: opt.e.offsetX, y: opt.e.offsetY }, zoom);\n\topt.e.preventDefault();\n\topt.e.stopPropagation();\n  });\n\nfabricCanvas.on('mouse:down', function(opt) {\n\tvar evt = opt.e;\n\tif (evt.altKey === true) {\n\t  this.isDragging = true;\n\t  this.selection = false;\n\t  this.lastPosX = evt.clientX;\n\t  this.lastPosY = evt.clientY;\n\t}\n  });\nfabricCanvas.on('mouse:move', function(opt) {\n\tif (this.isDragging) {\n\t  var e = opt.e;\n\t  var vpt = this.viewportTransform;\n\t  vpt[4] += e.clientX - this.lastPosX;\n\t  vpt[5] += e.clientY - this.lastPosY;\n\t  this.requestRenderAll();\n\t  this.lastPosX = e.clientX;\n\t  this.lastPosY = e.clientY;\n\t}\n  });\nfabricCanvas.on('mouse:up', function(opt) {\n\t// on mouse up we want to recalculate new interaction\n\t// for all objects, so we call setViewportTransform\n\tthis.setViewportTransform(this.viewportTransform);\n\tthis.isDragging = false;\n\tthis.selection = true;\n  });\n\t  \n\nvar temp_color;\nvar video_width = 0;\nvar video_height = 0;\nvar upload = false;\nvar disable_buttons = true;\nvar toast_text = \"\"\nvar ANNOTATOR_NAME = \"\"\nvar ANNOTATION_VIDEO_NAME = \"\"\nvar VIDEO_METADATA = {}\nvar play_button_text = \"ERROR\"\nvar temp_flag = false\nvar time_unix = 0;\nvar segmentation_flag = false;\nvar on_ready_flag = false;\nvar image_frames = []\nvar total_frames\nvar player_opacity = 0\nvar currentFrame = 0\n\n//TODO remove after fixing null exceptions\ninitAnnotationData(1)\ninitFrameData(1)\n\n//Current frame counter\nexport default function MainUpload() {\n\tconst [visualToggle, setVisualToggle] = useState(0);\n\tconst [annotationType, setAnnotationType] = useState(\"1\")\n\tconst [boxCount, setBoxCount] = useState(0)\n\tconst [videoFilePath, setVideoFileURL] = useState(null);\n\tconst [oldAnnotation, setOldAnnotation] = useState(null)\n\tconst [player, setPlayer] = useState(null)\n\tconst [duration, setDuration] = useState(0);\n\tconst [save, changeSave] = useState(false);\n\tconst [playing, setPlaying] = useState(false);\n\tconst [keyCheck, changeKeyCheck] = useState(true)\n\tconst [playbackRate, setPlaybackRate] = useState(1)\n\tconst [inputType, setInputType] = useState(0)\n\tconst [tableFrameNum, setTableFrameNum] = useState(0) //This var is to cause a slight delay to keep the table refresh happen at the same time of the frame change to not disrubt user **\n\tconst [previousFrameNumber, setPreviousFrameNumber] = useState(0) \n\n\t//New state vars\n\tconst [currFrameData, setCurrFrameData] = useState([])\n\tconst [currAnnotationData, setCurrAnnotationData] = useState([])\n\n\tif(!segmentation_flag){\n\t\tfabricCanvas.forEachObject(object => { object.selectable = true; object.evented = true;});\n\t}\n\n\tif(inputType == 1){\n\t\ttotal_frames = image_frames.length\n\t}\n\n\tconsole.log(fabricCanvas.getObjects())\n\n\tconst save_data = (frame_num) => {\n\t\t//return; //TODO Clear up\n\t\tif(fabricCanvas.getObjects().length != 0){\n\t\t\tupdateFrameData(frame_num, fabricCanvas.getObjects())\n\t\t}else{\n\t\t\tupdateFrameData(frame_num, [])\n\t\t}\n\t\tupdateAnnotationData(frame_num, currAnnotationData)\n\t}\n\n\tconst handleInputType = (val) => {\n\t\tif(val == 0 | val ==1){\n\t\t\tsetInputType(val)\n\t\t\t//alert(\"Input set to \" + val)\n\t\t}else{\n\t\t\talert(\"ERROR VALUE SET - Please report this bug!\\n\")\n\t\t}\n\t}\n\n\tconst handleSetCurrentFrame = (val) => {\n\t\tif(inputType == 1){\n\t\t\tcurrentFrame = val\n\t\t\tcanvasBackgroundUpdate()\n\t\t\ttotal_frames = image_frames.length\n\t\t\treturn;\n\t\t}\n\n\t\ttotal_frames = duration * frame_rate\n\t\thandle_visual_toggle()\n\t\tif(typeof(val) === \"number\"){\n\n\t\t\tcurrentFrame =(val)\n\t\t\tsetVisualToggle(Math.floor(Math.random() * 999999999999))\n\t\t\tvar new_skip = val/(total_frames)\n\t\t\tif(new_skip > duration){\n\t\t\t\tnew_skip = duration\n\t\t\t}\n\t\t\tplayer.seekTo(new_skip)\n\t\t}else{\n\t\t\tsave_data(currentFrame)\n\t\t\tvar frame_calc = (val['played']/total_frames)\n\t\t\tframe_calc = (Math.floor(val['played']*total_frames))\n\t\t\tif((play_button_text === \"Play\" && temp_flag === true) | play_button_text === \"Pause\"){\n\t\t\t\tif(frame_calc >= total_frames){\n\t\t\t\t\tcurrentFrame =(total_frames-1)\n\t\t\t\t\tsetVisualToggle(Math.floor(Math.random() * 999999999999))\n\t\t\t\t\ttemp_flag = false;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tcurrentFrame =(frame_calc)\n\t\t\t\tsetVisualToggle(Math.floor(Math.random() * 999999999999))\n\t\t\t\ttemp_flag = false;\n\t\t\t}\n\t\t\tif(play_button_text === \"Pause\"){\n\t\t\t}\n\t\t\tsetVisualToggle(Math.floor(Math.random() * 999999999999))\n\t\t}\n\t}\n\n\tconst removeRow = (index) => {\n\t\tconsole.log(index)\n\t\tvar index_num = 1;\n\t\tfor(var i = 0; i < currAnnotationData.length; i++){\n\t\t\tif(currAnnotationData[i]['id'] == index){\n\t\t\t\tindex_num = i\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (index_num === -1){\n\t\t\talert(\"bug: \" + index)\n\t\t}\n\t\tif(index.substring(index.length-1, index.length) !== \"f\"){ //Disabled removal of key-point for now\n\t\t\tvar current_objects = fabricCanvas.getObjects()\n\t\t\tconsole.log(current_objects)\n\t\t\tfor(var i = 0; i < current_objects.length; i++){\n\t\t\t\tconsole.log(current_objects[i])\n\t\t\t\tif(current_objects[i]['_objects'][1]['text'] === index){\n\t\t\t\t\tconsole.log(\"REMOVED\")\n\t\t\t\t\tfabricCanvas.remove(current_objects[i]);\n\t\t\t\t\tfabricCanvas.fire('saveData');\n\t\t\t\t\tfabricCanvas.renderAll();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconsole.log(\"CURRENT FRAME: \" + currentFrame)\n\t\tvar temp_array = [...currAnnotationData]; temp_array.splice(index_num, 1);\n\t\tsetCurrAnnotationData(temp_array);\n\t\t//var temp_frame = [...currFrameData]; temp_frame.splice(index_num, 1);\n\t\tsetCurrFrameData(fabricCanvas.getObjects())\n\t\tsave_data(currentFrame)\n\t}\n\n\tconst remove_table_index = (index) => {\n\t\tif (index === undefined) {\n\t\t\tvar indiciesToDelete = []\n\t\t\tfor(var i = 0; i < currAnnotationData.length; i++){\n\t\t\t\tindiciesToDelete.push(currAnnotationData[i]['id'])\n\t\t\t}\n\t\t\tindiciesToDelete.map(x => removeRow(x))\n\t\t}else{\n\t\t\tremoveRow(index)\n\t\t}\n\t\tconsole.log(currAnnotationData)\n\t\tsetVisualToggle(Math.floor(Math.random() * 999999999999))\n\t}\n\t\n\t\n\n\tconst save_previous_data = () => {\n\t\tif(currAnnotationData.length == 0){\n\t\t\treturn;\n\t\t}\n\t\tsetPreviousFrameNumber(currentFrame)\n\t}\n\n\tconst addToCanvas = () => {\n\t\tvar color = \"#\" + ((1<<24)*Math.random() | 0).toString(16)\n\t\t\n\t\tif(currAnnotationData == null){\n\t\t\tsetCurrAnnotationData([])\n\t\t}\n\t\tif (segmentation_flag == true){\n\t\t\talert(\"Please finish your current segmentation!\")\n\t\t\treturn\n\t\t}\n\t\t\n\t\tvar annotation_type_txt = \"error\"\n\n\t\tif (annotationType === ANNOTATION_BBOX){\n\t\t\tannotation_type_txt = \"b\"\n\t\t\tvar new_bbox = new BoundingBox(fabricCanvas.height/2, fabricCanvas.width/2, 50, 50, color, boxCount+'b', \"None\").generate_no_behavior(fabricCanvas)\n\t\t\t//fabricCanvas.add(new_bbox)\n\t\t}else if (annotationType === ANNOTATION_KEYPOINT){\n\t\t\t//TODO fix KeyPoint\n\t\t\talert(\"KeyPoint annotation are currently unavailable\")\n\t\t\tannotation_type_txt = \"k\"\n\t\t\t//var keyp = new KeyPoint().generate_stick(fabricCanvas)\n\t\t}else if (annotationType === ANNOTATION_SEG){\n\t\t\t//TODO Fix segmentation issues\n\t\t\tannotation_type_txt = \"s\"\t  \n\n\t\t\tvar segment = new Segmentation().generate_polygon(fabricCanvas, boxCount+'s', toggle_segmentation)\n\t\t\ttoggle_segmentation()\n\n\t\t}else if(annotationType === ANNOTATION_FRAME){\n\t\t\t//TODO Add annotation frame datapoint\n\t\t\tannotation_type_txt = \"f\"\n\t\t}\n\n\t\tif(inputType === 1){\n\t\t\tsetCurrAnnotationData(oldArray => [...oldArray, {id: boxCount+annotation_type_txt, global_id: \"\",status: \"\", current: \"\", behavior: \"\", posture: \"\", notes: \"\", confidence:\"\", dataType: \"image\", fileName: image_frames[currentFrame]['name']}])\n\t\t\t//setCurrAnnotationData(oldArray => [...oldArray, {id: boxCount+annotation_type_txt, global_id: \"test\",status: \"test\", current: \"test\", behavior: \"test\", posture: \"test\", confidence:\"test\", dataType: \"image\", fileName: image_frames[currentFrame]['name']}])\n\t\t\t//annotation_data[currentFrame].push({id: boxCount+annotation_type_txt, global_id: \"\",status: \"\", current: \"\", behavior: \"\", posture: \"\", notes: \"\", confidence:\"\", dataType: \"image\", fileName: image_frames[currentFrame]['name']})\n\t\t}else{\n\t\t\tsetCurrAnnotationData(oldArray => [...oldArray, {id: boxCount+annotation_type_txt, global_id: \"\",status: \"\", current: \"\", behavior: \"\", posture: \"\",  confidence:\"\", dataType: \"video\", fileName: \"frame_\"+currentFrame}])\n\t\t\t//annotation_data[currentFrame].push({id: boxCount+annotation_type_txt, global_id: \"\",status: \"\", current: \"\", behavior: \"\", posture: \"\", notes: \"\",  confidence:\"\", dataType: \"video\", fileName: \"frame_\"+currentFrame})\n\t\t}\n\t    //annotation_data[currentFrame].push({id: boxCount+annotation_type_txt, global_id: -1,status: \"\", current: \"\", behavior: \"\", posture: \"\", notes: \"\", confidence: \"\"})\n\t\tsetBoxCount(boxCount + 1);\n\t\tfabricCanvas.fire('saveData');\n\t}\n\n\tconst toggle_segmentation = (event) => {\n\t\tsegmentation_flag = !segmentation_flag\n\t}\n\n\tconst handleVideoUpload = (event) => {\n\t\tif(inputType === 1){\n\t\t\timage_frames = event.target.files\n\t\t\tinitAnnotationData(image_frames.length)\n\t\t\tinitFrameData(image_frames.length)\n\t\t\tdisable_buttons = false;\n\t\t}\n\t\t\n\t\tif(typeof(event) === \"string\"){//Youtube upload\n\t\t\tsetVideoFileURL(event)\n\t\t\tANNOTATION_VIDEO_NAME = event\n\t\t\tupload = true;\n\t\t\treturn;\n\t\t}\n\t\tif(inputType !== 1){\n\t\t\t//fileMetadata(event.target.files[0])\n\t\t}\n\t\tANNOTATION_VIDEO_NAME = event.target.files[0]['name']\n\t\tsetVideoFileURL(URL.createObjectURL(event.target.files[0]));\n\t\tupload = true;\n\t};\n\n\t//ASYNC Function  - To note that the data that comes out of this will be a bit delayed and this could cause some issues.\n\tconst handleOldAnnotation = (event) => {\n\t\tvar promise = downloadOldAnnotation(event)\n\t\tpromise.then(function (result) {\n\t\t\tif(result != null){\n\t\t\t\tsetOldAnnotation(new ExtractingAnnotation(result, fabricCanvas));\n\t\t\t}else{\n\t\t\t\talert(\"Error in processing Annotation\")\n\t\t\t}\n\t\t})\n\t}\n\n\tuseEffect(() => {\n\t\t//TODO Find a more elegant solution. This is a temporay patch work.\n\t\tif(oldAnnotation == null){\n\t\t\treturn;\n\t\t}\n\t\tstore.dispatch({\n\t\t\ttype: \"frame_data/initOldAnnotation\",\n\t\t\tpayload: oldAnnotation.get_frame_data()\n\t\t});\n\t\tstore.dispatch({\n\t\t\ttype: \"annotation_data/initOldAnnotation\",\n\t\t\tpayload: oldAnnotation.get_annotation_data()\n\t\t});\n\n\t\tsetCurrFrameData(oldAnnotation.get_frame_data()[0])\n\t\tsetCurrAnnotationData(oldAnnotation.get_annotation_data()[0])\n\t\tsetBoxCount(oldAnnotation.find_highest_localid())\n\t}, [oldAnnotation]);\n\t\t\n\n\tuseEffect(() =>{\n\t\tif(currFrameData.length != 0){\n\t\t\tcanvasBackgroundUpdate()\n\t\t}\n\t\tupdateFrameData(currentFrame, currFrameData)\n\t\tupdateAnnotationData(currentFrame, currAnnotationData)\n\t\t\n\t}, [currFrameData, currAnnotationData])\n\n\tconst downloadOldAnnotation = (file) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\tvar reader = new FileReader();\n\t\treader.onload = function(e) {\n\t\t\tresolve((JSON.parse(e.target.result)));\n\t\t}\n\t\treader.readAsText(file.target.files[0])\n\t\t})\n\t}\n  \n\n\tconst handlePlaying = (event) => {\n\t\tif(play_button_text === \"Pause\"){\n\t\t\ttemp_flag = true;\n\t\t}\n\t\tsetPlaying(!playing)\n\t\tsave_previous_data()\n\t}\n\n\n\tif(playing === true){\n\t\tplay_button_text = \"Pause\"\n\t\tplayer_opacity = 100\n\t}else{\n\t\tplay_button_text = \"Play\"\n\t\tplayer_opacity = 0\n\t}\n\n\tconst handleSetPlayer = val => {\n\t\tif(val != null){\n\t\tif(val['player'] != null){\n\t\t\tif(val['player']['player'] != null){\n\t\t\t\t\tif(val['player']['player'] != null){\n\t\t\t\t\t\tvideo_width = val['player']['player']['player'].videoWidth\n\t\t\t\t\t\tvideo_height = val['player']['player']['player'].videoHeight\n\t\t\t\t\t\tvar duration = val['player']['player']['player'].duration\n\t\t\t\t\t\tVIDEO_METADATA = {name: ANNOTATION_VIDEO_NAME, duration: duration, horizontal_res: video_width, vertical_res: video_height, frame_rate: frame_rate, time: time_unix}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tsetPlayer(val)\n\t}\n\n\tconst handleSetDuration = val => {\n\t\tif(upload === true && player != null){      \n\t\t\tnum_frames = Math.round(val * frame_rate);\n\n\t\t\tif(currAnnotationData.length == 0){\n\t\t\t\tconsole.log(\"Resetting frame_data and annotation_data\")\n\t\t\t\tinitFrameData(num_frames)\n\t\t\t\tinitAnnotationData(num_frames)\n\t\t\t}\n\n\t\t\t//upload = false;\n\t\t\tdisable_buttons = false\n\t\t}\n\t\ttotal_frames = parseInt(val) * frame_rate\n\t\tsetDuration(parseInt(val))\n\t}\n\n\tconst [scrubbing, setScrubbing] = useState(true);\n\n\n\tconst skip_frame_forward = e =>{\n\t\tsave_previous_data()\n\t\tsave_data(currentFrame)\n\t\tvar frameVal = currentFrame + skip_value\n\n\t\tif(frameVal >= total_frames){\n\t\t\tif(inputType === 1){\n\t\t\t\tcurrentFrame = (total_frames-1)\n\t\t\t\tsetCurrFrameData(getFrameData(total_frames-1))\n\t\t\t\tsetCurrAnnotationData(getAnnotationData(total_frames-1))\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsetCurrFrameData(getFrameData(total_frames-1))\n\t\t\tsetCurrAnnotationData(getAnnotationData(total_frames-1))\n\t\t\thandleSetCurrentFrame(total_frames-1)\n\t\t}else{\n\t\t\tif(inputType === 1){\n\t\t\t\tcurrentFrame =(frameVal)\n\t\t\t\tsetCurrFrameData(getFrameData(frameVal))\n\t\t\t\tsetCurrAnnotationData(getAnnotationData(frameVal))\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsetCurrFrameData(getFrameData(frameVal))\n\t\t\tsetCurrAnnotationData(getAnnotationData(frameVal))\n\t\t\thandleSetCurrentFrame(frameVal)\n\t\t}\n\t}\n\n\tconst skip_frame_backward = e => {\n\t\tsave_previous_data()\n\t\tsave_data(currentFrame)\n\t\tvar frameVal = currentFrame - skip_value\n\t\tif(frameVal < 0){\n\t\t\tif(inputType === 1){\n\t\t\t\tcurrentFrame = 0\n\t\t\t\tsetCurrFrameData(getFrameData(0))\n\t\t\t\tsetCurrAnnotationData(getAnnotationData(0))\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsetCurrFrameData(getFrameData(0))\n\t\t\tsetCurrAnnotationData(getAnnotationData(0))\n\t\t\thandleSetCurrentFrame(0)\n\t\t}else{\n\t\t\tif(inputType === 1){\n\t\t\t\tcurrentFrame =(frameVal)\n\t\t\t\tsetCurrFrameData(getFrameData(frameVal))\n\t\t\t\tsetCurrAnnotationData(getAnnotationData(frameVal))\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsetCurrFrameData(getFrameData(frameVal))\n\t\t\tsetCurrAnnotationData(getAnnotationData(frameVal))\n\t\t\thandleSetCurrentFrame(frameVal)\n\t\t}\n\t}\n\n\tuseEffect(() => {\n\t\tif(inputType === 1){\n\t\t\tcanvasBackgroundUpdate()\n\t\t}else if(duration != 0){\n\t\t\tcanvasBackgroundUpdate()\n\t\t}\n\t}, [currentFrame]);\n\n\tconst change_skip_value = (event) => {\n\t\tskip_value = event\n\t}\n\n\tconst change_annotation_type = (event) => {\n\t\tsetAnnotationType(event)\n\t}\n\n\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\tconst onKeyPress = (event) =>{\n\t\t//Making sure input for textbox doesnt get counted as a mode change\n\t\tif(keyCheck === false){\n\t\t\treturn;\n\t\t}\n\t\tif(segmentation_flag === true){\n\t\t\talert(\"Please finish your current action!\")\n\t\t\treturn;\n\t\t}\n\t\tif (event.key === ANNOTATION_BBOX){\n\t\t\ttoast_text = \"Mode Switch: Bounding Box\"\n\t\t\tchangeSave(true)\n\t\t\tsetAnnotationType(ANNOTATION_BBOX)\n\t\t}else if (event.key === ANNOTATION_KEYPOINT){\n\t\t\ttoast_text = \"Mode Switch: Key Point\"\n\t\t\tchangeSave(true)\n\t\t\tsetAnnotationType(ANNOTATION_KEYPOINT)\n\t\t}else if(event.key === ANNOTATION_SEG) {\n\t\t\ttoast_text = \"Mode Switch: Segmentation\"\n\t\t\tchangeSave(true)\n\t\t\tsetAnnotationType(ANNOTATION_SEG)\n\t\t}else if(event.key === ANNOTATION_FRAME){\n\t\t\ttoast_text = \"Mode Switch: Behavior Annotation\"\n\t\t\tchangeSave(true)\n\t\t\tsetAnnotationType(ANNOTATION_FRAME)\n\t\t}else if (event.key === \"a\"){\n\t\t\tvar annotext = \"\"\n\t\t\tif(annotationType === ANNOTATION_BBOX){\n\t\t\t\tannotext = \"Bounding Box\"\n\t\t\t}else if(annotationType === ANNOTATION_FRAME){\n\t\t\t\tannotext = \"Behavior Data\"\n\t\t\t}else if (annotationType === ANNOTATION_KEYPOINT){\n\t\t\t\tannotext = \"Keypoint\"\n\t\t\t}else if (annotationType === ANNOTATION_SEG){\n\t\t\t\tannotext = \"Segmentation\"\n\t\t\t}\n\t\t\ttoast_text = \"Added Annotation - \" + annotext\n\t\t\tif(annotationType !== ANNOTATION_SEG){\n\t\t\t\tchangeSave(true)\n\t\t\t}\n\t\t\taddToCanvas()\n\t\t}else if (event.key === \"q\"){\n\t\t\tskip_frame_backward()\n\t\t}else if (event.key === \"w\"){\n\t\t\tcanvasBackgroundUpdate()\n\t\t\thandlePlaying()\n\t\t}else if (event.key === \"e\"){\n\t\t\tskip_frame_forward()\n\t\t}else if (event.key === \"f\"){\n\t\t\tif(scrubbing === false){\n\t\t\t\ttoast_text = \"Scrubbing Mode Activated\"\n\t\t\t\tsetScrubbing(true)\n\t\t\t\tchangeSave(true)\n\t\t\t}else{\n\t\t\t\ttoast_text = \"Scrubbing Mode Deactivated\"\n\t\t\t\tsetScrubbing(false)\n\t\t\t\tchangeSave(true)\n\t\t\t}\n\t\t}else if(event.key === \"c\"){\n\t\t\ttoast_text = \"Copying previous frame annotation\"\n\t\t\tsetCurrAnnotationData(JSON.parse(JSON.stringify(getAnnotationData(previousFrameNumber))))\n\n\t\t\tvar previous_frame_data = getFrameData(previousFrameNumber);\n\t\t\tfabric.util.enlivenObjects(previous_frame_data, function(objects) {\t\t\n\t\t\t\tfor(var i = 0; i < objects.length; i++){\n\t\t\t\t\tobjects[i]['local_id'] = previous_frame_data[i]['local_id']\n\t\t\t\t\tfabricCanvas.add(objects[i])\n\t\t\t\t}\n\t\t\t\tsetCurrFrameData(objects)\n\t\t\t}); \n\t\t\t/* for(var i = 0; i < frame_data[previousFrameNumber].length; i++){\n\t\t\t\tfabricCanvas.add(JSON.parse(JSON.stringify(frame_data[previousFrameNumber][i])))\n\t\t\t} */\n\t\t\tchangeSave(true)\n\t\t}\n\t}  \n\n\tuseEffect(() => {\n\t\tdocument.addEventListener(\"keydown\", onKeyPress);\n\t\treturn () => document.removeEventListener(\"keydown\", onKeyPress);\n\t}, [onKeyPress]);\n\t\n\n\n\tconst change_annotator_name = (event) => {\n\t\tANNOTATOR_NAME = event\n\t}\n\n\tconst handle_visual_toggle = () => {\n\t\tsetVisualToggle(Math.floor(Math.random() * 999999999999))\n\t}\n\n\tconst handleSetPlaybackRate = (playbackRate) => {\n\t\tif(isNaN(playbackRate)){\n\t\t\tsetPlaybackRate(0)\n\t\t}else if(playbackRate > 16){\n\t\t\talert(\"Max playback rate is 16!\")\n\t\t\tsetPlaybackRate(16)\n\t\t}\t\n\t\telse{\n\t\t\tsetPlaybackRate(playbackRate)\n\t\t}\n\t}\n\n\tconst toggleKeyCheck = (toggle_val) => {\n\t\tconsole.log(\"Keycheck activated\")\n\t\tif(toggle_val === undefined){\n\t\t\tchangeKeyCheck(!keyCheck)\n\t\t}else{\n\t\t\tchangeKeyCheck(toggle_val)\n\t\t}\n\t}\n\n\tconst setFrameRate = (framerate) => {\n\t\tframe_rate = parseInt(framerate)\n\t\tif (frame_rate > 120){\n\t\t\tframe_rate = 120;\n\t\t}else if(frame_rate <= 0){\n\t\t\tframe_rate = 1;\n\t\t}else if(Number.isFinite(frame_rate) == false){\n\t\t\tframe_rate = 1;\n\t\t\treturn;\n\t\t}\n\n\t\tnum_frames = Math.round(duration * frame_rate);\n\t\tif(currAnnotationData.length == 0){\n\t\t\ttotal_frames = duration * framerate\n\t\t\tconsole.log(\"Resetting frame_data and annotation_data\")\n\t\t\t\n\t\t\tinitFrameData(num_frames)\n\t\t\tinitAnnotationData(num_frames)\n\n\t\t}else{\n\t\t\talert(\"There is data currently annotated! To change frame rate refresh the page and re-upload!\")\n\t\t}\n\t}\n\n\tconst setDateTime = (time) => {\n\t\ttime_unix = time;\n\t\tVIDEO_METADATA = {name: ANNOTATION_VIDEO_NAME, duration: duration, horizontal_res: video_width, vertical_res: video_height, frame_rate: frame_rate, time: time_unix}\n\t}\n \n\tconst canvasBackgroundUpdate = () => {\n\t\tconsole.log(\"updated canvas\")\n\t\tif(inputType == 1){ //This is for when images are uploaded\n\t\t\tvar img = new Image()\n\t\t\timg.onload = function() {\n\t\t\t\tfabricCanvas.clear()\n\t\t\t\tif(currFrameData != undefined){\n\t\t\t\t\tfor(var i = 0; i < currFrameData.length; i++){\n\t\t\t\t\t\tfabricCanvas.add(currFrameData[i])\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tVIDEO_METADATA = {name: ANNOTATION_VIDEO_NAME, duration: duration, horizontal_res: img.width, vertical_res: img.height, frame_rate: frame_rate, time: time_unix}\n\t\t\t\tvar f_img = new fabric.Image(img, {\n\t\t\t\t\tobjectCaching: false,\n\t\t\t\t\tscaleX: scaling_factor_width / img.width,\n\t\t\t\t\tscaleY: scaling_factor_height / img.height\n\t\t\t\t});\n\t\t\t\tconsole.log(\"CURRFRAME: \" + currentFrame)\n\t\t\t\tfabricCanvas.setBackgroundImage(f_img);\n\t\t\t\n\t\t\t\tfabricCanvas.renderAll();\n\t\t\t\t//save_data()\n\t\t\t\tsetTableFrameNum(currentFrame)\n\t\n\t\t\t};\n\t\t\timg.src = URL.createObjectURL(image_frames[currentFrame])\n\t\t\treturn;\n\t\t}else if(inputType == 0){ //This is for when videos are uploaded\n\t\t\t//TODO cleanup variabkle\n\t\t\tvar htmlvideo = document.getElementsByTagName('video')[0]\n\t\t\tlet canvas = document.createElement('canvas');\n\t\t\tlet context = canvas.getContext('2d');\n\t\t\tlet [w, h] = [scaling_factor_width, scaling_factor_height]\n\t\t\tcanvas.width =  scaling_factor_width;\n\t\t\tcanvas.height = scaling_factor_height;\n\t\t\n\t\t\tcontext.drawImage(htmlvideo, 0, 0, w, h);\n\t\t\tlet base64ImageData = canvas.toDataURL();\n\n\t\t\tvar img = new Image()\n\t\t\timg.onload = function() {\n\t\t\t\tfabricCanvas.clear()\n\t\t\t\tif(currFrameData != undefined){\n\t\t\t\t\tfor(var i = 0; i < currFrameData.length; i++){\n\t\t\t\t\t\tfabricCanvas.add(currFrameData[i])\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tvar f_img = new fabric.Image(img, {\n\t\t\t\t\tobjectCaching: false,\n\t\t\t\t\tscaleX: scaling_factor_width / img.width,\n\t\t\t\t\tscaleY: scaling_factor_height / img.height\n\t\t\t\t});\n\t\t\t\n\t\t\t\tfabricCanvas.setBackgroundImage(f_img);\n\t\t\t\n\t\t\t\tfabricCanvas.renderAll();\n\t\t\t\tcanvas.remove()\n\t\t\t\t//save_data()\n\t\t\t\tsetTableFrameNum(currentFrame)\n\n\t\t\t};\n\n\t\t\timg.src = base64ImageData\n\t\t}\n\t}\n\n\tconst handleOnReady = val => {\n\t\t//canvasBackgroundUpdate()\n\t\tif(on_ready_flag == false){\n\t\t\tcanvasBackgroundUpdate()\n\t\t\ton_ready_flag = true\n\t\t}\n\t}\n\n\tconst handleChangeAnnot = val => {\n\t\tsetCurrAnnotationData(val)\n\t}\n\n\treturn (\n\t\t<div>\n\t\t\t<CustomNavBar \n\t\t\t\tdisable_buttons={disable_buttons} \n\t\t\t\tvideo_width={video_width} \n\t\t\t\tvideo_height={video_height} \n\t\t\t\tskip_value={skip_value} \n\t\t\t\tANNOTATOR_NAME={ANNOTATOR_NAME}\n\t\t\t\thandleOldAnnotation={handleOldAnnotation}\n\t\t\t\thandleVideoUpload={handleVideoUpload}\n\t\t\t\tcurrentFrame={currentFrame}\n\t\t\t\tdisplay_frame_num={\"Frame #\" + parseInt(currentFrame+1)+' / '+parseInt(total_frames)}\n\t\t\t\tskip_frame_forward={skip_frame_forward}\n\t\t\t\tskip_frame_backward={skip_frame_backward}\n\t\t\t\thandlePlaying={handlePlaying}\n\t\t\t\tplay_button_text={play_button_text}\n\t\t\t\taddToCanvas={addToCanvas}\n\t\t\t\tANNOTATION_VIDEO_NAME={ANNOTATION_VIDEO_NAME}\n\t\t\t\tchange_skip_value={change_skip_value}\n\t\t\t\tchange_annotator_name={change_annotator_name}\n\t\t\t\tchange_annotation_type={change_annotation_type}\n\t\t\t\tVIDEO_METADATA={VIDEO_METADATA}\n\t\t\t\thandleSetPlaybackRate={handleSetPlaybackRate}\n\t\t\t\ttoggleKeyCheck={toggleKeyCheck}\n\t\t\t\tsetFrameRate={setFrameRate}\n\t\t\t\tframe_rate={frame_rate}\n\t\t\t\tsetDateTime={setDateTime}\n\t\t\t\tfabricCanvas={fabricCanvas}\n\t\t\t\tsave_data={save_data}\n\t\t\t\thandle_visual_toggle={handle_visual_toggle}\n\t\t\t\thandleInputType={handleInputType}\n\t\t\t\timage_frames={image_frames}\n\t\t\t\ttoggle_segmentation={toggle_segmentation}\n\t\t\t/>\n\t\t\t<Toast \n\t\t\t\tonClose={() => changeSave(false)} \n\t\t\t\tshow={save} delay={500} autohide\n\t\t\t\tstyle={{ position: 'absolute', top: '100', left: '100', zIndex: '100'}}\n\t\t\t>\n\t\t\t\t<Toast.Header>\n\t\t\t\t\t<strong className=\"mr-auto\">{toast_text}</strong>\n\t\t\t\t</Toast.Header>\n\t\t\t</Toast>\n\t\t\t{\n\t\t\t\tupload === true && \n\t\t\t\t<div style={{display: \"grid\"}} show={upload}>\n\t\t\t\t\t<div style={{gridColumn: 1, gridRow:1, position: \"relative\", width: scaling_factor_width, height: scaling_factor_height, top: 0, left: 0, opacity: player_opacity}}>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tinputType==0 && \n\t\t\t\t\t\t\t<ReactPlayer \n\t\t\t\t\t\t\t\tonReady={handleOnReady}\n\t\t\t\t\t\t\t\tref={handleSetPlayer} \n\t\t\t\t\t\t\t\tonDuration={handleSetDuration} \n\t\t\t\t\t\t\t\turl={videoFilePath} \n\t\t\t\t\t\t\t\twidth='100%'\n\t\t\t\t\t\t\t\theight='100%'\n\t\t\t\t\t\t\t\tplaying={playing} \n\t\t\t\t\t\t\t\tcontrols={false} \n\t\t\t\t\t\t\t\tstyle={{position:'absolute', float:'left', top:0, left:0}}\n\t\t\t\t\t\t\t\tvolume={0}\n\t\t\t\t\t\t\t\tmuted={true}\n\t\t\t\t\t\t\t\tpip={false}\n\t\t\t\t\t\t\t\tplaybackRate={playbackRate}\n\t\t\t\t\t\t\t\tid=\"myvideo\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style={{gridColumn: 1, gridRow:1, position: \"relative\",  top: 0, left: 0, opacity: 100-player_opacity}}>\n\t\t\t\t\t\t<FabricRender \n\t\t\t\t\t\t\tfabricCanvas={fabricCanvas}\n\t\t\t\t\t\t\tcurrentFrame={currentFrame}\n\t\t\t\t\t\t\tsave_data={save_data}\n\t\t\t\t\t\t\tscaling_factor_height={scaling_factor_height}\n\t\t\t\t\t\t\tscaling_factor_width={scaling_factor_width}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style={{gridColumn: 2, gridRow:1, position: \"relative\",width: scaling_factor_width*.4, height: scaling_factor_height, top: 0, left: 0}}>\n\t\t\t\t\t\t<AnnotationTable\n\t\t\t\t\t\t\tannotation_data={currAnnotationData}\n\t\t\t\t\t\t\tchange_annotation_data={handleChangeAnnot}\n\t\t\t\t\t\t\tcurrentFrame={tableFrameNum}\n\t\t\t\t\t\t\ttoggleKeyCheck={toggleKeyCheck}\n\t\t\t\t\t\t\tcolumns={columns}\n\t\t\t\t\t\t\tremove_table_index={remove_table_index}\n\t\t\t\t\t\t\thandleSetCurrentFrame={handleSetCurrentFrame}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t}\n\t\t</div>\n\t);\n}","export const ANNOTATION_FRAME = \"1\"\nexport const ANNOTATION_BBOX = \"2\"\nexport const ANNOTATION_SEG = \"3\"\nexport const ANNOTATION_KEYPOINT = \"4\"\n","const fabric = require(\"fabric\").fabric;\n\nclass KeyPoint {\n    //TODO Optimize this code. Right now there is a significant performance penalty if there are multiple keypoints on the canvas\n    generate_stick(canvas){\n        fabric.Object.prototype.originX = fabric.Object.prototype.originY = 'center';\n\n        function makeCircle(left, top, line1, line2, line3, line4) {\n            var c = new fabric.Circle({\n            left: left,\n            top: top,\n            strokeWidth: 2.5,\n            radius: 6,\n            fill: '#fff',\n            stroke: '#666'\n            });\n            c.hasControls = c.hasBorders = false;\n\n            c.line1 = line1;\n            c.line2 = line2;\n            c.line3 = line3;\n            c.line4 = line4;\n\n            return c;\n        }\n\n        function makeLine(coords) {\n            return new fabric.Line(coords, {\n            fill: 'red',\n            stroke: 'red',\n            strokeWidth: 5,\n            selectable: true,\n            evented: false,\n            });\n        }\n\n        var line = makeLine([ 250, 200, 250, 175 ]),\n            line2 = makeLine([ 250, 175, 250, 250 ]),\n            line3 = makeLine([ 250, 250, 300, 350]),\n            line4 = makeLine([ 250, 250, 200, 350]),\n            line5 = makeLine([ 250, 175, 175, 225 ]),\n            line6 = makeLine([ 250, 175, 325, 225 ]);\n\n        canvas.add(line, line2, line3, line4, line5, line6);\n\n        canvas.add(\n            makeCircle(line.get('x1'), line.get('y1'), null, line),\n            makeCircle(line.get('x2'), line.get('y2'), line, line2, line5, line6),\n            makeCircle(line2.get('x2'), line2.get('y2'), line2, line3, line4),\n            makeCircle(line3.get('x2'), line3.get('y2'), line3),\n            makeCircle(line4.get('x2'), line4.get('y2'), line4),\n            makeCircle(line5.get('x2'), line5.get('y2'), line5),\n            makeCircle(line6.get('x2'), line6.get('y2'), line6)\n        );\n\n        canvas.on('object:moving', function(e) {\n            var p = e.target;\n            p.line1 && p.line1.set({ 'x2': p.left, 'y2': p.top });\n            p.line2 && p.line2.set({ 'x1': p.left, 'y1': p.top });\n            p.line3 && p.line3.set({ 'x1': p.left, 'y1': p.top });\n            p.line4 && p.line4.set({ 'x1': p.left, 'y1': p.top });\n            canvas.renderAll();\n        });\n    }   \n\n\n    generate_poly(canvas){\n        \n    }\n}\n\nexport {KeyPoint}","import React from 'react';\nimport { useState } from 'react';\nimport \"bootstrap/dist/css/bootstrap.min.css\";\n\nimport Navbar from 'react-bootstrap/Navbar'\nimport Nav from 'react-bootstrap/Nav'\nimport Button from 'react-bootstrap/Button'\nimport { NavDropdown, NavLink } from 'react-bootstrap';\nimport Form from 'react-bootstrap/Form'\nimport Dropdown from 'react-bootstrap/Dropdown'\nimport { ButtonGroup } from 'react-bootstrap';\nimport Modal from 'react-bootstrap/Modal'\n\nimport DatePicker from 'react-datepicker'\nimport \"react-datepicker/dist/react-datepicker.css\";\n\nimport Instructions from './instructions';\nimport { downloadFileJSON , downloadFileCSV} from '../../processing/download';\nimport { Edit } from '../../annotations/segmentation_edit';\n\nimport {run_model, load} from '../../tensorflow/ObjectDetection';\nimport { run_model_segment } from '../../tensorflow/SemanticSegmentation';\n\nimport ExportingAnnotation from '../../processing/exporting_annotation';\nimport ProcessVideo from './process_video';\n\n\n\nexport default function MultiviewCustomNavBar(props){\n\tconst [show, setShow] = useState(false);\n\tconst [uploadShow, setUploadShow] = useState(true);\n\tconst [startDate, setStartDate] = useState(0);\n\tconst [frameRate, setFrameRate] = useState(0)\n\tconst [skipValue, setSkipValue] = useState(0)\n\t//const [playbackRate, setPlaybackRate] = useState(0)\n\tconst [horizontalRes, setHorizontalRes] = useState(0)\n\tconst [verticalRes, setVerticalRes] = useState(0)\n\tconst [videoFormat, setVideoFormat] = useState(2)\n\tconst [videoLink, setVideoLink] = useState(\"\")\n\tconst [model, setModel] = useState(\"\")\n\tconst [process, setProcess] = useState(false)\n\tconst [editSeg, setEditSeg] = useState(false)\n\n\tconst handleClose = () => setShow(false);\n\tconst handleShow = () => setShow(true);\n\tconst handleUploadClose = () => {setUploadShow(false); setProcess(true)}\n\tconst handleUploadShow = () => setUploadShow(true)\n\n\tconst handleDownloadJSON = () => {\n\t\tvar converted_annot = new ExportingAnnotation(props.frame_data, props.fabricCanvas, props.VIDEO_METADATA, props.image_frames).get_frame_json()\n\t\tdownloadFileJSON(props.ANNOTATION_VIDEO_NAME, props.ANNOTATOR_NAME, converted_annot, props.annotation_data, props.VIDEO_METADATA)\n\t}\n\n\tconst handleDownloadCSV = () => {\n\t\tdownloadFileCSV(props.ANNOTATION_VIDEO_NAME, props.ANNOTATOR_NAME, props.annotation_data, props.columns)\n\t}\n\n\tconst handleSetStartDate = (date) => {\n\t\tsetStartDate(date)\n\t\ttry { //Making sure that any garbage input taken care of\n\t\t\tprops.setDateTime(Math.floor((date.getTime() / 1000)))\n\t\t} catch (error) {\n\t\t\talert(\"Invalid date input!\")\n\t\t}\n\t}\n\n\tconst handleVideoFormat = (type) => {\n\t\tconsole.log(type)\n\t\t//TODO Make sure bug is resolved and simply have video format equal type\n\t\ttype = parseInt(type)\n\t\tif(type === 0){\n\t\t\tsetVideoFormat(0)\n\t\t}else if (type === 1){\n\t\t\tsetVideoFormat(1)\n\t\t}else if (type === 2){\n\t\t\tsetVideoFormat(2)\n\t\t\tprops.handleInputType(1)\n\t\t}\n\t}\n\n\tconst handleEnableModel = (event) => {\n\t\t//Defualt value is true which is disbaled. False turns it on!\n\t\tif(model === \"\"){\n\t\t\talert(\"Please select a model\")\n\t\t}\n\t\tload(model)\n\t}\n\n\tconst handleVideoLink = (event) => {\n\t\tif(typeof(event) === \"string\"){\n\t\t\tsetVideoLink(event.target.value)\n\t\t\tconsole.log(event.target.value)\n\t\t}else{\n\t\t\tsetVideoLink(URL.createObjectURL(event.target.files[0]))\n\t\t}\n\t}\n\n\tconst handleEditSeg = (event) => {\n\t\tsetEditSeg(!editSeg)\n\t}\n\n\tconst edit_click = (event) => {\n\t\thandleEditSeg();\t\t\n\t\tEdit(props.fabricCanvas, props.save_data);\n\t\tprops.toggle_segmentation();\n\t}\n\n\t/* TODO Add local storgae option\n\tif (localStorage.getItem('frame_data') != null){\n\t\talert(\"There is some data stored\")\n\t\tprops.annotation_data = localStorage.getItem('annotation_data');\n\t\tprops.frame_data = localStorage.getItem('frame_data');\n\t}*/\n\n\treturn (\n\t\t<div>\n\t\t{\n\t\t\t//TODO Re-enable this for video processing. \n\t\t\tprocess == 2 && \n\t\t\t<ProcessVideo\n\t\t\t\tframe_rate={frameRate}\n\t\t\t\tvideo_link={videoLink}\n\t\t\t/>\n\t\t}\n\t\t<Modal show={show} onHide={handleClose} size='lg'>\n\t\t\t<Modal.Header closeButton>\n\t\t\t<Modal.Title>Instructions</Modal.Title>\n\t\t\t</Modal.Header>\n\t\t\t<Modal.Body><Instructions></Instructions></Modal.Body>\n\t\t\t<Modal.Footer>\n\t\t\t<Button variant=\"secondary\" onClick={handleClose}>Close</Button>\n\t\t\t</Modal.Footer>\n\t\t</Modal>\n\t\t<Modal show={uploadShow} onHide={handleUploadClose} size='lg'>\n\t\t\t<Modal.Header closeButton>\n\t\t\t\t<Modal.Title>Upload</Modal.Title>\n\t\t\t</Modal.Header>\n\t\t\t<Modal.Body>\n\t\t\t\t<div style={{display: \"grid\"}}>\n\t\t\t\t\t{/*onClick and onBlur events are for the sole purpose to stop the eventKeys from firing off*/}\n\t\t\t\t\t<Form style={{float: \"left\",gridColumn: 1, gridRow:1, zIndex:99}}>\n\t\t\t\t\t\tVideo Format: \n\t\t\t\t\t\t<Form.Control\n\t\t\t\t\t\t\tas=\"select\"\n\t\t\t\t\t\t\tid=\"inlineFormCustomSelect\"\n\t\t\t\t\t\t\tonChange={(event)=>{handleVideoFormat(event.target.value)}}\n\t\t\t\t\t\t\tdefaultValue={videoFormat}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<option value=\"2\">Image</option>\n\t\t\t\t\t\t</Form.Control>\n\t\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\t</Form>\n\t\t\t\t\t<div style={{float: \"left\",gridColumn: 1, gridRow:2, zIndex:99}}>\n\t\t\t\t\t\tAnnotator Name: <input type='text' defaultValue={props.ANNOTATOR_NAME} onClick={(event) => {props.toggleKeyCheck(false)}} onBlur={(event) => {props.toggleKeyCheck(true)}} onChange={(event) => {props.change_annotator_name(event.target.value)}}></input>\n\t\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style={{float: \"left\",gridColumn: 1, gridRow:3, zIndex:99}}>\n\t\t\t\t\t\t<text>Date and Time: </text>\n\t\t\t\t\t\t<DatePicker\n\t\t\t\t\t\t\tselected={startDate}\n\t\t\t\t\t\t\tonChange={(date) => {handleSetStartDate(date)}}\n\t\t\t\t\t\t\ttimeInputLabel=\"Time:\"\n\t\t\t\t\t\t\tdateFormat=\"yyyy/MM/dd hh:mm\"\n\t\t\t\t\t\t\tshowTimeInput\n\t\t\t\t\t\t\tonClick={(event) => {props.toggleKeyCheck(false)}}\n\t\t\t\t\t\t\tonClickOutside={(event) => {props.toggleKeyCheck(true)}}\n\t\t\t\t\t\t\tonCalendarOpen={(event) => {props.toggleKeyCheck(false)}}\n\t\t\t\t\t\t\tonCalendarClose={(event) => {props.toggleKeyCheck(true)}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\t</div>\n\t\t\t\t\t{videoFormat === 0 && \n\t\t\t\t\t\t<Form style={{float: \"left\",gridColumn: 1, gridRow:4}}>\n\t\t\t\t\t\t\t<Form.File multiple id=\"file\" label=\"Video Upload\" accept=\".mp4\" custom type=\"file\" onChange={(event) => {props.handleVideoUpload(event); handleVideoLink(event)}} />\n\t\t\t\t\t\t</Form>\n\t\t\t\t\t}\n\t\t\t\t\t{videoFormat === 1 &&\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<text>Youtube URL: </text>\n\t\t\t\t\t\t\t<input onChange={handleVideoLink}></input>\n\t\t\t\t\t\t\t<Button onClick={(event) => {props.handleVideoUpload(videoLink)}}>Upload</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t}{videoFormat === 2 &&\n                        <div>\n                            <Form style={{float: \"left\",gridColumn: 1, gridRow:4}}>\n                                <Form.File multiple id=\"file\" label=\"Image-set 1 Upload\" accept=\"image/*\" custom type=\"file\" onChange={(event) => {props.handleVideoUpload(event); handleVideoLink(event)}} />\n                            </Form>\n                            <Form style={{float: \"left\",gridColumn: 1, gridRow:4}}>\n                                <Form.File multiple id=\"file\" label=\"Image-set 2 Upload\" accept=\"image/*\" custom type=\"file\" onChange={(event) => {props.handleVideoUpload(event); handleVideoLink(event)}} />\n                            </Form>\n                            <Form style={{float: \"left\",gridColumn: 1, gridRow:4}}>\n                                <Form.File multiple id=\"file\" label=\"Image-set 3 Upload\" accept=\"image/*\" custom type=\"file\" onChange={(event) => {props.handleVideoUpload(event); handleVideoLink(event)}} />\n                            </Form>\n                        </div>\n\t\t\t\t\t}\n\t\t\t\t\t<Form style={{float: \"left\",gridColumn: 1, gridRow:5}}>\n\t\t\t\t\t\t<Form.File disabled={props.disable_buttons} accept=\".json\" id=\"file\" label=\"Annotation Upload\" custom type=\"file\" onChange={props.handleOldAnnotation}/>\n\t\t\t\t\t</Form>\n\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\tFrame Rate: <input type=\"number\" value={props.frame_rate} onClick={(event) => {props.toggleKeyCheck(false)}} onBlur={(event) => {props.toggleKeyCheck(true)}} onChange={(event) => {props.setFrameRate(parseInt(event.target.value)); setFrameRate(parseInt(event.target.value))}}></input>\n\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\tSkip Value: <input type='number' defaultValue=\"1\" onChange={(event) => {props.change_skip_value(parseInt(event.target.value))}}></input>\n\t\t\t\t\tPlayback Rate: <input type='number' defaultValue=\"1\" onChange={(event) => {props.handleSetPlaybackRate(parseInt(event.target.value))}}></input>\n\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\t<div>\n\t\t\t\t\t\tEnable Object Detection Model:{' '}\n\t\t\t\t\t\t<select defaultValue={model} onChange={(event) => {setModel(event.target.value)}} id='base_model'>\n\t\t\t\t\t\t\t<option value=\"\">Select</option>\n\t\t\t\t\t\t\t<option value=\"lite_mobilenet_v2\">SSD Lite Mobilenet V2</option>\n\t\t\t\t\t\t\t<option value=\"mobilenet_v1\">SSD Mobilenet v1</option>\n\t\t\t\t\t\t\t<option value=\"mobilenet_v2\">SSD Mobilenet v2</option>\n\t\t\t\t\t\t</select>{' '}\n\t\t\t\t\t\t<Button size='sm' variant='outline-success' onClick={handleEnableModel}>Enable</Button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t</div>\n\t\t\t</Modal.Body>\n\t\t\t<Modal.Footer>\n\t\t\t<Button variant=\"success\" onClick={handleUploadClose}>Upload</Button>\n\t\t\t</Modal.Footer>\n\t\t</Modal>\n\t\t<Navbar sticky=\"top\" bg=\"dark\" variant=\"dark\" className=\"bg-5\">\n\t\t\t\t<Navbar.Brand href=\"#home\">AVAT</Navbar.Brand>\n\t\t\t\t<Nav className=\"mr-auto\">\n\t\t\t\t\t\t<NavDropdown disabled={props.disable_buttons} title=\"Export\" id=\"basic-nav-dropdown\">\n\t\t\t\t\t\t\t<NavDropdown.Item onClick={handleDownloadJSON}>JSON</NavDropdown.Item>\n\t\t\t\t\t\t\t<NavDropdown.Divider />\n\t\t\t\t\t\t\t<NavDropdown.Item onClick={handleDownloadCSV}>CSV</NavDropdown.Item>\n\t\t\t\t\t\t</NavDropdown>\n\t\t\t\t\t\t<NavLink onClick={handleShow}>Instructions</NavLink>\n\t\t\t\t\t\t<NavLink onClick={props.handle_link_open}>Report</NavLink>\n\t\t\t\t</Nav>\n\t\t\t\t<div>\n\t\t\t\t\t{\n\t\t\t\t\t\tmodel.length > 0 &&\n\t\t\t\t\t\t<Button id=\"run\" variant=\"outline-info\" onClick={(event) => {run_model_segment(props.fabricCanvas, props.annotation_data, props.currentFrame, props.save_data, props.handle_visual_toggle); props.handle_visual_toggle();}}>Run model</Button>\n\t\t\t\t\t}\n\t\t\t\t\t<Button variant=\"outline-success\" onClick={handleUploadShow}>Upload</Button>{' '}\n\t\t\t\t\t{\n\t\t\t\t\t\teditSeg === false && <Button variant=\"outline-success\" onClick={edit_click}>Edit Seg</Button>\n\t\t\t\t\t}\n\t\t\t\t\t{\n\t\t\t\t\t\teditSeg === true && <Button variant=\"outline-success\" onClick={edit_click}>Confirm</Button>\n\t\t\t\t\t}\n\t\t\t\t\t{' '}\n\t\t\t\t\t<Dropdown as={ButtonGroup}>\n\t\t\t\t\t\t<Button variant=\"secondary\" disabled={true}>{props.display_frame_num}</Button>{' '}\n\t\t\t\t\t\t<Dropdown.Toggle split variant=\"secondary\" id=\"dropdown-split-basic\" />\n\t\t\t\t\t\t<Dropdown.Menu>\n\t\t\t\t\t\t\tSkip Value: <input type='number' defaultValue=\"1\" onChange={(event) => {props.change_skip_value(parseInt(event.target.value))}}></input>\n\t\t\t\t\t\t\tPlayback Rate: <input type='number' defaultValue=\"1\" onChange={(event) => {props.handleSetPlaybackRate(parseInt(event.target.value))}}></input>\n\t\t\t\t\t\t</Dropdown.Menu>\n\t\t\t\t\t</Dropdown>{' '}\n\t\t\t\t\t\n\t\t\t\t\t<Button variant=\"primary\" disabled={props.disable_buttons} onClick={props.skip_frame_backward}>Prev</Button>{' '}\n\t\t\t\t\t<Button variant=\"primary\" disabled={props.disable_buttons} onClick={props.handlePlaying}>{props.play_button_text}</Button>{' '}\n\t\t\t\t\t<Button variant=\"primary\" disabled={props.disable_buttons} onClick={props.skip_frame_forward}>Next</Button>{' '}\n\t\t\t\t\t<Dropdown as={ButtonGroup} drop='left'>\n\t\t\t\t\t\t<Button variant=\"success\" onClick={props.addToCanvas}>Add</Button>\n\t\t\t\t\t\t<Dropdown.Toggle split variant=\"success\" id=\"dropdown-split-basic\" />\n\t\t\t\t\t\t<Dropdown.Menu>\n\t\t\t\t\t\t\t<Dropdown.Item onClick={(event) =>{props.change_annotation_type(\"1\")}}>Behavior Annotation</Dropdown.Item>\n\t\t\t\t\t\t\t<Dropdown.Item onClick={(event) =>{props.change_annotation_type(\"2\")}}>BoundingBox</Dropdown.Item>\n\t\t\t\t\t\t\t<Dropdown.Item onClick={(event) =>{props.change_annotation_type(\"3\")}}>Segmentation</Dropdown.Item>\n\t\t\t\t\t\t</Dropdown.Menu>\n\t\t\t\t\t</Dropdown>\n\t\t\t\t\t{/*<Button variant=\"danger\" onClick={remove} disabled={disable_buttons} style={{position:\"relative\"}}>Remove</Button>{' '}*/}\n\t\t\t\t</div>\n\t\t</Navbar>\n\t\t</div>\n\t)\n}","//Core imports\nimport React, { useEffect, useState } from \"react\"; \nimport ReactPlayer from 'react-player'\nimport 'bootstrap/dist/css/bootstrap.min.css';\n//import fileMetadata from '../../processing/extract_framerate'\n\n//UI Element imports\nimport Toast from 'react-bootstrap/Toast'\n\n//Processing\nimport ExtractingAnnotation from '../../processing/annotation-processing'\n\n//Annotations\nimport { BoundingBox } from '../../annotations/bounding_box'\nimport { KeyPoint } from '../../annotations/key_point'\nimport { Segmentation } from '../../annotations/segmentation'\n\n//Column information + data structure\nimport {columns} from '../../static_data/columns'\n//import {columns_LPS} from '../../static_data/columns'\nimport {ANNOTATION_FRAME, ANNOTATION_BBOX, ANNOTATION_KEYPOINT, ANNOTATION_SEG} from '../../static_data/constants'\n\n//Components\nimport MultiviewCustomNavBar from \"../Components/nav_bar_multiview\";\nimport FabricRender from \"../Components/fabric_canvas\";\nimport AnnotationTable from \"../Components/change_table\";\nimport { configureCallbacks } from \"@tensorflow/tfjs-layers/dist/base_callbacks\";\n\n//TODO add local storage functionality to auto-save\nif (typeof(Storage) === \"undefined\") {\n  // Code for localStorage/sessionStorage.\n  alert('Your browser does not support local storage. \\nSome autosaving features of the app will not work as intended.\\nPlease see the documentation to find supported browsers and their versions')\n}\n\nconst fabric = require(\"fabric\").fabric;\n\n//TODO ADD DYNAMIC SOLUTION \nvar frame_rate = 15;\nvar num_frames = -1;\nvar scaling_factor_width = 1920;\nvar scaling_factor_height = 1080;\nvar skip_value = 1;\n\nconsole.log(window.screen.width)\nconsole.log(window.screen.height)\n\n//var current_screen_width = window.screen.width;\nvar current_screen_height = window.screen.height;\n\n//Mappings are based off of https://en.wikipedia.org/wiki/List_of_common_resolutions make sure to use 1:1 and 16:9 aspect ratio\n/*if (current_screen_height >= 1440){\n  scaling_factor_width = 1920;\n  scaling_factor_height = 1080;\n}else */if(current_screen_height >= 1080){\n  scaling_factor_width = 1280;\n  scaling_factor_height = 720;\n}else if(current_screen_height >= 1024){\n  scaling_factor_width = 1152;\n  scaling_factor_height = 648;\n}else if(current_screen_height >= 768){\n  scaling_factor_width = 1024;\n  scaling_factor_height = 576;\n}\n\n// globally accessable fabricCanvas instance\nvar fabricCanvas = new fabric.Canvas('c', {\n\tuniScaleTransform: true,\n\tuniformScaling: false,\n\tincludeDefaultValues: false\n});\n\n\n\nfabricCanvas.on('mouse:over', function(e) {\n\tif(e.target == null | segmentation_flag == true){\n\t\treturn;\n\t}else if(e.target['_objects'] == undefined){\n\t\treturn;\n\t}\t\n/* \tif(e.target['type'] !== 'rect' | e.target['type'] !== 'polygon'){\n\t\treturn;\n\t} */\n    temp_color = e.target['_objects'][0].get('fill')\n\te.target['_objects'][0].set('fill', \"#39FF14\");\n    fabricCanvas.renderAll();\n});\n\nfabricCanvas.on('mouse:out', function(e) {\n\tif(e.target == null | segmentation_flag == true){\n\t\treturn;\n\t}else if(e.target['_objects'] == undefined){\n\t\treturn;\n\t}\n/* \tif(e.target['type'] !== 'rect' | e.target['type'] !== 'polygon'){\n\t\treturn;\n\t} */\n\te.target['_objects'][0].set('fill', temp_color);\n    fabricCanvas.renderAll();\n});\n\nfabric.Image.prototype.toObject = (function(toObject) {\n\treturn function() {\n\t  return fabric.util.object.extend(toObject.call(this), {\n\t\tsrc: this.toDataURL()\n\t  });\n\t};\n  })(fabric.Image.prototype.toObject);\n\nfabricCanvas.on('mouse:wheel', function(opt) {\n\tvar delta = opt.e.deltaY;\n\tvar zoom = fabricCanvas.getZoom();\n\t\n\tzoom *= 0.999 ** delta;\n\tif (zoom > 20) zoom = 20;\n\tif (zoom < 0.01) zoom = 0.01;\n\tfabricCanvas.zoomToPoint({ x: opt.e.offsetX, y: opt.e.offsetY }, zoom);\n\topt.e.preventDefault();\n\topt.e.stopPropagation();\n  });\n\nfabricCanvas.on('mouse:down', function(opt) {\n\tvar evt = opt.e;\n\tif (evt.altKey === true) {\n\t  this.isDragging = true;\n\t  this.selection = false;\n\t  this.lastPosX = evt.clientX;\n\t  this.lastPosY = evt.clientY;\n\t}\n  });\nfabricCanvas.on('mouse:move', function(opt) {\n\tif (this.isDragging) {\n\t  var e = opt.e;\n\t  var vpt = this.viewportTransform;\n\t  vpt[4] += e.clientX - this.lastPosX;\n\t  vpt[5] += e.clientY - this.lastPosY;\n\t  this.requestRenderAll();\n\t  this.lastPosX = e.clientX;\n\t  this.lastPosY = e.clientY;\n\t}\n  });\nfabricCanvas.on('mouse:up', function(opt) {\n\t// on mouse up we want to recalculate new interaction\n\t// for all objects, so we call setViewportTransform\n\tthis.setViewportTransform(this.viewportTransform);\n\tthis.isDragging = false;\n\tthis.selection = true;\n  });\n\t  \n\n\nvar temp_color;\nvar video_width = 0;\nvar video_height = 0;\nvar frame_data = [[]];\nvar annotation_data = [[]];\nvar upload = false;\nvar disable_buttons = true;\nvar sliderPercent = 0\nvar toast_text = \"\"\nvar previous_annotation = []\nvar previous_canvas_annotation = []\nvar ANNOTATOR_NAME = \"\"\nvar ANNOTATION_VIDEO_NAME = \"\"\nvar VIDEO_METADATA = {}\nvar play_button_text = \"ERROR\"\nvar temp_flag = false\nvar time_unix = 0;\nvar segmentation_flag = false;\nvar temp_selection_color;\nvar on_ready_flag = false;\nvar image_frames = []\nvar image_frames1 = []\nvar image_frames2 = []\nvar total_frames\nvar player_opacity = 0\n\nfunction save_data(frame_num){\n\t//return; //TODO Clear up\n\tif(fabricCanvas.getObjects().length != 0){\n\t\t//fabricCanvas.setBackgroundImage(null)\n\t\tframe_data[frame_num] = fabricCanvas.getObjects()\n\t\tframe_data[frame_num][\"backgroundImage\"] = null\n\t}else{\n\t\tframe_data[frame_num] = []\n\t}\n\tconsole.log(\"SAVED\")\n}\n\nfunction save_localstorage(){\n\t//console.log(frame_data)\n\ttry{\n\t\t//localStorage.setItem('frame_data', JSON.stringify(frame_data))\n\t\t//localStorage.setItem('annotation_data', JSON.stringify(annotation_data))\n\t} catch (error){\n\t\tconsole.log(\"Local storage failed!\")\n\t}\n}\n\n\n//Current frame counter\nexport default function MainMultiview() {\n\tconst [visualToggle, setVisualToggle] = useState(0);\n\tconst [annotationType, setAnnotationType] = useState(\"1\")\n\tconst [boxCount, setBoxCount] = useState(0)\n\tconst [videoFilePath, setVideoFileURL] = useState(null);\n\tconst [videoFilePath1, setVideoFileURL1] = useState(null);\n\tconst [videoFilePath2, setVideoFileURL2] = useState(null);\n\tconst [oldAnnotation, setOldAnnotation] = useState(null)\n\tconst [player, setPlayer] = useState(null)\n\tconst [duration, setDuration] = useState(0);\n\tconst [show, setShow] = useState(false);\n\tconst [save, changeSave] = useState(false);\n\tconst [seeking, setSeeking] = useState(false)\n\tconst [playing, setPlaying] = useState(false);\n\tconst [keyCheck, changeKeyCheck] = useState(true)\n\tconst [playbackRate, setPlaybackRate] = useState(1)\n\tconst [inputType, setInputType] = useState(1)\n\tconst [currentFrame, setCurrentFrame] = useState(0)\n\tconst [tableFrameNum, setTableFrameNum] = useState(0) //This var is to cause a slight delay to keep the table refresh happen at the same time of the frame change to not disrubt user **\n\n\tif(!segmentation_flag){\n\t\tfabricCanvas.forEachObject(object => {\n\t\t\tobject.selectable = true\n\t\t\tobject.evented = true;\n\t\t});\n\t}\n\n\tconst handleSetCurrentFrame = (val) => {\n\t\ttotal_frames = duration * frame_rate\n\t\thandle_visual_toggle()\n\t\tif(typeof(val) === \"number\"){\n\n\t\t\tsetCurrentFrame(val)\n\t\t\tsetVisualToggle(Math.floor(Math.random() * 999999999999))\n\t\t\tvar new_skip = val/(total_frames)\n\t\t\tif(new_skip > duration){\n\t\t\t\tnew_skip = duration\n\t\t\t}\n\t\t\tplayer.seekTo(new_skip)\n\t\t}else{\n\t\t\tsave_data(currentFrame)\n\t\t\tvar frame_calc = (val['played']/total_frames)\n\t\t\tframe_calc = (Math.floor(val['played']*total_frames))\n\t\t\tif((play_button_text === \"Play\" && temp_flag === true) | play_button_text === \"Pause\"){\n\t\t\t\tif(frame_calc >= total_frames){\n\t\t\t\t\tsetCurrentFrame(total_frames-1)\n\t\t\t\t\tsetVisualToggle(Math.floor(Math.random() * 999999999999))\n\t\t\t\t\ttemp_flag = false;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tsetCurrentFrame(frame_calc)\n\t\t\t\tsetVisualToggle(Math.floor(Math.random() * 999999999999))\n\t\t\t\ttemp_flag = false;\n\t\t\t}\n\t\t\tif(play_button_text === \"Pause\"){\n\t\t\t}\n\t\t\tsetVisualToggle(Math.floor(Math.random() * 999999999999))\n\t\t}\n\t}\n\n\tconst removeRow = (index) => {\t\t\n\t\tvar index_num = 0;\n\t\tfor(var i = 0; i < annotation_data[currentFrame].length; i++){\n\t\t\tif(annotation_data[currentFrame][i]['id'] == index){\n\t\t\t\tindex_num = i\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif(index.substring(index.length-1, index.length) !== \"f\"){ //Disabled removal of key-point for now\n\t\t\tvar current_objects = fabricCanvas.getObjects()\n\t\t\tfor(var i = 0; i < current_objects.length; i++){\n\t\t\t\tconsole.log(current_objects[i])\n\t\t\t\tif(current_objects[i]['_objects'][1]['text'] === index){\n\t\t\t\t\tconsole.log(\"REMOVED\")\n\t\t\t\t\tconsole.log(current_objects[i])\n\t\t\t\t\tfabricCanvas.remove(current_objects[i]);\n\t\t\t\t\tfabricCanvas.fire('saveData');\n\t\t\t\t\tfabricCanvas.renderAll();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tannotation_data[currentFrame].splice(index_num, 1)\n\t\tsave_data(currentFrame)\n\t\t\n\t}\n\n\tconst remove_table_index = (index) => {\n\t\tif (index === undefined) {\n\t\t\tvar indiciesToDelete = []\n\t\t\tfor(var i = 0; i < annotation_data[currentFrame].length; i++){\n\t\t\t\tindiciesToDelete.push(annotation_data[currentFrame][i]['id'])\n\t\t\t}\n\t\t\tindiciesToDelete.map(x => removeRow(x))\n\t\t}else{\n\t\t\tremoveRow(index)\n\t\t}\n\t\t//TODO make this more elegant - Currently makes a random number since the state change using an incremental update to the integer caused a stop of state updates and did not respond to any changes. This forces the values to be changed on random and should not have any dependence of the previous value of the visual toggle state.\n\t\tsetVisualToggle(Math.floor(Math.random() * 999999999999))\n\t}\n\t\n\t\n\n\tconst save_previous_data = () => {\n\t\tif(annotation_data[currentFrame].length == 0){\n\t\t\treturn;\n\t\t}\n\t\tprevious_annotation = annotation_data[currentFrame]\n\t\tprevious_canvas_annotation = frame_data[currentFrame]\n\t}\n\n\tconst addToCanvas = () =>{\n\t\tvar color = \"#\" + ((1<<24)*Math.random() | 0).toString(16)\n\t\t\n\t\tif(annotation_data[currentFrame] == null){\n\t\t\tannotation_data[currentFrame] = []\n\t\t}\n\t\tif (segmentation_flag == true){\n\t\t\talert(\"Please finish your current segmentation!\")\n\t\t\treturn\n\t\t}\n\t\t\n\t\tvar annotation_type_txt = \"error\"\n\n\t\tif (annotationType === ANNOTATION_BBOX){\n\t\t\tannotation_type_txt = \"b\"\n\t\t\tvar new_bbox = new BoundingBox(fabricCanvas.height/2, fabricCanvas.width/2, 50, 50, color, boxCount+'b', \"None\").generate_no_behavior(fabricCanvas)\n\t\t\t//fabricCanvas.add(new_bbox)\n\t\t}else if (annotationType === ANNOTATION_KEYPOINT){\n\t\t\t//TODO fix KeyPoint\n\t\t\talert(\"KeyPoint annotation are currently unavailable\")\n\t\t\tannotation_type_txt = \"k\"\n\t\t\t//var keyp = new KeyPoint().generate_stick(fabricCanvas)\n\t\t}else if (annotationType === ANNOTATION_SEG){\n\t\t\t//TODO Fix segmentation issues\n\t\t\tannotation_type_txt = \"s\"\t  \n\n\t\t\tvar segment = new Segmentation().generate_polygon(fabricCanvas, boxCount+'s', toggle_segmentation)\n\t\t\ttoggle_segmentation()\n\n\t\t}else if(annotationType === ANNOTATION_FRAME){\n\t\t\t//TODO Add annotation frame datapoint\n\t\t\tannotation_type_txt = \"f\"\n\t\t}\n\n\t\tif(inputType === 1){\n\t\t\tannotation_data[currentFrame].push({id: boxCount+annotation_type_txt, global_id: \"\",status: \"\", current: \"\", behavior: \"\", posture: \"\", notes: \"\", confidence:\"\", dataType: \"image\", fileName: image_frames[currentFrame]['name']})\n\t\t}else{\n\t\t\tannotation_data[currentFrame].push({id: boxCount+annotation_type_txt, global_id: \"\",status: \"\", current: \"\", behavior: \"\", posture: \"\", notes: \"\",  confidence:\"\", dataType: \"video\", fileName: \"frame_\"+currentFrame})\n\t\t}\n    //annotation_data[currentFrame].push({id: boxCount+annotation_type_txt, global_id: -1,status: \"\", current: \"\", behavior: \"\", posture: \"\", notes: \"\", confidence: \"\"})\n\t\tsave_data(currentFrame)\n\t\tsetBoxCount(boxCount + 1);\n\t\tfabricCanvas.fire('saveData');\n\t}\n\n\tconst toggle_segmentation = (event) => {\n\t\tsegmentation_flag = !segmentation_flag\n\t}\n\n\tconst handleVideoUpload = (event) => {\n\t\tif(inputType === 1){\n\t\t\timage_frames = event.target.files\n\t\t\ttotal_frames = image_frames.length\n\t\t\tfor(var i = 0; i < total_frames; i++){\n\t\t\t\tannotation_data.push([])\n\t\t\t}\n\t\t\tcanvasBackgroundUpdate() //TODO might cause a breaking change since no return\n\t\t\tdisable_buttons = false;\n\t\t}\n\n\t\tANNOTATION_VIDEO_NAME = event.target.files[0]['name']\n\t\tsetVideoFileURL(URL.createObjectURL(event.target.files[0]));\n\t\tupload = true;\n\t};\n\n\tconst handleVideoUpload1 = (event) => {\n\t\timage_frames1 = event.target.files\n\t\ttotal_frames = image_frames1.length\n\t\tfor(var i = 0; i < total_frames; i++){\n\t\t\tannotation_data.push([])\n\t\t}\n\t\tcanvasBackgroundUpdate() //TODO might cause a breaking change since no return\n\t\tdisable_buttons = false;\n\t\tsetVideoFileURL1(URL.createObjectURL(event.target.files[0]));\n\t}\n\n\tconst handleVideoUpload2= (event) => {\n\t\timage_frames2 = event.target.files\n\t\ttotal_frames = image_frames2.length\n\t\tfor(var i = 0; i < total_frames; i++){\n\t\t\tannotation_data.push([])\n\t\t}\n\t\tcanvasBackgroundUpdate() //TODO might cause a breaking change since no return\n\t\tdisable_buttons = false;\n\t\tsetVideoFileURL2(URL.createObjectURL(event.target.files[0]));\n\t}\n\n\t//ASYNC Function  - To note that the data that comes out of this will be a bit delayed and this could cause some issues.\n\tconst handleOldAnnotation = (event) => {\n\t\tvar promise = downloadOldAnnotation(event)\n\t\tpromise.then(function (result) {\n\t\t\tif(result != null){\n\t\t\t\tsetOldAnnotation(new ExtractingAnnotation(result, fabricCanvas));\n\t\t\t}else{\n\t\t\t\talert(\"Error in processing Annotation\")\n\t\t\t}\n\t\t})\n\t}\n\n\tuseEffect(() => {\n\t\t//TODO Find a more elegant solution. This is a temporay patch work.\n\t\tif(oldAnnotation == null){\n\t\t\treturn;\n\t\t}\n\t\tframe_data = oldAnnotation.get_frame_data();\n\t\tannotation_data = oldAnnotation.get_annotation_data();\n\t\thandle_visual_toggle()\n\t\tcanvasBackgroundUpdate()\n\t\tconsole.log(oldAnnotation.get_frame_data())\n\t}, [oldAnnotation]);\n\n\tconst downloadOldAnnotation = (file) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\tvar reader = new FileReader();\n\t\treader.onload = function(e) {\n\t\t\tresolve((JSON.parse(e.target.result)));\n\t\t}\n\t\treader.readAsText(file.target.files[0])\n\t\t})\n\t}\n  \n\n\tconst handlePlaying = (event) => {\n\t\tif(play_button_text === \"Pause\"){\n\t\t\ttemp_flag = true;\n\t\t}\n\t\tsetPlaying(!playing)\n\t\tsave_previous_data()\n\t}\n\n\n\tif(playing === true){\n\t\tplay_button_text = \"Pause\"\n\t\tplayer_opacity = 100\n\t}else{\n\t\tplay_button_text = \"Play\"\n\t\tplayer_opacity = 0\n\t}\n\n\tconst handleSeekChange = e => {\n\t\tsliderPercent = (parseFloat(e.target.value))\n\t\tplayer.seekTo(sliderPercent)\n\t}\n\n\tconst handleSeekMouseDown = e => {\n\t\tsetSeeking(true)\n\t\tsliderPercent = (parseFloat(e.target.value))\n\t\t//player.seekTo(parseFloat(e.target.value))\n\t}\n\n\tconst handleSeekMouseUp = e => {\n\t\tsetSeeking(false)\n\t\tsliderPercent = (parseFloat(e.target.value))\n\t\t//player.seekTo(parseFloat(e.target.value))\n\t}\n\n\tconst handleSetPlayer = val => {\n\t\tif(val != null){\n\t\tif(val['player'] != null){\n\t\t\tif(val['player']['player'] != null){\n\t\t\t\t\tif(val['player']['player'] != null){\n\t\t\t\t\t\tvideo_width = val['player']['player']['player'].videoWidth\n\t\t\t\t\t\tvideo_height = val['player']['player']['player'].videoHeight\n\t\t\t\t\t\tvar duration = val['player']['player']['player'].duration\n\t\t\t\t\t\tVIDEO_METADATA = {name: ANNOTATION_VIDEO_NAME, duration: duration, horizontal_res: video_width, vertical_res: video_height, frame_rate: frame_rate, time: time_unix}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tsetPlayer(val)\n\t}\n\n\tconst handleSetDuration = val => {\n\t\tif(upload === true && player != null){      \n\t\t\tnum_frames = Math.round(val * frame_rate);\n\n\t\t\tif(annotation_data[0].length == 0){\n\t\t\t\tconsole.log(\"Resetting frame_data and annotation_data\")\n\t\t\t\tframe_data = new Array(num_frames)\n\t\t\t\tannotation_data = new Array(num_frames)\n\t\t\t\t//TODO Update this later\n\t\t\t\tfor (var i = 0; i < num_frames; i++){\n\t\t\t\t\tframe_data[i] = []\n\t\t\t\t\tannotation_data[i] = []\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//upload = false;\n\t\t\tdisable_buttons = false\n\t\t}\n\t\ttotal_frames = parseInt(val) * frame_rate\n\t\tsetDuration(parseInt(val))\n\t}\n\n\tconst [scrubbing, setScrubbing] = useState(true);\n\n\n\tconst skip_frame_forward = e =>{\n\t\tsave_previous_data()\n\t\tvar frameVal = currentFrame + skip_value\n\t\tif(frameVal >= total_frames){\n\t\t\tif(inputType === 1){\n\t\t\t\tsetCurrentFrame(total_frames-1)\n\t\t\t\treturn;\n\t\t\t}\n\t\t\thandleSetCurrentFrame(total_frames-1)\n\t\t}else{\n\t\t\tif(inputType === 1){\n\t\t\t\tsetCurrentFrame(frameVal)\n\t\t\t\treturn;\n\t\t\t}\n\t\t\thandleSetCurrentFrame(frameVal)\n\t\t}\n\t\t//canvasBackgroundUpdate()\n\t}\n\n\tconst skip_frame_backward = e => {\n\t\tsave_previous_data()\n\n\t\tvar frameVal = currentFrame - skip_value\n\t\tif(frameVal < 0){\n\t\t\tif(inputType === 1){\n\t\t\t\tsetCurrentFrame(0)\n\t\t\t\treturn;\n\t\t\t}\n\t\t\thandleSetCurrentFrame(0)\n\t\t}else{\n\t\t\tif(inputType === 1){\n\t\t\t\tsetCurrentFrame(frameVal)\n\t\t\t\treturn;\n\t\t\t}\n\t\t\thandleSetCurrentFrame(frameVal)\n\t\t}\n\t\t//canvasBackgroundUpdate()\n\t}\n\n\tuseEffect(() => {\n\t\t//alert(\"\")\n\t\tif(inputType === 1){\n\t\t\tcanvasBackgroundUpdate()\n\t\t}\n\t}, [currentFrame]);\n\n\tconst change_skip_value = (event) => {\n\t\tskip_value = event\n\t}\n\n\tconst change_annotation_type = (event) => {\n\t\tsetAnnotationType(event)\n\t}\n\n\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\tconst onKeyPress = (event) =>{\n\t\t//Making sure input for textbox doesnt get counted as a mode change\n\t\tif(keyCheck === false){\n\t\t\treturn;\n\t\t}\n\t\tif(segmentation_flag === true){\n\t\t\talert(\"Please finish your current action!\")\n\t\t\treturn;\n\t\t}\n\t\tif (event.key === ANNOTATION_BBOX){\n\t\t\ttoast_text = \"Mode Switch: Bounding Box\"\n\t\t\tchangeSave(true)\n\t\t\tsetAnnotationType(ANNOTATION_BBOX)\n\t\t}else if (event.key === ANNOTATION_KEYPOINT){\n\t\t\ttoast_text = \"Mode Switch: Key Point\"\n\t\t\tchangeSave(true)\n\t\t\tsetAnnotationType(ANNOTATION_KEYPOINT)\n\t\t}else if(event.key === ANNOTATION_SEG) {\n\t\t\ttoast_text = \"Mode Switch: Segmentation\"\n\t\t\tchangeSave(true)\n\t\t\tsetAnnotationType(ANNOTATION_SEG)\n\t\t}else if(event.key === ANNOTATION_FRAME){\n\t\t\ttoast_text = \"Mode Switch: Behavior Annotation\"\n\t\t\tchangeSave(true)\n\t\t\tsetAnnotationType(ANNOTATION_FRAME)\n\t\t}else if (event.key === \"a\"){\n\t\t\tvar annotext = \"\"\n\t\t\tif(annotationType === ANNOTATION_BBOX){\n\t\t\t\tannotext = \"Bounding Box\"\n\t\t\t}else if(annotationType === ANNOTATION_FRAME){\n\t\t\t\tannotext = \"Behavior Data\"\n\t\t\t}else if (annotationType === ANNOTATION_KEYPOINT){\n\t\t\t\tannotext = \"Keypoint\"\n\t\t\t}else if (annotationType === ANNOTATION_SEG){\n\t\t\t\tannotext = \"Segmentation\"\n\t\t\t}\n\t\t\ttoast_text = \"Added Annotation - \" + annotext\n\t\t\tif(annotationType !== ANNOTATION_SEG){\n\t\t\t\tchangeSave(true)\n\t\t\t}\n\t\t\taddToCanvas()\n\t\t}else if (event.key === \"q\"){\n\t\t\tsave_localstorage()\n\t\t\tskip_frame_backward()\n\t\t}else if (event.key === \"w\"){\n\t\t\tcanvasBackgroundUpdate()\n\t\t\thandlePlaying()\n\t\t}else if (event.key === \"e\"){\n\t\t\tconsole.log(fabricCanvas.toJSON())\n\t\t\tsave_localstorage()\n\t\t\tskip_frame_forward()\n\t\t}else if (event.key === \"s\"){\n\t\t\ttoast_text = \"Annotation Saved\"\n\t\t\tchangeSave(true)\n\t\t\tframe_data[currentFrame] = fabricCanvas.toJSON()\n\t\t}else if (event.key === \"f\"){\n\t\t\tif(scrubbing === false){\n\t\t\t\ttoast_text = \"Scrubbing Mode Activated\"\n\t\t\t\tsetScrubbing(true)\n\t\t\t\tchangeSave(true)\n\t\t\t}else{\n\t\t\t\ttoast_text = \"Scrubbing Mode Deactivated\"\n\t\t\t\tsetScrubbing(false)\n\t\t\t\tchangeSave(true)\n\t\t\t}\n\t\t}else if(event.key === \"c\"){\n\t\t\ttoast_text = \"Copying previous frame annotation\"\n\t\t\tannotation_data[currentFrame] = JSON.parse(JSON.stringify(previous_annotation))\n\t\t\tframe_data[currentFrame] = JSON.parse(JSON.stringify(previous_canvas_annotation))\n\t\t\tfabric.util.enlivenObjects(frame_data[currentFrame], function(objects) {\t\t\n\t\t\t\tconsole.log(objects)\t\n\t\t\t\tframe_data[currentFrame] = objects\t\n\t\t\t\tfor(var i = 0; i < objects.length; i++){\n\t\t\t\t\tframe_data[currentFrame][i]['local_id'] = previous_canvas_annotation[i]['local_id']\n\t\t\t\t}\n\t\t\t\tcanvasBackgroundUpdate() //TODO Might run into performance issues. If performance issues persist, refine this approach.\n\t\t\t\tchangeSave(true)\n\t\t\t});\n\t\t}\n\t}  \n\n\tuseEffect(() => {\n\t\tdocument.addEventListener(\"keydown\", onKeyPress);\n\t\treturn () => document.removeEventListener(\"keydown\", onKeyPress);\n\t}, [onKeyPress]);\n\t\n\n\n\tconst handle_link_open = () => {\n\t\twindow.open(\"https://forms.gle/CrJuYEoT39uFgnR17\", \"_blank\")\n\t}\n\n\tconst change_annotator_name = (event) => {\n\t\tANNOTATOR_NAME = event\n\t}\n\n\tconst handle_visual_toggle = () => {\n\t\tsetVisualToggle(Math.floor(Math.random() * 999999999999))\n\t}\n\n\tconst handleSetPlaybackRate = (playbackRate) => {\n\t\tif(isNaN(playbackRate)){\n\t\t\tsetPlaybackRate(0)\n\t\t}else if(playbackRate > 16){\n\t\t\talert(\"Max playback rate is 16!\")\n\t\t\tsetPlaybackRate(16)\n\t\t}\t\n\t\telse{\n\t\t\tsetPlaybackRate(playbackRate)\n\t\t}\n\t}\n\n\tconst toggleKeyCheck = (toggle_val) => {\n\t\tconsole.log(\"Keycheck activated\")\n\t\tif(toggle_val === undefined){\n\t\t\tchangeKeyCheck(!keyCheck)\n\t\t}else{\n\t\t\tchangeKeyCheck(toggle_val)\n\t\t}\n\t}\n\n\tconst setFrameRate = (framerate) => {\n\t\tframe_rate = parseInt(framerate)\n\t\tif (frame_rate > 120){\n\t\t\tframe_rate = 120;\n\t\t}else if(frame_rate <= 0){\n\t\t\tframe_rate = 1;\n\t\t}else if(Number.isFinite(frame_rate) == false){\n\t\t\tframe_rate = 1;\n\t\t\treturn;\n\t\t}\n\t\tconsole.log(Number.isFinite(frame_rate))\n\t\tconsole.log(frame_rate)\n\n\t\tnum_frames = Math.round(duration * frame_rate);\n\t\tif(annotation_data[0].length == 0){\n\t\t\ttotal_frames = duration * framerate\n\t\t\tconsole.log(\"Resetting frame_data and annotation_data\")\n\t\t\tframe_data = new Array(num_frames)\n\t\t\tannotation_data = new Array(num_frames)\n\t\t\t//TODO Update this later\n\t\t\tfor (var i = 0; i < num_frames; i++){\n\t\t\t\tframe_data[i] = []\n\t\t\t\tannotation_data[i] = []\n\t\t\t}\n\t\t\t//TODO make this more elegant - Currently makes a random number since the state change using an incremental update to the integer caused a stop of state updates and did not respond to any changes. This forces the values to be changed on random and should not have any dependence of the previous value of the visual toggle state.\n\t\t\tsetVisualToggle(Math.floor(Math.random() * 999999999999))\n\n\t\t}else{\n\t\t\talert(\"There is data currently annotated! To change frame rate refresh the page and re-upload!\")\n\t\t}\n\t}\n\n\tconst setDateTime = (time) => {\n\t\ttime_unix = time;\n\t\tVIDEO_METADATA = {name: ANNOTATION_VIDEO_NAME, duration: duration, horizontal_res: video_width, vertical_res: video_height, frame_rate: frame_rate, time: time_unix}\n\t\tconsole.log(time)\n\t}\n\n\t\n\tconsole.log(document.getElementsByTagName('img')[0])\n\tconst canvasBackgroundUpdate = () => {\n\t\tconsole.log(\"hi\")\n\t\tif(image_frames.length == 0){\n\t\t\treturn;\n\t\t}else if (image_frames1.length == 0){\n\t\t\treturn;\n\t\t}else if (image_frames2.length == 0){\n\t\t\treturn;\n\t\t}\n\t\tif(inputType == 1){ //This is for when images are uploaded\n\t\t\tdocument.getElementsByTagName('img')[0].src = URL.createObjectURL(image_frames[currentFrame])\n\t\t\tdocument.getElementsByTagName('img')[1].src = URL.createObjectURL(image_frames1[currentFrame])\n\t\t\tdocument.getElementsByTagName('img')[2].src = URL.createObjectURL(image_frames2[currentFrame])\n\t\t}\n\t}\n\n\tcanvasBackgroundUpdate()\n\n\treturn (\n\t\t<div>\n\t\t\t<MultiviewCustomNavBar \n\t\t\t\tdisable_buttons={disable_buttons} \n\t\t\t\tvideo_width={video_width} \n\t\t\t\tvideo_height={video_height} \n\t\t\t\tskip_value={skip_value} \n\t\t\t\tANNOTATOR_NAME={ANNOTATOR_NAME}\n\t\t\t\thandle_link_open={handle_link_open}\n\t\t\t\thandleOldAnnotation={handleOldAnnotation}\n\t\t\t\thandleVideoUpload={handleVideoUpload}\n\t\t\t\tcurrentFrame={currentFrame}\n\t\t\t\tdisplay_frame_num={\"Frame #\" + parseInt(currentFrame+1)+' / '+parseInt(total_frames)}\n\t\t\t\tskip_frame_forward={skip_frame_forward}\n\t\t\t\tskip_frame_backward={skip_frame_backward}\n\t\t\t\thandlePlaying={handlePlaying}\n\t\t\t\tplay_button_text={play_button_text}\n\t\t\t\taddToCanvas={addToCanvas}\n\t\t\t\tANNOTATION_VIDEO_NAME={ANNOTATION_VIDEO_NAME}\n\t\t\t\tframe_data={frame_data}\n\t\t\t\tchange_skip_value={change_skip_value}\n\t\t\t\tchange_annotator_name={change_annotator_name}\n\t\t\t\tchange_annotation_type={change_annotation_type}\n\t\t\t\tannotation_data={annotation_data}\n\t\t\t\tVIDEO_METADATA={VIDEO_METADATA}\n\t\t\t\tscaling_factor_height={scaling_factor_height}\n\t\t\t\tscaling_factor_width={scaling_factor_width}\n\t\t\t\tcolumns={columns}\n\t\t\t\thandleSetPlaybackRate={handleSetPlaybackRate}\n\t\t\t\ttoggleKeyCheck={toggleKeyCheck}\n\t\t\t\tsetFrameRate={setFrameRate}\n\t\t\t\tframe_rate={frame_rate}\n\t\t\t\tsetDateTime={setDateTime}\n\t\t\t\tfabricCanvas={fabricCanvas}\n\t\t\t\tsave_data={save_data}\n\t\t\t\thandle_visual_toggle={handle_visual_toggle}\n\t\t\t\timage_frames={image_frames}\n\t\t\t\ttoggle_segmentation={toggle_segmentation}\n\t\t\t/>\n\t\t\t<Toast \n\t\t\t\tonClose={() => changeSave(false)} \n\t\t\t\tshow={save} delay={500} autohide\n\t\t\t\tstyle={{ position: 'absolute', top: '100', left: '100', zIndex: '100'}}\n\t\t\t>\n\t\t\t\t<Toast.Header>\n\t\t\t\t\t<strong className=\"mr-auto\">{toast_text}</strong>\n\t\t\t\t</Toast.Header>\n\t\t\t</Toast>\n\t\t\t{\n\t\t\t\tupload === true && \n\t\t\t\t<div style={{display: \"grid\"}} show={upload}>\n\t\t\t\t\t<div style={{gridColumn: 1, gridRow:1, position: \"relative\", width: scaling_factor_width, height: scaling_factor_height, top: 0, left: 0, opacity: player_opacity}}>\n\t\t\t\t\t\t<img></img>\n\t\t\t\t\t\t<img></img>\n\t\t\t\t\t\t<img></img>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div style={{gridColumn: 1, gridRow:2, position: \"relative\", width: scaling_factor_width, top: 0, left: 0}}>\n\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style={{gridColumn: 2, gridRow:1, position: \"relative\",width: scaling_factor_width*.4, height: scaling_factor_height, top: 0, left: 0}}>\n\t\t\t\t\t\t<AnnotationTable\n\t\t\t\t\t\t\tannotation_data={annotation_data}\n\t\t\t\t\t\t\tcurrentFrame={tableFrameNum}\n\t\t\t\t\t\t\ttoggleKeyCheck={toggleKeyCheck}\n\t\t\t\t\t\t\tcolumns={columns}\n\t\t\t\t\t\t\tremove_table_index={remove_table_index}\n\t\t\t\t\t\t\thandleSetCurrentFrame={handleSetCurrentFrame}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t}\n\t\t</div>\n\t);\n}\n\n\n","\nimport React, { useState } from \"react\";\nimport 'bootstrap/dist/css/bootstrap.min.css';\n\nimport Button from 'react-bootstrap/Button'\nimport Modal from 'react-bootstrap/Modal'\nimport Carousel from 'react-bootstrap/Carousel'\n\nimport MainUpload from './main_upload'\nimport MainMultiview from './main_muiltiview'\nimport { Container, Jumbotron, Col, Row, Card} from \"react-bootstrap\";\nimport Instructions from \"../Components/instructions\";\n\nimport selection_items from '../../static_data/selectionscreen_info.json'\n\n//<img src={process.env.PUBLIC_URL + '/favicon.ico'} alt=\"logo\" style={{width: \"30%\"}} />\nfunction SelectionScreen(){\n    const [show, setShow] = useState(false);\n    const handleClose = () => setShow(false);\n\tconst handleShow = () => setShow(true);\n    const [upload, setUpload] = useState(false)\n    const handleUpload = (event) => {\n        setUpload(!upload)\n    }\n\n    const [multiview, setMultiview] = useState(false)\n    const handleMultiview = (event) => {\n        setMultiview(!multiview)\n    }\n\n    if(upload){\n        return (<MainUpload/>)\n    }else if(multiview){\n        return (<MainMultiview/>)\n    }else{\n        return (\n            <div>\n                <Modal show={show} onHide={handleClose} size='lg'>\n                    <Modal.Header closeButton>\n                    <Modal.Title>Instructions</Modal.Title>\n                    </Modal.Header>\n                    <Modal.Body><Instructions></Instructions></Modal.Body>\n                    <Modal.Footer>\n                    <Button variant=\"secondary\" onClick={handleClose}>Close</Button>\n                    </Modal.Footer>\n                </Modal>\n                <main>\n                    <Jumbotron className=\"text-center\">\n                        <Container>\n                            <h1 className=\"jumbotron-heading\">AVAT</h1>\n                            <p className=\"lead text-muted\"> Analysis tool to record data for livestock behavior and computer vision applications. </p>\n                            <p>\n                                <Button onClick={handleUpload} variant=\"success\" className=\"mx-1 my-2\">Video Upload</Button>\n                                <Button onClick={handleMultiview} variant=\"success\">Multiview</Button>\n                            </p>\n                        </Container>\n                    </Jumbotron>\n                        <Carousel controls={false} fade style={{\"width\": \"70%\", \"margin-left\": \"auto\", \"margin-right\": \"auto\"}}>\n                            {\n                                selection_items.map((item, key) => {\n                                    return(\n                                        <Carousel.Item interval={item.slide_time}>\n                                            <Card \n                                                className=\"mb-5 box-shadow\" \n                                                top\n                                                width='100%'\n                                            >\n                                                <Card.Img width=\"60%\" variant=\"top\" src={process.env.PUBLIC_URL + item.src} />\n                                                <Card.Body style={{\"text-align\": \"center\"}}>\n                                                    <Card.Title>{item.altText}</Card.Title>\n                                                    <Card.Text>{item.description}</Card.Text>\n                                                </Card.Body>\n                                            </Card>\n                                        </Carousel.Item>\n                                    )\n                                })\n                            }\n                        </Carousel>\n                </main>\n            </div>\n        )\n    }\n}\n\nexport default SelectionScreen;","/**\n * @author Pradeep Senthil (pradeepsen99@gmail.com)\n * @\n */\n\n import React, { useState } from \"react\"; \n import ReactDOM from 'react-dom'\n import './App.css';\n import ReactPlayer from 'react-player'\n import 'bootstrap/dist/css/bootstrap.min.css';\n \n import FrontEnd from './ui_elements/Pages/main_upload'\n import SelectionScreen from './ui_elements/Pages/selection_screen'\n \n //<FrontEnd></FrontEnd>\n function App() {\n   return (\n     <div>\n       <SelectionScreen></SelectionScreen>    \n     </div>\n   );\n }\n       //<ActiveObject />\n       //<input type=\"file\" onChange={handleVideoUpload1} />\n       //<div>\n         //<ReactPlayer url={videoFilePath1} width=\"50%\" height=\"50%\" controls={true} style={{position:'relative', float:'left'}}/>\n         //<Fabric/>\n       //</div>\n \n export default App;","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nimport { Provider } from 'react-redux'\nimport store from './store'\n\n/* ReactDOM.render(\n    <App/>,\n    document.getElementById('root')\n);\n */\n\n//REDUX code\nReactDOM.render(\n    <Provider store={store}>\n      <App/>,\n    </Provider>,\n    document.getElementById('root')\n);\n\n\n/**\n * IF NEED TO RE-ENABLE STRICT MODE THEN UNNCOMMENT AND ADD BACK\n * \n *   <React.StrictMode>\n    <MainUpload></MainUpload>\n  </React.StrictMode>,\n */\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}