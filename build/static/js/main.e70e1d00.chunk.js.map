{"version":3,"sources":["backend_processing/annotation-processing.js","static_data/behaviors.js","static_data/posture.js","ui_elements/Components/change_table.js","backend_processing/bounding_box.js","backend_processing/frame_bounding_box.js","backend_processing/segmentation.js","backend_processing/key_point.js","ui_elements/Components/instructions.js","ui_elements/Pages/main_upload.js","static_data/status.js","static_data/behaviors_LPS.js","ui_elements/Pages/main_youtube.js","serviceWorker.js","index.js"],"names":["AnnotationProcessing","annotation_json","this","objects","console","log","id","frame_num","i","objects_frame","length","curr_obj","curr_obj_frames","j","push","behaviors","value","label","posture","Type","SELECT","ChangeTable","fabric","require","BoundingBox","top","left","width","height","color","behavior","Rect","hasRotatingPoint","uniScaleTransform","fill","borderColor","opacity","Text","toString","fontSize","canvas","group","Group","addWithUpdate","rectangle","id_text","toObject","temp","propertiesToInclude","util","object","extend","call","local_id","add","on","obj","circle","target","item","scaleX","scaleY","set","isDown","origX","origY","o","pointer","getPointer","e","x","y","rect_temp","originX","originY","angle","transparentCorners","Math","abs","renderAll","off","FrameBoundingBox","frame_data","canvas_width","canvas_height","video_height","vide_width","windowWidth","windowHeight","bounding_boxes","random","curr_box","getTop","getLeft","getWidth","getHeight","generate_no_behavior","data","floor","$","Segmentation","activeLine","polygonMode","pointArray","Array","lineArray","activeShape","forEachObject","selectable","prototypefabric","selection","options","polygon","generatePolygon","addPoint","class","x2","y2","points","get","drawPolygon","Date","getTime","Circle","radius","stroke","strokeWidth","layerX","getZoom","layerY","hasBorders","hasControls","objectCaching","line","Line","evented","pos","Polygon","remove","polyPoint","each","index","point","Instructions","Storage","alert","columns","dataField","text","headerStyle","editCellStyle","cell","row","rowIndex","colIndex","backgroundColor","editor","type","CHECKBOX","formatter","cellContent","className","onClick","annotation_data","currentFrame","splice","fabricCanvas","getObjects","createReactClass","num_frames","scaling_factor_width","scaling_factor_height","skip_value","window","screen","current_screen_height","Canvas","video_width","Fabric","componentDidMount","el","ReactDOM","findDOMNode","initialize","save_data","render","upload","disable_buttons","sliderPercent","toast_text","previous_annotation","previous_canvas_annotation","ANNOTATOR_NAME","ANNOTATION_VIDEO_NAME","toJSON","MainUpload","useState","visualToggle","setVisualToggle","save_previous_data","annotationType","setAnnotationType","boxCount","setBoxCount","addToCanvas","global_id","status","current","generate_polygon","fire","getActiveObject","videoFilePath","setVideoFileURL","oldAnnotation","setOldAnnotation","useEffect","getAllObjectByFrame","downloadOldAnnotation","file","Promise","resolve","reject","reader","FileReader","onload","JSON","parse","result","readAsText","files","playing","setPlaying","handlePlaying","event","play_button_text","setSeeking","player","setPlayer","duration","setDuration","scrubbing","setScrubbing","skip_frame_forward","stringify","total_frames","getCurrentTime","seekTo","skip_frame_backward","downloadFile","a","fileName","json","blob","Blob","URL","createObjectURL","href","link","document","createElement","download","body","appendChild","click","removeChild","show","setShow","handleClose","save","changeSave","keyCheck","changeKeyCheck","onKeyPress","key","annotext","addEventListener","removeEventListener","loadFromJSON","Navbar","bg","variant","Brand","Nav","Link","NavDropdown","disabled","title","Item","Divider","defaultValue","onChange","parseInt","Form","style","float","File","custom","then","accept","Button","position","Toast","onClose","delay","autohide","zIndex","Header","Modal","onHide","size","closeButton","Title","Body","Footer","display","gridColumn","gridRow","onProgress","val","round","bbox","generate_frame","setActiveObject","ref","videoWidth","videoHeight","onDuration","url","controls","volume","muted","pip","min","max","step","onMouseDown","parseFloat","onMouseUp","keyField","table","noDataIndication","cellEdit","cellEditFactory","mode","blurToSave","afterSaveCell","oldValue","newValue","column","onStartEdit","columnIndex","pagination","paginationFactory","Boolean","location","hostname","match","getElementById","navigator","serviceWorker","ready","registration","unregister","catch","error","message"],"mappings":"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","file":"static/js/main.e70e1d00.chunk.js","sourcesContent":["export default class AnnotationProcessing {\n    constructor(annotation_json){\n        this.objects = annotation_json['objects']\n        console.log(this.objects)\n    }\n\n    getObjects() {\n        return this.objects\n    }\n\n    getObjectById(id) {\n        return this.objects[id]\n    }\n\n    getObjectByIdFrame(id, frame_num){\n        return this.objects[id][frame_num]\n    }\n\n    getAllObjectByFrame(frame_num){\n        var i;\n        var objects_frame = []\n        for (i = 0; i < this.objects.length; i++){\n            var curr_obj = this.objects[i]\n            if(curr_obj['frames'][curr_obj['frames'].length-1]['frameNumber'] < frame_num){\n                continue;\n            }\n            var curr_obj_frames = curr_obj['frames'];\n            for (var j = 0; j < curr_obj_frames.length; j++){\n                if(curr_obj_frames[j]['frameNumber'] === frame_num){\n                    objects_frame.push(curr_obj_frames[j]);\n                    break;\n                }\n            }\n        }\n        console.log(objects_frame)\n        return objects_frame;\n    }\n\n}\n\n","const behaviors = [{\n  value: 'inactive',\n  label: 'Inactive'\n},{\n  value: 'walking',\n  label: 'Walking'\n},{\n  value: 'running',\n  label: 'Running'\n},{\n  value: 'play_solo',\n  label: 'Play Solo'\n},{\n  value: 'play_social',\n  label: 'Play Social'\n},{\n  value: 'head_tossing',\n  label: 'Head Tossing'\n},{\n  value: 'interacting',\n  label: 'Interacting with pen features'\n},{\n  value: 'drinking',\n  label: 'Drinking'\n},{\n  value: 'eating',\n  label: 'Eating'\n},{\n  value: 'fighting',\n  label: 'Fighting'\n},{\n  value: 'defacating',\n  label: 'Defacating'\n},{\n  value: 'other_active',\n  label: 'Other'\n},{\n  value: 'unknown',\n  label: 'Unknown'\n},]\n\nexport {behaviors};","const posture = [{\n    value: 'Lying sternally',\n    label: 'lying_sternally'\n  }, {\n    value: 'Sitting',\n    label: 'sitting'\n  }, {\n    value: 'Standing',\n    label: 'standing'\n  }, {\n    value: 'Walking ',\n    label: 'walking'\n  }, {\n    value: 'Consumption',\n    label: 'consumption'\n  }]\n\n  export {posture}","import React, { useState } from \"react\"; \nimport 'bootstrap/dist/css/bootstrap.min.css';\n\nimport BootstrapTable from 'react-bootstrap-table-next';\nimport cellEditFactory, { Type } from 'react-bootstrap-table2-editor';\nimport 'react-bootstrap-table-next/dist/react-bootstrap-table2.min.css';\n\nimport {behaviors} from '../../static_data/behaviors'\nimport {posture} from '../../static_data/posture'\n\nconst columns = [{\n    dataField: \"id\",\n    text: \"ID\"\n},{\n    dataField: \"behavior\",\n    text: \"Beh\",\n    editor: {\n        type: Type.SELECT,\n        options: behaviors\n      }\n},{\n    dataField: \"is_hidden\",\n    text: \"Hid\"\n},{\n    dataField: \"posture\",\n    text: \"Pos\",\n    editor: {\n        type: Type.SELECT,\n        options: posture\n      }\n}]\n\nfunction json_to_table_ANIKET(data){\n    var ret = []\n    if(data == null){\n        return []\n    }\n    for(var i = 0; i < data['objects'].length; i++){\n        const elem_id = i + 1\n        var curr_obj = data['objects'][i]\n        console.log(curr_obj['left'])\n        ret.push({id: elem_id.toString(), behavior: \"None\", is_hidden: \"False\", posture: \"None\"})        \n    }\n    return ret\n}\n\nfunction json_to_table(data){\n    var ret = []\n    if (data == null){\n        return []\n    }\n    for(var i = 0; i < data.length; i++){\n        ret.push(data[i].generate_row())\n    }\n    \n\n    return ret\n}\n\nfunction ChangeTable(input){\n    //console.log(input.data)\n    const data = json_to_table(input.data)\n    return (\n        <div style={{width: \"15%\"}}>\n            <BootstrapTable condensed={true} keyField='id' data={data} columns={ columns } cellEdit={ cellEditFactory({ mode: 'click', blurToSave: true }) }/>\n        </div>\n    )\n}\n\nexport default ChangeTable;","import { grep } from \"jquery\";\n\nconst fabric = require(\"fabric\").fabric;\n\nclass BoundingBox {\n    constructor(top, left, width, height, color, id, behavior) {\n        this.top = top;\n        this.left = left;\n        this.id = id;\n        this.behavior = behavior;\n        this.color = color;\n        this.width = width;\n        this.height = height;\n    }\n\n    rectangle(){\n        return new fabric.Rect({\n            hasRotatingPoint: false,\n            uniScaleTransform: true,\n            height: this.height,\n            width: this.width,\n            fill: this.color,\n            borderColor: '#000',\n            opacity: '.4',\n            top: this.top,\n            left: this.left,\n        });\n    } \n\n    //TODO Add text scaling\n    id_text(){\n        return new fabric.Text(this.id.toString(), {\n            fontSize: 20,\n            top: this.top,\n            left: this.left,\n            uniScaleTransform: false,\n          });\n    }\n\n    behavior(){\n\n    }\n\n    generate_no_behavior(canvas){\n        var group = new fabric.Group();\n        group.addWithUpdate(this.rectangle())\n        group.addWithUpdate(this.id_text())\n        \n        var temp = this.id \n        group.toObject = (function(toObject) {\n            return function(propertiesToInclude) {\n                return fabric.util.object.extend(toObject.call(this, propertiesToInclude), {\n                    local_id: temp\n                });\n            };\n        })(group.toObject);\n        //console.log(group.toJSON())\n\n        canvas.add(group)\n\n        function onChange(obj) {\n            var circle = obj.target.item(1),\n                group = obj.target,\n                scaleX = group.width / (group.width * group.scaleX),\n                scaleY = group.height / (group.height * group.scaleY);\n            circle.set('scaleX', scaleX);\n            circle.set('scaleY', scaleY);\n        }\n        canvas.on({\n            'object:scaling': onChange\n        })\n        return group\n    }\n\n    generate_mouse_no_behavior(canvas){\n        var group, isDown, origX, origY;\n\n        var temp_id = new fabric.Text(this.id.toString(), {\n            fontSize: 20,\n            top: this.top,\n            left: this.left,\n            uniScaleTransform: false,\n          });\n\n        canvas.on('mouse:down', function(o){\n            isDown = true;\n            var pointer = canvas.getPointer(o.e);\n            origX = pointer.x;\n            origY = pointer.y;\n            var pointer = canvas.getPointer(o.e);\n            var rect_temp = new fabric.Rect({\n                left: origX,\n                top: origY,\n                originX: 'left',\n                originY: 'top',\n                width: pointer.x-origX,\n                height: pointer.y-origY,\n                angle: 0,\n                fill: 'rgba(255,0,0,0.5)',\n                transparentCorners: false,\n                uniScaleTransform: true\n            });\n            group = rect_temp\n\n\n            canvas.add(group)\n        });\n        \n        canvas.on('mouse:move', function(o){\n            if (!isDown) return;\n            var pointer = canvas.getPointer(o.e);\n            \n            if(origX>pointer.x){\n                group.set({ left: Math.abs(pointer.x) });\n            }\n            if(origY>pointer.y){\n                group.set({ top: Math.abs(pointer.y) });\n            }\n            \n            group.set({ width: Math.abs(origX - pointer.x) });\n            group.set({ height: Math.abs(origY - pointer.y) });\n            \n            \n            canvas.renderAll();\n        });\n        \n        canvas.on('mouse:up', function(o){\n          isDown = false;\n          canvas.off('mouse:down')\n          canvas.off('mouse:up')\n        });\n    }\n\n    generate_with_behavior(){\n\n    }\n}\n\n\nfunction genetate_bounding_box(){\n\n}\n\nexport {BoundingBox, genetate_bounding_box}","import { BoundingBox } from \"./bounding_box\"\n\nclass FrameBoundingBox {\n    constructor(frame_data, canvas_width, canvas_height, video_height, vide_width){\n        this.frame_data = frame_data;\n        this.canvas_width = canvas_width;\n        this.canvas_height = canvas_height;\n        this.windowWidth = vide_width;\n        this.windowHeight = video_height;\n    }\n\n    generate_frame(){\n        var bounding_boxes = []\n        for (var i = 0; i < this.frame_data.length; i++){\n            var color = \"#\" + ((1<<24)*Math.random() | 0).toString(16)\n            console.log(this.frame_data[i])\n            var curr_box = new BoundingBox(this.getTop(this.frame_data[i]), this.getLeft(this.frame_data[i]), this.getWidth(this.frame_data[i]), this.getHeight(this.frame_data[i]), color, i, \"TEST\").generate_no_behavior()\n            bounding_boxes.push(curr_box);\n        }\n        return bounding_boxes\n    }\n\n    getID(data){\n        return data['id']\n    }\n\n    getWidth(data){\n        return Math.floor((data['bbox']['width']/this.windowWidth)*this.canvas_width)\n    }\n\n    getHeight(data){\n        return Math.floor((data['bbox']['height']/this.windowHeight)*this.canvas_height)\n    }\n\n    getTop(data){\n        return Math.floor((data['bbox']['y']/this.windowHeight)*this.canvas_height)\n    }\n\n    getLeft(data){\n        return Math.floor((data['bbox']['x']/this.windowWidth)*this.canvas_width)\n    }\n\n\n}\n\nexport {FrameBoundingBox}","const fabric = require(\"fabric\").fabric;\nconst $ = require(\"jquery\")\n\nclass Segmentation {\n    generate_polygon(canvas, id){\n        var min = 99;\n        var max = 999999;\n        var polygonMode = true;\n        var pointArray = new Array();\n        var lineArray = new Array();\n\n        var activeLine;\n        var activeShape = false;\n\n        canvas.forEachObject(function(object){ \n            object.selectable = false; \n        });\n\n        var prototypefabric = new function () {\n                //canvas = window._canvas = new fabric.Canvas('c');\n                //canvas.setWidth($(window).width());\n                //canvas.setHeight($(window).height()-$('#nav-bar').height());\n                canvas.selection = false;\n        \n                canvas.on('mouse:down', function (options) {\n                    if(options.target && options.target.id === pointArray[0].id){\n                        prototypefabric.polygon.generatePolygon(pointArray);\n                    }\n                    if(polygonMode){\n                        prototypefabric.polygon.addPoint(options);\n                    }\n                });\n                canvas.on('mouse:up', function (options) {\n        \n                });\n                canvas.on('mouse:move', function (options) {\n                    if(activeLine && activeLine.class == \"line\"){\n                        var pointer = canvas.getPointer(options.e);\n                        activeLine.set({ x2: pointer.x, y2: pointer.y });\n        \n                        var points = activeShape.get(\"points\");\n                        points[pointArray.length] = {\n                            x:pointer.x,\n                            y:pointer.y\n                        }\n                        activeShape.set({\n                            points: points\n                        });\n                        canvas.renderAll();\n                    }\n                    canvas.renderAll();\n                });\n        }();\n        \n        \n        \n        prototypefabric.polygon = {\n            drawPolygon : function() {\n                polygonMode = true;\n                pointArray = new Array();\n                lineArray = new Array();\n            },\n            addPoint : function(options) {\n                var random = Math.floor(Math.random() * (max - min + 1)) + min;\n                var id = new Date().getTime() + random;\n                var circle = new fabric.Circle({\n                    radius: 5,\n                    fill: '#ffffff',\n                    stroke: '#333333',\n                    strokeWidth: 0.5,\n                    left: (options.e.layerX/canvas.getZoom()),\n                    top: (options.e.layerY/canvas.getZoom()),\n                    selectable: false,\n                    hasBorders: false,\n                    hasControls: false,\n                    originX:'center',\n                    originY:'center',\n                    id:id,\n                        objectCaching:false\n                });\n                if(pointArray.length === 0){\n                    circle.set({\n                        fill:'red'\n                    })\n                }\n                var points = [(options.e.layerX/canvas.getZoom()),(options.e.layerY/canvas.getZoom()),(options.e.layerX/canvas.getZoom()),(options.e.layerY/canvas.getZoom())];\n                var line = new fabric.Line(points, {\n                    strokeWidth: 2,\n                    fill: '#999999',\n                    stroke: '#999999',\n                    class:'line',\n                    originX:'center',\n                    originY:'center',\n                    selectable: false,\n                    hasBorders: false,\n                    hasControls: false,\n                    evented: false,\n                        objectCaching:false\n                });\n                if(activeShape){\n                    var pos = canvas.getPointer(options.e);\n                    var points = activeShape.get(\"points\");\n                    points.push({\n                        x: pos.x,\n                        y: pos.y\n                    });\n                    var polygon = new fabric.Polygon(points,{\n                        stroke:'#333333',\n                        strokeWidth:1,\n                        fill: '#cccccc',\n                        opacity: 0.3,\n                        selectable: false,\n                        hasBorders: false,\n                        hasControls: false,\n                        evented: false,\n                        objectCaching:false\n                    });\n                    canvas.remove(activeShape);\n                    canvas.add(polygon);\n                    activeShape = polygon;\n                    canvas.renderAll();\n                }\n                else{\n                    var polyPoint = [{x:(options.e.layerX/canvas.getZoom()),y:(options.e.layerY/canvas.getZoom())}];\n                    var polygon = new fabric.Polygon(polyPoint,{\n                        stroke:'#333333',\n                        strokeWidth:1,\n                        fill: '#cccccc',\n                        opacity: 0.3,\n                        selectable: false,\n                        hasBorders: false,\n                        hasControls: false,\n                        evented: false,\n                        objectCaching:false\n                    });\n                    activeShape = polygon;\n                    canvas.add(polygon);\n                }\n                activeLine = line;\n        \n                pointArray.push(circle);\n                lineArray.push(line);\n        \n                canvas.add(line);\n                canvas.add(circle);\n                canvas.selection = false;\n            },\n            generatePolygon : function(pointArray){\n                var points = new Array();\n                $.each(pointArray,function(index,point){\n                    points.push({\n                        x:point.left,\n                        y:point.top\n                    });\n                    canvas.remove(point);\n                });\n                $.each(lineArray,function(index,line){\n                    canvas.remove(line);\n                });\n\n                console.log(pointArray)\n                console.log(lineArray)\n\n\n                var group = new fabric.Group()\n                for (var i = 0; i < pointArray.length; i++){\n                    group.addWithUpdate(pointArray[i])\n                    group.addWithUpdate(lineArray[i])\n                }\n                \n                /*group.addWithUpdate(new fabric.Text(id.toString(), {\n                    fontSize: 20,\n                    centerX: \"center\",\n                    top: pointArray[0].top,\n                    left: pointArray[0].left, \n                    uniScaleTransform: false,\n                  }));\n                */\n               //To add custom id\n                group.toObject = (function(toObject) {\n                    return function(propertiesToInclude) {\n                        return fabric.util.object.extend(toObject.call(this, propertiesToInclude), {\n                            local_id: id\n                        });\n                    };\n                })(group.toObject);\n\n                canvas.add(group)\n                  \n                canvas.remove(activeLine);\n                canvas.remove(activeShape)\n                //canvas.add(polygon);\n        \n                activeLine = null;\n                activeShape = null;\n                polygonMode = false;\n                canvas.selection = true;\n\n                canvas.forEachObject(function(object){ \n                    object.selectable = true; \n                });\n\n                return group\n            }\n        };\n        \n        \n        //return prototypefabric.polygon.drawPolygon();\n    }\n}\n\nexport {Segmentation}","const fabric = require(\"fabric\").fabric;\n\nclass KeyPoint {\n    //TODO Optimize this code. Right now there is a significant performance penalty if there are multiple keypoints on the canvas\n    generate_stick(canvas){\n        fabric.Object.prototype.originX = fabric.Object.prototype.originY = 'center';\n\n        function makeCircle(left, top, line1, line2, line3, line4) {\n            var c = new fabric.Circle({\n            left: left,\n            top: top,\n            strokeWidth: 2.5,\n            radius: 6,\n            fill: '#fff',\n            stroke: '#666'\n            });\n            c.hasControls = c.hasBorders = false;\n\n            c.line1 = line1;\n            c.line2 = line2;\n            c.line3 = line3;\n            c.line4 = line4;\n\n            return c;\n        }\n\n        function makeLine(coords) {\n            return new fabric.Line(coords, {\n            fill: 'red',\n            stroke: 'red',\n            strokeWidth: 5,\n            selectable: true,\n            evented: false,\n            });\n        }\n\n        var line = makeLine([ 250, 200, 250, 175 ]),\n            line2 = makeLine([ 250, 175, 250, 250 ]),\n            line3 = makeLine([ 250, 250, 300, 350]),\n            line4 = makeLine([ 250, 250, 200, 350]),\n            line5 = makeLine([ 250, 175, 175, 225 ]),\n            line6 = makeLine([ 250, 175, 325, 225 ]);\n\n        canvas.add(line, line2, line3, line4, line5, line6);\n\n        canvas.add(\n            makeCircle(line.get('x1'), line.get('y1'), null, line),\n            makeCircle(line.get('x2'), line.get('y2'), line, line2, line5, line6),\n            makeCircle(line2.get('x2'), line2.get('y2'), line2, line3, line4),\n            makeCircle(line3.get('x2'), line3.get('y2'), line3),\n            makeCircle(line4.get('x2'), line4.get('y2'), line4),\n            makeCircle(line5.get('x2'), line5.get('y2'), line5),\n            makeCircle(line6.get('x2'), line6.get('y2'), line6)\n        );\n\n        canvas.on('object:moving', function(e) {\n            var p = e.target;\n            p.line1 && p.line1.set({ 'x2': p.left, 'y2': p.top });\n            p.line2 && p.line2.set({ 'x1': p.left, 'y1': p.top });\n            p.line3 && p.line3.set({ 'x1': p.left, 'y1': p.top });\n            p.line4 && p.line4.set({ 'x1': p.left, 'y1': p.top });\n            canvas.renderAll();\n        });\n    }   \n\n\n    generate_poly(canvas){\n        \n    }\n}\n\nexport {KeyPoint}","import React, { useState } from \"react\"; \n\nexport default function Instructions(){\n    return (\n        <div>\n        <h3>Keybinds:</h3>\n\n        There are preset keybinds setup to make it easier to use the tool without having to click around. If done properly a combination of mouse and keyboard actions speed up the annotation process. \n        <br></br><br></br>\n        * <kbd>1</kbd> : Mode Switch: Bounding Box<br></br>\n        * <kbd>2</kbd> : Mode Switch: Key Point<br></br>\n        * <kbd>3</kbd> : Mode Switch: Segmentation<br></br>\n        * <kbd>a</kbd> : Add annotation<br></br>\n        * <kbd>r</kbd> : Remove selected annotation<br></br>\n        * <kbd>q</kbd> : Skip backward frame(s)<br></br>\n        * <kbd>s</kbd> : Save annotation<br></br>\n        * <kbd>w</kbd> : Pause/Play<br></br>\n        * <kbd>e</kbd> : Skip forward frame(s)<br></br>\n\n        <br></br><br></br>\n        <h3>Uploading Video:</h3>\n\n        Ensure that you know the framerate, vertical and horizontal resolution of the video chosen to be annotated. These values should be entered into the settings tab into their respective fields. \n        <br></br><br></br>\n        Click on the right side browse button. All other buttons on the screen shuold be disabled until the video has been uploaded. Currenntly ```.mp4``` format is the best choice and tested for. \n        <br></br><br></br>\n        <h3>Annotations</h3>\n        <br></br>\n        There are currently three kinds of annotations. \n        <br></br><br></br>\n        <h4>Bounding Box:</h4>\n\n        This forms a square around the desired object. There should be small squares at the edges of the bounding box which can be used to resize the box. The number on the top left of the box is used to identify the placement of the box in the table to the right.\n        <br></br><br></br>\n        <h4>Key Point:</h4>\n\n        This generates an object with multiple points and lines attached to each other. They should be arranged around the obejct where the singular circle with one connecting line is the head and progress to each of the other limbs. \n\n        ***Note: This feature is currently in development and there will be bugs in using this.***\n        <br></br><br></br>\n        <h4>Segmentation:</h4>\n\n        Upon generating this each click on the video generates a point which eventually will transform to a set of interconnected points. To complete the polygon click on the original point generated (which is the red colored point)\n\n        ***Note: Unline the Bounding Box, segmentation cant be edited after generated. To fix a mistake remove the annotation and continue from the start.***\n\n        </div>\n    )\n}","import React, { useEffect, useState } from \"react\"; \nimport ReactDOM from 'react-dom'\nimport ReactPlayer from 'react-player'\nimport 'bootstrap/dist/css/bootstrap.min.css';\n\nimport Button from 'react-bootstrap/Button'\nimport Navbar from 'react-bootstrap/Navbar'\nimport Nav from 'react-bootstrap/Nav'\nimport Modal from 'react-bootstrap/Modal'\nimport Form from 'react-bootstrap/Form'\nimport Toast from 'react-bootstrap/Toast'\n\n\nimport AnnotationProcessing from '../../backend_processing/annotation-processing'\nimport ChangeTable from '../Components/change_table'\nimport { NavDropdown } from \"react-bootstrap\";\n\n//Custom implemented classes\nimport { BoundingBox } from '../../backend_processing/bounding_box'\nimport { FrameBoundingBox } from '../../backend_processing/frame_bounding_box'\nimport { KeyPoint } from '../../backend_processing/key_point'\nimport { Segmentation } from '../../backend_processing/segmentation'\nimport { Annotation } from '../../backend_processing/annotation'\nimport Instructions from \"../Components/instructions\";\n\nimport BootstrapTable from 'react-bootstrap-table-next';\nimport cellEditFactory, { Type } from 'react-bootstrap-table2-editor';\nimport 'react-bootstrap-table-next/dist/react-bootstrap-table2.min.css';\nimport paginationFactory from 'react-bootstrap-table2-paginator';\nimport { CSVExport } from 'react-bootstrap-table2-toolkit';\n\nimport {behaviors} from '../../static_data/behaviors_LPS'\nimport {posture} from '../../static_data/posture'\nimport {status} from '../../static_data/status'\n//import {columns} from '../../static_data/columns' //TODO re-add columns\n\n//TODO add local storage functionality to auto-save\nif (typeof(Storage) === \"undefined\") {\n  // Code for localStorage/sessionStorage.\n  alert('Your browser does not support local storage. \\nSome autosaving features of the app will not work as intended.\\nPlease see the documentation to find supported browsers and their versions')\n} \n\nconst columns = [{\n  dataField: \"id\",\n  text: \"ID\",\n  headerStyle: () => { return { width: \"40px\", left: 0 }; }\n},{\n  dataField: \"global_id\",\n  text: \"Glo\",\n  headerStyle: () => { return { width: \"50px\", left: 0}; },\n  editCellStyle: (cell, row, rowIndex, colIndex) => {\n    const backgroundColor = cell > 2101 ? '#00BFFF' : '#00FFFF';\n    return { backgroundColor };\n  }\n},{\n  dataField: \"status\",\n  text: \"Status\",\n  editor: {\n      type: Type.SELECT,\n      options: status\n    }\n},{\n  dataField: \"current\",\n  text: \"Curr\",\n  editor: {\n    type: Type.CHECKBOX,\n    value: 'Start:Stop'\n  },\n  headerStyle: () => { return { width: \"60px\", left: 0}; },\n},{\n  dataField: \"behavior\",\n  text: \"Behavior\",\n  editor: {\n      type: Type.SELECT,\n      options: behaviors,\n  }\n},{\n  dataField: \"remove\",\n  text: \"Del\",\n  headerStyle: () => { return { width: \"50px\", left: 0}; },\n  formatter: (cellContent, row) => {\n    return (\n      <button\n        className=\"btn btn-danger btn-xs\"\n          onClick={() => remove_table_index(row.id)}\n          label=\"Del\"\n        >\n      </button>\n    );\n  },\n}\n]\n\nfunction remove_table_index(index){\n  annotation_data[currentFrame].splice(index, 1)\n  console.log(fabricCanvas.getObjects()[index])\n  //fabricCanvas.remove(fabricCanvas.getObjects()[index].remove());\n  //fabricCanvas.fire('saveData');\n  \n}\n\n\nconst ANNOTATION_FRAME = \"1\"\nconst ANNOTATION_BBOX = \"2\"\nconst ANNOTATION_KEYPOINT = \"3\"\nconst ANNOTATION_SEG = \"4\"\n\nconst fabric = require(\"fabric\").fabric;\nconst createReactClass = require('create-react-class');\n\n\n//TODO ADD DYNAMIC SOLUTION \nvar frame_rate = 15;\nvar num_frames = -1;\nvar scaling_factor_width = 1920;\nvar scaling_factor_height = 1080;\nvar skip_value = 1;\n\nconsole.log(window.screen.width)\nconsole.log(window.screen.height)\n\nvar current_screen_width = window.screen.width;\nvar current_screen_height = window.screen.height;\n\n//Mappings are based off of https://en.wikipedia.org/wiki/List_of_common_resolutions make sure to use 1:1 and 16:9 aspect ratio\nif (current_screen_height >= 1440){\n  scaling_factor_width = 1920;\n  scaling_factor_height = 1080;\n}else if(current_screen_height >= 1080){\n  scaling_factor_width = 1280;\n  scaling_factor_height = 720;\n}else if(current_screen_height >= 1024){\n  scaling_factor_width = 1152;\n  scaling_factor_height = 648;\n}else if(current_screen_height >= 768){\n  scaling_factor_width = 1024;\n  scaling_factor_height = 576;\n}\n\n\n// globally accessable fabricCanvas instance\nvar fabricCanvas = new fabric.Canvas('c', {uniScaleTransform: true});\n\nvar video_width = 0;\nvar video_height = 0;\n\nvar Fabric = createReactClass({\n\tcomponentDidMount() {\n  \tvar el = ReactDOM.findDOMNode(this);\n\n    //alert(\"Loaded player: \\nHorizontal Resolution = \" + scaling_factor_width + \"\\nVertical Resolution = \" + scaling_factor_height)\n    // Here we have the canvas so we can initialize fabric\n    fabricCanvas.initialize(el, {\n    \theight: scaling_factor_height,\n      width: scaling_factor_width,\n      backgroundColor : null,\n    });\n    \n    // on mouse up lets save some state\n    fabricCanvas.on('mouse:up', () => {\n      save_data(currentFrame)\n    });\n\n    fabricCanvas.on('object:added', save_data(currentFrame));\n    fabricCanvas.on('object:removed', save_data(currentFrame));\n    fabricCanvas.on('object:modified', save_data(currentFrame));\n    \n    // an event we will fire when we want to save state\n    fabricCanvas.on('saveData', () => {\n      fabricCanvas.renderAll(); // programatic changes we make will not trigger a render in fabric\n    });\n  }, \n  render() {\n    return <canvas></canvas>\n  }\n});\n\nvar frame_data = [[]];\nvar annotation_data = [[]];\nvar upload = false;\nvar disable_buttons = true;\nvar currentFrame = 0;\nvar sliderPercent = 0\nvar toast_text = \"\"\nvar previous_annotation = []\nvar previous_canvas_annotation = []\nvar ANNOTATOR_NAME = \"\"\nvar ANNOTATION_VIDEO_NAME = \"\"\n\n\nfunction save_data(frame_num){\n  frame_data[frame_num] = fabricCanvas.toJSON()\n  console.log(\"SAVED\")\n  console.log(frame_data[frame_num])\n}\n\n\n//Current frame counter\nfunction MainUpload() {\n  \n  const [visualToggle, setVisualToggle] = useState(false);\n\n  const save_previous_data = () => {\n    if(annotation_data[currentFrame].length == 0){\n      return;\n    }\n    console.log(annotation_data[currentFrame].length === 0)\n    console.log(\"saved annotation\")\n    previous_annotation = annotation_data[currentFrame]\n    previous_canvas_annotation = frame_data[currentFrame]\n  }\n\n  const [annotationType, setAnnotationType] = useState(\"1\")\n  const handleAnnotationType = (event) => {\n    console.log(event.target.value)\n  }\n  \n  const [boxCount, setBoxCount] = useState(0)\n  const addToCanvas = () =>{\n    var color = \"#\" + ((1<<24)*Math.random() | 0).toString(16)\n    \n    if(annotation_data[currentFrame] == null){\n      annotation_data[currentFrame] = []\n    }\n    \n    if (annotationType === ANNOTATION_BBOX){\n      annotation_data[currentFrame].push({id: boxCount+'b', global_id: null,status: \"None\", current: \"Start\", behavior: \"None\"})\n      var new_bbox = new BoundingBox(fabricCanvas.height/2, fabricCanvas.width/2, 50, 50, color, boxCount+'b', \"None\").generate_no_behavior(fabricCanvas)\n    }else if (annotationType === ANNOTATION_KEYPOINT){\n      //TODO fix KeyPoint\n      alert(\"KeyPoint annotation are currently unavailable\")\n      //annotation_data[currentFrame].push({id: boxCount+'k', behavior: \"None\", is_hidden: 0, posture: \"None\"})\n      //var keyp = new KeyPoint().generate_stick(fabricCanvas)\n    }else if (annotationType === ANNOTATION_SEG){\n      annotation_data[currentFrame].push({id: boxCount+'s', global_id:null, status: \"None\", current: \"Start\", behavior: \"None\"})\n      var segment = new Segmentation().generate_polygon(fabricCanvas, boxCount+'s')\n    }else if(annotationType === ANNOTATION_FRAME){\n      //TODO Add annotation frame datapoint\n      annotation_data[currentFrame].push({id: boxCount+'f', global_id: null,status: \"None\", current: \"Start\", behavior: \"None\"})\n    }\n    save_data(currentFrame)\n    setBoxCount(boxCount + 1);\n    fabricCanvas.fire('saveData');\n  }\n\n  const remove = () => {\n    setBoxCount(boxCount + 1)\n    var index = fabricCanvas.getActiveObject().toJSON()['local_id']\n    console.log(fabricCanvas.getActiveObject().toJSON())\n    for(var i = 0; i < annotation_data[currentFrame].length; i++){\n      if (annotation_data[currentFrame][i]['id'] === index){\n        annotation_data[currentFrame].splice(i, 1)\n        break;\n      }\n    }\n    fabricCanvas.remove(fabricCanvas.getActiveObject());\n    fabricCanvas.fire('saveData');\n  }\n\n  const [videoFilePath, setVideoFileURL] = useState(null);\n  const handleVideoUpload = (event) => {\n    setVideoFileURL(URL.createObjectURL(event.target.files[0]));\n    console.log(event.target.files[0])\n    ANNOTATION_VIDEO_NAME = event.target.files[0]['name']\n    upload = true;\n  };\n\n  //Code for dual video upload option. Currently disabled\n  const [videoFilePath1, setVideoFileURL1] = useState(null);\n  const handleVideoUpload1 = (event) => {\n    setVideoFileURL1(URL.createObjectURL(event.target.files[0]));\n  };\n  \n  //ASYNC Function  - To note that the data that comes out of this will be a bit delayed and this could cause some issues.\n  const [oldAnnotation, setOldAnnotation] = useState(null)\n  const handleOldAnnotation = (event) => {\n      var promise = downloadOldAnnotation(event)\n      promise.then(function (result) {\n        if(result != null){\n          setOldAnnotation(new AnnotationProcessing(result));\n        }else{\n          console.log(\"ERROR in upload old_annotation\")\n        }\n      })\n  }\n\n  useEffect(() => {\n    //TODO Find a more elegant solution. This is a temporay patch work.\n    if(oldAnnotation == null){\n      return;\n    }\n    console.log(oldAnnotation)\n    console.log(oldAnnotation.getAllObjectByFrame(2));\n  }, oldAnnotation);\n\n  const downloadOldAnnotation = (file) => {\n    return new Promise((resolve, reject) => {\n      var reader = new FileReader();\n      reader.onload = function(e) {\n         resolve((JSON.parse(e.target.result)));\n      }\n      reader.readAsText(file.target.files[0])\n    })\n  }\n  \n\n  const [playing, setPlaying] = useState(false);\n  const handlePlaying = (event) => {\n    setPlaying(!playing)\n  }\n\n  var play_button_text = \"ERROR\"\n  if(playing === true){\n    play_button_text = \"Pause\"\n  }else{\n  play_button_text = \"Play\"\n  }\n\n  const [seeking, setSeeking] = useState(false)\n\n\n  const handleSeekChange = e => {\n    sliderPercent = (parseFloat(e.target.value))\n  }\n\n  const handleSeekMouseDown = e => {\n    setSeeking(true)\n  }\n\n  const handleSeekMouseUp = e => {\n    setSeeking(false)\n    player.seekTo(parseFloat(e.target.value))\n  }\n\n  const [player, setPlayer] = useState(null)\n  const handleSetPlayer = val => {\n    //console.log(val)\n    if(val != null){\n      if(val['player'] != null){\n        if(val['player']['player'] != null){\n          if(val['player']['player'] != null){\n            video_width = val['player']['player']['player'].videoWidth\n            video_height = val['player']['player']['player'].videoHeight\n            var duration = val['player']['player']['player'].duration\n            //alert(\"*Loaded player* \\nHorizontal Resolution = \" + video_width + \"\\nVertical Resolution = \" + video_height + \"\\nFrame Rate: \" + frame_rate + \" FPS\\nDuration: \" + duration + \" seconds\")\n          }\n        }\n      }\n    }\n    setPlayer(val)\n  }\n\n  //TODO Autoset resolution\n  \n\n\n  const [duration, setDuration] = useState(0);\n  const handleSetDuration = val => {\n    if(upload === true && player != null){      \n      console.log(\"Initializing...\")\n      num_frames = Math.round(val * frame_rate);\n\n      frame_data = new Array(num_frames)\n      annotation_data = new Array(num_frames)\n\n      //TODO Update this later\n      for (var i = 0; i < num_frames; i++){\n        frame_data[i] = []\n        annotation_data[i] = []\n      }\n      upload = false;\n      disable_buttons = false\n    }\n    setDuration(parseInt(val))\n    console.log(val)\n  }\n\n\n  const handleSetCurrentFrame = val => {\n    save_data(currentFrame)\n    var total_frames = duration * frame_rate\n    currentFrame = (val['played']/total_frames)\n    currentFrame = (Math.round(val['played']*total_frames))\n    setVisualToggle(!visualToggle)\n    if(oldAnnotation != null){ \n      //fabricCanvas.clear();\n      var bbox = new FrameBoundingBox(oldAnnotation.getAllObjectByFrame(currentFrame), scaling_factor_width, scaling_factor_height).generate_frame()\n      for(var i = 0; i < bbox.length; i++){\n        var curr_obj = bbox[i]\n        console.log(curr_obj)\n        fabricCanvas.add(curr_obj);\n        fabricCanvas.setActiveObject(curr_obj);\n        fabricCanvas.fire('saveData');\n      }\n    }\n\n  }\n\n  const [scrubbing, setScrubbing] = useState(true);\n\n  const skip_frame_forward = e =>{\n    save_previous_data()\n    if(scrubbing === false){\n      if (annotation_data[currentFrame+skip_value].length == 0){\n        annotation_data[currentFrame+skip_value] = JSON.parse(JSON.stringify(annotation_data[currentFrame]));\n        frame_data[currentFrame+skip_value] = frame_data[currentFrame];\n        console.log(\"Carryover annotation\")\n      }\n    }\n\n    var total_frames = duration * frame_rate\n    console.log((((player.getCurrentTime()/duration)*total_frames))/(total_frames) + (skip_value/total_frames))\n    player.seekTo((((player.getCurrentTime()/duration)*total_frames))/(total_frames) + (skip_value/total_frames))\n  }\n\n  const skip_frame_backward = e => {\n    save_previous_data()\n    var total_frames = duration * frame_rate\n    player.seekTo((((player.getCurrentTime()/duration)*total_frames))/(total_frames) - (skip_value/total_frames))\n  }\n\n  const downloadFile = async () => {\n    var fileName = \"generated_annotations\";\n    if(ANNOTATION_VIDEO_NAME !== \"\" && ANNOTATOR_NAME !== \"\"){\n      fileName = ANNOTATION_VIDEO_NAME + \"_\" +  ANNOTATOR_NAME\n    }\n    //const json = JSON.stringify(fabricCanvas.getObjects());\n    const json = JSON.stringify({\"annotations\": frame_data, \"behavior_data\": annotation_data})\n    //var json = JSON.stringify(frame_data);\n    var blob = new Blob([json],{type:'application/json'});\n    var href = await URL.createObjectURL(blob);\n    var link = document.createElement('a');\n    link.href = href;\n    link.download = fileName + \".json\";\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n\n\n  }\n\n  const [show, setShow] = useState(false);\n\n  const handleClose = () => setShow(false);\n  const handleShow = () => setShow(true);\n\n  const [save, changeSave] = useState(false);\n  \n  const [keyCheck, changeKeyCheck] = useState(true)\n  const handle_key_check = (event) => {\n    changeKeyCheck(!keyCheck)\n    console.log(\"Changing keyCheck to: \" + keyCheck)\n  }\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const onKeyPress = (event) =>{\n    //Making sure input for textbox doesnt get counted as a mode change\n    if(keyCheck == false){\n      return;\n    }\n    //TODO Add keystroke disabling when typing in values in other parts\n\n    if (event.key === ANNOTATION_BBOX){\n      toast_text = \"Mode Switch: Bounding Box\"\n      changeSave(true)\n      setAnnotationType(ANNOTATION_BBOX)\n    }else if (event.key === ANNOTATION_KEYPOINT){\n      toast_text = \"Mode Switch: Key Point\"\n      changeSave(true)\n      setAnnotationType(ANNOTATION_KEYPOINT)\n    }else if(event.key === ANNOTATION_SEG) {\n      toast_text = \"Mode Switch: Segmentation\"\n      changeSave(true)\n      setAnnotationType(ANNOTATION_SEG)\n    }else if(event.key === ANNOTATION_FRAME){\n      toast_text = \"Mode Switch: Behavior Annotation\"\n      changeSave(true)\n      setAnnotationType(ANNOTATION_FRAME)\n    }else if (event.key === \"a\"){\n      var annotext = \"\"\n      if(annotationType === ANNOTATION_BBOX){\n        annotext = \"Bounding Box\"\n      }else if(annotationType === ANNOTATION_FRAME){\n        annotext = \"Behavior Data\"\n      }else if (annotationType === ANNOTATION_KEYPOINT){\n        annotext = \"Keypoint\"\n      }else if (annotationType === ANNOTATION_SEG){\n        annotext = \"Segmentation\"\n      }\n      toast_text = \"Added Annotation - \" + annotext\n      changeSave(true)\n      addToCanvas()\n    }else if (event.key === \"r\"){\n      toast_text = \"Removed Annotation\"\n      changeSave(true)\n      remove()\n    }else if (event.key === \"q\"){\n      skip_frame_backward()\n    }else if (event.key === \"w\"){\n      handlePlaying()\n    }else if (event.key === \"e\"){\n      skip_frame_forward()\n    }else if (event.key === \"s\"){\n      toast_text = \"Annotation Saved\"\n      changeSave(true)\n      frame_data[currentFrame] = fabricCanvas.toJSON()\n    }else if (event.key === \"f\"){\n      if(scrubbing === false){\n        toast_text = \"Scrubbing Mode Activated\"\n        setScrubbing(true)\n        changeSave(true)\n      }else{\n        toast_text = \"Scrubbing Mode Deactivated\"\n        setScrubbing(false)\n        changeSave(true)\n      }\n    }else if(event.key === \"c\"){\n      toast_text = \"Copying previous frame annotation\"\n      annotation_data[currentFrame] = previous_annotation\n      frame_data[currentFrame] = previous_canvas_annotation\n      changeSave(true)\n    }\n  }  \n\n  const [test, changeTest] = useState(false);\n \n  useEffect(() => {\n    document.addEventListener(\"keydown\", onKeyPress);\n    return () => document.removeEventListener(\"keydown\", onKeyPress);\n  }, [onKeyPress]);\n  \n  fabricCanvas.loadFromJSON(frame_data[currentFrame], function() {\n    fabricCanvas.renderAll();\n  });\n\n  /*\n    <NavDropdown disabled={disable_buttons} title=\"Mode\" id=\"basic-nav-dropdown\">\n    <NavDropdown.Item onClick={setAnnotationType(ANNOTATION_BBOX)} >Square Box</NavDropdown.Item>\n    <NavDropdown.Divider />\n    <NavDropdown.Item onClick={setAnnotationType(ANNOTATION_KEYPOINT)}>Key Point</NavDropdown.Item>\n    <NavDropdown.Divider />\n    <NavDropdown.Item onClick={setAnnotationType(ANNOTATION_SEG)}>Segmentation</NavDropdown.Item>\n  </NavDropdown>\n  */ \n\n  return (\n    <div>\n      <Navbar bg=\"dark\" variant=\"dark\" className=\"bg-5\">\n          <Navbar.Brand href=\"#home\">Annotation Tool</Navbar.Brand>\n          <Nav className=\"mr-auto\">\n              <Nav.Link onClick={handleShow}>Instructions</Nav.Link>\n\n\n\n              <NavDropdown disabled={disable_buttons} title=\"Export\" id=\"basic-nav-dropdown\">\n                <NavDropdown.Item onClick={downloadFile}>JSON</NavDropdown.Item>\n                <NavDropdown.Divider />\n                <NavDropdown.Item >CSV</NavDropdown.Item>\n              </NavDropdown>\n\n              <NavDropdown title=\"Settings\" id=\"basic-nav-dropdown\">\n                <NavDropdown.Divider />\n                Frame Rate: <input type=\"number\" defaultValue=\"15\"></input>\n                <NavDropdown.Divider />\n                Horizontal Res: <input type='number' defaultValue={video_width}></input>\n                <NavDropdown.Divider />\n                Vertical Res: <input type='number' defaultValue={video_height}></input>\n                <NavDropdown.Divider />\n                Skip Value: <input type='number' defaultValue=\"1\" onChange={(event) => {skip_value = parseInt(event.target.value)}}></input>\n                <NavDropdown.Divider />\n                Annotator Name: <input type='text' defaultValue=\"\" onChange={(event) => {ANNOTATOR_NAME = (event.target.value)}}></input>\n                </NavDropdown>\n          </Nav>\n\n          <div>\n            <Form style={{float: \"left\", width: 80}}>\n              <Form.File disabled={disable_buttons} id=\"file\" label=\"Annotation Upload\" custom type=\"file\" onChange={handleOldAnnotation}/>\n            </Form>\n            <Form style={{float: \"left\", width: 80}}>\n              <Form.File id=\"file\" label=\"Video Upload\" accept=\".mp4\" custom type=\"file\" onChange={handleVideoUpload} />\n            </Form>\n            <Button variant=\"secondary\" disabled={true}>Frame # {parseInt(currentFrame)+' / '+parseInt(duration * frame_rate)}</Button>{' '}\n            <Button variant=\"primary\" disabled={disable_buttons} onClick={skip_frame_backward}>Prev</Button>{' '}\n            <Button variant=\"primary\" disabled={disable_buttons} onClick={handlePlaying}>{play_button_text}</Button>{' '}\n            <Button variant=\"primary\" disabled={disable_buttons} onClick={skip_frame_forward}>Next</Button>{' '}\n            <Button variant=\"success\" disabled={disable_buttons} onClick={addToCanvas} style={{position:\"relative\"}}>Add</Button>{' '}\n            <Button variant=\"danger\" onClick={remove} disabled={disable_buttons} style={{position:\"relative\"}}>Remove</Button>{' '}\n          </div>\n      </Navbar>\n      <Toast onClose={() => changeSave(false)} show={save} delay={500} autohide\n          style={{\n            position: 'absolute',\n            top: 0,\n            left: '40%',\n            zIndex: 100\n          }}>\n        <Toast.Header>\n          <strong className=\"mr-auto\">{toast_text}</strong>\n        </Toast.Header>\n      </Toast>\n      <Modal show={show} onHide={handleClose} size='lg'>\n          <Modal.Header closeButton>\n          <Modal.Title>Instructions</Modal.Title>\n          </Modal.Header>\n          <Modal.Body><Instructions></Instructions></Modal.Body>\n          <Modal.Footer>\n          <Button variant=\"secondary\" onClick={handleClose}>Close</Button>\n          </Modal.Footer>\n      </Modal>\n      <div style={{display: \"grid\"}}>\n        <div style={{gridColumn: 1, gridRow:1, position: \"relative\", width: scaling_factor_width, height: scaling_factor_height, top: 0, left: 0}}>\n          <ReactPlayer \n            onProgress={handleSetCurrentFrame} \n            ref={handleSetPlayer} \n            onDuration={handleSetDuration} \n            url={videoFilePath} \n            width='100%'\n            height='99.999%'\n            playing={playing} \n            controls={false} \n            style={{position:'absolute', float:'left', top:0, left:0}}\n            volume={0}\n            muted={true}\n            pip={false}\n          />\n        </div>\n        <div style={{gridColumn: 1, gridRow:1, position: \"relative\",  top: 0, left: 0}}>\n          <Fabric/>\n        </div>\n        <div style={{gridColumn: 1, gridRow:2, position: \"relative\", width: scaling_factor_width, top: 0, left: 0}}>\n\n          <input\n            style={{width: scaling_factor_width}}\n            type='range' min={0} max={0.999999} step='any'\n            value={sliderPercent}\n            onMouseDown={handleSeekMouseDown}\n            onChange={handleSeekChange}\n            onMouseUp={handleSeekMouseUp}\n          />\n        </div>\n        <div style={{gridColumn: 2, gridRow:1, position: \"relative\",width: scaling_factor_width*.4, height: scaling_factor_height, top: 0, left: 0}}>\n          <div>\n            <BootstrapTable\n              keyField='id'\n              data={annotation_data[currentFrame]} \n              columns={ columns }\n              table\n              noDataIndication={ () => <div>No recorded annotations or behaviors for this frame<br/>Please add an annotation or behavior tag to start.</div> }\n              cellEdit={\n                cellEditFactory({ mode: 'click', blurToSave: true,\n                  afterSaveCell: (oldValue, newValue, row, column) => {\n                    //console.log(annotation_data[currentFrame][row['id']])\n                    annotation_data[currentFrame][row['id']] = row\n                    changeKeyCheck(true)\n                  },\n                  onStartEdit: (row, column, rowIndex, columnIndex) => {\n                    changeKeyCheck(false)\n                  }\n                }) \n              }\n              pagination={ paginationFactory() }\n            />\n            </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n\nexport default MainUpload;","const status = [{\n    value: 'Stationary',\n    label: 'Stationary'\n},{\n    value: 'Minor',\n    label: 'Minor'\n},{\n    value: 'Stationary Transition',\n    label: 'Stationary Transition'\n},{\n    value: 'Active Transition',\n    label: 'Active Transition'\n},{\n    value: 'Active',\n    label: 'Active'\n},{\n    value: 'Event',\n    label: 'Event'\n}]\n\nexport {status}","const behaviors = [{\n    value: 'Other',\n    label: 'Other'\n},{\n    value: 'Lying',\n    label: 'Lying'\n},{\n    value: 'Standing',\n    label: 'Standing'\n},{\n    value: 'Sitting',\n    label: 'Sitting'\n},{\n    value: 'Kneeling',\n    label: 'Kneeling'\n},{\n    value: 'Scar',\n    label: 'Scar'\n},{\n    value: 'Facial',\n    label: 'Facial'\n},{\n    value: 'Skin',\n    label: 'Skin'\n},{\n    value: 'Walking',\n    label: 'Walking'\n},{\n    value: 'Running',\n    label: 'Running'\n},{\n    value: 'Transitioning',\n    label: 'Transitioning'\n},{\n    value: 'Exploring',\n    label: 'Exploring'\n},{\n    value: 'Selfplay',\n    label: 'Selfplay'\n},{\n    value: 'Aggression',\n    label: 'Aggression'\n},{\n    value: 'Defecation',\n    label: 'Defecation'\n},{\n    value: 'Urination',\n    label: 'Urination'\n},{\n    value: 'Drinking',\n    label: 'Drinking'\n},{\n    value: 'Feeding',\n    label: 'Feeding'\n}\n]\n\nexport {behaviors};","import React, { useEffect, useState } from \"react\"; \nimport ReactDOM from 'react-dom'\nimport ReactPlayer from 'react-player'\nimport 'bootstrap/dist/css/bootstrap.min.css';\n\nimport Button from 'react-bootstrap/Button'\nimport Navbar from 'react-bootstrap/Navbar'\nimport Nav from 'react-bootstrap/Nav'\nimport Modal from 'react-bootstrap/Modal'\nimport Form from 'react-bootstrap/Form'\nimport Toast from 'react-bootstrap/Toast'\n\n\nimport AnnotationProcessing from '../../backend_processing/annotation-processing'\nimport ChangeTable from '../Components/change_table'\nimport { NavDropdown } from \"react-bootstrap\";\n\n//Custom implemented classes\nimport { BoundingBox } from '../../backend_processing/bounding_box'\nimport { FrameBoundingBox } from '../../backend_processing/frame_bounding_box'\nimport { KeyPoint } from '../../backend_processing/key_point'\nimport { Segmentation } from '../../backend_processing/segmentation'\nimport { Annotation } from '../../backend_processing/annotation'\n\nimport BootstrapTable from 'react-bootstrap-table-next';\nimport cellEditFactory, { Type } from 'react-bootstrap-table2-editor';\nimport 'react-bootstrap-table-next/dist/react-bootstrap-table2.min.css';\nimport {behaviors} from '../../static_data/behaviors'\nimport {posture} from '../../static_data/posture'\n\n\nconst columns = [{\n  dataField: \"id\",\n  text: \"ID\"\n},{\n  dataField: \"global_id\",\n  text: \"Glo\"\n},{\n  dataField: \"behavior\",\n  text: \"Beh\",\n  editor: {\n      type: Type.SELECT,\n      options: behaviors\n    }\n},{\n  dataField: \"is_hidden\",\n  text: \"Hid\"\n},{\n  dataField: \"posture\",\n  text: \"Pos\",\n  editor: {\n      type: Type.SELECT,\n      options: posture\n    }\n}]\n\n\nconst fabric = require(\"fabric\").fabric;\nconst createReactClass = require('create-react-class');\n\n\n//TODO ADD DYNAMIC SOLUTION \nvar frame_rate = 15;\nvar num_frames = 7200;\nvar scaling_factor_height = 1080;\nvar scaling_factor_width = 1920;\nvar skip_value = 1;\n\nconsole.log(window.screen.width)\nconsole.log(window.screen.height)\n\nvar current_screen_width = window.screen.width;\nvar current_screen_height = window.screen.height;\n\nif (current_screen_height >= 1440){\n  scaling_factor_height = 1080;\n  scaling_factor_width = 1920;\n}else if(current_screen_height <= 1024){\n  scaling_factor_height = 648;\n  scaling_factor_width = 1152;\n}\n\n// globally accessable fabricCanvas instance\nvar fabricCanvas = new fabric.Canvas('c', {uniScaleTransform: true});\n\n\nvar Fabric = createReactClass({\n\tcomponentDidMount() {\n  \tvar el = ReactDOM.findDOMNode(this);\n    \n    // Here we have the canvas so we can initialize fabric\n    fabricCanvas.initialize(el, {\n    \theight: scaling_factor_height,\n      width: scaling_factor_width,\n      backgroundColor : null,\n    });\n    \n    // on mouse up lets save some state\n    fabricCanvas.on('mouse:up', () => {\n      //frame_data[global_currFrame] = fabricCanvas.toJSON()\n    });\n\n    \n    // an event we will fire when we want to save state\n    fabricCanvas.on('saveData', () => {\n      fabricCanvas.renderAll(); // programatic changes we make will not trigger a render in fabric\n    });\n  }, \n  render() {\n    return <canvas></canvas>\n  }\n});\n\nvar frame_data = [[]];\nvar annotation_data = [[]];\nvar upload = false;\nvar disable_buttons = true;\nvar global_currFrame = 0;\nvar toast_text = \"\"\n\n//Current frame counter\nfunction MainYoutube() {\n  \n  const [annotationType, setAnnotationType] = useState(0)\n  const handleAnnotationType = (event) => {\n    console.log(event.target.value)\n  }\n  \n  const [boxCount, setBoxCount] = useState(0)\n  const addToCanvas = () =>{\n    var color = \"#\" + ((1<<24)*Math.random() | 0).toString(16)\n    \n    if(annotation_data[currentFrame] == null){\n      annotation_data[currentFrame] = []\n    }\n\n    if (annotationType === 0){\n      annotation_data[currentFrame].push({id: boxCount, global_id: -1,behavior: \"None\", is_hidden: 0, posture: \"None\"})\n      var new_bbox = new BoundingBox(fabricCanvas.height/2, fabricCanvas.width/2, 50, 50, color, boxCount, \"None\", fabricCanvas).generate_mouse_no_behavior(fabricCanvas)\n      //annotation_data[currentFrame].push(new Annotation(boxCount, \"None\", \"None\", 0,0, new_bbox))\n      //fabricCanvas.add(new_bbox)\n      //fabricCanvas.setActiveObject(new_bbox);\n    }else if (annotationType === 1){\n      annotation_data[currentFrame].push({id: boxCount, behavior: \"None\", is_hidden: 0, posture: \"None\"})\n      var keyp = new KeyPoint().generate_stick(fabricCanvas)\n    }else if (annotationType === 2){\n      annotation_data[currentFrame].push({id: boxCount, behavior: \"None\", is_hidden: 0, posture: \"None\"})\n      var segment = new Segmentation().generate_polygon(fabricCanvas, boxCount)\n    }\n\n    setBoxCount(boxCount + 1);\n    fabricCanvas.fire('saveData');\n  }\n\n  const remove = () => {\n    setBoxCount(boxCount + 1)\n    var index = fabricCanvas.getActiveObject().toJSON()['local_id']\n    console.log(fabricCanvas.getActiveObject().toJSON())\n    for(var i = 0; i < annotation_data[currentFrame].length; i++){\n      if (annotation_data[currentFrame][i]['id'] === index){\n        annotation_data[currentFrame].splice(i, 1)\n        break;\n      }\n    }\n    fabricCanvas.remove(fabricCanvas.getActiveObject());\n    fabricCanvas.fire('saveData');\n  }\n\n  const [videoFilePath, setVideoFileURL] = useState(null);\n  const handleVideoUpload = (event) => {\n    //console.log(oldAnnotation)\n    setVideoFileURL(URL.createObjectURL(event.target.files[0]));\n    upload = true;\n  };\n\n  //Code for dual video upload option. Currently disabled\n  const [videoFilePath1, setVideoFileURL1] = useState(null);\n  const handleVideoUpload1 = (event) => {\n    setVideoFileURL1(URL.createObjectURL(event.target.files[0]));\n  };\n  \n  //ASYNC Function  - To note that the data that comes out of this will be a bit delayed and this could cause some issues.\n  const [oldAnnotation, setOldAnnotation] = useState(null)\n  const handleOldAnnotation = (event) => {\n      var promise = downloadOldAnnotation(event)\n      promise.then(function (result) {\n        if(result != null){\n          setOldAnnotation(new AnnotationProcessing(result));\n        }else{\n          console.log(\"ERROR in upload old_annotation\")\n        }\n      })\n  }\n\n  useEffect(() => {\n    //TODO Find a more elegant solution. This is a temporay patch work.\n    if(oldAnnotation == null){\n      return;\n    }\n    console.log(oldAnnotation)\n    console.log(oldAnnotation.getAllObjectByFrame(2));\n  }, oldAnnotation);\n\n  const downloadOldAnnotation = (file) => {\n    return new Promise((resolve, reject) => {\n      var reader = new FileReader();\n      reader.onload = function(e) {\n         resolve((JSON.parse(e.target.result)));\n      }\n      reader.readAsText(file.target.files[0])\n    })\n  }\n  \n\n  const [playing, setPlaying] = useState(false);\n  const handlePlaying = (event) => {\n    setPlaying(!playing)\n  }\n\n  var play_button_text = \"ERROR\"\n  if(playing === true){\n    play_button_text = \"Pause\"\n  }else{\n  play_button_text = \"Play\"\n  }\n\n  const [seeking, setSeeking] = useState(false)\n  const [sliderPercent, setSliderPercent] = useState(0)\n\n  const handleSeekChange = e => {\n    setSliderPercent(parseFloat(e.target.value))\n  }\n\n  const handleSeekMouseDown = e => {\n    setSeeking(true)\n  }\n\n  const handleSeekMouseUp = e => {\n    setSeeking(false)\n    player.seekTo(parseFloat(e.target.value))\n  }\n\n  const [player, setPlayer] = useState(null)\n  const handleSetPlayer = val => {\n    setPlayer(val)\n    if(upload === true && player != null){      \n      console.log(\"RESET VALUES\")\n      frame_data = new Array(num_frames)\n      annotation_data = new Array(num_frames)\n      //TODO Update this later\n      for (var i = 0; i < 7200; i++){\n        frame_data[i] = []\n        annotation_data[i] = []\n      }\n      upload = false;\n      disable_buttons = false\n    }\n  }\n\n  const [duration, setDuration] = useState(0);\n  const handleSetDuration = val => {\n    setDuration(parseInt(val))\n    console.log(val)\n  }\n\n\n  const [currentFrame, setCurrentFrame] = useState(0)\n  const handleSetCurrentFrame = val => {\n    var total_frames = duration * frame_rate\n    setSliderPercent(currentFrame/total_frames)\n    setCurrentFrame(Math.round(val['played']*total_frames))\n    global_currFrame = currentFrame\n\n\n\n    if(oldAnnotation != null){ \n      fabricCanvas.clear();\n      var bbox = new FrameBoundingBox(oldAnnotation.getAllObjectByFrame(currentFrame), scaling_factor_width, scaling_factor_height).generate_frame()\n      for(var i = 0; i < bbox.length; i++){\n        var curr_obj = bbox[i]\n        console.log(curr_obj)\n        fabricCanvas.add(curr_obj);\n        fabricCanvas.setActiveObject(curr_obj);\n        fabricCanvas.fire('saveData');\n      }\n    }\n\n  }\n\n  const skip_frame_forward = e =>{\n    var total_frames = duration * frame_rate\n    player.seekTo((((player.getCurrentTime()/duration)*total_frames))/(total_frames) + (skip_value/total_frames))\n  }\n\n  const skip_frame_backward = e => {\n    var total_frames = duration * frame_rate\n    player.seekTo((((player.getCurrentTime()/duration)*total_frames))/(total_frames) - (skip_value/total_frames))\n  }\n\n  //frame_data[currentFrame] = fabricCanvas.toJSON()\n\n  const downloadFile = async () => {\n    var fileName = \"generated_annotations\";\n    //const json = JSON.stringify(fabricCanvas.getObjects());\n    var json = JSON.stringify(frame_data);\n    var blob = new Blob([json],{type:'application/json'});\n    var href = await URL.createObjectURL(blob);\n    var link = document.createElement('a');\n    link.href = href;\n    link.download = fileName + \".json\";\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n\n    fileName = \"generated_data\";\n    json = JSON.stringify(annotation_data);\n    blob = new Blob([json],{type:'application/json'});\n    href = await URL.createObjectURL(blob);\n    link = document.createElement('a');\n    link.href = href;\n    link.download = fileName + \".json\";\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  }\n\n  const [show, setShow] = useState(false);\n\n  const handleClose = () => setShow(false);\n  const handleShow = () => setShow(true);\n\n  const handleSquareBox = () => {\n    setAnnotationType(0);\n  }\n\n  const handleKeyPoint = () => {\n    setAnnotationType(1);\n  }\n\n  const handleSegmentation = () => {\n    setAnnotationType(2);\n  }\n\n  const [save, changeSave] = useState(false);\n  \n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const onKeyPress = (event) =>{\n    if(event.key === \"3\") {\n      toast_text = \"Mode Switch: Segmentation\"\n      changeSave(true)\n      handleSegmentation()\n    }else if (event.key === \"1\"){\n      toast_text = \"Mode Switch: Bounding Box\"\n      changeSave(true)\n      handleSquareBox()\n    }else if (event.key === \"2\"){\n      toast_text = \"Mode Switch: Key Point\"\n      changeSave(true)\n      handleKeyPoint()\n    }else if (event.key === \"a\"){\n      toast_text = \"Added Annotation\"\n      changeSave(true)\n      addToCanvas()\n    }else if (event.key === \"r\"){\n      toast_text = \"Removed Annotation\"\n      changeSave(true)\n      remove()\n    }else if (event.key === \"q\"){\n      skip_frame_backward()\n    }\n    else if (event.key === \"w\"){\n      handlePlaying()\n    }\n    else if (event.key === \"e\"){\n      skip_frame_forward()\n    }else if (event.key === \"s\"){\n      toast_text = \"Annotation Saved\"\n      changeSave(true)\n      frame_data[currentFrame] = fabricCanvas.toJSON()\n    }\n  }  \n \n  useEffect(() => {\n    document.addEventListener(\"keydown\", onKeyPress);\n    return () => document.removeEventListener(\"keydown\", onKeyPress);\n  }, [onKeyPress]);\n  \n  useEffect(() => {\n    fabricCanvas.clear()\n    if(frame_data[currentFrame] === [] | frame_data[currentFrame] == null){\n      annotation_data[currentFrame] = []\n    }\n    console.log(currentFrame)\n    fabricCanvas.loadFromJSON(frame_data[currentFrame], function() {\n      console.log(frame_data[currentFrame])\n      fabricCanvas.renderAll();\n    });\n  }, [currentFrame]);\n\n  return (\n    <div>\n      <Navbar bg=\"dark\" variant=\"dark\" className=\"bg-5\">\n          <Navbar.Brand href=\"#home\">Annotation Tool</Navbar.Brand>\n          <Nav className=\"mr-auto\">\n              <Nav.Link onClick={handleShow}>Instructions</Nav.Link>\n\n              <NavDropdown disabled={disable_buttons} title=\"Annotation Type\" id=\"basic-nav-dropdown\">\n                <NavDropdown.Item onClick={handleSquareBox} >Square Box</NavDropdown.Item>\n                <NavDropdown.Divider />\n                <NavDropdown.Item onClick={handleKeyPoint}>Key Point</NavDropdown.Item>\n                <NavDropdown.Divider />\n                <NavDropdown.Item onClick={handleSegmentation}>Segmentation</NavDropdown.Item>\n              </NavDropdown>\n\n              <NavDropdown disabled={disable_buttons} title=\"Export\" id=\"basic-nav-dropdown\">\n                <NavDropdown.Item onClick={downloadFile}>JSON</NavDropdown.Item>\n                <NavDropdown.Divider />\n                <NavDropdown.Item >CSV</NavDropdown.Item>\n              </NavDropdown>\n\n              <NavDropdown disabled={disable_buttons} title=\"Settings\" id=\"basic-nav-dropdown\">\n                <NavDropdown.Divider />\n                Frame Rate: <input type=\"number\" defaultValue=\"15\"></input>\n                <NavDropdown.Divider />\n                Horizontal Res: <input type='number' defaultValue=\"3840\"></input>\n                <NavDropdown.Divider />\n                Vertical Res: <input type='number' defaultValue=\"2178\"></input>\n                <NavDropdown.Divider />\n                Skip Value: <input type='number' defaultValue=\"1\" onChange={(event) => {skip_value = event.target.value}}></input>\n              </NavDropdown>\n          </Nav>\n\n          <div>\n            <Form style={{float: \"left\", width: 80}}>\n              <Form.File disabled={disable_buttons} id=\"file\" label=\"Annotation Upload\" custom type=\"file\" onChange={handleOldAnnotation}/>\n            </Form>\n            <Form style={{float: \"left\", width: 80}}>\n              <Form.File id=\"file\" label=\"Video Upload\" accept=\".mp4\" custom type=\"file\" onChange={handleVideoUpload} />\n            </Form>\n            <Button variant=\"secondary\" disabled={true}>Frame # {parseInt(currentFrame)+' / '+parseInt(duration * frame_rate)}</Button>{' '}\n            <Button variant=\"primary\" disabled={disable_buttons} onClick={skip_frame_backward}>Prev</Button>{' '}\n            <Button variant=\"primary\" disabled={disable_buttons} onClick={handlePlaying}>{play_button_text}</Button>{' '}\n            <Button variant=\"primary\" disabled={disable_buttons} onClick={skip_frame_forward}>Next</Button>{' '}\n            <Button variant=\"success\" disabled={disable_buttons} onClick={addToCanvas} style={{position:\"relative\"}}>Add</Button>{' '}\n            <Button variant=\"danger\" onClick={remove} disabled={disable_buttons} style={{position:\"relative\"}}>Remove</Button>{' '}\n          </div>\n      </Navbar>\n      <Toast onClose={() => changeSave(false)} show={save} delay={500} autohide\n          style={{\n            position: 'absolute',\n            top: '00%',\n            left: '50%',\n          }}>\n        <Toast.Header>\n          <strong className=\"mr-auto\">{toast_text}</strong>\n        </Toast.Header>\n      </Toast>\n      <Modal show={show} onHide={handleClose}>\n          <Modal.Header closeButton>\n          <Modal.Title>Instructions</Modal.Title>\n          </Modal.Header>\n          <Modal.Body>TODO: Add instructions</Modal.Body>\n          <Modal.Footer>\n          <Button variant=\"secondary\" onClick={handleClose}>Close</Button>\n          </Modal.Footer>\n      </Modal>\n      <div style={{display: \"grid\"}}>\n        <div style={{gridColumn: 1, gridRow:1, position: \"relative\", width: scaling_factor_width, height: scaling_factor_height, top: 0, left: 0}}>\n          <ReactPlayer \n            onProgress={handleSetCurrentFrame} \n            ref={handleSetPlayer} \n            onDuration={handleSetDuration} \n            url={\"https://www.youtube.com/watch?v=MF6J2H983HY\"} \n            width='100%'\n            height='99.999%'\n            playing={playing} \n            controls={false} \n            style={{position:'absolute', float:'left', top:0, left:0}}\n            volume={0}\n            muted={true}\n            pip={false}\n          />\n        </div>\n        <div style={{gridColumn: 1, gridRow:1, position: \"relative\", width: scaling_factor_width, height: scaling_factor_height, top: 0, left: 0}}>\n          <Fabric/>\n        </div>\n        <div style={{gridColumn: 1, gridRow:2, position: \"relative\", width: scaling_factor_width, top: 0, left: 0}}>\n\n          <input\n            style={{width: scaling_factor_width}}\n            type='range' min={0} max={0.999999} step='any'\n            value={sliderPercent}\n            onMouseDown={handleSeekMouseDown}\n            onChange={handleSeekChange}\n            onMouseUp={handleSeekMouseUp}\n          />\n        </div>\n        <div style={{gridColumn: 2, gridRow:1, position: \"relative\", width: scaling_factor_width, height: scaling_factor_height, top: 0, left: 0}}>\n          <div style={{width: \"25%\"}}>\n              <BootstrapTable \n                keyField='id' \n                data={annotation_data[currentFrame]} \n                columns={ columns } \n                cellEdit={ \n                  cellEditFactory({ mode: 'click', blurToSave: true, afterSaveCell: (oldValue, newValue, row, column) => {\n                    annotation_data[currentFrame][row['id']] = row\n                  } }) \n                }\n              />\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n\nexport default MainYoutube;","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nimport MainUpload from './ui_elements/Pages/main_upload'\nimport MainYoutube from './ui_elements/Pages/main_youtube'\n\nReactDOM.render(\n    <MainUpload></MainUpload>,\n  document.getElementById('root')\n);\n\n/**\n * IF NEED TO RE-ENABLE STRICT MODE THEN UNNCOMMENT AND ADD BACK\n * \n *   <React.StrictMode>\n    <MainUpload></MainUpload>\n  </React.StrictMode>,\n */\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}