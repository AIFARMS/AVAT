(this.webpackJsonpannotation_tool=this.webpackJsonpannotation_tool||[]).push([[0],{102:function(e,t,n){e.exports=n(188)},107:function(e,t,n){},108:function(e,t,n){},180:function(e,t){},181:function(e,t){},182:function(e,t){},188:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),i=n(13),l=n.n(i),r=(n(107),n(108),n(39)),c=n.n(r),s=(n(50),n(48),n(11),n(46)),u=n.n(s),d=n(62),h=n(6),f=n(12),g=n(37),v=n(38),m=n(22),b=n(29),y=n(49),p=n(23),w=n(24),E=function(){function e(t){Object(p.a)(this,e),this.objects=t.objects,console.log(this.objects)}return Object(w.a)(e,[{key:"getObjects",value:function(){return this.objects}},{key:"getObjectById",value:function(e){return this.objects[e]}},{key:"getObjectByIdFrame",value:function(e,t){return this.objects[e][t]}},{key:"getAllObjectByFrame",value:function(e){var t,n=[];for(t=0;t<this.objects.length;t++){var a=this.objects[t];if(!(a.frames[a.frames.length-1].frameNumber<e))for(var o=a.frames,i=0;i<o.length;i++)if(o[i].frameNumber===e){n.push(o[i]);break}}return console.log(n),n}}]),e}(),j=n(40),k=n.n(j),O=n(25),S=n.n(O),C=(n(83),[{value:"inactive",label:"Inactive"},{value:"walking",label:"Walking"},{value:"running",label:"Running"},{value:"play_solo",label:"Play Solo"},{value:"play_social",label:"Play Social"},{value:"head_tossing",label:"Head Tossing"},{value:"interacting",label:"Interacting with pen features"},{value:"drinking",label:"Drinking"},{value:"eating",label:"Eating"},{value:"fighting",label:"Fighting"},{value:"defacating",label:"Defacating"},{value:"other_active",label:"Other"},{value:"unknown",label:"Unknown"}]),_=[{value:"Lying sternally",label:"lying_sternally"},{value:"Sitting",label:"sitting"},{value:"Standing",label:"standing"},{value:"Walking ",label:"walking"},{value:"Consumption",label:"consumption"}];O.Type.SELECT,O.Type.SELECT;var x=n(196),T=(n(96),n(52).fabric),A=function(){function e(t,n,a,o,i,l,r){Object(p.a)(this,e),this.top=t,this.left=n,this.id=l,this.behavior=r,this.color=i,this.width=a,this.height=o}return Object(w.a)(e,[{key:"rectangle",value:function(){return new T.Rect({hasRotatingPoint:!1,uniScaleTransform:!0,height:this.height,width:this.width,fill:this.color,borderColor:"#000",opacity:".4",top:this.top,left:this.left})}},{key:"id_text",value:function(){return new T.Text(this.id.toString(),{fontSize:20,top:this.top,left:this.left,uniScaleTransform:!1})}},{key:"behavior",value:function(){}},{key:"generate_no_behavior",value:function(e){var t=new T.Group;t.addWithUpdate(this.rectangle()),t.addWithUpdate(this.id_text());var n,a=this.id;return t.toObject=(n=t.toObject,function(e){return T.util.object.extend(n.call(this,e),{local_id:a})}),e.add(t),t}},{key:"generate_mouse_no_behavior",value:function(e){var t,n,a,o;new T.Text(this.id.toString(),{fontSize:20,top:this.top,left:this.left,uniScaleTransform:!1});e.on("mouse:down",(function(i){n=!0;var l=e.getPointer(i.e);a=l.x,o=l.y;l=e.getPointer(i.e);var r=new T.Rect({left:a,top:o,originX:"left",originY:"top",width:l.x-a,height:l.y-o,angle:0,fill:"rgba(255,0,0,0.5)",transparentCorners:!1,uniScaleTransform:!0});t=r,e.add(t)})),e.on("mouse:move",(function(i){if(n){var l=e.getPointer(i.e);a>l.x&&t.set({left:Math.abs(l.x)}),o>l.y&&t.set({top:Math.abs(l.y)}),t.set({width:Math.abs(a-l.x)}),t.set({height:Math.abs(o-l.y)}),e.renderAll()}})),e.on("mouse:up",(function(t){n=!1,e.off("mouse:down"),e.off("mouse:up")}))}},{key:"generate_with_behavior",value:function(){}}]),e}();var N=function(){function e(t,n,a,o,i){Object(p.a)(this,e),this.frame_data=t,this.canvas_width=n,this.canvas_height=a,this.windowWidth=i,this.windowHeight=o}return Object(w.a)(e,[{key:"generate_frame",value:function(){for(var e=[],t=0;t<this.frame_data.length;t++){var n="#"+((1<<24)*Math.random()|0).toString(16);console.log(this.frame_data[t]);var a=new A(this.getTop(this.frame_data[t]),this.getLeft(this.frame_data[t]),this.getWidth(this.frame_data[t]),this.getHeight(this.frame_data[t]),n,t,"TEST").generate_no_behavior();e.push(a)}return e}},{key:"getID",value:function(e){return e.id}},{key:"getWidth",value:function(e){return Math.floor(e.bbox.width/this.windowWidth*this.canvas_width)}},{key:"getHeight",value:function(e){return Math.floor(e.bbox.height/this.windowHeight*this.canvas_height)}},{key:"getTop",value:function(e){return Math.floor(e.bbox.y/this.windowHeight*this.canvas_height)}},{key:"getLeft",value:function(e){return Math.floor(e.bbox.x/this.windowWidth*this.canvas_width)}}]),e}(),R=n(52).fabric,D=function(){function e(){Object(p.a)(this,e)}return Object(w.a)(e,[{key:"generate_stick",value:function(e){function t(e,t,n,a,o,i){var l=new R.Circle({left:e,top:t,strokeWidth:2.5,radius:6,fill:"#fff",stroke:"#666"});return l.hasControls=l.hasBorders=!1,l.line1=n,l.line2=a,l.line3=o,l.line4=i,l}function n(e){return new R.Line(e,{fill:"red",stroke:"red",strokeWidth:5,selectable:!0,evented:!1})}R.Object.prototype.originX=R.Object.prototype.originY="center";var a=n([250,200,250,175]),o=n([250,175,250,250]),i=n([250,250,300,350]),l=n([250,250,200,350]),r=n([250,175,175,225]),c=n([250,175,325,225]);e.add(a,o,i,l,r,c),e.add(t(a.get("x1"),a.get("y1"),null,a),t(a.get("x2"),a.get("y2"),a,o,r,c),t(o.get("x2"),o.get("y2"),o,i,l),t(i.get("x2"),i.get("y2"),i),t(l.get("x2"),l.get("y2"),l),t(r.get("x2"),r.get("y2"),r),t(c.get("x2"),c.get("y2"),c)),e.on("object:moving",(function(t){var n=t.target;n.line1&&n.line1.set({x2:n.left,y2:n.top}),n.line2&&n.line2.set({x1:n.left,y1:n.top}),n.line3&&n.line3.set({x1:n.left,y1:n.top}),n.line4&&n.line4.set({x1:n.left,y1:n.top}),e.renderAll()}))}},{key:"generate_poly",value:function(e){}}]),e}(),M=n(52).fabric,P=n(96),F=function(){function e(){Object(p.a)(this,e)}return Object(w.a)(e,[{key:"generate_polygon",value:function(e,t){var n,a=!0,o=new Array,i=new Array,l=!1;e.forEachObject((function(e){e.selectable=!1}));var r=new function(){e.selection=!1,e.on("mouse:down",(function(e){e.target&&e.target.id===o[0].id&&r.polygon.generatePolygon(o),a&&r.polygon.addPoint(e)})),e.on("mouse:up",(function(e){})),e.on("mouse:move",(function(t){if(n&&"line"==n.class){var a=e.getPointer(t.e);n.set({x2:a.x,y2:a.y});var i=l.get("points");i[o.length]={x:a.x,y:a.y},l.set({points:i}),e.renderAll()}e.renderAll()}))};r.polygon={drawPolygon:function(){a=!0,o=new Array,i=new Array},addPoint:function(t){var a=Math.floor(999901*Math.random())+99,r=(new Date).getTime()+a,c=new M.Circle({radius:5,fill:"#ffffff",stroke:"#333333",strokeWidth:.5,left:t.e.layerX/e.getZoom(),top:t.e.layerY/e.getZoom(),selectable:!1,hasBorders:!1,hasControls:!1,originX:"center",originY:"center",id:r,objectCaching:!1});0===o.length&&c.set({fill:"red"});var s=[t.e.layerX/e.getZoom(),t.e.layerY/e.getZoom(),t.e.layerX/e.getZoom(),t.e.layerY/e.getZoom()],u=new M.Line(s,{strokeWidth:2,fill:"#999999",stroke:"#999999",class:"line",originX:"center",originY:"center",selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1});if(l){var d=e.getPointer(t.e);(s=l.get("points")).push({x:d.x,y:d.y});var h=new M.Polygon(s,{stroke:"#333333",strokeWidth:1,fill:"#cccccc",opacity:.3,selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1});e.remove(l),e.add(h),l=h,e.renderAll()}else{var f=[{x:t.e.layerX/e.getZoom(),y:t.e.layerY/e.getZoom()}];h=new M.Polygon(f,{stroke:"#333333",strokeWidth:1,fill:"#cccccc",opacity:.3,selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1});l=h,e.add(h)}n=u,o.push(c),i.push(u),e.add(u),e.add(c),e.selection=!1},generatePolygon:function(o){var r=new Array;P.each(o,(function(t,n){r.push({x:n.left,y:n.top}),e.remove(n)})),P.each(i,(function(t,n){e.remove(n)})),console.log(o),console.log(i);for(var c,s=new M.Group,u=0;u<o.length;u++)s.addWithUpdate(o[u]),s.addWithUpdate(i[u]);return s.toObject=(c=s.toObject,function(e){return M.util.object.extend(c.call(this,e),{local_id:t})}),e.add(s),e.remove(n),e.remove(l),n=null,l=null,a=!1,e.selection=!0,e.forEachObject((function(e){e.selectable=!0})),s}}}}]),e}(),B=[{dataField:"id",text:"ID"},{dataField:"global_id",text:"Glo"},{dataField:"behavior",text:"Beh",editor:{type:O.Type.SELECT,options:C}},{dataField:"is_hidden",text:"Hid"},{dataField:"posture",text:"Pos",editor:{type:O.Type.SELECT,options:_}}],L=n(52).fabric,W=n(97),I=1080,U=1920,J=1;console.log(window.screen.width),console.log(window.screen.height);window.screen.width;var H=window.screen.height;H>=1440?(I=1080,U=1920):H<=1024&&(I=648,U=1152);var V=new L.Canvas("c",{uniScaleTransform:!0}),X=W({displayName:"Fabric",componentDidMount:function(){var e=l.a.findDOMNode(this);V.initialize(e,{height:I,width:U,backgroundColor:null}),V.on("mouse:up",(function(){$(q)})),V.on("object:added",$(q)),V.on("object:removed",$(q)),V.on("object:modified",$(q)),V.on("saveData",(function(){V.renderAll()}))},render:function(){return o.a.createElement("canvas",null)}}),Y=[[]],Z=[[]],z=!1,G=!0,q=0,K="";function $(e){Y[e]=V.toJSON(),console.log("SAVED")}var Q=function(){var e=Object(a.useState)(0),t=Object(h.a)(e,2),n=t[0],i=t[1],l=Object(a.useState)(0),r=Object(h.a)(l,2),s=r[0],p=r[1],w=function(){var e="#"+((1<<24)*Math.random()|0).toString(16);if(null==Z[ke]&&(Z[ke]=[]),$(ke),0===n){Z[ke].push({id:s,global_id:-1,behavior:"None",is_hidden:0,posture:"None"});new A(V.height/2,V.width/2,50,50,e,s,"None",V).generate_no_behavior(V)}else if(1===n){Z[ke].push({id:s,behavior:"None",is_hidden:0,posture:"None"});(new D).generate_stick(V)}else if(2===n){Z[ke].push({id:s,behavior:"None",is_hidden:0,posture:"None"});(new F).generate_polygon(V,s)}p(s+1),V.fire("saveData")},j=function(){p(s+1);var e=V.getActiveObject().toJSON().local_id;console.log(V.getActiveObject().toJSON());for(var t=0;t<Z[ke].length;t++)if(Z[ke][t].id===e){Z[ke].splice(t,1);break}V.remove(V.getActiveObject()),V.fire("saveData")},O=Object(a.useState)(null),C=Object(h.a)(O,2),_=C[0],T=C[1],R=Object(a.useState)(null),M=Object(h.a)(R,2),P=(M[0],M[1],Object(a.useState)(null)),L=Object(h.a)(P,2),W=L[0],H=L[1];Object(a.useEffect)((function(){null!=W&&(console.log(W),console.log(W.getAllObjectByFrame(2)))}),W);var Q=function(e){return new Promise((function(t,n){var a=new FileReader;a.onload=function(e){t(JSON.parse(e.target.result))},a.readAsText(e.target.files[0])}))},ee=Object(a.useState)(!1),te=Object(h.a)(ee,2),ne=te[0],ae=te[1],oe=function(e){ae(!ne)},ie="ERROR";ie=!0===ne?"Pause":"Play";var le=Object(a.useState)(!1),re=Object(h.a)(le,2),ce=(re[0],re[1]),se=Object(a.useState)(0),ue=Object(h.a)(se,2),de=ue[0],he=ue[1],fe=Object(a.useState)(null),ge=Object(h.a)(fe,2),ve=ge[0],me=ge[1],be=Object(a.useState)(0),ye=Object(h.a)(be,2),pe=ye[0],we=ye[1],Ee=Object(a.useState)(0),je=Object(h.a)(Ee,2),ke=je[0],Oe=je[1],Se=function(e){0==Y[ke+J].length&&(console.log(ke),Z[ke+J]=JSON.parse(JSON.stringify(Z[ke])),Y[ke+J]=Y[ke],console.log("Carryover annotation"));var t=15*pe;ve.seekTo(ve.getCurrentTime()/pe*t/t+J/t)},Ce=function(e){var t=15*pe;ve.seekTo(ve.getCurrentTime()/pe*t/t-J/t)},_e=function(){var e=Object(d.a)(u.a.mark((function e(){var t,n,a,o,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="generated_annotations",n=JSON.stringify(Y),a=new Blob([n],{type:"application/json"}),e.next=5,URL.createObjectURL(a);case 5:return o=e.sent,(i=document.createElement("a")).href=o,i.download=t+".json",document.body.appendChild(i),i.click(),document.body.removeChild(i),t="generated_data",n=JSON.stringify(Z),a=new Blob([n],{type:"application/json"}),e.next=17,URL.createObjectURL(a);case 17:o=e.sent,(i=document.createElement("a")).href=o,i.download=t+".json",document.body.appendChild(i),i.click(),document.body.removeChild(i);case 24:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),xe=Object(a.useState)(!1),Te=Object(h.a)(xe,2),Ae=Te[0],Ne=Te[1],Re=function(){return Ne(!1)},De=function(){i(0)},Me=function(){i(1)},Pe=function(){i(2)},Fe=Object(a.useState)(!1),Be=Object(h.a)(Fe,2),Le=Be[0],We=Be[1],Ie=function(e){"3"===e.key?(K="Mode Switch: Segmentation",We(!0),Pe()):"1"===e.key?(K="Mode Switch: Bounding Box",We(!0),De()):"2"===e.key?(K="Mode Switch: Key Point",We(!0),Me()):"a"===e.key?(K="Added Annotation",We(!0),w()):"r"===e.key?(K="Removed Annotation",We(!0),j()):"q"===e.key?Ce():"w"===e.key?oe():"e"===e.key?Se():"s"===e.key&&(K="Annotation Saved",We(!0),Y[ke]=V.toJSON())},Ue=Object(a.useState)(!1),Je=Object(h.a)(Ue,2);return Je[0],Je[1],Object(a.useEffect)((function(){return document.addEventListener("keydown",Ie),function(){return document.removeEventListener("keydown",Ie)}}),[Ie]),Object(a.useEffect)((function(){console.log(ke),console.log(Y),console.log(Z),V.loadFromJSON(Y[ke],(function(){V.renderAll()}))}),[ke]),o.a.createElement("div",null,o.a.createElement(g.a,{bg:"dark",variant:"dark",className:"bg-5"},o.a.createElement(g.a.Brand,{href:"#home"},"Annotation Tool"),o.a.createElement(v.a,{className:"mr-auto"},o.a.createElement(v.a.Link,{onClick:function(){return Ne(!0)}},"Instructions"),o.a.createElement(x.a,{disabled:G,title:"Annotation Type",id:"basic-nav-dropdown"},o.a.createElement(x.a.Item,{onClick:De},"Square Box"),o.a.createElement(x.a.Divider,null),o.a.createElement(x.a.Item,{onClick:Me},"Key Point"),o.a.createElement(x.a.Divider,null),o.a.createElement(x.a.Item,{onClick:Pe},"Segmentation")),o.a.createElement(x.a,{disabled:G,title:"Export",id:"basic-nav-dropdown"},o.a.createElement(x.a.Item,{onClick:_e},"JSON"),o.a.createElement(x.a.Divider,null),o.a.createElement(x.a.Item,null,"CSV")),o.a.createElement(x.a,{disabled:G,title:"Settings",id:"basic-nav-dropdown"},o.a.createElement(x.a.Divider,null),"Frame Rate: ",o.a.createElement("input",{type:"number",defaultValue:"15"}),o.a.createElement(x.a.Divider,null),"Horizontal Res: ",o.a.createElement("input",{type:"number",defaultValue:"3840"}),o.a.createElement(x.a.Divider,null),"Vertical Res: ",o.a.createElement("input",{type:"number",defaultValue:"2178"}),o.a.createElement(x.a.Divider,null),"Skip Value: ",o.a.createElement("input",{type:"number",defaultValue:"1",onChange:function(e){J=e.target.value}}))),o.a.createElement("div",null,o.a.createElement(b.a,{style:{float:"left",width:80}},o.a.createElement(b.a.File,{disabled:G,id:"file",label:"Annotation Upload",custom:!0,type:"file",onChange:function(e){Q(e).then((function(e){null!=e?H(new E(e)):console.log("ERROR in upload old_annotation")}))}})),o.a.createElement(b.a,{style:{float:"left",width:80}},o.a.createElement(b.a.File,{id:"file",label:"Video Upload",accept:".mp4",custom:!0,type:"file",onChange:function(e){T(URL.createObjectURL(e.target.files[0])),z=!0}})),o.a.createElement(f.a,{variant:"secondary",disabled:!0},"Frame # ",parseInt(ke)+" / "+parseInt(15*pe))," ",o.a.createElement(f.a,{variant:"primary",disabled:G,onClick:Ce},"Prev")," ",o.a.createElement(f.a,{variant:"primary",disabled:G,onClick:oe},ie)," ",o.a.createElement(f.a,{variant:"primary",disabled:G,onClick:Se},"Next")," ",o.a.createElement(f.a,{variant:"success",disabled:G,onClick:w,style:{position:"relative"}},"Add")," ",o.a.createElement(f.a,{variant:"danger",onClick:j,disabled:G,style:{position:"relative"}},"Remove")," ")),o.a.createElement(y.a,{onClose:function(){return We(!1)},show:Le,delay:500,autohide:!0,style:{position:"absolute",top:"00%",left:"50%"}},o.a.createElement(y.a.Header,null,o.a.createElement("strong",{className:"mr-auto"},K))),o.a.createElement(m.a,{show:Ae,onHide:Re},o.a.createElement(m.a.Header,{closeButton:!0},o.a.createElement(m.a.Title,null,"Instructions")),o.a.createElement(m.a.Body,null,"TODO: Add instructions"),o.a.createElement(m.a.Footer,null,o.a.createElement(f.a,{variant:"secondary",onClick:Re},"Close"))),o.a.createElement("div",{style:{display:"grid"}},o.a.createElement("div",{style:{gridColumn:1,gridRow:1,position:"relative",width:U,height:I,top:0,left:0}},o.a.createElement(c.a,{onProgress:function(e){$(ke);var t=15*pe;if(he(ke/t),Oe(Math.round(e.played*t)),q=Math.round(e.played*t),null!=W)for(var n=new N(W.getAllObjectByFrame(ke),U,I).generate_frame(),a=0;a<n.length;a++){var o=n[a];console.log(o),V.add(o),V.setActiveObject(o),V.fire("saveData")}},ref:function(e){if(me(e),!0===z&&null!=ve){console.log("Initializing..."),Y=new Array(7200),Z=new Array(7200);for(var t=0;t<7200;t++)Y[t]=[],Z[t]=[];z=!1,G=!1}},onDuration:function(e){we(parseInt(e)),console.log(e)},url:_,width:"100%",height:"99.999%",playing:ne,controls:!1,style:{position:"absolute",float:"left",top:0,left:0},volume:0,muted:!0,pip:!1})),o.a.createElement("div",{style:{gridColumn:1,gridRow:1,position:"relative",width:U,height:I,top:0,left:0}},o.a.createElement(X,null)),o.a.createElement("div",{style:{gridColumn:1,gridRow:2,position:"relative",width:U,top:0,left:0}},o.a.createElement("input",{style:{width:U},type:"range",min:0,max:.999999,step:"any",value:de,onMouseDown:function(e){ce(!0)},onChange:function(e){he(parseFloat(e.target.value))},onMouseUp:function(e){ce(!1),ve.seekTo(parseFloat(e.target.value))}})),o.a.createElement("div",{style:{gridColumn:2,gridRow:1,position:"relative",width:U,height:I,top:0,left:0}},o.a.createElement("div",{style:{width:"25%"}},o.a.createElement(k.a,{keyField:"id",data:Z[ke],columns:B,cellEdit:S()({mode:"click",blurToSave:!0,afterSaveCell:function(e,t,n,a){console.log(Z[ke][n.id]),Z[ke][n.id]=n}})})))))},ee=(n(100),O.Type.SELECT,O.Type.SELECT,n(52).fabric),te=n(97),ne=1080,ae=1920;console.log(window.screen.width),console.log(window.screen.height);window.screen.width;var oe=window.screen.height;oe>=1440?(ne=1080,ae=1920):oe<=1024&&(ne=648,ae=1152);var ie=new ee.Canvas("c",{uniScaleTransform:!0});te({displayName:"Fabric",componentDidMount:function(){var e=l.a.findDOMNode(this);ie.initialize(e,{height:ne,width:ae,backgroundColor:null}),ie.on("mouse:up",(function(){})),ie.on("saveData",(function(){ie.renderAll()}))},render:function(){return o.a.createElement("canvas",null)}});n(194),n(195);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(o.a.createElement(Q,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[102,1,2]]]);
//# sourceMappingURL=main.49ca8244.chunk.js.map